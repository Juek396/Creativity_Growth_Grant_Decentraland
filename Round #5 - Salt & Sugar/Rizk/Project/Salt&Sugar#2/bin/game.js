"use strict";var sd=Object.create;var ci=Object.defineProperty;var cd=Object.getOwnPropertyDescriptor;var ud=Object.getOwnPropertyNames;var fd=Object.getPrototypeOf,ld=Object.prototype.hasOwnProperty;var Ht=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),dd=(e,n)=>{for(var s in n)ci(e,s,{get:n[s],enumerable:!0})},Qs=(e,n,s,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of ud(n))!ld.call(e,a)&&a!==s&&ci(e,a,{get:()=>n[a],enumerable:!(t=cd(n,a))||t.enumerable});return e};var $e=(e,n,s)=>(s=e!=null?sd(fd(e)):{},Qs(n||!e||!e.__esModule?ci(s,"default",{value:e,enumerable:!0}):s,e)),pd=e=>Qs(ci({},"__esModule",{value:!0}),e);var Ks=Ht((vm,Js)=>{"use strict";Js.exports=hd;function hd(e,n){for(var s=new Array(arguments.length-1),t=0,a=2,r=!0;a<arguments.length;)s[t++]=arguments[a++];return new Promise(function(o,i){s[t]=function(p){if(r)if(r=!1,p)i(p);else{for(var m=new Array(arguments.length-1),f=0;f<m.length;)m[f++]=arguments[f];o.apply(null,m)}};try{e.apply(n||null,s)}catch(u){r&&(r=!1,i(u))}})}});var oc=Ht(nc=>{"use strict";var ui=nc;ui.length=function(n){var s=n.length;if(!s)return 0;for(var t=0;--s%4>1&&n.charAt(s)==="=";)++t;return Math.ceil(n.length*3)/4-t};var Mo=new Array(64),tc=new Array(123);for(Bn=0;Bn<64;)tc[Mo[Bn]=Bn<26?Bn+65:Bn<52?Bn+71:Bn<62?Bn-4:Bn-59|43]=Bn++;var Bn;ui.encode=function(n,s,t){for(var a=null,r=[],c=0,o=0,i;s<t;){var u=n[s++];switch(o){case 0:r[c++]=Mo[u>>2],i=(u&3)<<4,o=1;break;case 1:r[c++]=Mo[i|u>>4],i=(u&15)<<2,o=2;break;case 2:r[c++]=Mo[i|u>>6],r[c++]=Mo[u&63],o=0;break}c>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,r)),c=0)}return o&&(r[c++]=Mo[i],r[c++]=61,o===1&&(r[c++]=61)),a?(c&&a.push(String.fromCharCode.apply(String,r.slice(0,c))),a.join("")):String.fromCharCode.apply(String,r.slice(0,c))};var ec="invalid encoding";ui.decode=function(n,s,t){for(var a=t,r=0,c,o=0;o<n.length;){var i=n.charCodeAt(o++);if(i===61&&r>1)break;if((i=tc[i])===void 0)throw Error(ec);switch(r){case 0:c=i,r=1;break;case 1:s[t++]=c<<2|(i&48)>>4,c=i,r=2;break;case 2:s[t++]=(c&15)<<4|(i&60)>>2,c=i,r=3;break;case 3:s[t++]=(c&3)<<6|i,r=0;break}}if(r===1)throw Error(ec);return t-a};ui.test=function(n){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(n)}});var ic=Ht((bm,rc)=>{"use strict";rc.exports=fi;function fi(){this._listeners={}}fi.prototype.on=function(n,s,t){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:s,ctx:t||this}),this};fi.prototype.off=function(n,s){if(n===void 0)this._listeners={};else if(s===void 0)this._listeners[n]=[];else for(var t=this._listeners[n],a=0;a<t.length;)t[a].fn===s?t.splice(a,1):++a;return this};fi.prototype.emit=function(n){var s=this._listeners[n];if(s){for(var t=[],a=1;a<arguments.length;)t.push(arguments[a++]);for(a=0;a<s.length;)s[a].fn.apply(s[a++].ctx,t)}return this}});var dc=Ht((Em,lc)=>{"use strict";lc.exports=ac(ac);function ac(e){return typeof Float32Array<"u"?function(){var n=new Float32Array([-0]),s=new Uint8Array(n.buffer),t=s[3]===128;function a(i,u,p){n[0]=i,u[p]=s[0],u[p+1]=s[1],u[p+2]=s[2],u[p+3]=s[3]}function r(i,u,p){n[0]=i,u[p]=s[3],u[p+1]=s[2],u[p+2]=s[1],u[p+3]=s[0]}e.writeFloatLE=t?a:r,e.writeFloatBE=t?r:a;function c(i,u){return s[0]=i[u],s[1]=i[u+1],s[2]=i[u+2],s[3]=i[u+3],n[0]}function o(i,u){return s[3]=i[u],s[2]=i[u+1],s[1]=i[u+2],s[0]=i[u+3],n[0]}e.readFloatLE=t?c:o,e.readFloatBE=t?o:c}():function(){function n(t,a,r,c){var o=a<0?1:0;if(o&&(a=-a),a===0)t(1/a>0?0:2147483648,r,c);else if(isNaN(a))t(2143289344,r,c);else if(a>34028234663852886e22)t((o<<31|2139095040)>>>0,r,c);else if(a<11754943508222875e-54)t((o<<31|Math.round(a/1401298464324817e-60))>>>0,r,c);else{var i=Math.floor(Math.log(a)/Math.LN2),u=Math.round(a*Math.pow(2,-i)*8388608)&8388607;t((o<<31|i+127<<23|u)>>>0,r,c)}}e.writeFloatLE=n.bind(null,sc),e.writeFloatBE=n.bind(null,cc);function s(t,a,r){var c=t(a,r),o=(c>>31)*2+1,i=c>>>23&255,u=c&8388607;return i===255?u?NaN:o*(1/0):i===0?o*1401298464324817e-60*u:o*Math.pow(2,i-150)*(u+8388608)}e.readFloatLE=s.bind(null,uc),e.readFloatBE=s.bind(null,fc)}(),typeof Float64Array<"u"?function(){var n=new Float64Array([-0]),s=new Uint8Array(n.buffer),t=s[7]===128;function a(i,u,p){n[0]=i,u[p]=s[0],u[p+1]=s[1],u[p+2]=s[2],u[p+3]=s[3],u[p+4]=s[4],u[p+5]=s[5],u[p+6]=s[6],u[p+7]=s[7]}function r(i,u,p){n[0]=i,u[p]=s[7],u[p+1]=s[6],u[p+2]=s[5],u[p+3]=s[4],u[p+4]=s[3],u[p+5]=s[2],u[p+6]=s[1],u[p+7]=s[0]}e.writeDoubleLE=t?a:r,e.writeDoubleBE=t?r:a;function c(i,u){return s[0]=i[u],s[1]=i[u+1],s[2]=i[u+2],s[3]=i[u+3],s[4]=i[u+4],s[5]=i[u+5],s[6]=i[u+6],s[7]=i[u+7],n[0]}function o(i,u){return s[7]=i[u],s[6]=i[u+1],s[5]=i[u+2],s[4]=i[u+3],s[3]=i[u+4],s[2]=i[u+5],s[1]=i[u+6],s[0]=i[u+7],n[0]}e.readDoubleLE=t?c:o,e.readDoubleBE=t?o:c}():function(){function n(t,a,r,c,o,i){var u=c<0?1:0;if(u&&(c=-c),c===0)t(0,o,i+a),t(1/c>0?0:2147483648,o,i+r);else if(isNaN(c))t(0,o,i+a),t(2146959360,o,i+r);else if(c>17976931348623157e292)t(0,o,i+a),t((u<<31|2146435072)>>>0,o,i+r);else{var p;if(c<22250738585072014e-324)p=c/5e-324,t(p>>>0,o,i+a),t((u<<31|p/4294967296)>>>0,o,i+r);else{var m=Math.floor(Math.log(c)/Math.LN2);m===1024&&(m=1023),p=c*Math.pow(2,-m),t(p*4503599627370496>>>0,o,i+a),t((u<<31|m+1023<<20|p*1048576&1048575)>>>0,o,i+r)}}}e.writeDoubleLE=n.bind(null,sc,0,4),e.writeDoubleBE=n.bind(null,cc,4,0);function s(t,a,r,c,o){var i=t(c,o+a),u=t(c,o+r),p=(u>>31)*2+1,m=u>>>20&2047,f=4294967296*(u&1048575)+i;return m===2047?f?NaN:p*(1/0):m===0?p*5e-324*f:p*Math.pow(2,m-1075)*(f+4503599627370496)}e.readDoubleLE=s.bind(null,uc,0,4),e.readDoubleBE=s.bind(null,fc,4,0)}(),e}function sc(e,n,s){n[s]=e&255,n[s+1]=e>>>8&255,n[s+2]=e>>>16&255,n[s+3]=e>>>24}function cc(e,n,s){n[s]=e>>>24,n[s+1]=e>>>16&255,n[s+2]=e>>>8&255,n[s+3]=e&255}function uc(e,n){return(e[n]|e[n+1]<<8|e[n+2]<<16|e[n+3]<<24)>>>0}function fc(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}});var pc=Ht((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}});var li=Ht(hc=>{"use strict";var Ha=hc;Ha.length=function(n){for(var s=0,t=0,a=0;a<n.length;++a)t=n.charCodeAt(a),t<128?s+=1:t<2048?s+=2:(t&64512)===55296&&(n.charCodeAt(a+1)&64512)===56320?(++a,s+=4):s+=3;return s};Ha.read=function(n,s,t){var a=t-s;if(a<1)return"";for(var r=null,c=[],o=0,i;s<t;)i=n[s++],i<128?c[o++]=i:i>191&&i<224?c[o++]=(i&31)<<6|n[s++]&63:i>239&&i<365?(i=((i&7)<<18|(n[s++]&63)<<12|(n[s++]&63)<<6|n[s++]&63)-65536,c[o++]=55296+(i>>10),c[o++]=56320+(i&1023)):c[o++]=(i&15)<<12|(n[s++]&63)<<6|n[s++]&63,o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,c)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,c.slice(0,o))),r.join("")):String.fromCharCode.apply(String,c.slice(0,o))};Ha.write=function(n,s,t){for(var a=t,r,c,o=0;o<n.length;++o)r=n.charCodeAt(o),r<128?s[t++]=r:r<2048?(s[t++]=r>>6|192,s[t++]=r&63|128):(r&64512)===55296&&((c=n.charCodeAt(o+1))&64512)===56320?(r=65536+((r&1023)<<10)+(c&1023),++o,s[t++]=r>>18|240,s[t++]=r>>12&63|128,s[t++]=r>>6&63|128,s[t++]=r&63|128):(s[t++]=r>>12|224,s[t++]=r>>6&63|128,s[t++]=r&63|128);return t-a}});var yc=Ht((wm,mc)=>{"use strict";mc.exports=md;function md(e,n,s){var t=s||8192,a=t>>>1,r=null,c=t;return function(i){if(i<1||i>a)return e(i);c+i>t&&(r=e(t),c=0);var u=n.call(r,c,c+=i);return c&7&&(c=(c|7)+1),u}}});var xc=Ht((Sm,vc)=>{"use strict";vc.exports=$t;var Pr=oo();function $t(e,n){this.lo=e>>>0,this.hi=n>>>0}var xo=$t.zero=new $t(0,0);xo.toNumber=function(){return 0};xo.zzEncode=xo.zzDecode=function(){return this};xo.length=function(){return 1};var yd=$t.zeroHash="\0\0\0\0\0\0\0\0";$t.fromNumber=function(n){if(n===0)return xo;var s=n<0;s&&(n=-n);var t=n>>>0,a=(n-t)/4294967296>>>0;return s&&(a=~a>>>0,t=~t>>>0,++t>4294967295&&(t=0,++a>4294967295&&(a=0))),new $t(t,a)};$t.from=function(n){if(typeof n=="number")return $t.fromNumber(n);if(Pr.isString(n))if(Pr.Long)n=Pr.Long.fromString(n);else return $t.fromNumber(parseInt(n,10));return n.low||n.high?new $t(n.low>>>0,n.high>>>0):xo};$t.prototype.toNumber=function(n){if(!n&&this.hi>>>31){var s=~this.lo+1>>>0,t=~this.hi>>>0;return s||(t=t+1>>>0),-(s+t*4294967296)}return this.lo+this.hi*4294967296};$t.prototype.toLong=function(n){return Pr.Long?new Pr.Long(this.lo|0,this.hi|0,!!n):{low:this.lo|0,high:this.hi|0,unsigned:!!n}};var no=String.prototype.charCodeAt;$t.fromHash=function(n){return n===yd?xo:new $t((no.call(n,0)|no.call(n,1)<<8|no.call(n,2)<<16|no.call(n,3)<<24)>>>0,(no.call(n,4)|no.call(n,5)<<8|no.call(n,6)<<16|no.call(n,7)<<24)>>>0)};$t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};$t.prototype.zzEncode=function(){var n=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^n)>>>0,this.lo=(this.lo<<1^n)>>>0,this};$t.prototype.zzDecode=function(){var n=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^n)>>>0,this.hi=(this.hi>>>1^n)>>>0,this};$t.prototype.length=function(){var n=this.lo,s=(this.lo>>>28|this.hi<<4)>>>0,t=this.hi>>>24;return t===0?s===0?n<16384?n<128?1:2:n<2097152?3:4:s<16384?s<128?5:6:s<2097152?7:8:t<128?9:10}});var oo=Ht(Ga=>{"use strict";var He=Ga;He.asPromise=Ks();He.base64=oc();He.EventEmitter=ic();He.float=dc();He.inquire=pc();He.utf8=li();He.pool=yc();He.LongBits=xc();He.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);He.global=He.isNode&&global||!1||typeof self<"u"&&self||Ga;He.emptyArray=Object.freeze?Object.freeze([]):[];He.emptyObject=Object.freeze?Object.freeze({}):{};He.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};He.isString=function(n){return typeof n=="string"||n instanceof String};He.isObject=function(n){return n&&typeof n=="object"};He.isset=He.isSet=function(n,s){var t=n[s];return t!=null&&n.hasOwnProperty(s)?typeof t!="object"||(Array.isArray(t)?t.length:Object.keys(t).length)>0:!1};He.Buffer=function(){try{var e=He.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch{return null}}();He._Buffer_from=null;He._Buffer_allocUnsafe=null;He.newBuffer=function(n){return typeof n=="number"?He.Buffer?He._Buffer_allocUnsafe(n):new He.Array(n):He.Buffer?He._Buffer_from(n):typeof Uint8Array>"u"?n:new Uint8Array(n)};He.Array=typeof Uint8Array<"u"?Uint8Array:Array;He.Long=He.global.dcodeIO&&He.global.dcodeIO.Long||He.global.Long||He.inquire("long");He.key2Re=/^true|false|0|1$/;He.key32Re=/^-?(?:0|[1-9][0-9]*)$/;He.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;He.longToHash=function(n){return n?He.LongBits.from(n).toHash():He.LongBits.zeroHash};He.longFromHash=function(n,s){var t=He.LongBits.fromHash(n);return He.Long?He.Long.fromBits(t.lo,t.hi,s):t.toNumber(!!s)};function bc(e,n,s){for(var t=Object.keys(n),a=0;a<t.length;++a)(e[t[a]]===void 0||!s)&&(e[t[a]]=n[t[a]]);return e}He.merge=bc;He.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};function Ec(e){function n(s,t){if(!(this instanceof n))return new n(s,t);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:new Error().stack||""}),t&&bc(this,t)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}He.newError=Ec;He.ProtocolError=Ec("ProtocolError");He.oneOfGetter=function(n){for(var s={},t=0;t<n.length;++t)s[n[t]]=1;return function(){for(var a=Object.keys(this),r=a.length-1;r>-1;--r)if(s[a[r]]===1&&this[a[r]]!==void 0&&this[a[r]]!==null)return a[r]}};He.oneOfSetter=function(n){return function(s){for(var t=0;t<n.length;++t)n[t]!==s&&delete this[n[t]]}};He.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};He._configure=function(){var e=He.Buffer;if(!e){He._Buffer_from=He._Buffer_allocUnsafe=null;return}He._Buffer_from=e.from!==Uint8Array.from&&e.from||function(s,t){return new e(s,t)},He._Buffer_allocUnsafe=e.allocUnsafe||function(s){return new e(s)}}});var Ja=Ht((Am,Tc)=>{"use strict";Tc.exports=it;var wn=oo(),ja,di=wn.LongBits,gc=wn.base64,wc=wn.utf8;function zr(e,n,s){this.fn=e,this.len=n,this.next=void 0,this.val=s}function $a(){}function vd(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function it(){this.len=0,this.head=new zr($a,0,0),this.tail=this.head,this.states=null}var Sc=function(){return wn.Buffer?function(){return(it.create=function(){return new ja})()}:function(){return new it}};it.create=Sc();it.alloc=function(n){return new wn.Array(n)};wn.Array!==Array&&(it.alloc=wn.pool(it.alloc,wn.Array.prototype.subarray));it.prototype._push=function(n,s,t){return this.tail=this.tail.next=new zr(n,s,t),this.len+=s,this};function Xa(e,n,s){n[s]=e&255}function xd(e,n,s){for(;e>127;)n[s++]=e&127|128,e>>>=7;n[s]=e}function Za(e,n){this.len=e,this.next=void 0,this.val=n}Za.prototype=Object.create(zr.prototype);Za.prototype.fn=xd;it.prototype.uint32=function(n){return this.len+=(this.tail=this.tail.next=new Za((n=n>>>0)<128?1:n<16384?2:n<2097152?3:n<268435456?4:5,n)).len,this};it.prototype.int32=function(n){return n<0?this._push(Qa,10,di.fromNumber(n)):this.uint32(n)};it.prototype.sint32=function(n){return this.uint32((n<<1^n>>31)>>>0)};function Qa(e,n,s){for(;e.hi;)n[s++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)n[s++]=e.lo&127|128,e.lo=e.lo>>>7;n[s++]=e.lo}it.prototype.uint64=function(n){var s=di.from(n);return this._push(Qa,s.length(),s)};it.prototype.int64=it.prototype.uint64;it.prototype.sint64=function(n){var s=di.from(n).zzEncode();return this._push(Qa,s.length(),s)};it.prototype.bool=function(n){return this._push(Xa,1,n?1:0)};function Ya(e,n,s){n[s]=e&255,n[s+1]=e>>>8&255,n[s+2]=e>>>16&255,n[s+3]=e>>>24}it.prototype.fixed32=function(n){return this._push(Ya,4,n>>>0)};it.prototype.sfixed32=it.prototype.fixed32;it.prototype.fixed64=function(n){var s=di.from(n);return this._push(Ya,4,s.lo)._push(Ya,4,s.hi)};it.prototype.sfixed64=it.prototype.fixed64;it.prototype.float=function(n){return this._push(wn.float.writeFloatLE,4,n)};it.prototype.double=function(n){return this._push(wn.float.writeDoubleLE,8,n)};var bd=wn.Array.prototype.set?function(n,s,t){s.set(n,t)}:function(n,s,t){for(var a=0;a<n.length;++a)s[t+a]=n[a]};it.prototype.bytes=function(n){var s=n.length>>>0;if(!s)return this._push(Xa,1,0);if(wn.isString(n)){var t=it.alloc(s=gc.length(n));gc.decode(n,t,0),n=t}return this.uint32(s)._push(bd,s,n)};it.prototype.string=function(n){var s=wc.length(n);return s?this.uint32(s)._push(wc.write,s,n):this._push(Xa,1,0)};it.prototype.fork=function(){return this.states=new vd(this),this.head=this.tail=new zr($a,0,0),this.len=0,this};it.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new zr($a,0,0),this.len=0),this};it.prototype.ldelim=function(){var n=this.head,s=this.tail,t=this.len;return this.reset().uint32(t),t&&(this.tail.next=n.next,this.tail=s,this.len+=t),this};it.prototype.finish=function(){for(var n=this.head.next,s=this.constructor.alloc(this.len),t=0;n;)n.fn(n.val,s,t),t+=n.len,n=n.next;return s};it._configure=function(e){ja=e,it.create=Sc(),ja._configure()}});var Rc=Ht((_m,_c)=>{"use strict";_c.exports=Dn;var Ac=Ja();(Dn.prototype=Object.create(Ac.prototype)).constructor=Dn;var ro=oo();function Dn(){Ac.call(this)}Dn._configure=function(){Dn.alloc=ro._Buffer_allocUnsafe,Dn.writeBytesBuffer=ro.Buffer&&ro.Buffer.prototype instanceof Uint8Array&&ro.Buffer.prototype.set.name==="set"?function(n,s,t){s.set(n,t)}:function(n,s,t){if(n.copy)n.copy(s,t,0,n.length);else for(var a=0;a<n.length;)s[t++]=n[a++]}};Dn.prototype.bytes=function(n){ro.isString(n)&&(n=ro._Buffer_from(n,"base64"));var s=n.length>>>0;return this.uint32(s),s&&this._push(Dn.writeBytesBuffer,s,n),this};function Ed(e,n,s){e.length<40?ro.utf8.write(e,n,s):n.utf8Write?n.utf8Write(e,s):n.write(e,s)}Dn.prototype.string=function(n){var s=ro.Buffer.byteLength(n);return this.uint32(s),s&&this._push(Ed,s,n),this};Dn._configure()});var ts=Ht((Rm,kc)=>{"use strict";kc.exports=Ft;var In=oo(),es,Bc=In.LongBits,gd=In.utf8;function kn(e,n){return RangeError("index out of range: "+e.pos+" + "+(n||1)+" > "+e.len)}function Ft(e){this.buf=e,this.pos=0,this.len=e.length}var Nc=typeof Uint8Array<"u"?function(n){if(n instanceof Uint8Array||Array.isArray(n))return new Ft(n);throw Error("illegal buffer")}:function(n){if(Array.isArray(n))return new Ft(n);throw Error("illegal buffer")},Ic=function(){return In.Buffer?function(s){return(Ft.create=function(a){return In.Buffer.isBuffer(a)?new es(a):Nc(a)})(s)}:Nc};Ft.create=Ic();Ft.prototype._slice=In.Array.prototype.subarray||In.Array.prototype.slice;Ft.prototype.uint32=function(){var n=4294967295;return function(){if(n=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(n=(n|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return n;if((this.pos+=5)>this.len)throw this.pos=this.len,kn(this,10);return n}}();Ft.prototype.int32=function(){return this.uint32()|0};Ft.prototype.sint32=function(){var n=this.uint32();return n>>>1^-(n&1)|0};function Ka(){var e=new Bc(0,0),n=0;if(this.len-this.pos>4){for(;n<4;++n)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<n*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;n=0}else{for(;n<3;++n){if(this.pos>=this.len)throw kn(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<n*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<n*7)>>>0,e}if(this.len-this.pos>4){for(;n<5;++n)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<n*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;n<5;++n){if(this.pos>=this.len)throw kn(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<n*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Ft.prototype.bool=function(){return this.uint32()!==0};function pi(e,n){return(e[n-4]|e[n-3]<<8|e[n-2]<<16|e[n-1]<<24)>>>0}Ft.prototype.fixed32=function(){if(this.pos+4>this.len)throw kn(this,4);return pi(this.buf,this.pos+=4)};Ft.prototype.sfixed32=function(){if(this.pos+4>this.len)throw kn(this,4);return pi(this.buf,this.pos+=4)|0};function Cc(){if(this.pos+8>this.len)throw kn(this,8);return new Bc(pi(this.buf,this.pos+=4),pi(this.buf,this.pos+=4))}Ft.prototype.float=function(){if(this.pos+4>this.len)throw kn(this,4);var n=In.float.readFloatLE(this.buf,this.pos);return this.pos+=4,n};Ft.prototype.double=function(){if(this.pos+8>this.len)throw kn(this,4);var n=In.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,n};Ft.prototype.bytes=function(){var n=this.uint32(),s=this.pos,t=this.pos+n;if(t>this.len)throw kn(this,n);if(this.pos+=n,Array.isArray(this.buf))return this.buf.slice(s,t);if(s===t){var a=In.Buffer;return a?a.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,s,t)};Ft.prototype.string=function(){var n=this.bytes();return gd.read(n,0,n.length)};Ft.prototype.skip=function(n){if(typeof n=="number"){if(this.pos+n>this.len)throw kn(this,n);this.pos+=n}else do if(this.pos>=this.len)throw kn(this);while(this.buf[this.pos++]&128);return this};Ft.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Ft._configure=function(e){es=e,Ft.create=Ic(),es._configure();var n=In.Long?"toLong":"toNumber";In.merge(Ft.prototype,{int64:function(){return Ka.call(this)[n](!1)},uint64:function(){return Ka.call(this)[n](!0)},sint64:function(){return Ka.call(this).zzDecode()[n](!1)},fixed64:function(){return Cc.call(this)[n](!0)},sfixed64:function(){return Cc.call(this)[n](!1)}})}});var zc=Ht((Nm,Pc)=>{"use strict";Pc.exports=bo;var Mc=ts();(bo.prototype=Object.create(Mc.prototype)).constructor=bo;var Oc=oo();function bo(e){Mc.call(this,e)}bo._configure=function(){Oc.Buffer&&(bo.prototype._slice=Oc.Buffer.prototype.slice)};bo.prototype.string=function(){var n=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+n,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+n,this.len))};bo._configure()});var Uc=Ht((Cm,Fc)=>{"use strict";Fc.exports=Fr;var ns=oo();(Fr.prototype=Object.create(ns.EventEmitter.prototype)).constructor=Fr;function Fr(e,n,s){if(typeof e!="function")throw TypeError("rpcImpl must be a function");ns.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!n,this.responseDelimited=!!s}Fr.prototype.rpcCall=function e(n,s,t,a,r){if(!a)throw TypeError("request must be specified");var c=this;if(!r)return ns.asPromise(e,c,n,s,t,a);if(!c.rpcImpl){setTimeout(function(){r(Error("already ended"))},0);return}try{return c.rpcImpl(n,s[c.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(i,u){if(i)return c.emit("error",i,n),r(i);if(u===null){c.end(!0);return}if(!(u instanceof t))try{u=t[c.responseDelimited?"decodeDelimited":"decode"](u)}catch(p){return c.emit("error",p,n),r(p)}return c.emit("data",u,n),r(null,u)})}catch(o){c.emit("error",o,n),setTimeout(function(){r(o)},0);return}};Fr.prototype.end=function(n){return this.rpcImpl&&(n||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Vc=Ht(Lc=>{"use strict";var wd=Lc;wd.Service=Uc()});var Wc=Ht((Im,Dc)=>{"use strict";Dc.exports={}});var Gc=Ht(Hc=>{"use strict";var fn=Hc;fn.build="minimal";fn.Writer=Ja();fn.BufferWriter=Rc();fn.Reader=ts();fn.BufferReader=zc();fn.util=oo();fn.rpc=Vc();fn.roots=Wc();fn.configure=qc;function qc(){fn.util._configure(),fn.Writer._configure(fn.BufferWriter),fn.Reader._configure(fn.BufferReader)}qc()});var Qe=Ht((Om,jc)=>{"use strict";jc.exports=Gc()});var Ps=Ht((Tl,Ms)=>{"use strict";(function(e){if(typeof Tl=="object"&&typeof Ms<"u")Ms.exports=e();else{var n;typeof global<"u"?n=global:typeof self<"u"&&(n=self),n.CANNON=e()}})(function(){var e,n,s;return function t(a,r,c){function o(p,m){if(!r[p]){if(!a[p]){var f=typeof require=="function"&&require;if(!m&&f)return f(p,!0);if(i)return i(p,!0);throw new Error("Cannot find module '"+p+"'")}var y=r[p]={exports:{}};a[p][0].call(y.exports,function(l){var d=a[p][1][l];return o(d||l)},y,y.exports,t,a,r,c)}return r[p].exports}for(var i=typeof require=="function"&&require,u=0;u<c.length;u++)o(c[u]);return o}({1:[function(t,a,r){a.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,a,r){a.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,a,r){var c=t("../math/Vec3"),o=t("../utils/Utils");a.exports=i;function i(m){m=m||{},this.lowerBound=new c,m.lowerBound&&this.lowerBound.copy(m.lowerBound),this.upperBound=new c,m.upperBound&&this.upperBound.copy(m.upperBound)}var u=new c;i.prototype.setFromPoints=function(m,f,y,l){var d=this.lowerBound,v=this.upperBound,h=y;d.copy(m[0]),h&&h.vmult(d,d),v.copy(d);for(var x=1;x<m.length;x++){var w=m[x];h&&(h.vmult(w,u),w=u),w.x>v.x&&(v.x=w.x),w.x<d.x&&(d.x=w.x),w.y>v.y&&(v.y=w.y),w.y<d.y&&(d.y=w.y),w.z>v.z&&(v.z=w.z),w.z<d.z&&(d.z=w.z)}return f&&(f.vadd(d,d),f.vadd(v,v)),l&&(d.x-=l,d.y-=l,d.z-=l,v.x+=l,v.y+=l,v.z+=l),this},i.prototype.copy=function(m){return this.lowerBound.copy(m.lowerBound),this.upperBound.copy(m.upperBound),this},i.prototype.clone=function(){return new i().copy(this)},i.prototype.extend=function(m){var f=m.lowerBound.x;this.lowerBound.x>f&&(this.lowerBound.x=f);var y=m.upperBound.x;this.upperBound.x<y&&(this.upperBound.x=y);var f=m.lowerBound.y;this.lowerBound.y>f&&(this.lowerBound.y=f);var y=m.upperBound.y;this.upperBound.y<y&&(this.upperBound.y=y);var f=m.lowerBound.z;this.lowerBound.z>f&&(this.lowerBound.z=f);var y=m.upperBound.z;this.upperBound.z<y&&(this.upperBound.z=y)},i.prototype.overlaps=function(m){var f=this.lowerBound,y=this.upperBound,l=m.lowerBound,d=m.upperBound;return(l.x<=y.x&&y.x<=d.x||f.x<=d.x&&d.x<=y.x)&&(l.y<=y.y&&y.y<=d.y||f.y<=d.y&&d.y<=y.y)&&(l.z<=y.z&&y.z<=d.z||f.z<=d.z&&d.z<=y.z)},i.prototype.contains=function(m){var f=this.lowerBound,y=this.upperBound,l=m.lowerBound,d=m.upperBound;return f.x<=l.x&&y.x>=d.x&&f.y<=l.y&&y.y>=d.y&&f.z<=l.z&&y.z>=d.z},i.prototype.getCorners=function(m,f,y,l,d,v,h,x){var w=this.lowerBound,k=this.upperBound;m.copy(w),f.set(k.x,w.y,w.z),y.set(k.x,k.y,w.z),l.set(w.x,k.y,k.z),d.set(k.x,w.y,w.z),v.set(w.x,k.y,w.z),h.set(w.x,w.y,k.z),x.copy(k)};var p=[new c,new c,new c,new c,new c,new c,new c,new c];i.prototype.toLocalFrame=function(m,f){var y=p,l=y[0],d=y[1],v=y[2],h=y[3],x=y[4],w=y[5],k=y[6],N=y[7];this.getCorners(l,d,v,h,x,w,k,N);for(var A=0;A!==8;A++){var P=y[A];m.pointToLocal(P,P)}return f.setFromPoints(y)},i.prototype.toWorldFrame=function(m,f){var y=p,l=y[0],d=y[1],v=y[2],h=y[3],x=y[4],w=y[5],k=y[6],N=y[7];this.getCorners(l,d,v,h,x,w,k,N);for(var A=0;A!==8;A++){var P=y[A];m.pointToWorld(P,P)}return f.setFromPoints(y)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,a,r){a.exports=c;function c(){this.matrix=[]}c.prototype.get=function(o,i){if(o=o.index,i=i.index,i>o){var u=i;i=o,o=u}return this.matrix[(o*(o+1)>>1)+i-1]},c.prototype.set=function(o,i,u){if(o=o.index,i=i.index,i>o){var p=i;i=o,o=p}this.matrix[(o*(o+1)>>1)+i-1]=u?1:0},c.prototype.reset=function(){for(var o=0,i=this.matrix.length;o!==i;o++)this.matrix[o]=0},c.prototype.setNumObjects=function(o){this.matrix.length=o*(o-1)>>1}},{}],5:[function(t,a,r){var c=t("../objects/Body"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../shapes/Shape"),p=t("../shapes/Plane");a.exports=m;function m(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}m.prototype.collisionPairs=function(N,A,P){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var f=c.STATIC|c.KINEMATIC;m.prototype.needBroadphaseCollision=function(N,A){return!(!(N.collisionFilterGroup&A.collisionFilterMask)||!(A.collisionFilterGroup&N.collisionFilterMask)||(N.type&f||N.sleepState===c.SLEEPING)&&(A.type&f||A.sleepState===c.SLEEPING))},m.prototype.intersectionTest=function(N,A,P,M){this.useBoundingBoxes?this.doBoundingBoxBroadphase(N,A,P,M):this.doBoundingSphereBroadphase(N,A,P,M)};var y=new o,l=new o,d=new i,v=new o;m.prototype.doBoundingSphereBroadphase=function(N,A,P,M){var W=y;A.position.vsub(N.position,W);var $=Math.pow(N.boundingRadius+A.boundingRadius,2),E=W.norm2();E<$&&(P.push(N),M.push(A))},m.prototype.doBoundingBoxBroadphase=function(N,A,P,M){N.aabbNeedsUpdate&&N.computeAABB(),A.aabbNeedsUpdate&&A.computeAABB(),N.aabb.overlaps(A.aabb)&&(P.push(N),M.push(A))};var h={keys:[]},x=[],w=[];m.prototype.makePairsUnique=function(N,A){for(var P=h,M=x,W=w,$=N.length,E=0;E!==$;E++)M[E]=N[E],W[E]=A[E];N.length=0,A.length=0;for(var E=0;E!==$;E++){var _=M[E].id,O=W[E].id,V=_<O?_+","+O:O+","+_;P[V]=E,P.keys.push(V)}for(var E=0;E!==P.keys.length;E++){var V=P.keys.pop(),D=P[V];N.push(M[D]),A.push(W[D]),delete P[V]}},m.prototype.setWorld=function(N){};var k=new o;m.boundingSphereCheck=function(N,A){var P=k;return N.position.vsub(A.position,P),Math.pow(N.shape.boundingSphereRadius+A.shape.boundingSphereRadius,2)>P.norm2()},m.prototype.aabbQuery=function(N,A,P){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,a,r){a.exports=u;var c=t("./Broadphase"),o=t("../math/Vec3"),i=t("../shapes/Shape");function u(f,y,l,d,v){c.apply(this),this.nx=l||10,this.ny=d||10,this.nz=v||10,this.aabbMin=f||new o(100,100,100),this.aabbMax=y||new o(-100,-100,-100);var h=this.nx*this.ny*this.nz;if(h<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=h,this.binLengths.length=h;for(var x=0;x<h;x++)this.bins[x]=[],this.binLengths[x]=0}u.prototype=new c,u.prototype.constructor=u;var p=new o,m=new o;u.prototype.collisionPairs=function(f,y,l){for(var d=f.numObjects(),v=f.bodies,ye=this.aabbMax,re=this.aabbMin,h=this.nx,x=this.ny,w=this.nz,k=x*w,N=w,A=1,P=ye.x,M=ye.y,W=ye.z,$=re.x,E=re.y,_=re.z,O=h/(P-$),V=x/(M-E),D=w/(W-_),J=(P-$)/h,ee=(M-E)/x,K=(W-_)/w,de=Math.sqrt(J*J+ee*ee+K*K)*.5,_e=i.types,ze=_e.SPHERE,Oe=_e.PLANE,je=_e.BOX,Pe=_e.COMPOUND,q=_e.CONVEXPOLYHEDRON,R=this.bins,F=this.binLengths,Z=this.bins.length,T=0;T!==Z;T++)F[T]=0;var L=Math.ceil,re=Math.min,ye=Math.max;function Y(Le,Pt,Kt,qt,ot,I,G){var Q=(Le-$)*O|0,ge=(Pt-E)*V|0,be=(Kt-_)*D|0,Ne=L((qt-$)*O),Ce=L((ot-E)*V),ut=L((I-_)*D);Q<0?Q=0:Q>=h&&(Q=h-1),ge<0?ge=0:ge>=x&&(ge=x-1),be<0?be=0:be>=w&&(be=w-1),Ne<0?Ne=0:Ne>=h&&(Ne=h-1),Ce<0?Ce=0:Ce>=x&&(Ce=x-1),ut<0?ut=0:ut>=w&&(ut=w-1),Q*=k,ge*=N,be*=A,Ne*=k,Ce*=N,ut*=A;for(var At=Q;At<=Ne;At+=k)for(var ct=ge;ct<=Ce;ct+=N)for(var en=be;en<=ut;en+=A){var un=At+ct+en;R[un][F[un]++]=G}}for(var T=0;T!==d;T++){var C=v[T],te=C.shape;switch(te.type){case ze:var se=C.position.x,le=C.position.y,pe=C.position.z,ve=te.radius;Y(se-ve,le-ve,pe-ve,se+ve,le+ve,pe+ve,C);break;case Oe:te.worldNormalNeedsUpdate&&te.computeWorldNormal(C.quaternion);var xe=te.worldNormal,Se=$+J*.5-C.position.x,Re=E+ee*.5-C.position.y,Fe=_+K*.5-C.position.z,Me=p;Me.set(Se,Re,Fe);for(var Te=0,Xe=0;Te!==h;Te++,Xe+=k,Me.y=Re,Me.x+=J)for(var Ge=0,et=0;Ge!==x;Ge++,et+=N,Me.z=Fe,Me.y+=ee)for(var nt=0,yt=0;nt!==w;nt++,yt+=A,Me.z+=K)if(Me.dot(xe)<de){var wt=Xe+et+yt;R[wt][F[wt]++]=C}break;default:C.aabbNeedsUpdate&&C.computeAABB(),Y(C.aabb.lowerBound.x,C.aabb.lowerBound.y,C.aabb.lowerBound.z,C.aabb.upperBound.x,C.aabb.upperBound.y,C.aabb.upperBound.z,C);break}}for(var T=0;T!==Z;T++){var mt=F[T];if(mt>1)for(var Dt=R[T],Te=0;Te!==mt;Te++)for(var C=Dt[Te],Ge=0;Ge!==Te;Ge++){var Ie=Dt[Ge];this.needBroadphaseCollision(C,Ie)&&this.intersectionTest(C,Ie,y,l)}}this.makePairsUnique(y,l)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,a,r){a.exports=i;var c=t("./Broadphase"),o=t("./AABB");function i(){c.apply(this)}i.prototype=new c,i.prototype.constructor=i,i.prototype.collisionPairs=function(p,m,f){var y=p.bodies,l=y.length,d,v,h,x;for(d=0;d!==l;d++)for(v=0;v!==d;v++)h=y[d],x=y[v],this.needBroadphaseCollision(h,x)&&this.intersectionTest(h,x,m,f)};var u=new o;i.prototype.aabbQuery=function(p,m,f){f=f||[];for(var y=0;y<p.bodies.length;y++){var l=p.bodies[y];l.aabbNeedsUpdate&&l.computeAABB(),l.aabb.overlaps(m)&&f.push(l)}return f}},{"./AABB":3,"./Broadphase":5}],8:[function(t,a,r){a.exports=c;function c(){this.matrix={}}c.prototype.get=function(o,i){if(o=o.id,i=i.id,i>o){var u=i;i=o,o=u}return o+"-"+i in this.matrix},c.prototype.set=function(o,i,u){if(o=o.id,i=i.id,i>o){var p=i;i=o,o=p}u?this.matrix[o+"-"+i]=!0:delete this.matrix[o+"-"+i]},c.prototype.reset=function(){this.matrix={}},c.prototype.setNumObjects=function(o){}},{}],9:[function(t,a,r){a.exports=l;var c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("../math/Transform"),u=t("../shapes/ConvexPolyhedron"),p=t("../shapes/Box"),m=t("../collision/RaycastResult"),f=t("../shapes/Shape"),y=t("../collision/AABB");function l(Y,C){this.from=Y?Y.clone():new c,this.to=C?C.clone():new c,this._direction=new c,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=l.ANY,this.result=new m,this.hasHit=!1,this.callback=function(te){}}l.prototype.constructor=l,l.CLOSEST=1,l.ANY=2,l.ALL=4;var d=new y,v=[];l.prototype.intersectWorld=function(Y,C){return this.mode=C.mode||l.ANY,this.result=C.result||new m,this.skipBackfaces=!!C.skipBackfaces,this.collisionFilterMask=typeof C.collisionFilterMask<"u"?C.collisionFilterMask:-1,this.collisionFilterGroup=typeof C.collisionFilterGroup<"u"?C.collisionFilterGroup:-1,C.from&&this.from.copy(C.from),C.to&&this.to.copy(C.to),this.callback=C.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(d),v.length=0,Y.broadphase.aabbQuery(Y,d,v),this.intersectBodies(v),this.hasHit};var h=new c,x=new c;l.pointInTriangle=w;function w(Y,C,te,se){se.vsub(C,L),te.vsub(C,h),Y.vsub(C,x);var le=L.dot(L),pe=L.dot(h),ve=L.dot(x),xe=h.dot(h),Se=h.dot(x),Re,Fe;return(Re=xe*ve-pe*Se)>=0&&(Fe=le*Se-pe*ve)>=0&&Re+Fe<le*xe-pe*pe}var k=new c,N=new o;l.prototype.intersectBody=function(Y,C){C&&(this.result=C,this._updateDirection());var te=this.checkCollisionResponse;if(!(te&&!Y.collisionResponse)&&!(!(this.collisionFilterGroup&Y.collisionFilterMask)||!(Y.collisionFilterGroup&this.collisionFilterMask)))for(var se=k,le=N,pe=0,ve=Y.shapes.length;pe<ve;pe++){var xe=Y.shapes[pe];if(!(te&&!xe.collisionResponse)&&(Y.quaternion.mult(Y.shapeOrientations[pe],le),Y.quaternion.vmult(Y.shapeOffsets[pe],se),se.vadd(Y.position,se),this.intersectShape(xe,le,se,Y),this.result._shouldStop))break}},l.prototype.intersectBodies=function(Y,C){C&&(this.result=C,this._updateDirection());for(var te=0,se=Y.length;!this.result._shouldStop&&te<se;te++)this.intersectBody(Y[te])},l.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},l.prototype.intersectShape=function(Y,C,te,se){var le=this.from,pe=ye(le,this._direction,te);if(!(pe>Y.boundingSphereRadius)){var ve=this[Y.type];ve&&ve.call(this,Y,C,te,se)}};var A=new c,P=new c,M=new c,W=new c,$=new c,E=new c,_=new c,O=new m;l.prototype.intersectBox=function(Y,C,te,se){return this.intersectConvex(Y.convexPolyhedronRepresentation,C,te,se)},l.prototype[f.types.BOX]=l.prototype.intersectBox,l.prototype.intersectPlane=function(Y,C,te,se){var le=this.from,pe=this.to,ve=this._direction,xe=new c(0,0,1);C.vmult(xe,xe);var Se=new c;le.vsub(te,Se);var Re=Se.dot(xe);pe.vsub(te,Se);var Fe=Se.dot(xe);if(!(Re*Fe>0)&&!(le.distanceTo(pe)<Re)){var Me=xe.dot(ve);if(!(Math.abs(Me)<this.precision)){var Te=new c,Xe=new c,Ge=new c;le.vsub(te,Te);var et=-xe.dot(Te)/Me;ve.scale(et,Xe),le.vadd(Xe,Ge),this.reportIntersection(xe,Ge,Y,se,-1)}}},l.prototype[f.types.PLANE]=l.prototype.intersectPlane,l.prototype.getAABB=function(Y){var C=this.to,te=this.from;Y.lowerBound.x=Math.min(C.x,te.x),Y.lowerBound.y=Math.min(C.y,te.y),Y.lowerBound.z=Math.min(C.z,te.z),Y.upperBound.x=Math.max(C.x,te.x),Y.upperBound.y=Math.max(C.y,te.y),Y.upperBound.z=Math.max(C.z,te.z)};var V={faceList:[0]};l.prototype.intersectHeightfield=function(Y,C,te,se){var le=Y.data,pe=Y.elementSize,ve=new c,xe=new l(this.from,this.to);i.pointToLocalFrame(te,C,xe.from,xe.from),i.pointToLocalFrame(te,C,xe.to,xe.to);var Se=[],Re=null,Fe=null,Me=null,Te=null,Xe=Y.getIndexOfPosition(xe.from.x,xe.from.y,Se,!1);if(Xe&&(Re=Se[0],Fe=Se[1],Me=Se[0],Te=Se[1]),Xe=Y.getIndexOfPosition(xe.to.x,xe.to.y,Se,!1),Xe&&((Re===null||Se[0]<Re)&&(Re=Se[0]),(Me===null||Se[0]>Me)&&(Me=Se[0]),(Fe===null||Se[1]<Fe)&&(Fe=Se[1]),(Te===null||Se[1]>Te)&&(Te=Se[1])),Re!==null){var Ge=[];Y.getRectMinMax(Re,Fe,Me,Te,Ge);for(var et=Ge[0],nt=Ge[1],yt=Re;yt<=Me;yt++)for(var wt=Fe;wt<=Te;wt++){if(this.result._shouldStop||(Y.getConvexTrianglePillar(yt,wt,!1),i.pointToWorldFrame(te,C,Y.pillarOffset,ve),this.intersectConvex(Y.pillarConvex,C,ve,se,V),this.result._shouldStop))return;Y.getConvexTrianglePillar(yt,wt,!0),i.pointToWorldFrame(te,C,Y.pillarOffset,ve),this.intersectConvex(Y.pillarConvex,C,ve,se,V)}}},l.prototype[f.types.HEIGHTFIELD]=l.prototype.intersectHeightfield;var D=new c,J=new c;l.prototype.intersectSphere=function(Y,C,te,se){var le=this.from,pe=this.to,ve=Y.radius,xe=Math.pow(pe.x-le.x,2)+Math.pow(pe.y-le.y,2)+Math.pow(pe.z-le.z,2),Se=2*((pe.x-le.x)*(le.x-te.x)+(pe.y-le.y)*(le.y-te.y)+(pe.z-le.z)*(le.z-te.z)),Re=Math.pow(le.x-te.x,2)+Math.pow(le.y-te.y,2)+Math.pow(le.z-te.z,2)-Math.pow(ve,2),Fe=Math.pow(Se,2)-4*xe*Re,Me=D,Te=J;if(!(Fe<0))if(Fe===0)le.lerp(pe,Fe,Me),Me.vsub(te,Te),Te.normalize(),this.reportIntersection(Te,Me,Y,se,-1);else{var Xe=(-Se-Math.sqrt(Fe))/(2*xe),Ge=(-Se+Math.sqrt(Fe))/(2*xe);if(Xe>=0&&Xe<=1&&(le.lerp(pe,Xe,Me),Me.vsub(te,Te),Te.normalize(),this.reportIntersection(Te,Me,Y,se,-1)),this.result._shouldStop)return;Ge>=0&&Ge<=1&&(le.lerp(pe,Ge,Me),Me.vsub(te,Te),Te.normalize(),this.reportIntersection(Te,Me,Y,se,-1))}},l.prototype[f.types.SPHERE]=l.prototype.intersectSphere;var ee=new c,K=new c,de=new c,_e=new c;l.prototype.intersectConvex=function(C,te,se,le,pe){for(var ve=K,xe=ee,Se=_e,Re=de,Fe=pe&&pe.faceList||null,Me=C.faces,Te=C.vertices,Xe=C.faceNormals,Ge=this._direction,et=this.from,nt=this.to,yt=et.distanceTo(nt),wt=-1,mt=Fe?Fe.length:Me.length,Dt=this.result,Ie=0;!Dt._shouldStop&&Ie<mt;Ie++){var Le=Fe?Fe[Ie]:Ie,Pt=Me[Le],Kt=Xe[Le],qt=te,ot=se;Se.copy(Te[Pt[0]]),qt.vmult(Se,Se),Se.vadd(ot,Se),Se.vsub(et,Se),qt.vmult(Kt,xe);var I=Ge.dot(xe);if(!(Math.abs(I)<this.precision)){var G=xe.dot(Se)/I;if(!(G<0)){Ge.mult(G,M),M.vadd(et,M),W.copy(Te[Pt[0]]),qt.vmult(W,W),ot.vadd(W,W);for(var Q=1;!Dt._shouldStop&&Q<Pt.length-1;Q++){$.copy(Te[Pt[Q]]),E.copy(Te[Pt[Q+1]]),qt.vmult($,$),qt.vmult(E,E),ot.vadd($,$),ot.vadd(E,E);var ge=M.distanceTo(et);!(w(M,W,$,E)||w(M,$,W,E))||ge>yt||this.reportIntersection(xe,M,C,le,Le)}}}}},l.prototype[f.types.CONVEXPOLYHEDRON]=l.prototype.intersectConvex;var ze=new c,Oe=new c,je=new c,Pe=new c,q=new c,R=new c,F=new y,Z=[],T=new i;l.prototype.intersectTrimesh=function(C,te,se,le,pe){var ve=ze,xe=Z,Se=T,Re=K,Fe=_e,Me=de,Te=F,Xe=Oe,Ge=je,et=Pe,nt=R,yt=q,wt=pe&&pe.faceList||null,mt=C.indices,Dt=C.vertices,Ie=C.faceNormals,Le=this.from,Pt=this.to,Kt=this._direction,qt=-1;Se.position.copy(se),Se.quaternion.copy(te),i.vectorToLocalFrame(se,te,Kt,Xe),i.pointToLocalFrame(se,te,Le,Ge),i.pointToLocalFrame(se,te,Pt,et);var ot=Ge.distanceSquared(et);C.tree.rayQuery(this,Se,xe);for(var I=0,G=xe.length;!this.result._shouldStop&&I!==G;I++){var Q=xe[I];C.getNormal(Q,ve),C.getVertex(mt[Q*3],W),W.vsub(Ge,Fe);var ge=Xe.dot(ve),be=ve.dot(Fe)/ge;if(!(be<0)){Xe.scale(be,M),M.vadd(Ge,M),C.getVertex(mt[Q*3+1],$),C.getVertex(mt[Q*3+2],E);var Ne=M.distanceSquared(Ge);!(w(M,$,W,E)||w(M,W,$,E))||Ne>ot||(i.vectorToWorldFrame(te,ve,yt),i.pointToWorldFrame(se,te,M,nt),this.reportIntersection(yt,nt,C,le,Q))}}xe.length=0},l.prototype[f.types.TRIMESH]=l.prototype.intersectTrimesh,l.prototype.reportIntersection=function(Y,C,te,se,le){var pe=this.from,ve=this.to,xe=pe.distanceTo(C),Se=this.result;if(!(this.skipBackfaces&&Y.dot(this._direction)>0))switch(Se.hitFaceIndex=typeof le<"u"?le:-1,this.mode){case l.ALL:this.hasHit=!0,Se.set(pe,ve,Y,C,te,se,xe),Se.hasHit=!0,this.callback(Se);break;case l.CLOSEST:(xe<Se.distance||!Se.hasHit)&&(this.hasHit=!0,Se.hasHit=!0,Se.set(pe,ve,Y,C,te,se,xe));break;case l.ANY:this.hasHit=!0,Se.hasHit=!0,Se.set(pe,ve,Y,C,te,se,xe),Se._shouldStop=!0;break}};var L=new c,re=new c;function ye(Y,C,te){te.vsub(Y,L);var se=L.dot(C);C.mult(se,re),re.vadd(Y,re);var le=te.distanceTo(re);return le}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,a,r){var c=t("../math/Vec3");a.exports=o;function o(){this.rayFromWorld=new c,this.rayToWorld=new c,this.hitNormalWorld=new c,this.hitPointWorld=new c,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}o.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},o.prototype.abort=function(){this._shouldStop=!0},o.prototype.set=function(i,u,p,m,f,y,l){this.rayFromWorld.copy(i),this.rayToWorld.copy(u),this.hitNormalWorld.copy(p),this.hitPointWorld.copy(m),this.shape=f,this.body=y,this.distance=l}},{"../math/Vec3":30}],11:[function(t,a,r){var c=t("../shapes/Shape"),o=t("../collision/Broadphase");a.exports=i;function i(u){o.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var p=this.axisList;this._addBodyHandler=function(m){p.push(m.body)},this._removeBodyHandler=function(m){var f=p.indexOf(m.body);f!==-1&&p.splice(f,1)},u&&this.setWorld(u)}i.prototype=new o,i.prototype.setWorld=function(u){this.axisList.length=0;for(var p=0;p<u.bodies.length;p++)this.axisList.push(u.bodies[p]);u.removeEventListener("addBody",this._addBodyHandler),u.removeEventListener("removeBody",this._removeBodyHandler),u.addEventListener("addBody",this._addBodyHandler),u.addEventListener("removeBody",this._removeBodyHandler),this.world=u,this.dirty=!0},i.insertionSortX=function(u){for(var p=1,m=u.length;p<m;p++){for(var f=u[p],y=p-1;y>=0&&!(u[y].aabb.lowerBound.x<=f.aabb.lowerBound.x);y--)u[y+1]=u[y];u[y+1]=f}return u},i.insertionSortY=function(u){for(var p=1,m=u.length;p<m;p++){for(var f=u[p],y=p-1;y>=0&&!(u[y].aabb.lowerBound.y<=f.aabb.lowerBound.y);y--)u[y+1]=u[y];u[y+1]=f}return u},i.insertionSortZ=function(u){for(var p=1,m=u.length;p<m;p++){for(var f=u[p],y=p-1;y>=0&&!(u[y].aabb.lowerBound.z<=f.aabb.lowerBound.z);y--)u[y+1]=u[y];u[y+1]=f}return u},i.prototype.collisionPairs=function(u,p,m){var f=this.axisList,y=f.length,l=this.axisIndex,d,v;for(this.dirty&&(this.sortList(),this.dirty=!1),d=0;d!==y;d++){var h=f[d];for(v=d+1;v<y;v++){var x=f[v];if(this.needBroadphaseCollision(h,x)){if(!i.checkBounds(h,x,l))break;this.intersectionTest(h,x,p,m)}}}},i.prototype.sortList=function(){for(var u=this.axisList,p=this.axisIndex,m=u.length,f=0;f!==m;f++){var y=u[f];y.aabbNeedsUpdate&&y.computeAABB()}p===0?i.insertionSortX(u):p===1?i.insertionSortY(u):p===2&&i.insertionSortZ(u)},i.checkBounds=function(u,p,m){var f,y;m===0?(f=u.position.x,y=p.position.x):m===1?(f=u.position.y,y=p.position.y):m===2&&(f=u.position.z,y=p.position.z);var l=u.boundingRadius,d=p.boundingRadius,v=f-l,h=f+l,x=y-d,w=y+d;return x<h},i.prototype.autoDetectAxis=function(){for(var u=0,p=0,m=0,f=0,y=0,l=0,d=this.axisList,v=d.length,h=1/v,x=0;x!==v;x++){var w=d[x],k=w.position.x;u+=k,p+=k*k;var N=w.position.y;m+=N,f+=N*N;var A=w.position.z;y+=A,l+=A*A}var P=p-u*u*h,M=f-m*m*h,W=l-y*y*h;P>M?P>W?this.axisIndex=0:this.axisIndex=2:M>W?this.axisIndex=1:this.axisIndex=2},i.prototype.aabbQuery=function(u,p,m){m=m||[],this.dirty&&(this.sortList(),this.dirty=!1);var f=this.axisIndex,y="x";f===1&&(y="y"),f===2&&(y="z");for(var l=this.axisList,d=p.lowerBound[y],v=p.upperBound[y],h=0;h<l.length;h++){var x=l[h];x.aabbNeedsUpdate&&x.computeAABB(),x.aabb.overlaps(p)&&m.push(x)}return m}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,a,r){a.exports=f;var c=t("./Constraint"),o=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),u=t("../equations/RotationalEquation"),p=t("../equations/ContactEquation"),m=t("../math/Vec3");function f(d,v,h){h=h||{};var x=typeof h.maxForce<"u"?h.maxForce:1e6,w=h.pivotA?h.pivotA.clone():new m,k=h.pivotB?h.pivotB.clone():new m;this.axisA=h.axisA?h.axisA.clone():new m,this.axisB=h.axisB?h.axisB.clone():new m,o.call(this,d,w,v,k,x),this.collideConnected=!!h.collideConnected,this.angle=typeof h.angle<"u"?h.angle:0;var N=this.coneEquation=new i(d,v,h),A=this.twistEquation=new u(d,v,h);this.twistAngle=typeof h.twistAngle<"u"?h.twistAngle:0,N.maxForce=0,N.minForce=-x,A.maxForce=0,A.minForce=-x,this.equations.push(N,A)}f.prototype=new o,f.constructor=f;var y=new m,l=new m;f.prototype.update=function(){var d=this.bodyA,v=this.bodyB,h=this.coneEquation,x=this.twistEquation;o.prototype.update.call(this),d.vectorToWorldFrame(this.axisA,h.axisA),v.vectorToWorldFrame(this.axisB,h.axisB),this.axisA.tangents(x.axisA,x.axisA),d.vectorToWorldFrame(x.axisA,x.axisA),this.axisB.tangents(x.axisB,x.axisB),v.vectorToWorldFrame(x.axisB,x.axisB),h.angle=this.angle,x.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,a,r){a.exports=o;var c=t("../utils/Utils");function o(i,u,p){p=c.defaults(p,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=i,this.bodyB=u,this.id=o.idCounter++,this.collideConnected=p.collideConnected,p.wakeUpBodies&&(i&&i.wakeUp(),u&&u.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.prototype.enable=function(){for(var i=this.equations,u=0;u<i.length;u++)i[u].enabled=!0},o.prototype.disable=function(){for(var i=this.equations,u=0;u<i.length;u++)i[u].enabled=!1},o.idCounter=0},{"../utils/Utils":53}],14:[function(t,a,r){a.exports=i;var c=t("./Constraint"),o=t("../equations/ContactEquation");function i(u,p,m,f){c.call(this,u,p),typeof m>"u"&&(m=u.position.distanceTo(p.position)),typeof f>"u"&&(f=1e6),this.distance=m;var y=this.distanceEquation=new o(u,p);this.equations.push(y),y.minForce=-f,y.maxForce=f}i.prototype=new c,i.prototype.update=function(){var u=this.bodyA,p=this.bodyB,m=this.distanceEquation,f=this.distance*.5,y=m.ni;p.position.vsub(u.position,y),y.normalize(),y.mult(f,m.ri),y.mult(-f,m.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,a,r){a.exports=f;var c=t("./Constraint"),o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),u=t("../equations/RotationalMotorEquation"),p=t("../equations/ContactEquation"),m=t("../math/Vec3");function f(d,v,h){h=h||{};var x=typeof h.maxForce<"u"?h.maxForce:1e6,w=h.pivotA?h.pivotA.clone():new m,k=h.pivotB?h.pivotB.clone():new m;o.call(this,d,w,v,k,x);var N=this.axisA=h.axisA?h.axisA.clone():new m(1,0,0);N.normalize();var A=this.axisB=h.axisB?h.axisB.clone():new m(1,0,0);A.normalize();var P=this.rotationalEquation1=new i(d,v,h),M=this.rotationalEquation2=new i(d,v,h),W=this.motorEquation=new u(d,v,x);W.enabled=!1,this.equations.push(P,M,W)}f.prototype=new o,f.constructor=f,f.prototype.enableMotor=function(){this.motorEquation.enabled=!0},f.prototype.disableMotor=function(){this.motorEquation.enabled=!1},f.prototype.setMotorSpeed=function(d){this.motorEquation.targetVelocity=d},f.prototype.setMotorMaxForce=function(d){this.motorEquation.maxForce=d,this.motorEquation.minForce=-d};var y=new m,l=new m;f.prototype.update=function(){var d=this.bodyA,v=this.bodyB,h=this.motorEquation,x=this.rotationalEquation1,w=this.rotationalEquation2,k=y,N=l,A=this.axisA,P=this.axisB;o.prototype.update.call(this),d.quaternion.vmult(A,k),v.quaternion.vmult(P,N),k.tangents(x.axisA,w.axisA),x.axisB.copy(N),w.axisB.copy(N),this.motorEquation.enabled&&(d.quaternion.vmult(this.axisA,h.axisA),v.quaternion.vmult(this.axisB,h.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,a,r){a.exports=f;var c=t("./Constraint"),o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),u=t("../equations/RotationalMotorEquation"),p=t("../equations/ContactEquation"),m=t("../math/Vec3");function f(d,v,h){h=h||{};var x=typeof h.maxForce<"u"?h.maxForce:1e6,w=new m,k=new m,N=new m;d.position.vadd(v.position,N),N.scale(.5,N),v.pointToLocalFrame(N,k),d.pointToLocalFrame(N,w),o.call(this,d,w,v,k,x);var A=this.rotationalEquation1=new i(d,v,h),P=this.rotationalEquation2=new i(d,v,h),M=this.rotationalEquation3=new i(d,v,h);this.equations.push(A,P,M)}f.prototype=new o,f.constructor=f;var y=new m,l=new m;f.prototype.update=function(){var d=this.bodyA,v=this.bodyB,h=this.motorEquation,x=this.rotationalEquation1,w=this.rotationalEquation2,k=this.rotationalEquation3,N=y,A=l;o.prototype.update.call(this),d.vectorToWorldFrame(m.UNIT_X,x.axisA),v.vectorToWorldFrame(m.UNIT_Y,x.axisB),d.vectorToWorldFrame(m.UNIT_Y,w.axisA),v.vectorToWorldFrame(m.UNIT_Z,w.axisB),d.vectorToWorldFrame(m.UNIT_Z,k.axisA),v.vectorToWorldFrame(m.UNIT_X,k.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,a,r){a.exports=u;var c=t("./Constraint"),o=t("../equations/ContactEquation"),i=t("../math/Vec3");function u(p,m,f,y,l){c.call(this,p,f),l=typeof l<"u"?l:1e6,this.pivotA=m?m.clone():new i,this.pivotB=y?y.clone():new i;var d=this.equationX=new o(p,f),v=this.equationY=new o(p,f),h=this.equationZ=new o(p,f);this.equations.push(d,v,h),d.minForce=v.minForce=h.minForce=-l,d.maxForce=v.maxForce=h.maxForce=l,d.ni.set(1,0,0),v.ni.set(0,1,0),h.ni.set(0,0,1)}u.prototype=new c,u.prototype.update=function(){var p=this.bodyA,m=this.bodyB,f=this.equationX,y=this.equationY,l=this.equationZ;p.quaternion.vmult(this.pivotA,f.ri),m.quaternion.vmult(this.pivotB,f.rj),y.ri.copy(f.ri),y.rj.copy(f.rj),l.ri.copy(f.ri),l.rj.copy(f.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Mat3"),i=t("./Equation");function u(f,y,l){l=l||{};var d=typeof l.maxForce<"u"?l.maxForce:1e6;i.call(this,f,y,-d,d),this.axisA=l.axisA?l.axisA.clone():new c(1,0,0),this.axisB=l.axisB?l.axisB.clone():new c(0,1,0),this.angle=typeof l.angle<"u"?l.angle:0}u.prototype=new i,u.prototype.constructor=u;var p=new c,m=new c;u.prototype.computeB=function(f){var y=this.a,l=this.b,d=this.axisA,v=this.axisB,h=p,x=m,w=this.jacobianElementA,k=this.jacobianElementB;d.cross(v,h),v.cross(d,x),w.rotational.copy(x),k.rotational.copy(h);var N=Math.cos(this.angle)-d.dot(v),A=this.computeGW(),P=this.computeGiMf(),M=-N*y-A*l-f*P;return M}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,a,r){a.exports=u;var c=t("./Equation"),o=t("../math/Vec3"),i=t("../math/Mat3");function u(x,w,k){k=typeof k<"u"?k:1e6,c.call(this,x,w,0,k),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}u.prototype=new c,u.prototype.constructor=u;var p=new o,m=new o,f=new o;u.prototype.computeB=function(x){var w=this.a,k=this.b,N=this.bi,A=this.bj,P=this.ri,M=this.rj,W=p,$=m,E=N.velocity,_=N.angularVelocity,O=N.force,V=N.torque,D=A.velocity,J=A.angularVelocity,ee=A.force,K=A.torque,de=f,_e=this.jacobianElementA,ze=this.jacobianElementB,Oe=this.ni;P.cross(Oe,W),M.cross(Oe,$),Oe.negate(_e.spatial),W.negate(_e.rotational),ze.spatial.copy(Oe),ze.rotational.copy($),de.copy(A.position),de.vadd(M,de),de.vsub(N.position,de),de.vsub(P,de);var je=Oe.dot(de),Pe=this.restitution+1,q=Pe*D.dot(Oe)-Pe*E.dot(Oe)+J.dot($)-_.dot(W),R=this.computeGiMf(),F=-je*w-q*k-x*R;return F};var y=new o,l=new o,d=new o,v=new o,h=new o;u.prototype.getImpactVelocityAlongNormal=function(){var x=y,w=l,k=d,N=v,A=h;return this.bi.position.vadd(this.ri,k),this.bj.position.vadd(this.rj,N),this.bi.getVelocityAtWorldPoint(k,x),this.bj.getVelocityAtWorldPoint(N,w),x.vsub(w,A),this.ni.dot(A)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,a,r){a.exports=i;var c=t("../math/JacobianElement"),o=t("../math/Vec3");function i(N,A,P,M){this.id=i.id++,this.minForce=typeof P>"u"?-1e6:P,this.maxForce=typeof M>"u"?1e6:M,this.bi=N,this.bj=A,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new c,this.jacobianElementB=new c,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}i.prototype.constructor=i,i.id=0,i.prototype.setSpookParams=function(N,A,P){var M=A,W=N,$=P;this.a=4/($*(1+4*M)),this.b=4*M/(1+4*M),this.eps=4/($*$*W*(1+4*M))},i.prototype.computeB=function(N,A,P){var M=this.computeGW(),W=this.computeGq(),$=this.computeGiMf();return-W*N-M*A-$*P},i.prototype.computeGq=function(){var N=this.jacobianElementA,A=this.jacobianElementB,P=this.bi,M=this.bj,W=P.position,$=M.position;return N.spatial.dot(W)+A.spatial.dot($)};var u=new o;i.prototype.computeGW=function(){var N=this.jacobianElementA,A=this.jacobianElementB,P=this.bi,M=this.bj,W=P.velocity,$=M.velocity,E=P.angularVelocity||u,_=M.angularVelocity||u;return N.multiplyVectors(W,E)+A.multiplyVectors($,_)},i.prototype.computeGWlambda=function(){var N=this.jacobianElementA,A=this.jacobianElementB,P=this.bi,M=this.bj,W=P.vlambda,$=M.vlambda,E=P.wlambda||u,_=M.wlambda||u;return N.multiplyVectors(W,E)+A.multiplyVectors($,_)};var p=new o,m=new o,f=new o,y=new o;i.prototype.computeGiMf=function(){var N=this.jacobianElementA,A=this.jacobianElementB,P=this.bi,M=this.bj,W=P.force,$=P.torque,E=M.force,_=M.torque,O=P.invMassSolve,V=M.invMassSolve;return P.invInertiaWorldSolve?P.invInertiaWorldSolve.vmult($,f):f.set(0,0,0),M.invInertiaWorldSolve?M.invInertiaWorldSolve.vmult(_,y):y.set(0,0,0),W.mult(O,p),E.mult(V,m),N.multiplyVectors(p,f)+A.multiplyVectors(m,y)};var l=new o;i.prototype.computeGiMGt=function(){var N=this.jacobianElementA,A=this.jacobianElementB,P=this.bi,M=this.bj,W=P.invMassSolve,$=M.invMassSolve,E=P.invInertiaWorldSolve,_=M.invInertiaWorldSolve,O=W+$;return E&&(E.vmult(N.rotational,l),O+=l.dot(N.rotational)),_&&(_.vmult(A.rotational,l),O+=l.dot(A.rotational)),O};var d=new o,v=new o,h=new o,x=new o,w=new o,k=new o;i.prototype.addToWlambda=function(N){var A=this.jacobianElementA,P=this.jacobianElementB,M=this.bi,W=this.bj,$=d;A.spatial.mult(M.invMassSolve*N,$),M.vlambda.vadd($,M.vlambda),P.spatial.mult(W.invMassSolve*N,$),W.vlambda.vadd($,W.vlambda),M.invInertiaWorldSolve&&(M.invInertiaWorldSolve.vmult(A.rotational,$),$.mult(N,$),M.wlambda.vadd($,M.wlambda)),W.invInertiaWorldSolve&&(W.invInertiaWorldSolve.vmult(P.rotational,$),$.mult(N,$),W.wlambda.vadd($,W.wlambda))},i.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,a,r){a.exports=u;var c=t("./Equation"),o=t("../math/Vec3"),i=t("../math/Mat3");function u(f,y,l){c.call(this,f,y,-l,l),this.ri=new o,this.rj=new o,this.t=new o}u.prototype=new c,u.prototype.constructor=u;var p=new o,m=new o;u.prototype.computeB=function(f){var y=this.a,l=this.b,d=this.bi,v=this.bj,h=this.ri,x=this.rj,w=p,k=m,N=this.t;h.cross(N,w),x.cross(N,k);var A=this.jacobianElementA,P=this.jacobianElementB;N.negate(A.spatial),w.negate(A.rotational),P.spatial.copy(N),P.rotational.copy(k);var M=this.computeGW(),W=this.computeGiMf(),$=-M*l-f*W;return $}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Mat3"),i=t("./Equation");function u(f,y,l){l=l||{};var d=typeof l.maxForce<"u"?l.maxForce:1e6;i.call(this,f,y,-d,d),this.axisA=l.axisA?l.axisA.clone():new c(1,0,0),this.axisB=l.axisB?l.axisB.clone():new c(0,1,0),this.maxAngle=Math.PI/2}u.prototype=new i,u.prototype.constructor=u;var p=new c,m=new c;u.prototype.computeB=function(f){var y=this.a,l=this.b,d=this.axisA,v=this.axisB,h=p,x=m,w=this.jacobianElementA,k=this.jacobianElementB;d.cross(v,h),v.cross(d,x),w.rotational.copy(x),k.rotational.copy(h);var N=Math.cos(this.maxAngle)-d.dot(v),A=this.computeGW(),P=this.computeGiMf(),M=-N*y-A*l-f*P;return M}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Mat3"),i=t("./Equation");function u(p,m,f){f=typeof f<"u"?f:1e6,i.call(this,p,m,-f,f),this.axisA=new c,this.axisB=new c,this.targetVelocity=0}u.prototype=new i,u.prototype.constructor=u,u.prototype.computeB=function(p){var m=this.a,f=this.b,y=this.bi,l=this.bj,d=this.axisA,v=this.axisB,h=this.jacobianElementA,x=this.jacobianElementB;h.rotational.copy(d),v.negate(x.rotational);var w=this.computeGW()-this.targetVelocity,k=this.computeGiMf(),N=-w*f-p*k;return N}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,a,r){var c=t("../utils/Utils");a.exports=o;function o(i,u,p){p=c.defaults(p,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=o.idCounter++,this.materials=[i,u],this.friction=p.friction,this.restitution=p.restitution,this.contactEquationStiffness=p.contactEquationStiffness,this.contactEquationRelaxation=p.contactEquationRelaxation,this.frictionEquationStiffness=p.frictionEquationStiffness,this.frictionEquationRelaxation=p.frictionEquationRelaxation}o.idCounter=0},{"../utils/Utils":53}],25:[function(t,a,r){a.exports=c;function c(o){var i="";o=o||{},typeof o=="string"?(i=o,o={}):typeof o=="object"&&(i=""),this.name=i,this.id=c.idCounter++,this.friction=typeof o.friction<"u"?o.friction:-1,this.restitution=typeof o.restitution<"u"?o.restitution:-1}c.idCounter=0},{}],26:[function(t,a,r){a.exports=o;var c=t("./Vec3");function o(){this.spatial=new c,this.rotational=new c}o.prototype.multiplyElement=function(i){return i.spatial.dot(this.spatial)+i.rotational.dot(this.rotational)},o.prototype.multiplyVectors=function(i,u){return i.dot(this.spatial)+u.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,a,r){a.exports=o;var c=t("./Vec3");function o(i){i?this.elements=i:this.elements=[0,0,0,0,0,0,0,0,0]}o.prototype.identity=function(){var i=this.elements;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1},o.prototype.setZero=function(){var i=this.elements;i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0},o.prototype.setTrace=function(i){var u=this.elements;u[0]=i.x,u[4]=i.y,u[8]=i.z},o.prototype.getTrace=function(u){var u=u||new c,p=this.elements;u.x=p[0],u.y=p[4],u.z=p[8]},o.prototype.vmult=function(i,u){u=u||new c;var p=this.elements,m=i.x,f=i.y,y=i.z;return u.x=p[0]*m+p[1]*f+p[2]*y,u.y=p[3]*m+p[4]*f+p[5]*y,u.z=p[6]*m+p[7]*f+p[8]*y,u},o.prototype.smult=function(i){for(var u=0;u<this.elements.length;u++)this.elements[u]*=i},o.prototype.mmult=function(i,u){for(var p=u||new o,m=0;m<3;m++)for(var f=0;f<3;f++){for(var y=0,l=0;l<3;l++)y+=i.elements[m+l*3]*this.elements[l+f*3];p.elements[m+f*3]=y}return p},o.prototype.scale=function(i,u){u=u||new o;for(var p=this.elements,m=u.elements,f=0;f!==3;f++)m[3*f+0]=i.x*p[3*f+0],m[3*f+1]=i.y*p[3*f+1],m[3*f+2]=i.z*p[3*f+2];return u},o.prototype.solve=function(i,u){u=u||new c;for(var p=3,m=4,f=[],y=0;y<p*m;y++)f.push(0);var y,l;for(y=0;y<3;y++)for(l=0;l<3;l++)f[y+m*l]=this.elements[y+3*l];f[3+4*0]=i.x,f[3+4*1]=i.y,f[3+4*2]=i.z;var d=3,v=d,h,x=4,w,k;do{if(y=v-d,f[y+m*y]===0){for(l=y+1;l<v;l++)if(f[y+m*l]!==0){h=x;do w=x-h,f[w+m*y]+=f[w+m*l];while(--h);break}}if(f[y+m*y]!==0)for(l=y+1;l<v;l++){var N=f[y+m*l]/f[y+m*y];h=x;do w=x-h,f[w+m*l]=w<=y?0:f[w+m*l]-f[w+m*y]*N;while(--h)}}while(--d);if(u.z=f[2*m+3]/f[2*m+2],u.y=(f[1*m+3]-f[1*m+2]*u.z)/f[1*m+1],u.x=(f[0*m+3]-f[0*m+2]*u.z-f[0*m+1]*u.y)/f[0*m+0],isNaN(u.x)||isNaN(u.y)||isNaN(u.z)||u.x===1/0||u.y===1/0||u.z===1/0)throw"Could not solve equation! Got x=["+u.toString()+"], b=["+i.toString()+"], A=["+this.toString()+"]";return u},o.prototype.e=function(i,u,p){if(p===void 0)return this.elements[u+3*i];this.elements[u+3*i]=p},o.prototype.copy=function(i){for(var u=0;u<i.elements.length;u++)this.elements[u]=i.elements[u];return this},o.prototype.toString=function(){for(var i="",u=",",p=0;p<9;p++)i+=this.elements[p]+u;return i},o.prototype.reverse=function(i){i=i||new o;for(var u=3,p=6,m=[],f=0;f<u*p;f++)m.push(0);var f,y;for(f=0;f<3;f++)for(y=0;y<3;y++)m[f+p*y]=this.elements[f+3*y];m[3+6*0]=1,m[3+6*1]=0,m[3+6*2]=0,m[4+6*0]=0,m[4+6*1]=1,m[4+6*2]=0,m[5+6*0]=0,m[5+6*1]=0,m[5+6*2]=1;var l=3,d=l,v,h=p,x;do{if(f=d-l,m[f+p*f]===0){for(y=f+1;y<d;y++)if(m[f+p*y]!==0){v=h;do x=h-v,m[x+p*f]+=m[x+p*y];while(--v);break}}if(m[f+p*f]!==0)for(y=f+1;y<d;y++){var w=m[f+p*y]/m[f+p*f];v=h;do x=h-v,m[x+p*y]=x<=f?0:m[x+p*y]-m[x+p*f]*w;while(--v)}}while(--l);f=2;do{y=f-1;do{var w=m[f+p*y]/m[f+p*f];v=p;do x=p-v,m[x+p*y]=m[x+p*y]-m[x+p*f]*w;while(--v)}while(y--)}while(--f);f=2;do{var w=1/m[f+p*f];v=p;do x=p-v,m[x+p*f]=m[x+p*f]*w;while(--v)}while(f--);f=2;do{y=2;do{if(x=m[u+y+p*f],isNaN(x)||x===1/0)throw"Could not reverse! A=["+this.toString()+"]";i.e(f,y,x)}while(y--)}while(f--);return i},o.prototype.setRotationFromQuaternion=function(i){var u=i.x,p=i.y,m=i.z,f=i.w,y=u+u,l=p+p,d=m+m,v=u*y,h=u*l,x=u*d,w=p*l,k=p*d,N=m*d,A=f*y,P=f*l,M=f*d,W=this.elements;return W[3*0+0]=1-(w+N),W[3*0+1]=h-M,W[3*0+2]=x+P,W[3*1+0]=h+M,W[3*1+1]=1-(v+N),W[3*1+2]=k-A,W[3*2+0]=x-P,W[3*2+1]=k+A,W[3*2+2]=1-(v+w),this},o.prototype.transpose=function(i){i=i||new o;for(var u=i.elements,p=this.elements,m=0;m!==3;m++)for(var f=0;f!==3;f++)u[3*m+f]=p[3*f+m];return i}},{"./Vec3":30}],28:[function(t,a,r){a.exports=o;var c=t("./Vec3");function o(y,l,d,v){this.x=y!==void 0?y:0,this.y=l!==void 0?l:0,this.z=d!==void 0?d:0,this.w=v!==void 0?v:1}o.prototype.set=function(y,l,d,v){this.x=y,this.y=l,this.z=d,this.w=v},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(y,l){var d=Math.sin(l*.5);this.x=y.x*d,this.y=y.y*d,this.z=y.z*d,this.w=Math.cos(l*.5)},o.prototype.toAxisAngle=function(y){y=y||new c,this.normalize();var l=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);return d<.001?(y.x=this.x,y.y=this.y,y.z=this.z):(y.x=this.x/d,y.y=this.y/d,y.z=this.z/d),[y,l]};var i=new c,u=new c;o.prototype.setFromVectors=function(y,l){if(y.isAntiparallelTo(l)){var d=i,v=u;y.tangents(d,v),this.setFromAxisAngle(d,Math.PI)}else{var h=y.cross(l);this.x=h.x,this.y=h.y,this.z=h.z,this.w=Math.sqrt(Math.pow(y.norm(),2)*Math.pow(l.norm(),2))+y.dot(l),this.normalize()}};var p=new c,m=new c,f=new c;o.prototype.mult=function(y,l){l=l||new o;var d=this.w,v=p,h=m,x=f;return v.set(this.x,this.y,this.z),h.set(y.x,y.y,y.z),l.w=d*y.w-v.dot(h),v.cross(h,x),l.x=d*h.x+y.w*v.x+x.x,l.y=d*h.y+y.w*v.y+x.y,l.z=d*h.z+y.w*v.z+x.z,l},o.prototype.inverse=function(y){var l=this.x,d=this.y,v=this.z,h=this.w;y=y||new o,this.conjugate(y);var x=1/(l*l+d*d+v*v+h*h);return y.x*=x,y.y*=x,y.z*=x,y.w*=x,y},o.prototype.conjugate=function(y){return y=y||new o,y.x=-this.x,y.y=-this.y,y.z=-this.z,y.w=this.w,y},o.prototype.normalize=function(){var y=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);y===0?(this.x=0,this.y=0,this.z=0,this.w=0):(y=1/y,this.x*=y,this.y*=y,this.z*=y,this.w*=y)},o.prototype.normalizeFast=function(){var y=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;y===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=y,this.y*=y,this.z*=y,this.w*=y)},o.prototype.vmult=function(y,l){l=l||new c;var d=y.x,v=y.y,h=y.z,x=this.x,w=this.y,k=this.z,N=this.w,A=N*d+w*h-k*v,P=N*v+k*d-x*h,M=N*h+x*v-w*d,W=-x*d-w*v-k*h;return l.x=A*N+W*-x+P*-k-M*-w,l.y=P*N+W*-w+M*-x-A*-k,l.z=M*N+W*-k+A*-w-P*-x,l},o.prototype.copy=function(y){return this.x=y.x,this.y=y.y,this.z=y.z,this.w=y.w,this},o.prototype.toEuler=function(y,l){l=l||"YZX";var d,v,h,x=this.x,w=this.y,k=this.z,N=this.w;switch(l){case"YZX":var A=x*w+k*N;if(A>.499&&(d=2*Math.atan2(x,N),v=Math.PI/2,h=0),A<-.499&&(d=-2*Math.atan2(x,N),v=-Math.PI/2,h=0),isNaN(d)){var P=x*x,M=w*w,W=k*k;d=Math.atan2(2*w*N-2*x*k,1-2*M-2*W),v=Math.asin(2*A),h=Math.atan2(2*x*N-2*w*k,1-2*P-2*W)}break;default:throw new Error("Euler order "+l+" not supported yet.")}y.y=d,y.z=v,y.x=h},o.prototype.setFromEuler=function(y,l,d,v){v=v||"XYZ";var h=Math.cos(y/2),x=Math.cos(l/2),w=Math.cos(d/2),k=Math.sin(y/2),N=Math.sin(l/2),A=Math.sin(d/2);return v==="XYZ"?(this.x=k*x*w+h*N*A,this.y=h*N*w-k*x*A,this.z=h*x*A+k*N*w,this.w=h*x*w-k*N*A):v==="YXZ"?(this.x=k*x*w+h*N*A,this.y=h*N*w-k*x*A,this.z=h*x*A-k*N*w,this.w=h*x*w+k*N*A):v==="ZXY"?(this.x=k*x*w-h*N*A,this.y=h*N*w+k*x*A,this.z=h*x*A+k*N*w,this.w=h*x*w-k*N*A):v==="ZYX"?(this.x=k*x*w-h*N*A,this.y=h*N*w+k*x*A,this.z=h*x*A-k*N*w,this.w=h*x*w+k*N*A):v==="YZX"?(this.x=k*x*w+h*N*A,this.y=h*N*w+k*x*A,this.z=h*x*A-k*N*w,this.w=h*x*w-k*N*A):v==="XZY"&&(this.x=k*x*w-h*N*A,this.y=h*N*w-k*x*A,this.z=h*x*A+k*N*w,this.w=h*x*w+k*N*A),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,a,r){var c=t("./Vec3"),o=t("./Quaternion");a.exports=i;function i(p){p=p||{},this.position=new c,p.position&&this.position.copy(p.position),this.quaternion=new o,p.quaternion&&this.quaternion.copy(p.quaternion)}var u=new o;i.pointToLocalFrame=function(p,m,f,l){var l=l||new c;return f.vsub(p,l),m.conjugate(u),u.vmult(l,l),l},i.prototype.pointToLocal=function(p,m){return i.pointToLocalFrame(this.position,this.quaternion,p,m)},i.pointToWorldFrame=function(p,m,f,l){var l=l||new c;return m.vmult(f,l),l.vadd(p,l),l},i.prototype.pointToWorld=function(p,m){return i.pointToWorldFrame(this.position,this.quaternion,p,m)},i.prototype.vectorToWorldFrame=function(p,f){var f=f||new c;return this.quaternion.vmult(p,f),f},i.vectorToWorldFrame=function(p,m,f){return p.vmult(m,f),f},i.vectorToLocalFrame=function(p,m,f,l){var l=l||new c;return m.w*=-1,m.vmult(f,l),m.w*=-1,l}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,a,r){a.exports=o;var c=t("./Mat3");function o(m,f,y){this.x=m||0,this.y=f||0,this.z=y||0}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1),o.prototype.cross=function(m,f){var y=m.x,l=m.y,d=m.z,v=this.x,h=this.y,x=this.z;return f=f||new o,f.x=h*d-x*l,f.y=x*y-v*d,f.z=v*l-h*y,f},o.prototype.set=function(m,f,y){return this.x=m,this.y=f,this.z=y,this},o.prototype.setZero=function(){this.x=this.y=this.z=0},o.prototype.vadd=function(m,f){if(f)f.x=m.x+this.x,f.y=m.y+this.y,f.z=m.z+this.z;else return new o(this.x+m.x,this.y+m.y,this.z+m.z)},o.prototype.vsub=function(m,f){if(f)f.x=this.x-m.x,f.y=this.y-m.y,f.z=this.z-m.z;else return new o(this.x-m.x,this.y-m.y,this.z-m.z)},o.prototype.crossmat=function(){return new c([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},o.prototype.normalize=function(){var m=this.x,f=this.y,y=this.z,l=Math.sqrt(m*m+f*f+y*y);if(l>0){var d=1/l;this.x*=d,this.y*=d,this.z*=d}else this.x=0,this.y=0,this.z=0;return l},o.prototype.unit=function(m){m=m||new o;var f=this.x,y=this.y,l=this.z,d=Math.sqrt(f*f+y*y+l*l);return d>0?(d=1/d,m.x=f*d,m.y=y*d,m.z=l*d):(m.x=1,m.y=0,m.z=0),m},o.prototype.norm=function(){var m=this.x,f=this.y,y=this.z;return Math.sqrt(m*m+f*f+y*y)},o.prototype.length=o.prototype.norm,o.prototype.norm2=function(){return this.dot(this)},o.prototype.lengthSquared=o.prototype.norm2,o.prototype.distanceTo=function(m){var f=this.x,y=this.y,l=this.z,d=m.x,v=m.y,h=m.z;return Math.sqrt((d-f)*(d-f)+(v-y)*(v-y)+(h-l)*(h-l))},o.prototype.distanceSquared=function(m){var f=this.x,y=this.y,l=this.z,d=m.x,v=m.y,h=m.z;return(d-f)*(d-f)+(v-y)*(v-y)+(h-l)*(h-l)},o.prototype.mult=function(m,f){f=f||new o;var y=this.x,l=this.y,d=this.z;return f.x=m*y,f.y=m*l,f.z=m*d,f},o.prototype.scale=o.prototype.mult,o.prototype.dot=function(m){return this.x*m.x+this.y*m.y+this.z*m.z},o.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},o.prototype.negate=function(m){return m=m||new o,m.x=-this.x,m.y=-this.y,m.z=-this.z,m};var i=new o,u=new o;o.prototype.tangents=function(m,f){var y=this.norm();if(y>0){var l=i,d=1/y;l.set(this.x*d,this.y*d,this.z*d);var v=u;Math.abs(l.x)<.9?(v.set(1,0,0),l.cross(v,m)):(v.set(0,1,0),l.cross(v,m)),l.cross(m,f)}else m.set(1,0,0),f.set(0,1,0)},o.prototype.toString=function(){return this.x+","+this.y+","+this.z},o.prototype.toArray=function(){return[this.x,this.y,this.z]},o.prototype.copy=function(m){return this.x=m.x,this.y=m.y,this.z=m.z,this},o.prototype.lerp=function(m,f,y){var l=this.x,d=this.y,v=this.z;y.x=l+(m.x-l)*f,y.y=d+(m.y-d)*f,y.z=v+(m.z-v)*f},o.prototype.almostEquals=function(m,f){return f===void 0&&(f=1e-6),!(Math.abs(this.x-m.x)>f||Math.abs(this.y-m.y)>f||Math.abs(this.z-m.z)>f)},o.prototype.almostZero=function(m){return m===void 0&&(m=1e-6),!(Math.abs(this.x)>m||Math.abs(this.y)>m||Math.abs(this.z)>m)};var p=new o;o.prototype.isAntiparallelTo=function(m,f){return this.negate(p),p.almostEquals(m,f)},o.prototype.clone=function(){return new o(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,a,r){a.exports=l;var c=t("../utils/EventTarget"),o=t("../shapes/Shape"),i=t("../math/Vec3"),u=t("../math/Mat3"),p=t("../math/Quaternion"),m=t("../material/Material"),f=t("../collision/AABB"),y=t("../shapes/Box");function l(D){D=D||{},c.apply(this),this.id=l.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup=typeof D.collisionFilterGroup=="number"?D.collisionFilterGroup:1,this.collisionFilterMask=typeof D.collisionFilterMask=="number"?D.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,D.position&&this.position.copy(D.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,D.velocity&&this.velocity.copy(D.velocity),this.initVelocity=new i,this.force=new i;var J=typeof D.mass=="number"?D.mass:0;this.mass=J,this.invMass=J>0?1/J:0,this.material=D.material||null,this.linearDamping=typeof D.linearDamping=="number"?D.linearDamping:.01,this.type=J<=0?l.STATIC:l.DYNAMIC,typeof D.type==typeof l.STATIC&&(this.type=D.type),this.allowSleep=typeof D.allowSleep<"u"?D.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof D.sleepSpeedLimit<"u"?D.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof D.sleepTimeLimit<"u"?D.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new p,D.quaternion&&this.quaternion.copy(D.quaternion),this.initQuaternion=new p,this.angularVelocity=new i,D.angularVelocity&&this.angularVelocity.copy(D.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new p,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new u,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new u,this.fixedRotation=typeof D.fixedRotation<"u"?D.fixedRotation:!1,this.angularDamping=typeof D.angularDamping<"u"?D.angularDamping:.01,this.aabb=new f,this.aabbNeedsUpdate=!0,this.wlambda=new i,D.shape&&this.addShape(D.shape),this.updateMassProperties()}l.prototype=new c,l.prototype.constructor=l,l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2,l.idCounter=0,l.prototype.wakeUp=function(){var D=this.sleepState;this.sleepState=0,D===l.SLEEPING&&this.dispatchEvent({type:"wakeup"})},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.prototype.sleepTick=function(D){if(this.allowSleep){var J=this.sleepState,ee=this.velocity.norm2()+this.angularVelocity.norm2(),K=Math.pow(this.sleepSpeedLimit,2);J===l.AWAKE&&ee<K?(this.sleepState=l.SLEEPY,this.timeLastSleepy=D,this.dispatchEvent(l.sleepyEvent)):J===l.SLEEPY&&ee>K?this.wakeUp():J===l.SLEEPY&&D-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(l.sleepEvent))}},l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},l.prototype.pointToLocalFrame=function(D,ee){var ee=ee||new i;return D.vsub(this.position,ee),this.quaternion.conjugate().vmult(ee,ee),ee},l.prototype.vectorToLocalFrame=function(D,ee){var ee=ee||new i;return this.quaternion.conjugate().vmult(D,ee),ee},l.prototype.pointToWorldFrame=function(D,ee){var ee=ee||new i;return this.quaternion.vmult(D,ee),ee.vadd(this.position,ee),ee},l.prototype.vectorToWorldFrame=function(D,ee){var ee=ee||new i;return this.quaternion.vmult(D,ee),ee};var d=new i,v=new p;l.prototype.addShape=function(D,J,ee){var K=new i,de=new p;return J&&K.copy(J),ee&&de.copy(ee),this.shapes.push(D),this.shapeOffsets.push(K),this.shapeOrientations.push(de),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},l.prototype.updateBoundingRadius=function(){for(var D=this.shapes,J=this.shapeOffsets,ee=D.length,K=0,de=0;de!==ee;de++){var _e=D[de];_e.updateBoundingSphereRadius();var ze=J[de].norm(),Oe=_e.boundingSphereRadius;ze+Oe>K&&(K=ze+Oe)}this.boundingRadius=K};var h=new f;l.prototype.computeAABB=function(){for(var D=this.shapes,J=this.shapeOffsets,ee=this.shapeOrientations,K=D.length,de=d,_e=v,ze=this.quaternion,Oe=this.aabb,je=h,Pe=0;Pe!==K;Pe++){var q=D[Pe];ee[Pe].mult(ze,_e),_e.vmult(J[Pe],de),de.vadd(this.position,de),q.calculateWorldAABB(de,_e,je.lowerBound,je.upperBound),Pe===0?Oe.copy(je):Oe.extend(je)}this.aabbNeedsUpdate=!1};var x=new u,w=new u,k=new u;l.prototype.updateInertiaWorld=function(D){var J=this.invInertia;if(!(J.x===J.y&&J.y===J.z&&!D)){var ee=x,K=w,de=k;ee.setRotationFromQuaternion(this.quaternion),ee.transpose(K),ee.scale(J,ee),ee.mmult(K,this.invInertiaWorld)}};var N=new i,A=new i;l.prototype.applyForce=function(D,J){if(this.type===l.DYNAMIC){var ee=N;J.vsub(this.position,ee);var K=A;ee.cross(D,K),this.force.vadd(D,this.force),this.torque.vadd(K,this.torque)}};var P=new i,M=new i;l.prototype.applyLocalForce=function(D,J){if(this.type===l.DYNAMIC){var ee=P,K=M;this.vectorToWorldFrame(D,ee),this.pointToWorldFrame(J,K),this.applyForce(ee,K)}};var W=new i,$=new i,E=new i;l.prototype.applyImpulse=function(D,J){if(this.type===l.DYNAMIC){var ee=W;J.vsub(this.position,ee);var K=$;K.copy(D),K.mult(this.invMass,K),this.velocity.vadd(K,this.velocity);var de=E;ee.cross(D,de),this.invInertiaWorld.vmult(de,de),this.angularVelocity.vadd(de,this.angularVelocity)}};var _=new i,O=new i;l.prototype.applyLocalImpulse=function(D,J){if(this.type===l.DYNAMIC){var ee=_,K=O;this.vectorToWorldFrame(D,ee),this.pointToWorldFrame(J,K),this.applyImpulse(ee,K)}};var V=new i;l.prototype.updateMassProperties=function(){var D=V;this.invMass=this.mass>0?1/this.mass:0;var J=this.inertia,ee=this.fixedRotation;this.computeAABB(),D.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),y.calculateInertia(D,this.mass,J),this.invInertia.set(J.x>0&&!ee?1/J.x:0,J.y>0&&!ee?1/J.y:0,J.z>0&&!ee?1/J.z:0),this.updateInertiaWorld(!0)},l.prototype.getVelocityAtWorldPoint=function(D,J){var ee=new i;return D.vsub(this.position,ee),this.angularVelocity.cross(ee,J),this.velocity.vadd(J,J),J}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,a,r){var c=t("./Body"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../collision/RaycastResult"),p=t("../collision/Ray"),m=t("../objects/WheelInfo");a.exports=f;function f(q){this.chassisBody=q.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof q.indexRightAxis<"u"?q.indexRightAxis:1,this.indexForwardAxis=typeof q.indexForwardAxis<"u"?q.indexForwardAxis:0,this.indexUpAxis=typeof q.indexUpAxis<"u"?q.indexUpAxis:2}var y=new o,l=new o,d=new o,v=new o,h=new o,x=new o,w=new p;f.prototype.addWheel=function(q){q=q||{};var R=new m(q),F=this.wheelInfos.length;return this.wheelInfos.push(R),F},f.prototype.setSteeringValue=function(q,R){var F=this.wheelInfos[R];F.steering=q};var k=new o;f.prototype.applyEngineForce=function(q,R){this.wheelInfos[R].engineForce=q},f.prototype.setBrake=function(q,R){this.wheelInfos[R].brake=q},f.prototype.addToWorld=function(q){var R=this.constraints;q.add(this.chassisBody);var F=this;this.preStepCallback=function(){F.updateVehicle(q.dt)},q.addEventListener("preStep",this.preStepCallback),this.world=q},f.prototype.getVehicleAxisWorld=function(q,R){R.set(q===0?1:0,q===1?1:0,q===2?1:0),this.chassisBody.vectorToWorldFrame(R,R)},f.prototype.updateVehicle=function(q){for(var R=this.wheelInfos,F=R.length,Z=this.chassisBody,T=0;T<F;T++)this.updateWheelTransform(T);this.currentVehicleSpeedKmHour=3.6*Z.velocity.norm();var L=new o;this.getVehicleAxisWorld(this.indexForwardAxis,L),L.dot(Z.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var T=0;T<F;T++)this.castRay(R[T]);this.updateSuspension(q);for(var re=new o,ye=new o,T=0;T<F;T++){var Y=R[T],C=Y.suspensionForce;C>Y.maxSuspensionForce&&(C=Y.maxSuspensionForce),Y.raycastResult.hitNormalWorld.scale(C*q,re),Y.raycastResult.hitPointWorld.vsub(Z.position,ye),Z.applyImpulse(re,Y.raycastResult.hitPointWorld)}this.updateFriction(q);var te=new o,se=new o,le=new o;for(T=0;T<F;T++){var Y=R[T];Z.getVelocityAtWorldPoint(Y.chassisConnectionPointWorld,le);var pe=1;switch(this.indexUpAxis){case 1:pe=-1;break}if(Y.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,se);var ve=se.dot(Y.raycastResult.hitNormalWorld);Y.raycastResult.hitNormalWorld.scale(ve,te),se.vsub(te,se);var xe=se.dot(le);Y.deltaRotation=pe*xe*q/Y.radius}(Y.sliding||!Y.isInContact)&&Y.engineForce!==0&&Y.useCustomSlidingRotationalSpeed&&(Y.deltaRotation=(Y.engineForce>0?1:-1)*Y.customSlidingRotationalSpeed*q),Math.abs(Y.brake)>Math.abs(Y.engineForce)&&(Y.deltaRotation=0),Y.rotation+=Y.deltaRotation,Y.deltaRotation*=.99}},f.prototype.updateSuspension=function(q){for(var R=this.chassisBody,F=R.mass,Z=this.wheelInfos,T=Z.length,L=0;L<T;L++){var re=Z[L];if(re.isInContact){var ye,Y=re.suspensionRestLength,C=re.suspensionLength,te=Y-C;ye=re.suspensionStiffness*te*re.clippedInvContactDotSuspension;var se=re.suspensionRelativeVelocity,le;se<0?le=re.dampingCompression:le=re.dampingRelaxation,ye-=le*se,re.suspensionForce=ye*F,re.suspensionForce<0&&(re.suspensionForce=0)}else re.suspensionForce=0}},f.prototype.removeFromWorld=function(q){var R=this.constraints;q.remove(this.chassisBody),q.removeEventListener("preStep",this.preStepCallback),this.world=null};var N=new o,A=new o;f.prototype.castRay=function(q){var R=N,F=A;this.updateWheelTransformWorld(q);var Z=this.chassisBody,T=-1,L=q.suspensionRestLength+q.radius;q.directionWorld.scale(L,R);var re=q.chassisConnectionPointWorld;re.vadd(R,F);var ye=q.raycastResult,Y=0;ye.reset();var C=Z.collisionResponse;Z.collisionResponse=!1,this.world.rayTest(re,F,ye),Z.collisionResponse=C;var te=ye.body;if(q.raycastResult.groundObject=0,te){T=ye.distance,q.raycastResult.hitNormalWorld=ye.hitNormalWorld,q.isInContact=!0;var se=ye.distance;q.suspensionLength=se-q.radius;var le=q.suspensionRestLength-q.maxSuspensionTravel,pe=q.suspensionRestLength+q.maxSuspensionTravel;q.suspensionLength<le&&(q.suspensionLength=le),q.suspensionLength>pe&&(q.suspensionLength=pe,q.raycastResult.reset());var ve=q.raycastResult.hitNormalWorld.dot(q.directionWorld),xe=new o;Z.getVelocityAtWorldPoint(q.raycastResult.hitPointWorld,xe);var Se=q.raycastResult.hitNormalWorld.dot(xe);if(ve>=-.1)q.suspensionRelativeVelocity=0,q.clippedInvContactDotSuspension=1/.1;else{var Re=-1/ve;q.suspensionRelativeVelocity=Se*Re,q.clippedInvContactDotSuspension=Re}}else q.suspensionLength=q.suspensionRestLength+0*q.maxSuspensionTravel,q.suspensionRelativeVelocity=0,q.directionWorld.scale(-1,q.raycastResult.hitNormalWorld),q.clippedInvContactDotSuspension=1;return T},f.prototype.updateWheelTransformWorld=function(q){q.isInContact=!1;var R=this.chassisBody;R.pointToWorldFrame(q.chassisConnectionPointLocal,q.chassisConnectionPointWorld),R.vectorToWorldFrame(q.directionLocal,q.directionWorld),R.vectorToWorldFrame(q.axleLocal,q.axleWorld)},f.prototype.updateWheelTransform=function(q){var R=v,F=h,Z=x,T=this.wheelInfos[q];this.updateWheelTransformWorld(T),T.directionLocal.scale(-1,R),F.copy(T.axleLocal),R.cross(F,Z),Z.normalize(),F.normalize();var L=T.steering,re=new i;re.setFromAxisAngle(R,L);var ye=new i;ye.setFromAxisAngle(F,T.rotation);var Y=T.worldTransform.quaternion;this.chassisBody.quaternion.mult(re,Y),Y.mult(ye,Y),Y.normalize();var C=T.worldTransform.position;C.copy(T.directionWorld),C.scale(T.suspensionLength,C),C.vadd(T.chassisConnectionPointWorld,C)};var P=[new o(1,0,0),new o(0,1,0),new o(0,0,1)];f.prototype.getWheelTransformWorld=function(q){return this.wheelInfos[q].worldTransform};var M=new o,W=[],$=[],E=1;f.prototype.updateFriction=function(q){for(var R=M,F=this.wheelInfos,Z=F.length,T=this.chassisBody,L=$,re=W,ye=0,Y=0;Y<Z;Y++){var C=F[Y],te=C.raycastResult.body;te&&ye++,C.sideImpulse=0,C.forwardImpulse=0,L[Y]||(L[Y]=new o),re[Y]||(re[Y]=new o)}for(var Y=0;Y<Z;Y++){var C=F[Y],te=C.raycastResult.body;if(te){var se=re[Y],le=this.getWheelTransformWorld(Y);le.vectorToWorldFrame(P[this.indexRightAxis],se);var pe=C.raycastResult.hitNormalWorld,ve=se.dot(pe);pe.scale(ve,R),se.vsub(R,se),se.normalize(),pe.cross(se,L[Y]),L[Y].normalize(),C.sideImpulse=Pe(T,C.raycastResult.hitPointWorld,te,C.raycastResult.hitPointWorld,se),C.sideImpulse*=E}}var xe=1,Se=.5;this.sliding=!1;for(var Y=0;Y<Z;Y++){var C=F[Y],te=C.raycastResult.body,Re=0;if(C.slipInfo=1,te){var Fe=0,Me=C.brake?C.brake:Fe;Re=D(T,te,C.raycastResult.hitPointWorld,L[Y],Me),Re+=C.engineForce*q;var Te=Me/Re;C.slipInfo*=Te}if(C.forwardImpulse=0,C.skidInfo=1,te){C.skidInfo=1;var Xe=C.suspensionForce*q*C.frictionSlip,Ge=Xe,et=Xe*Ge;C.forwardImpulse=Re;var nt=C.forwardImpulse*Se,yt=C.sideImpulse*xe,wt=nt*nt+yt*yt;if(C.sliding=!1,wt>et){this.sliding=!0,C.sliding=!0;var Te=Xe/Math.sqrt(wt);C.skidInfo*=Te}}}if(this.sliding)for(var Y=0;Y<Z;Y++){var C=F[Y];C.sideImpulse!==0&&C.skidInfo<1&&(C.forwardImpulse*=C.skidInfo,C.sideImpulse*=C.skidInfo)}for(var Y=0;Y<Z;Y++){var C=F[Y],mt=new o;if(mt.copy(C.raycastResult.hitPointWorld),C.forwardImpulse!==0){var Dt=new o;L[Y].scale(C.forwardImpulse,Dt),T.applyImpulse(Dt,mt)}if(C.sideImpulse!==0){var te=C.raycastResult.body,Ie=new o;Ie.copy(C.raycastResult.hitPointWorld);var Le=new o;re[Y].scale(C.sideImpulse,Le),T.pointToLocalFrame(mt,mt),mt["xyz"[this.indexUpAxis]]*=C.rollInfluence,T.pointToWorldFrame(mt,mt),T.applyImpulse(Le,mt),Le.scale(-1,Le),te.applyImpulse(Le,Ie)}}};var _=new o,O=new o,V=new o;function D(q,R,F,Z,T){var L=0,re=F,ye=_,Y=O,C=V;q.getVelocityAtWorldPoint(re,ye),R.getVelocityAtWorldPoint(re,Y),ye.vsub(Y,C);var te=Z.dot(C),se=_e(q,F,Z),le=_e(R,F,Z),pe=1,ve=pe/(se+le);return L=-te*ve,T<L&&(L=T),L<-T&&(L=-T),L}var J=new o,ee=new o,K=new o,de=new o;function _e(q,R,F){var Z=J,T=ee,L=K,re=de;return R.vsub(q.position,Z),Z.cross(F,T),q.invInertiaWorld.vmult(T,re),re.cross(Z,L),q.invMass+F.dot(L)}var ze=new o,Oe=new o,je=new o;function Pe(q,R,F,Z,T,pe){var re=T.norm2();if(re>1.1)return 0;var ye=ze,Y=Oe,C=je;q.getVelocityAtWorldPoint(R,ye),F.getVelocityAtWorldPoint(Z,Y),ye.vsub(Y,C);var te=T.dot(C),se=.2,le=1/(q.invMass+F.invMass),pe=-se*te*le;return pe}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,a,r){var c=t("./Body"),o=t("../shapes/Sphere"),i=t("../shapes/Box"),u=t("../math/Vec3"),p=t("../constraints/HingeConstraint");a.exports=m;function m(l){if(this.wheelBodies=[],this.coordinateSystem=typeof l.coordinateSystem>"u"?new u(1,2,3):l.coordinateSystem.clone(),this.chassisBody=l.chassisBody,!this.chassisBody){var d=new i(new u(5,2,.5));this.chassisBody=new c(1,d)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}m.prototype.addWheel=function(l){l=l||{};var d=l.body;d||(d=new c(1,new o(1.2))),this.wheelBodies.push(d),this.wheelForces.push(0);var v=new u,h=typeof l.position<"u"?l.position.clone():new u,x=new u;this.chassisBody.pointToWorldFrame(h,x),d.position.set(x.x,x.y,x.z);var w=typeof l.axis<"u"?l.axis.clone():new u(0,1,0);this.wheelAxes.push(w);var k=new p(this.chassisBody,d,{pivotA:h,axisA:w,pivotB:u.ZERO,axisB:w,collideConnected:!1});return this.constraints.push(k),this.wheelBodies.length-1},m.prototype.setSteeringValue=function(l,d){var v=this.wheelAxes[d],h=Math.cos(l),x=Math.sin(l),w=v.x,k=v.y;this.constraints[d].axisA.set(h*w-x*k,x*w+h*k,0)},m.prototype.setMotorSpeed=function(l,d){var v=this.constraints[d];v.enableMotor(),v.motorTargetVelocity=l},m.prototype.disableMotor=function(l){var d=this.constraints[l];d.disableMotor()};var f=new u;m.prototype.setWheelForce=function(l,d){this.wheelForces[d]=l},m.prototype.applyWheelForce=function(l,d){var v=this.wheelAxes[d],h=this.wheelBodies[d],x=h.torque;v.scale(l,f),h.vectorToWorldFrame(f,f),x.vadd(f,x)},m.prototype.addToWorld=function(l){for(var d=this.constraints,v=this.wheelBodies.concat([this.chassisBody]),h=0;h<v.length;h++)l.add(v[h]);for(var h=0;h<d.length;h++)l.addConstraint(d[h]);l.addEventListener("preStep",this._update.bind(this))},m.prototype._update=function(){for(var l=this.wheelForces,d=0;d<l.length;d++)this.applyWheelForce(l[d],d)},m.prototype.removeFromWorld=function(l){for(var d=this.constraints,v=this.wheelBodies.concat([this.chassisBody]),h=0;h<v.length;h++)l.remove(v[h]);for(var h=0;h<d.length;h++)l.removeConstraint(d[h])};var y=new u;m.prototype.getWheelSpeed=function(l){var d=this.wheelAxes[l],v=this.wheelBodies[l],h=v.angularVelocity;return this.chassisBody.vectorToWorldFrame(d,y),h.dot(y)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,a,r){a.exports=f;var c=t("../shapes/Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../shapes/Particle"),p=t("../objects/Body"),m=t("../material/Material");function f(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}f.prototype.add=function(k){this.particles.push(k),this.neighbors.length<this.particles.length&&this.neighbors.push([])},f.prototype.remove=function(k){var N=this.particles.indexOf(k);N!==-1&&(this.particles.splice(N,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var y=new o;f.prototype.getNeighbors=function(k,N){for(var A=this.particles.length,P=k.id,M=this.smoothingRadius*this.smoothingRadius,W=y,$=0;$!==A;$++){var E=this.particles[$];E.position.vsub(k.position,W),P!==E.id&&W.norm2()<M&&N.push(E)}};var l=new o,d=new o,v=new o,h=new o,x=new o,w=new o;f.prototype.update=function(){for(var k=this.particles.length,N=l,A=this.speedOfSound,P=this.eps,M=0;M!==k;M++){var W=this.particles[M],$=this.neighbors[M];$.length=0,this.getNeighbors(W,$),$.push(this.particles[M]);for(var E=$.length,_=0,O=0;O!==E;O++){W.position.vsub($[O].position,N);var V=N.norm(),D=this.w(V);_+=$[O].mass*D}this.densities[M]=_,this.pressures[M]=A*A*(this.densities[M]-this.density)}for(var J=d,ee=v,K=h,de=x,_e=w,M=0;M!==k;M++){var ze=this.particles[M];J.set(0,0,0),ee.set(0,0,0);for(var Oe,je,Pe,$=this.neighbors[M],E=$.length,O=0;O!==E;O++){var q=$[O];ze.position.vsub(q.position,de);var R=de.norm();Oe=-q.mass*(this.pressures[M]/(this.densities[M]*this.densities[M]+P)+this.pressures[O]/(this.densities[O]*this.densities[O]+P)),this.gradw(de,K),K.mult(Oe,K),J.vadd(K,J),q.velocity.vsub(ze.velocity,_e),_e.mult(1/(1e-4+this.densities[M]*this.densities[O])*this.viscosity*q.mass,_e),je=this.nablaw(R),_e.mult(je,_e),ee.vadd(_e,ee)}ee.mult(ze.mass,ee),J.mult(ze.mass,J),ze.force.vadd(ee,ze.force),ze.force.vadd(J,ze.force)}},f.prototype.w=function(k){var N=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(N,9))*Math.pow(N*N-k*k,3)},f.prototype.gradw=function(k,N){var A=k.norm(),P=this.smoothingRadius;k.mult(945/(32*Math.PI*Math.pow(P,9))*Math.pow(P*P-A*A,2),N)},f.prototype.nablaw=function(k){var N=this.smoothingRadius,A=945/(32*Math.PI*Math.pow(N,9))*(N*N-k*k)*(7*k*k-3*N*N);return A}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,a,r){var c=t("../math/Vec3");a.exports=o;function o(w,k,N){N=N||{},this.restLength=typeof N.restLength=="number"?N.restLength:1,this.stiffness=N.stiffness||100,this.damping=N.damping||1,this.bodyA=w,this.bodyB=k,this.localAnchorA=new c,this.localAnchorB=new c,N.localAnchorA&&this.localAnchorA.copy(N.localAnchorA),N.localAnchorB&&this.localAnchorB.copy(N.localAnchorB),N.worldAnchorA&&this.setWorldAnchorA(N.worldAnchorA),N.worldAnchorB&&this.setWorldAnchorB(N.worldAnchorB)}o.prototype.setWorldAnchorA=function(w){this.bodyA.pointToLocalFrame(w,this.localAnchorA)},o.prototype.setWorldAnchorB=function(w){this.bodyB.pointToLocalFrame(w,this.localAnchorB)},o.prototype.getWorldAnchorA=function(w){this.bodyA.pointToWorldFrame(this.localAnchorA,w)},o.prototype.getWorldAnchorB=function(w){this.bodyB.pointToWorldFrame(this.localAnchorB,w)};var i=new c,u=new c,p=new c,m=new c,f=new c,y=new c,l=new c,d=new c,v=new c,h=new c,x=new c;o.prototype.applyForce=function(){var w=this.stiffness,k=this.damping,N=this.restLength,A=this.bodyA,P=this.bodyB,M=i,W=u,$=p,E=m,_=x,O=f,V=y,D=l,J=d,ee=v,K=h;this.getWorldAnchorA(O),this.getWorldAnchorB(V),O.vsub(A.position,D),V.vsub(P.position,J),V.vsub(O,M);var de=M.norm();W.copy(M),W.normalize(),P.velocity.vsub(A.velocity,$),P.angularVelocity.cross(J,_),$.vadd(_,$),A.angularVelocity.cross(D,_),$.vsub(_,$),W.mult(-w*(de-N)-k*$.dot(W),E),A.force.vsub(E,A.force),P.force.vadd(E,P.force),D.cross(E,ee),J.cross(E,K),A.torque.vsub(ee,A.torque),P.torque.vadd(K,P.torque)}},{"../math/Vec3":30}],36:[function(t,a,r){var c=t("../math/Vec3"),o=t("../math/Transform"),i=t("../collision/RaycastResult"),u=t("../utils/Utils");a.exports=p;function p(y){y=u.defaults(y,{chassisConnectionPointLocal:new c,chassisConnectionPointWorld:new c,directionLocal:new c,directionWorld:new c,axleLocal:new c,axleWorld:new c,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=y.maxSuspensionTravel,this.customSlidingRotationalSpeed=y.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=y.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=y.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=y.chassisConnectionPointWorld.clone(),this.directionLocal=y.directionLocal.clone(),this.directionWorld=y.directionWorld.clone(),this.axleLocal=y.axleLocal.clone(),this.axleWorld=y.axleWorld.clone(),this.suspensionRestLength=y.suspensionRestLength,this.suspensionMaxLength=y.suspensionMaxLength,this.radius=y.radius,this.suspensionStiffness=y.suspensionStiffness,this.dampingCompression=y.dampingCompression,this.dampingRelaxation=y.dampingRelaxation,this.frictionSlip=y.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=y.rollInfluence,this.maxSuspensionForce=y.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=y.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new i,this.worldTransform=new o,this.isInContact=!1}var f=new c,m=new c,f=new c;p.prototype.updateWheel=function(y){var l=this.raycastResult;if(this.isInContact){var d=l.hitNormalWorld.dot(l.directionWorld);l.hitPointWorld.vsub(y.position,m),y.getVelocityAtWorldPoint(m,f);var v=l.hitNormalWorld.dot(f);if(d>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var h=-1/d;this.suspensionRelativeVelocity=v*h,this.clippedInvContactDotSuspension=h}}else l.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,l.directionWorld.scale(-1,l.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,a,r){a.exports=u;var c=t("./Shape"),o=t("../math/Vec3"),i=t("./ConvexPolyhedron");function u(y){c.call(this),this.type=c.types.BOX,this.halfExtents=y,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}u.prototype=new c,u.prototype.constructor=u,u.prototype.updateConvexPolyhedronRepresentation=function(){var y=this.halfExtents.x,l=this.halfExtents.y,d=this.halfExtents.z,v=o,h=[new v(-y,-l,-d),new v(y,-l,-d),new v(y,l,-d),new v(-y,l,-d),new v(-y,-l,d),new v(y,-l,d),new v(y,l,d),new v(-y,l,d)],x=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],w=[new v(0,0,1),new v(0,1,0),new v(1,0,0)],k=new i(h,x);this.convexPolyhedronRepresentation=k,k.material=this.material},u.prototype.calculateLocalInertia=function(y,l){return l=l||new o,u.calculateInertia(this.halfExtents,y,l),l},u.calculateInertia=function(y,l,d){var v=y;d.x=1/12*l*(2*v.y*2*v.y+2*v.z*2*v.z),d.y=1/12*l*(2*v.x*2*v.x+2*v.z*2*v.z),d.z=1/12*l*(2*v.y*2*v.y+2*v.x*2*v.x)},u.prototype.getSideNormals=function(y,l){var d=y,v=this.halfExtents;if(d[0].set(v.x,0,0),d[1].set(0,v.y,0),d[2].set(0,0,v.z),d[3].set(-v.x,0,0),d[4].set(0,-v.y,0),d[5].set(0,0,-v.z),l!==void 0)for(var h=0;h!==d.length;h++)l.vmult(d[h],d[h]);return d},u.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},u.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var p=new o,m=new o;u.prototype.forEachWorldCorner=function(y,l,d){for(var v=this.halfExtents,h=[[v.x,v.y,v.z],[-v.x,v.y,v.z],[-v.x,-v.y,v.z],[-v.x,-v.y,-v.z],[v.x,-v.y,-v.z],[v.x,v.y,-v.z],[-v.x,v.y,-v.z],[v.x,-v.y,v.z]],x=0;x<h.length;x++)p.set(h[x][0],h[x][1],h[x][2]),l.vmult(p,p),y.vadd(p,p),d(p.x,p.y,p.z)};var f=[new o,new o,new o,new o,new o,new o,new o,new o];u.prototype.calculateWorldAABB=function(y,l,d,v){var h=this.halfExtents;f[0].set(h.x,h.y,h.z),f[1].set(-h.x,h.y,h.z),f[2].set(-h.x,-h.y,h.z),f[3].set(-h.x,-h.y,-h.z),f[4].set(h.x,-h.y,-h.z),f[5].set(h.x,h.y,-h.z),f[6].set(-h.x,h.y,-h.z),f[7].set(h.x,-h.y,h.z);var x=f[0];l.vmult(x,x),y.vadd(x,x),v.copy(x),d.copy(x);for(var w=1;w<8;w++){var x=f[w];l.vmult(x,x),y.vadd(x,x);var k=x.x,N=x.y,A=x.z;k>v.x&&(v.x=k),N>v.y&&(v.y=N),A>v.z&&(v.z=A),k<d.x&&(d.x=k),N<d.y&&(d.y=N),A<d.z&&(d.z=A)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,a,r){a.exports=p;var c=t("./Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../math/Transform");function p(q,R,F){var Z=this;c.call(this),this.type=c.types.CONVEXPOLYHEDRON,this.vertices=q||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=R||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=F?F.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}p.prototype=new c,p.prototype.constructor=p;var m=new o;p.prototype.computeEdges=function(){var q=this.faces,R=this.vertices,F=R.length,Z=this.uniqueEdges;Z.length=0;for(var T=m,L=0;L!==q.length;L++)for(var re=q[L],ye=re.length,Y=0;Y!==ye;Y++){var C=(Y+1)%ye;R[re[Y]].vsub(R[re[C]],T),T.normalize();for(var te=!1,se=0;se!==Z.length;se++)if(Z[se].almostEquals(T)||Z[se].almostEquals(T)){te=!0;break}te||Z.push(T.clone())}},p.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var q=0;q<this.faces.length;q++){for(var R=0;R<this.faces[q].length;R++)if(!this.vertices[this.faces[q][R]])throw new Error("Vertex "+this.faces[q][R]+" not found!");var F=this.faceNormals[q]||new o;this.getFaceNormal(q,F),F.negate(F),this.faceNormals[q]=F;var Z=this.vertices[this.faces[q][0]];if(F.dot(Z)<0){console.error(".faceNormals["+q+"] = Vec3("+F.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var R=0;R<this.faces[q].length;R++)console.warn(".vertices["+this.faces[q][R]+"] = Vec3("+this.vertices[this.faces[q][R]].toString()+")")}}};var f=new o,y=new o;p.computeNormal=function(q,R,F,Z){R.vsub(q,y),F.vsub(R,f),f.cross(y,Z),Z.isZero()||Z.normalize()},p.prototype.getFaceNormal=function(q,R){var F=this.faces[q],Z=this.vertices[F[0]],T=this.vertices[F[1]],L=this.vertices[F[2]];return p.computeNormal(Z,T,L,R)};var l=new o;p.prototype.clipAgainstHull=function(q,R,F,Z,T,L,re,ye,Y){for(var C=l,te=this,se=ye,le=-1,pe=-Number.MAX_VALUE,ve=0;ve<F.faces.length;ve++){C.copy(F.faceNormals[ve]),T.vmult(C,C);var xe=C.dot(L);xe>pe&&(pe=xe,le=ve)}for(var Se=[],Re=F.faces[le],Fe=Re.length,Me=0;Me<Fe;Me++){var Te=F.vertices[Re[Me]],Xe=new o;Xe.copy(Te),T.vmult(Xe,Xe),Z.vadd(Xe,Xe),Se.push(Xe)}le>=0&&this.clipFaceAgainstHull(L,q,R,Se,re,ye,Y)};var d=new o,v=new o,h=new o,x=new o,w=new o,k=new o;p.prototype.findSeparatingAxis=function(q,R,F,Z,T,L,re,ye){var Y=d,C=v,te=h,se=x,le=w,pe=k,ve=Number.MAX_VALUE,xe=this,Se=0;if(xe.uniqueAxes)for(var Fe=0;Fe!==xe.uniqueAxes.length;Fe++){F.vmult(xe.uniqueAxes[Fe],Y);var Te=xe.testSepAxis(Y,q,R,F,Z,T);if(Te===!1)return!1;Te<ve&&(ve=Te,L.copy(Y))}else for(var Re=re?re.length:xe.faces.length,Fe=0;Fe<Re;Fe++){var Me=re?re[Fe]:Fe;Y.copy(xe.faceNormals[Me]),F.vmult(Y,Y);var Te=xe.testSepAxis(Y,q,R,F,Z,T);if(Te===!1)return!1;Te<ve&&(ve=Te,L.copy(Y))}if(q.uniqueAxes)for(var Fe=0;Fe!==q.uniqueAxes.length;Fe++){T.vmult(q.uniqueAxes[Fe],C),Se++;var Te=xe.testSepAxis(C,q,R,F,Z,T);if(Te===!1)return!1;Te<ve&&(ve=Te,L.copy(C))}else for(var Xe=ye?ye.length:q.faces.length,Fe=0;Fe<Xe;Fe++){var Me=ye?ye[Fe]:Fe;C.copy(q.faceNormals[Me]),T.vmult(C,C),Se++;var Te=xe.testSepAxis(C,q,R,F,Z,T);if(Te===!1)return!1;Te<ve&&(ve=Te,L.copy(C))}for(var Ge=0;Ge!==xe.uniqueEdges.length;Ge++){F.vmult(xe.uniqueEdges[Ge],se);for(var et=0;et!==q.uniqueEdges.length;et++)if(T.vmult(q.uniqueEdges[et],le),se.cross(le,pe),!pe.almostZero()){pe.normalize();var nt=xe.testSepAxis(pe,q,R,F,Z,T);if(nt===!1)return!1;nt<ve&&(ve=nt,L.copy(pe))}}return Z.vsub(R,te),te.dot(L)>0&&L.negate(L),!0};var N=[],A=[];p.prototype.testSepAxis=function(q,R,F,Z,T,L){var re=this;p.project(re,q,F,Z,N),p.project(R,q,T,L,A);var ye=N[0],Y=N[1],C=A[0],te=A[1];if(ye<te||C<Y)return!1;var se=ye-te,le=C-Y,pe=se<le?se:le;return pe};var P=new o,M=new o;p.prototype.calculateLocalInertia=function(q,R){this.computeLocalAABB(P,M);var F=M.x-P.x,Z=M.y-P.y,T=M.z-P.z;R.x=1/12*q*(2*Z*2*Z+2*T*2*T),R.y=1/12*q*(2*F*2*F+2*T*2*T),R.z=1/12*q*(2*Z*2*Z+2*F*2*F)},p.prototype.getPlaneConstantOfFace=function(q){var R=this.faces[q],F=this.faceNormals[q],Z=this.vertices[R[0]],T=-F.dot(Z);return T};var W=new o,$=new o,E=new o,_=new o,O=new o,V=new o,D=new o,J=new o;p.prototype.clipFaceAgainstHull=function(q,R,F,Z,T,L,re){for(var ye=W,Y=$,C=E,te=_,se=O,le=V,pe=D,ve=J,xe=this,Se=[],Re=Z,Fe=Se,Me=-1,Te=Number.MAX_VALUE,Xe=0;Xe<xe.faces.length;Xe++){ye.copy(xe.faceNormals[Xe]),F.vmult(ye,ye);var Ge=ye.dot(q);Ge<Te&&(Te=Ge,Me=Xe)}if(!(Me<0)){var et=xe.faces[Me];et.connectedFaces=[];for(var nt=0;nt<xe.faces.length;nt++)for(var yt=0;yt<xe.faces[nt].length;yt++)et.indexOf(xe.faces[nt][yt])!==-1&&nt!==Me&&et.connectedFaces.indexOf(nt)===-1&&et.connectedFaces.push(nt);for(var wt=Re.length,mt=et.length,Dt=[],Ie=0;Ie<mt;Ie++){var Le=xe.vertices[et[Ie]],Pt=xe.vertices[et[(Ie+1)%mt]];Le.vsub(Pt,Y),C.copy(Y),F.vmult(C,C),R.vadd(C,C),te.copy(this.faceNormals[Me]),F.vmult(te,te),R.vadd(te,te),C.cross(te,se),se.negate(se),le.copy(Le),F.vmult(le,le),R.vadd(le,le);var Kt=-le.dot(se),I,qt=et.connectedFaces[Ie];pe.copy(this.faceNormals[qt]);var ot=this.getPlaneConstantOfFace(qt);ve.copy(pe),F.vmult(ve,ve);var I=ot-ve.dot(R);for(this.clipFaceAgainstPlane(Re,Fe,ve,I);Re.length;)Re.shift();for(;Fe.length;)Re.push(Fe.shift())}pe.copy(this.faceNormals[Me]);var ot=this.getPlaneConstantOfFace(Me);ve.copy(pe),F.vmult(ve,ve);for(var I=ot-ve.dot(R),nt=0;nt<Re.length;nt++){var G=ve.dot(Re[nt])+I;if(G<=T&&(console.log("clamped: depth="+G+" to minDist="+(T+"")),G=T),G<=L){var Q=Re[nt];if(G<=0){var ge={point:Q,normal:ve,depth:G};re.push(ge)}}}}},p.prototype.clipFaceAgainstPlane=function(q,R,F,Z){var T,L,re=q.length;if(re<2)return R;var ye=q[q.length-1],Y=q[0];T=F.dot(ye)+Z;for(var C=0;C<re;C++){if(Y=q[C],L=F.dot(Y)+Z,T<0)if(L<0){var te=new o;te.copy(Y),R.push(te)}else{var te=new o;ye.lerp(Y,T/(T-L),te),R.push(te)}else if(L<0){var te=new o;ye.lerp(Y,T/(T-L),te),R.push(te),R.push(Y)}ye=Y,T=L}return R},p.prototype.computeWorldVertices=function(q,R){for(var F=this.vertices.length;this.worldVertices.length<F;)this.worldVertices.push(new o);for(var Z=this.vertices,T=this.worldVertices,L=0;L!==F;L++)R.vmult(Z[L],T[L]),q.vadd(T[L],T[L]);this.worldVerticesNeedsUpdate=!1};var ee=new o;p.prototype.computeLocalAABB=function(q,R){var F=this.vertices.length,Z=this.vertices,T=ee;q.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),R.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var L=0;L<F;L++){var re=Z[L];re.x<q.x?q.x=re.x:re.x>R.x&&(R.x=re.x),re.y<q.y?q.y=re.y:re.y>R.y&&(R.y=re.y),re.z<q.z?q.z=re.z:re.z>R.z&&(R.z=re.z)}},p.prototype.computeWorldFaceNormals=function(q){for(var R=this.faceNormals.length;this.worldFaceNormals.length<R;)this.worldFaceNormals.push(new o);for(var F=this.faceNormals,Z=this.worldFaceNormals,T=0;T!==R;T++)q.vmult(F[T],Z[T]);this.worldFaceNormalsNeedsUpdate=!1},p.prototype.updateBoundingSphereRadius=function(){for(var q=0,R=this.vertices,F=0,Z=R.length;F!==Z;F++){var T=R[F].norm2();T>q&&(q=T)}this.boundingSphereRadius=Math.sqrt(q)};var K=new o;p.prototype.calculateWorldAABB=function(q,R,F,Z){for(var T=this.vertices.length,L=this.vertices,re,ye,Y,C,te,se,le=0;le<T;le++){K.copy(L[le]),R.vmult(K,K),q.vadd(K,K);var pe=K;pe.x<re||re===void 0?re=pe.x:(pe.x>C||C===void 0)&&(C=pe.x),pe.y<ye||ye===void 0?ye=pe.y:(pe.y>te||te===void 0)&&(te=pe.y),pe.z<Y||Y===void 0?Y=pe.z:(pe.z>se||se===void 0)&&(se=pe.z)}F.set(re,ye,Y),Z.set(C,te,se)},p.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},p.prototype.getAveragePointLocal=function(q){q=q||new o;for(var R=this.vertices.length,F=this.vertices,Z=0;Z<R;Z++)q.vadd(F[Z],q);return q.mult(1/R,q),q},p.prototype.transformAllPoints=function(q,R){var F=this.vertices.length,Z=this.vertices;if(R){for(var T=0;T<F;T++){var L=Z[T];R.vmult(L,L)}for(var T=0;T<this.faceNormals.length;T++){var L=this.faceNormals[T];R.vmult(L,L)}}if(q)for(var T=0;T<F;T++){var L=Z[T];L.vadd(q,L)}};var de=new o,_e=new o,ze=new o;p.prototype.pointIsInside=function(q){var R=this.vertices.length,F=this.vertices,Z=this.faces,T=this.faceNormals,L=null,re=this.faces.length,ye=de;this.getAveragePointLocal(ye);for(var Y=0;Y<re;Y++){var C=this.faces[Y].length,R=T[Y],te=F[Z[Y][0]],se=_e;q.vsub(te,se);var le=R.dot(se),pe=ze;ye.vsub(te,pe);var ve=R.dot(pe);if(le<0&&ve>0||le>0&&ve<0)return!1}return L?1:-1};var Oe=new o,je=new o,Pe=new o;p.project=function(q,R,F,Z,T){var L=q.vertices.length,re=Oe,ye=je,Y=0,C=0,te=Pe,se=q.vertices;te.setZero(),u.vectorToLocalFrame(F,Z,R,ye),u.pointToLocalFrame(F,Z,te,te);var le=te.dot(ye);C=Y=se[0].dot(ye);for(var pe=1;pe<L;pe++){var ve=se[pe].dot(ye);ve>Y&&(Y=ve),ve<C&&(C=ve)}if(C-=le,Y-=le,C>Y){var xe=C;C=Y,Y=xe}T[0]=Y,T[1]=C}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,a,r){a.exports=p;var c=t("./Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("./ConvexPolyhedron");function p(m,f,y,l){var d=l,v=[],h=[],x=[],w=[],k=[],N=Math.cos,A=Math.sin;v.push(new o(f*N(0),f*A(0),-y*.5)),w.push(0),v.push(new o(m*N(0),m*A(0),y*.5)),k.push(1);for(var P=0;P<d;P++){var M=2*Math.PI/d*(P+1),W=2*Math.PI/d*(P+.5);P<d-1?(v.push(new o(f*N(M),f*A(M),-y*.5)),w.push(2*P+2),v.push(new o(m*N(M),m*A(M),y*.5)),k.push(2*P+3),x.push([2*P+2,2*P+3,2*P+1,2*P])):x.push([0,1,2*P+1,2*P]),(d%2===1||P<d/2)&&h.push(new o(N(W),A(W),0))}x.push(k),h.push(new o(0,0,1));for(var $=[],P=0;P<w.length;P++)$.push(w[w.length-P-1]);x.push($),this.type=c.types.CONVEXPOLYHEDRON,u.call(this,v,x,h)}p.prototype=new u},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,a,r){var c=t("./Shape"),o=t("./ConvexPolyhedron"),i=t("../math/Vec3"),u=t("../utils/Utils");a.exports=p;function p(m,f){f=u.defaults(f,{maxValue:null,minValue:null,elementSize:1}),this.data=m,this.maxValue=f.maxValue,this.minValue=f.minValue,this.elementSize=f.elementSize,f.minValue===null&&this.updateMinValue(),f.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,c.call(this),this.pillarConvex=new o,this.pillarOffset=new i,this.type=c.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}p.prototype=new c,p.prototype.update=function(){this._cachedPillars={}},p.prototype.updateMinValue=function(){for(var m=this.data,f=m[0][0],y=0;y!==m.length;y++)for(var l=0;l!==m[y].length;l++){var d=m[y][l];d<f&&(f=d)}this.minValue=f},p.prototype.updateMaxValue=function(){for(var m=this.data,f=m[0][0],y=0;y!==m.length;y++)for(var l=0;l!==m[y].length;l++){var d=m[y][l];d>f&&(f=d)}this.maxValue=f},p.prototype.setHeightValueAtIndex=function(m,f,y){var l=this.data;l[m][f]=y,this.clearCachedConvexTrianglePillar(m,f,!1),m>0&&(this.clearCachedConvexTrianglePillar(m-1,f,!0),this.clearCachedConvexTrianglePillar(m-1,f,!1)),f>0&&(this.clearCachedConvexTrianglePillar(m,f-1,!0),this.clearCachedConvexTrianglePillar(m,f-1,!1)),f>0&&m>0&&this.clearCachedConvexTrianglePillar(m-1,f-1,!0)},p.prototype.getRectMinMax=function(m,f,y,l,d){d=d||[];for(var v=this.data,h=this.minValue,x=m;x<=y;x++)for(var w=f;w<=l;w++){var k=v[x][w];k>h&&(h=k)}d[0]=this.minValue,d[1]=h},p.prototype.getIndexOfPosition=function(m,f,y,l){var d=this.elementSize,v=this.data,h=Math.floor(m/d),x=Math.floor(f/d);return y[0]=h,y[1]=x,l&&(h<0&&(h=0),x<0&&(x=0),h>=v.length-1&&(h=v.length-1),x>=v[0].length-1&&(x=v[0].length-1)),!(h<0||x<0||h>=v.length-1||x>=v[0].length-1)},p.prototype.getHeightAt=function(m,f,y){var l=[];this.getIndexOfPosition(m,f,l,y);var d=[];return this.getRectMinMax(l[0],l[1]+1,l[0],l[1]+1,d),(d[0]+d[1])/2},p.prototype.getCacheConvexTrianglePillarKey=function(m,f,y){return m+"_"+f+"_"+(y?1:0)},p.prototype.getCachedConvexTrianglePillar=function(m,f,y){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(m,f,y)]},p.prototype.setCachedConvexTrianglePillar=function(m,f,y,l,d){this._cachedPillars[this.getCacheConvexTrianglePillarKey(m,f,y)]={convex:l,offset:d}},p.prototype.clearCachedConvexTrianglePillar=function(m,f,y){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(m,f,y)]},p.prototype.getConvexTrianglePillar=function(m,f,y){var l=this.pillarConvex,d=this.pillarOffset;if(this.cacheEnabled){var v=this.getCachedConvexTrianglePillar(m,f,y);if(v){this.pillarConvex=v.convex,this.pillarOffset=v.offset;return}l=new o,d=new i,this.pillarConvex=l,this.pillarOffset=d}var v=this.data,h=this.elementSize,x=l.faces;l.vertices.length=6;for(var w=0;w<6;w++)l.vertices[w]||(l.vertices[w]=new i);x.length=5;for(var w=0;w<5;w++)x[w]||(x[w]=[]);var k=l.vertices,N=(Math.min(v[m][f],v[m+1][f],v[m][f+1],v[m+1][f+1])-this.minValue)/2+this.minValue;y?(d.set((m+.75)*h,(f+.75)*h,N),k[0].set(.25*h,.25*h,v[m+1][f+1]-N),k[1].set(-.75*h,.25*h,v[m][f+1]-N),k[2].set(.25*h,-.75*h,v[m+1][f]-N),k[3].set(.25*h,.25*h,-N-1),k[4].set(-.75*h,.25*h,-N-1),k[5].set(.25*h,-.75*h,-N-1),x[0][0]=0,x[0][1]=1,x[0][2]=2,x[1][0]=5,x[1][1]=4,x[1][2]=3,x[2][0]=2,x[2][1]=5,x[2][2]=3,x[2][3]=0,x[3][0]=3,x[3][1]=4,x[3][2]=1,x[3][3]=0,x[4][0]=1,x[4][1]=4,x[4][2]=5,x[4][3]=2):(d.set((m+.25)*h,(f+.25)*h,N),k[0].set(-.25*h,-.25*h,v[m][f]-N),k[1].set(.75*h,-.25*h,v[m+1][f]-N),k[2].set(-.25*h,.75*h,v[m][f+1]-N),k[3].set(-.25*h,-.25*h,-N-1),k[4].set(.75*h,-.25*h,-N-1),k[5].set(-.25*h,.75*h,-N-1),x[0][0]=0,x[0][1]=1,x[0][2]=2,x[1][0]=5,x[1][1]=4,x[1][2]=3,x[2][0]=0,x[2][1]=2,x[2][2]=5,x[2][3]=3,x[3][0]=1,x[3][1]=0,x[3][2]=3,x[3][3]=4,x[4][0]=4,x[4][1]=5,x[4][2]=2,x[4][3]=1),l.computeNormals(),l.computeEdges(),l.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(m,f,y,l,d)},p.prototype.calculateLocalInertia=function(m,f){return f=f||new i,f.set(0,0,0),f},p.prototype.volume=function(){return Number.MAX_VALUE},p.prototype.calculateWorldAABB=function(m,f,y,l){y.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},p.prototype.updateBoundingSphereRadius=function(){var m=this.data,f=this.elementSize;this.boundingSphereRadius=new i(m.length*f,m[0].length*f,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,a,r){a.exports=i;var c=t("./Shape"),o=t("../math/Vec3");function i(){c.call(this),this.type=c.types.PARTICLE}i.prototype=new c,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(u,p){return p=p||new o,p.set(0,0,0),p},i.prototype.volume=function(){return 0},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},i.prototype.calculateWorldAABB=function(u,p,m,f){m.copy(u),f.copy(u)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,a,r){a.exports=i;var c=t("./Shape"),o=t("../math/Vec3");function i(){c.call(this),this.type=c.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}i.prototype=new c,i.prototype.constructor=i,i.prototype.computeWorldNormal=function(p){var m=this.worldNormal;m.set(0,0,1),p.vmult(m,m),this.worldNormalNeedsUpdate=!1},i.prototype.calculateLocalInertia=function(p,m){return m=m||new o,m},i.prototype.volume=function(){return Number.MAX_VALUE};var u=new o;i.prototype.calculateWorldAABB=function(p,m,f,y){u.set(0,0,1),m.vmult(u,u);var l=Number.MAX_VALUE;f.set(-l,-l,-l),y.set(l,l,l),u.x===1&&(y.x=p.x),u.y===1&&(y.y=p.y),u.z===1&&(y.z=p.z),u.x===-1&&(f.x=p.x),u.y===-1&&(f.y=p.y),u.z===-1&&(f.z=p.z)},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,a,r){a.exports=u;var u=t("./Shape"),c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("../material/Material");function u(){this.id=u.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}u.prototype.constructor=u,u.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},u.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},u.prototype.calculateLocalInertia=function(p,m){throw"calculateLocalInertia() not implemented for shape type "+this.type},u.idCounter=0,u.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,a,r){a.exports=i;var c=t("./Shape"),o=t("../math/Vec3");function i(u){if(c.call(this),this.radius=u!==void 0?Number(u):1,this.type=c.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}i.prototype=new c,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(u,p){p=p||new o;var m=2*u*this.radius*this.radius/5;return p.x=m,p.y=m,p.z=m,p},i.prototype.volume=function(){return 4*Math.PI*this.radius/3},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},i.prototype.calculateWorldAABB=function(u,p,m,f){for(var y=this.radius,l=["x","y","z"],d=0;d<l.length;d++){var v=l[d];m[v]=u[v]-y,f[v]=u[v]+y}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,a,r){a.exports=f;var c=t("./Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../math/Transform"),p=t("../collision/AABB"),m=t("../utils/Octree");function f(E,_){c.call(this),this.type=c.types.TRIMESH,this.vertices=new Float32Array(E),this.indices=new Int16Array(_),this.normals=new Float32Array(_.length),this.aabb=new p,this.edges=null,this.scale=new o(1,1,1),this.tree=new m,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}f.prototype=new c,f.prototype.constructor=f;var y=new o;f.prototype.updateTree=function(){var E=this.tree;E.reset(),E.aabb.copy(this.aabb);var _=this.scale;E.aabb.lowerBound.x*=1/_.x,E.aabb.lowerBound.y*=1/_.y,E.aabb.lowerBound.z*=1/_.z,E.aabb.upperBound.x*=1/_.x,E.aabb.upperBound.y*=1/_.y,E.aabb.upperBound.z*=1/_.z;for(var O=new p,V=new o,D=new o,J=new o,ee=[V,D,J],K=0;K<this.indices.length/3;K++){var de=K*3;this._getUnscaledVertex(this.indices[de],V),this._getUnscaledVertex(this.indices[de+1],D),this._getUnscaledVertex(this.indices[de+2],J),O.setFromPoints(ee),E.insert(O,K)}E.removeEmptyNodes()};var l=new p;f.prototype.getTrianglesInAABB=function(E,_){l.copy(E);var O=this.scale,V=O.x,D=O.y,J=O.z,ee=l.lowerBound,K=l.upperBound;return ee.x/=V,ee.y/=D,ee.z/=J,K.x/=V,K.y/=D,K.z/=J,this.tree.aabbQuery(l,_)},f.prototype.setScale=function(E){var _=this.scale.x===this.scale.y===this.scale.z,O=E.x===E.y===E.z;_&&O||this.updateNormals(),this.scale.copy(E),this.updateAABB(),this.updateBoundingSphereRadius()},f.prototype.updateNormals=function(){for(var E=y,_=this.normals,O=0;O<this.indices.length/3;O++){var V=O*3,D=this.indices[V],J=this.indices[V+1],ee=this.indices[V+2];this.getVertex(D,w),this.getVertex(J,k),this.getVertex(ee,N),f.computeNormal(k,w,N,E),_[V]=E.x,_[V+1]=E.y,_[V+2]=E.z}},f.prototype.updateEdges=function(){for(var E={},_=function(_e,ze){var Oe=D<J?D+"_"+J:J+"_"+D;E[Oe]=!0},O=0;O<this.indices.length/3;O++){var V=O*3,D=this.indices[V],J=this.indices[V+1],ee=this.indices[V+2];_(D,J),_(J,ee),_(ee,D)}var K=Object.keys(E);this.edges=new Int16Array(K.length*2);for(var O=0;O<K.length;O++){var de=K[O].split("_");this.edges[2*O]=parseInt(de[0],10),this.edges[2*O+1]=parseInt(de[1],10)}},f.prototype.getEdgeVertex=function(E,_,O){var V=this.edges[E*2+(_?1:0)];this.getVertex(V,O)};var d=new o,v=new o;f.prototype.getEdgeVector=function(E,_){var O=d,V=v;this.getEdgeVertex(E,0,O),this.getEdgeVertex(E,1,V),V.vsub(O,_)};var h=new o,x=new o;f.computeNormal=function(E,_,O,V){_.vsub(E,x),O.vsub(_,h),h.cross(x,V),V.isZero()||V.normalize()};var w=new o,k=new o,N=new o;f.prototype.getVertex=function(E,_){var O=this.scale;return this._getUnscaledVertex(E,_),_.x*=O.x,_.y*=O.y,_.z*=O.z,_},f.prototype._getUnscaledVertex=function(E,_){var O=E*3,V=this.vertices;return _.set(V[O],V[O+1],V[O+2])},f.prototype.getWorldVertex=function(E,_,O,V){return this.getVertex(E,V),u.pointToWorldFrame(_,O,V,V),V},f.prototype.getTriangleVertices=function(E,_,O,V){var D=E*3;this.getVertex(this.indices[D],_),this.getVertex(this.indices[D+1],O),this.getVertex(this.indices[D+2],V)},f.prototype.getNormal=function(E,_){var O=E*3;return _.set(this.normals[O],this.normals[O+1],this.normals[O+2])};var A=new p;f.prototype.calculateLocalInertia=function(E,_){this.computeLocalAABB(A);var O=A.upperBound.x-A.lowerBound.x,V=A.upperBound.y-A.lowerBound.y,D=A.upperBound.z-A.lowerBound.z;return _.set(1/12*E*(2*V*2*V+2*D*2*D),1/12*E*(2*O*2*O+2*D*2*D),1/12*E*(2*V*2*V+2*O*2*O))};var P=new o;f.prototype.computeLocalAABB=function(E){var _=E.lowerBound,O=E.upperBound,V=this.vertices.length,D=this.vertices,J=P;this.getVertex(0,J),_.copy(J),O.copy(J);for(var ee=0;ee!==V;ee++)this.getVertex(ee,J),J.x<_.x?_.x=J.x:J.x>O.x&&(O.x=J.x),J.y<_.y?_.y=J.y:J.y>O.y&&(O.y=J.y),J.z<_.z?_.z=J.z:J.z>O.z&&(O.z=J.z)},f.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},f.prototype.updateBoundingSphereRadius=function(){for(var E=0,_=this.vertices,O=new o,V=0,D=_.length/3;V!==D;V++){this.getVertex(V,O);var J=O.norm2();J>E&&(E=J)}this.boundingSphereRadius=Math.sqrt(E)};var M=new o,W=new u,$=new p;f.prototype.calculateWorldAABB=function(E,_,O,V){var D=W,J=$;D.position=E,D.quaternion=_,this.aabb.toWorldFrame(D,J),O.copy(J.lowerBound),V.copy(J.upperBound)},f.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},f.createTorus=function(E,_,O,V,D){E=E||1,_=_||.5,O=O||8,V=V||6,D=D||Math.PI*2;for(var J=[],ee=[],K=0;K<=O;K++)for(var de=0;de<=V;de++){var _e=de/V*D,ze=K/O*Math.PI*2,Oe=(E+_*Math.cos(ze))*Math.cos(_e),je=(E+_*Math.cos(ze))*Math.sin(_e),Pe=_*Math.sin(ze);J.push(Oe,je,Pe)}for(var K=1;K<=O;K++)for(var de=1;de<=V;de++){var q=(V+1)*K+de-1,R=(V+1)*(K-1)+de-1,F=(V+1)*(K-1)+de,Z=(V+1)*K+de;ee.push(q,R,Z),ee.push(R,F,Z)}return new f(J,ee)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("./Solver");function u(){i.call(this),this.iterations=10,this.tolerance=1e-7}u.prototype=new i;var p=[],m=[],f=[];u.prototype.solve=function(y,l){var d=0,v=this.iterations,h=this.tolerance*this.tolerance,x=this.equations,w=x.length,k=l.bodies,N=k.length,A=y,P,M,W,$,E,_,O;if(w!==0)for(var V=0;V!==N;V++)k[V].updateSolveMassProperties();var D=m,J=f,ee=p;D.length=w,J.length=w,ee.length=w;for(var V=0;V!==w;V++){var K=x[V];ee[V]=0,J[V]=K.computeB(A),D[V]=1/K.computeC()}if(w!==0){for(var V=0;V!==N;V++){var de=k[V],_e=de.vlambda,ze=de.wlambda;_e.set(0,0,0),ze&&ze.set(0,0,0)}for(d=0;d!==v;d++){E=0;for(var Oe=0;Oe!==w;Oe++){var K=x[Oe];M=J[Oe],W=D[Oe],O=ee[Oe],_=K.computeGWlambda(),$=W*(M-_-K.eps*O),O+$<K.minForce?$=K.minForce-O:O+$>K.maxForce&&($=K.maxForce-O),ee[Oe]+=$,E+=$>0?$:-$,K.addToWlambda($)}if(E*E<h)break}for(var V=0;V!==N;V++){var de=k[V],je=de.velocity,Pe=de.angularVelocity;je.vadd(de.vlambda,je),Pe&&Pe.vadd(de.wlambda,Pe)}}return d}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,a,r){a.exports=c;function c(){this.equations=[]}c.prototype.solve=function(o,i){return 0},c.prototype.addEquation=function(o){o.enabled&&this.equations.push(o)},c.prototype.removeEquation=function(o){var i=this.equations,u=i.indexOf(o);u!==-1&&i.splice(u,1)},c.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,a,r){a.exports=p;var c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("./Solver"),u=t("../objects/Body");function p(A){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=A,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}p.prototype=new i;var m=[],f=[],y=[],l=[],d={bodies:[]},v=u.STATIC;function h(A){for(var P=A.length,M=0;M!==P;M++){var W=A[M];if(!W.visited&&!(W.body.type&v))return W}return!1}var x=[];function w(A,P,M,W){for(x.push(A),A.visited=!0,P(A,M,W);x.length;)for(var $=x.pop(),E;E=h($.children);)E.visited=!0,P(E,M,W),x.push(E)}function k(A,P,M){P.push(A.body);for(var W=A.eqs.length,$=0;$!==W;$++){var E=A.eqs[$];M.indexOf(E)===-1&&M.push(E)}}p.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},p.prototype.solve=function(A,P){for(var M=m,W=this.nodePool,$=P.bodies,E=this.equations,_=E.length,O=$.length,V=this.subsolver;W.length<O;)W.push(this.createNode());M.length=O;for(var D=0;D<O;D++)M[D]=W[D];for(var D=0;D!==O;D++){var J=M[D];J.body=$[D],J.children.length=0,J.eqs.length=0,J.visited=!1}for(var ee=0;ee!==_;ee++){var K=E[ee],D=$.indexOf(K.bi),de=$.indexOf(K.bj),_e=M[D],ze=M[de];_e.children.push(ze),_e.eqs.push(K),ze.children.push(_e),ze.eqs.push(K)}var Oe,je=0,Pe=y;V.tolerance=this.tolerance,V.iterations=this.iterations;for(var q=d;Oe=h(M);){Pe.length=0,q.bodies.length=0,w(Oe,k,q.bodies,Pe);var R=Pe.length;Pe=Pe.sort(N);for(var D=0;D!==R;D++)V.addEquation(Pe[D]);var F=V.solve(A,q);V.removeAllEquations(),je++}return je};function N(A,P){return P.id-A.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,a,r){var c=function(){};a.exports=c,c.prototype={constructor:c,addEventListener:function(o,i){this._listeners===void 0&&(this._listeners={});var u=this._listeners;return u[o]===void 0&&(u[o]=[]),u[o].indexOf(i)===-1&&u[o].push(i),this},hasEventListener:function(o,i){if(this._listeners===void 0)return!1;var u=this._listeners;return u[o]!==void 0&&u[o].indexOf(i)!==-1},removeEventListener:function(o,i){if(this._listeners===void 0)return this;var u=this._listeners;if(u[o]===void 0)return this;var p=u[o].indexOf(i);return p!==-1&&u[o].splice(p,1),this},dispatchEvent:function(o){if(this._listeners===void 0)return this;var i=this._listeners,u=i[o.type];if(u!==void 0){o.target=this;for(var p=0,m=u.length;p<m;p++)u[p].call(this,o)}return this}}},{}],50:[function(t,a,r){var c=t("../collision/AABB"),o=t("../math/Vec3");a.exports=u;function i(f){f=f||{},this.root=f.root||null,this.aabb=f.aabb?f.aabb.clone():new c,this.data=[],this.children=[]}function u(f,y){y=y||{},y.root=null,y.aabb=f,i.call(this,y),this.maxDepth=typeof y.maxDepth<"u"?y.maxDepth:8}u.prototype=new i,i.prototype.reset=function(f,y){this.children.length=this.data.length=0},i.prototype.insert=function(f,y,l){var d=this.data;if(l=l||0,!this.aabb.contains(f))return!1;var v=this.children;if(l<(this.maxDepth||this.root.maxDepth)){var h=!1;v.length||(this.subdivide(),h=!0);for(var x=0;x!==8;x++)if(v[x].insert(f,y,l+1))return!0;h&&(v.length=0)}return d.push(y),!0};var p=new o;i.prototype.subdivide=function(){var f=this.aabb,y=f.lowerBound,l=f.upperBound,d=this.children;d.push(new i({aabb:new c({lowerBound:new o(0,0,0)})}),new i({aabb:new c({lowerBound:new o(1,0,0)})}),new i({aabb:new c({lowerBound:new o(1,1,0)})}),new i({aabb:new c({lowerBound:new o(1,1,1)})}),new i({aabb:new c({lowerBound:new o(0,1,1)})}),new i({aabb:new c({lowerBound:new o(0,0,1)})}),new i({aabb:new c({lowerBound:new o(1,0,1)})}),new i({aabb:new c({lowerBound:new o(0,1,0)})})),l.vsub(y,p),p.scale(.5,p);for(var v=this.root||this,h=0;h!==8;h++){var x=d[h];x.root=v;var w=x.aabb.lowerBound;w.x*=p.x,w.y*=p.y,w.z*=p.z,w.vadd(y,w),w.vadd(p,x.aabb.upperBound)}},i.prototype.aabbQuery=function(f,y){for(var l=this.data,d=this.children,v=[this];v.length;){var h=v.pop();h.aabb.overlaps(f)&&Array.prototype.push.apply(y,h.data),Array.prototype.push.apply(v,h.children)}return y};var m=new c;i.prototype.rayQuery=function(f,y,l){return f.getAABB(m),m.toLocalFrame(y,m),this.aabbQuery(m,l),l},i.prototype.removeEmptyNodes=function(){for(var f=[this];f.length;){for(var y=f.pop(),l=y.children.length-1;l>=0;l--)y.children[l].data.length||y.children.splice(l,1);Array.prototype.push.apply(f,y.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,a,r){a.exports=c;function c(){this.objects=[],this.type=Object}c.prototype.release=function(){for(var o=arguments.length,i=0;i!==o;i++)this.objects.push(arguments[i])},c.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},c.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,a,r){a.exports=c;function c(){this.data={keys:[]}}c.prototype.get=function(o,i){if(o>i){var u=i;i=o,o=u}return this.data[o+"-"+i]},c.prototype.set=function(o,i,u){if(o>i){var p=i;i=o,o=p}var m=o+"-"+i;this.get(o,i)||this.data.keys.push(m),this.data[m]=u},c.prototype.reset=function(){for(var o=this.data,i=o.keys;i.length>0;){var u=i.pop();delete o[u]}}},{}],53:[function(t,a,r){function c(){}a.exports=c,c.defaults=function(o,i){o=o||{};for(var u in i)u in o||(o[u]=i[u]);return o}},{}],54:[function(t,a,r){a.exports=i;var c=t("../math/Vec3"),o=t("./Pool");function i(){o.call(this),this.type=c}i.prototype=new o,i.prototype.constructObject=function(){return new c}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,a,r){a.exports=h;var c=t("../collision/AABB"),o=t("../shapes/Shape"),i=t("../collision/Ray"),u=t("../math/Vec3"),p=t("../math/Transform"),m=t("../shapes/ConvexPolyhedron"),f=t("../math/Quaternion"),y=t("../solver/Solver"),l=t("../utils/Vec3Pool"),d=t("../equations/ContactEquation"),v=t("../equations/FrictionEquation");function h(oe){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=oe,this.currentContactMaterial=null,this.enableFrictionReduction=!1}h.prototype.createContactEquation=function(oe,b,g,S,B,z){var j;this.contactPointPool.length?(j=this.contactPointPool.pop(),j.bi=oe,j.bj=b):j=new d(oe,b),j.enabled=oe.collisionResponse&&b.collisionResponse&&g.collisionResponse&&S.collisionResponse;var H=this.currentContactMaterial;j.restitution=H.restitution,j.setSpookParams(H.contactEquationStiffness,H.contactEquationRelaxation,this.world.dt);var U=g.material||oe.material,ne=S.material||b.material;return U&&ne&&U.restitution>=0&&ne.restitution>=0&&(j.restitution=U.restitution*ne.restitution),j.si=B||g,j.sj=z||S,j},h.prototype.createFrictionEquationsFromContact=function(oe,b){var g=oe.bi,S=oe.bj,B=oe.si,z=oe.sj,j=this.world,H=this.currentContactMaterial,U=H.friction,ne=B.material||g.material,fe=z.material||S.material;if(ne&&fe&&ne.friction>=0&&fe.friction>=0&&(U=ne.friction*fe.friction),U>0){var he=U*j.gravity.length(),me=g.invMass+S.invMass;me>0&&(me=1/me);var ae=this.frictionEquationPool,ue=ae.length?ae.pop():new v(g,S,he*me),Ae=ae.length?ae.pop():new v(g,S,he*me);return ue.bi=Ae.bi=g,ue.bj=Ae.bj=S,ue.minForce=Ae.minForce=-he*me,ue.maxForce=Ae.maxForce=he*me,ue.ri.copy(oe.ri),ue.rj.copy(oe.rj),Ae.ri.copy(oe.ri),Ae.rj.copy(oe.rj),oe.ni.tangents(ue.t,Ae.t),ue.setSpookParams(H.frictionEquationStiffness,H.frictionEquationRelaxation,j.dt),Ae.setSpookParams(H.frictionEquationStiffness,H.frictionEquationRelaxation,j.dt),ue.enabled=Ae.enabled=oe.enabled,b.push(ue,Ae),!0}return!1};var x=new u,w=new u,k=new u;h.prototype.createFrictionFromAverage=function(oe){var b=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(b,this.frictionResult)||oe===1)){var g=this.frictionResult[this.frictionResult.length-2],S=this.frictionResult[this.frictionResult.length-1];x.setZero(),w.setZero(),k.setZero();for(var B=b.bi,z=b.bj,j=0;j!==oe;j++)b=this.result[this.result.length-1-j],b.bodyA!==B?(x.vadd(b.ni,x),w.vadd(b.ri,w),k.vadd(b.rj,k)):(x.vsub(b.ni,x),w.vadd(b.rj,w),k.vadd(b.ri,k));var H=1/oe;w.scale(H,g.ri),k.scale(H,g.rj),S.ri.copy(g.ri),S.rj.copy(g.rj),x.normalize(),x.tangents(g.t,S.t)}};var N=new u,A=new u,P=new f,M=new f;h.prototype.getContacts=function(oe,b,g,S,B,z,j){this.contactPointPool=B,this.frictionEquationPool=j,this.result=S,this.frictionResult=z;for(var H=P,U=M,ne=N,fe=A,he=0,me=oe.length;he!==me;he++){var ae=oe[he],ue=b[he],Ae=null;ae.material&&ue.material&&(Ae=g.getContactMaterial(ae.material,ue.material)||null);for(var Ue=0;Ue<ae.shapes.length;Ue++){ae.quaternion.mult(ae.shapeOrientations[Ue],H),ae.quaternion.vmult(ae.shapeOffsets[Ue],ne),ne.vadd(ae.position,ne);for(var Be=ae.shapes[Ue],ie=0;ie<ue.shapes.length;ie++){ue.quaternion.mult(ue.shapeOrientations[ie],U),ue.quaternion.vmult(ue.shapeOffsets[ie],fe),fe.vadd(ue.position,fe);var Ve=ue.shapes[ie];if(!(ne.distanceTo(fe)>Be.boundingSphereRadius+Ve.boundingSphereRadius)){var Ke=null;Be.material&&Ve.material&&(Ke=g.getContactMaterial(Be.material,Ve.material)||null),this.currentContactMaterial=Ke||Ae||g.defaultContactMaterial;var qe=this[Be.type|Ve.type];qe&&(Be.type<Ve.type?qe.call(this,Be,Ve,ne,fe,H,U,ae,ue,Be,Ve):qe.call(this,Ve,Be,fe,ne,U,H,ue,ae,Be,Ve))}}}}};var W=0,$=10;function E(oe){W>$||(W++,console.warn(oe))}h.prototype[o.types.BOX|o.types.BOX]=h.prototype.boxBox=function(oe,b,g,S,B,z,j,H){oe.convexPolyhedronRepresentation.material=oe.material,b.convexPolyhedronRepresentation.material=b.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse,this.convexConvex(oe.convexPolyhedronRepresentation,b.convexPolyhedronRepresentation,g,S,B,z,j,H,oe,b)},h.prototype[o.types.BOX|o.types.CONVEXPOLYHEDRON]=h.prototype.boxConvex=function(oe,b,g,S,B,z,j,H){oe.convexPolyhedronRepresentation.material=oe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,this.convexConvex(oe.convexPolyhedronRepresentation,b,g,S,B,z,j,H,oe,b)},h.prototype[o.types.BOX|o.types.PARTICLE]=h.prototype.boxParticle=function(oe,b,g,S,B,z,j,H){oe.convexPolyhedronRepresentation.material=oe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,this.convexParticle(oe.convexPolyhedronRepresentation,b,g,S,B,z,j,H,oe,b)},h.prototype[o.types.SPHERE]=h.prototype.sphereSphere=function(oe,b,g,S,B,z,j,H){var U=this.createContactEquation(j,H,oe,b);S.vsub(g,U.ni),U.ni.normalize(),U.ri.copy(U.ni),U.rj.copy(U.ni),U.ri.mult(oe.radius,U.ri),U.rj.mult(-b.radius,U.rj),U.ri.vadd(g,U.ri),U.ri.vsub(j.position,U.ri),U.rj.vadd(S,U.rj),U.rj.vsub(H.position,U.rj),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)};var _=new u,O=new u,V=new u;h.prototype[o.types.PLANE|o.types.TRIMESH]=h.prototype.planeTrimesh=function(oe,b,g,S,B,z,j,H){var U=new u,ne=_;ne.set(0,0,1),B.vmult(ne,ne);for(var fe=0;fe<b.vertices.length/3;fe++){b.getVertex(fe,U);var he=new u;he.copy(U),p.pointToWorldFrame(S,z,he,U);var me=O;U.vsub(g,me);var ae=ne.dot(me);if(ae<=0){var ue=this.createContactEquation(j,H,oe,b);ue.ni.copy(ne);var Ae=V;ne.scale(me.dot(ne),Ae),U.vsub(Ae,Ae),ue.ri.copy(Ae),ue.ri.vsub(j.position,ue.ri),ue.rj.copy(U),ue.rj.vsub(H.position,ue.rj),this.result.push(ue),this.createFrictionEquationsFromContact(ue,this.frictionResult)}}};var D=new u,J=new u,ee=new u,K=new u,de=new u,_e=new u,ze=new u,Oe=new u,je=new u,Pe=new u,q=new u,R=new u,F=new u,Z=new u,T=new c,L=[];h.prototype[o.types.SPHERE|o.types.TRIMESH]=h.prototype.sphereTrimesh=function(oe,b,g,S,B,z,j,H){var U=_e,ne=ze,fe=Oe,he=je,me=Pe,ae=q,ue=T,Ae=de,Ue=J,Be=L;p.pointToLocalFrame(S,z,g,me);var ie=oe.radius;ue.lowerBound.set(me.x-ie,me.y-ie,me.z-ie),ue.upperBound.set(me.x+ie,me.y+ie,me.z+ie),b.getTrianglesInAABB(ue,Be);for(var Ve=K,Ke=oe.radius*oe.radius,qe=0;qe<Be.length;qe++)for(var Ze=0;Ze<3;Ze++)if(b.getVertex(b.indices[Be[qe]*3+Ze],Ve),Ve.vsub(me,Ue),Ue.norm2()<=Ke){Ae.copy(Ve),p.pointToWorldFrame(S,z,Ae,Ve),Ve.vsub(g,Ue);var ke=this.createContactEquation(j,H,oe,b);ke.ni.copy(Ue),ke.ni.normalize(),ke.ri.copy(ke.ni),ke.ri.scale(oe.radius,ke.ri),ke.ri.vadd(g,ke.ri),ke.ri.vsub(j.position,ke.ri),ke.rj.copy(Ve),ke.rj.vsub(H.position,ke.rj),this.result.push(ke),this.createFrictionEquationsFromContact(ke,this.frictionResult)}for(var qe=0;qe<Be.length;qe++)for(var Ze=0;Ze<3;Ze++){b.getVertex(b.indices[Be[qe]*3+Ze],U),b.getVertex(b.indices[Be[qe]*3+(Ze+1)%3],ne),ne.vsub(U,fe),me.vsub(ne,ae);var xt=ae.dot(fe);me.vsub(U,ae);var _t=ae.dot(fe);if(_t>0&&xt<0){me.vsub(U,ae),he.copy(fe),he.normalize(),_t=ae.dot(he),he.scale(_t,ae),ae.vadd(U,ae);var Rt=ae.distanceTo(me);if(Rt<oe.radius){var ke=this.createContactEquation(j,H,oe,b);ae.vsub(me,ke.ni),ke.ni.normalize(),ke.ni.scale(oe.radius,ke.ri),p.pointToWorldFrame(S,z,ae,ae),ae.vsub(H.position,ke.rj),p.vectorToWorldFrame(z,ke.ni,ke.ni),p.vectorToWorldFrame(z,ke.ri,ke.ri),this.result.push(ke),this.createFrictionEquationsFromContact(ke,this.frictionResult)}}}for(var Bt=R,Yt=F,It=Z,rt=D,qe=0,ht=Be.length;qe!==ht;qe++){b.getTriangleVertices(Be[qe],Bt,Yt,It),b.getNormal(Be[qe],rt),me.vsub(Bt,ae);var Rt=ae.dot(rt);if(rt.scale(Rt,ae),me.vsub(ae,ae),Rt=ae.distanceTo(me),i.pointInTriangle(ae,Bt,Yt,It)&&Rt<oe.radius){var ke=this.createContactEquation(j,H,oe,b);ae.vsub(me,ke.ni),ke.ni.normalize(),ke.ni.scale(oe.radius,ke.ri),p.pointToWorldFrame(S,z,ae,ae),ae.vsub(H.position,ke.rj),p.vectorToWorldFrame(z,ke.ni,ke.ni),p.vectorToWorldFrame(z,ke.ri,ke.ri),this.result.push(ke),this.createFrictionEquationsFromContact(ke,this.frictionResult)}}Be.length=0};var re=new u,ye=new u;h.prototype[o.types.SPHERE|o.types.PLANE]=h.prototype.spherePlane=function(oe,b,g,S,B,z,j,H){var U=this.createContactEquation(j,H,oe,b);if(U.ni.set(0,0,1),z.vmult(U.ni,U.ni),U.ni.negate(U.ni),U.ni.normalize(),U.ni.mult(oe.radius,U.ri),g.vsub(S,re),U.ni.mult(U.ni.dot(re),ye),re.vsub(ye,U.rj),-re.dot(U.ni)<=oe.radius){var ne=U.ri,fe=U.rj;ne.vadd(g,ne),ne.vsub(j.position,ne),fe.vadd(S,fe),fe.vsub(H.position,fe),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)}};var Y=new u,C=new u,te=new u;function se(oe,b,g){for(var S=null,B=oe.length,z=0;z!==B;z++){var j=oe[z],H=Y;oe[(z+1)%B].vsub(j,H);var U=C;H.cross(b,U);var ne=te;g.vsub(j,ne);var fe=U.dot(ne);if(S===null||fe>0&&S===!0||fe<=0&&S===!1){S===null&&(S=fe>0);continue}else return!1}return!0}var le=new u,pe=new u,ve=new u,xe=new u,Se=[new u,new u,new u,new u,new u,new u],Re=new u,Fe=new u,Me=new u,Te=new u;h.prototype[o.types.SPHERE|o.types.BOX]=h.prototype.sphereBox=function(oe,b,g,S,B,z,j,H){var U=this.v3pool,ne=Se;g.vsub(S,le),b.getSideNormals(ne,z);for(var fe=oe.radius,he=[],me=!1,ae=Fe,ue=Me,Ae=Te,Ue=null,Be=0,ie=0,Ve=0,Ke=null,qe=0,Ze=ne.length;qe!==Ze&&me===!1;qe++){var ke=pe;ke.copy(ne[qe]);var xt=ke.norm();ke.normalize();var _t=le.dot(ke);if(_t<xt+fe&&_t>0){var Rt=ve,Bt=xe;Rt.copy(ne[(qe+1)%3]),Bt.copy(ne[(qe+2)%3]);var Yt=Rt.norm(),It=Bt.norm();Rt.normalize(),Bt.normalize();var rt=le.dot(Rt),ht=le.dot(Bt);if(rt<Yt&&rt>-Yt&&ht<It&&ht>-It){var zt=Math.abs(_t-xt-fe);(Ke===null||zt<Ke)&&(Ke=zt,ie=rt,Ve=ht,Ue=xt,ae.copy(ke),ue.copy(Rt),Ae.copy(Bt),Be++)}}}if(Be){me=!0;var Ye=this.createContactEquation(j,H,oe,b);ae.mult(-fe,Ye.ri),Ye.ni.copy(ae),Ye.ni.negate(Ye.ni),ae.mult(Ue,ae),ue.mult(ie,ue),ae.vadd(ue,ae),Ae.mult(Ve,Ae),ae.vadd(Ae,Ye.rj),Ye.ri.vadd(g,Ye.ri),Ye.ri.vsub(j.position,Ye.ri),Ye.rj.vadd(S,Ye.rj),Ye.rj.vsub(H.position,Ye.rj),this.result.push(Ye),this.createFrictionEquationsFromContact(Ye,this.frictionResult)}for(var ft=U.get(),Zt=Re,kt=0;kt!==2&&!me;kt++)for(var Nt=0;Nt!==2&&!me;Nt++)for(var St=0;St!==2&&!me;St++)if(ft.set(0,0,0),kt?ft.vadd(ne[0],ft):ft.vsub(ne[0],ft),Nt?ft.vadd(ne[1],ft):ft.vsub(ne[1],ft),St?ft.vadd(ne[2],ft):ft.vsub(ne[2],ft),S.vadd(ft,Zt),Zt.vsub(g,Zt),Zt.norm2()<fe*fe){me=!0;var Ye=this.createContactEquation(j,H,oe,b);Ye.ri.copy(Zt),Ye.ri.normalize(),Ye.ni.copy(Ye.ri),Ye.ri.mult(fe,Ye.ri),Ye.rj.copy(ft),Ye.ri.vadd(g,Ye.ri),Ye.ri.vsub(j.position,Ye.ri),Ye.rj.vadd(S,Ye.rj),Ye.rj.vsub(H.position,Ye.rj),this.result.push(Ye),this.createFrictionEquationsFromContact(Ye,this.frictionResult)}U.release(ft),ft=null;for(var Wt=U.get(),Qt=U.get(),Ye=U.get(),tn=U.get(),zt=U.get(),Ln=ne.length,kt=0;kt!==Ln&&!me;kt++)for(var Nt=0;Nt!==Ln&&!me;Nt++)if(kt%3!==Nt%3){ne[Nt].cross(ne[kt],Wt),Wt.normalize(),ne[kt].vadd(ne[Nt],Qt),Ye.copy(g),Ye.vsub(Qt,Ye),Ye.vsub(S,Ye);var Vn=Ye.dot(Wt);Wt.mult(Vn,tn);for(var St=0;St===kt%3||St===Nt%3;)St++;zt.copy(g),zt.vsub(tn,zt),zt.vsub(Qt,zt),zt.vsub(S,zt);var Wa=Math.abs(Vn),qa=zt.norm();if(Wa<ne[St].norm()&&qa<fe){me=!0;var bt=this.createContactEquation(j,H,oe,b);Qt.vadd(tn,bt.rj),bt.rj.copy(bt.rj),zt.negate(bt.ni),bt.ni.normalize(),bt.ri.copy(bt.rj),bt.ri.vadd(S,bt.ri),bt.ri.vsub(g,bt.ri),bt.ri.normalize(),bt.ri.mult(fe,bt.ri),bt.ri.vadd(g,bt.ri),bt.ri.vsub(j.position,bt.ri),bt.rj.vadd(S,bt.rj),bt.rj.vsub(H.position,bt.rj),this.result.push(bt),this.createFrictionEquationsFromContact(bt,this.frictionResult)}}U.release(Wt,Qt,Ye,tn,zt)};var Xe=new u,Ge=new u,et=new u,nt=new u,yt=new u,wt=new u,mt=new u,Dt=new u,Ie=new u,Le=new u;h.prototype[o.types.SPHERE|o.types.CONVEXPOLYHEDRON]=h.prototype.sphereConvex=function(oe,b,g,S,B,z,j,H){var U=this.v3pool;g.vsub(S,Xe);for(var ne=b.faceNormals,fe=b.faces,he=b.vertices,me=oe.radius,ae=[],ue=0;ue!==he.length;ue++){var Ae=he[ue],Ue=yt;z.vmult(Ae,Ue),S.vadd(Ue,Ue);var Be=nt;if(Ue.vsub(g,Be),Be.norm2()<me*me){Ve=!0;var ie=this.createContactEquation(j,H,oe,b);ie.ri.copy(Be),ie.ri.normalize(),ie.ni.copy(ie.ri),ie.ri.mult(me,ie.ri),Ue.vsub(S,ie.rj),ie.ri.vadd(g,ie.ri),ie.ri.vsub(j.position,ie.ri),ie.rj.vadd(S,ie.rj),ie.rj.vsub(H.position,ie.rj),this.result.push(ie),this.createFrictionEquationsFromContact(ie,this.frictionResult);return}}for(var Ve=!1,ue=0,Ke=fe.length;ue!==Ke&&Ve===!1;ue++){var qe=ne[ue],Ze=fe[ue],ke=wt;z.vmult(qe,ke);var xt=mt;z.vmult(he[Ze[0]],xt),xt.vadd(S,xt);var _t=Dt;ke.mult(-me,_t),g.vadd(_t,_t);var Rt=Ie;_t.vsub(xt,Rt);var Bt=Rt.dot(ke),Yt=Le;if(g.vsub(xt,Yt),Bt<0&&Yt.dot(ke)>0){for(var It=[],rt=0,ht=Ze.length;rt!==ht;rt++){var ft=U.get();z.vmult(he[Ze[rt]],ft),S.vadd(ft,ft),It.push(ft)}if(se(It,ke,g)){Ve=!0;var ie=this.createContactEquation(j,H,oe,b);ke.mult(-me,ie.ri),ke.negate(ie.ni);var Zt=U.get();ke.mult(-Bt,Zt);var kt=U.get();ke.mult(-me,kt),g.vsub(S,ie.rj),ie.rj.vadd(kt,ie.rj),ie.rj.vadd(Zt,ie.rj),ie.rj.vadd(S,ie.rj),ie.rj.vsub(H.position,ie.rj),ie.ri.vadd(g,ie.ri),ie.ri.vsub(j.position,ie.ri),U.release(Zt),U.release(kt),this.result.push(ie),this.createFrictionEquationsFromContact(ie,this.frictionResult);for(var rt=0,Nt=It.length;rt!==Nt;rt++)U.release(It[rt]);return}else for(var rt=0;rt!==Ze.length;rt++){var St=U.get(),Wt=U.get();z.vmult(he[Ze[(rt+1)%Ze.length]],St),z.vmult(he[Ze[(rt+2)%Ze.length]],Wt),S.vadd(St,St),S.vadd(Wt,Wt);var Qt=Ge;Wt.vsub(St,Qt);var Ye=et;Qt.unit(Ye);var tn=U.get(),zt=U.get();g.vsub(St,zt);var Ln=zt.dot(Ye);Ye.mult(Ln,tn),tn.vadd(St,tn);var Vn=U.get();if(tn.vsub(g,Vn),Ln>0&&Ln*Ln<Qt.norm2()&&Vn.norm2()<me*me){var ie=this.createContactEquation(j,H,oe,b);tn.vsub(S,ie.rj),tn.vsub(g,ie.ni),ie.ni.normalize(),ie.ni.mult(me,ie.ri),ie.rj.vadd(S,ie.rj),ie.rj.vsub(H.position,ie.rj),ie.ri.vadd(g,ie.ri),ie.ri.vsub(j.position,ie.ri),this.result.push(ie),this.createFrictionEquationsFromContact(ie,this.frictionResult);for(var rt=0,Nt=It.length;rt!==Nt;rt++)U.release(It[rt]);U.release(St),U.release(Wt),U.release(tn),U.release(Vn),U.release(zt);return}U.release(St),U.release(Wt),U.release(tn),U.release(Vn),U.release(zt)}for(var rt=0,Nt=It.length;rt!==Nt;rt++)U.release(It[rt])}}};var Pt=new u,Kt=new u;h.prototype[o.types.PLANE|o.types.BOX]=h.prototype.planeBox=function(oe,b,g,S,B,z,j,H){b.convexPolyhedronRepresentation.material=b.material,b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse,this.planeConvex(oe,b.convexPolyhedronRepresentation,g,S,B,z,j,H)};var qt=new u,ot=new u,I=new u,G=new u;h.prototype[o.types.PLANE|o.types.CONVEXPOLYHEDRON]=h.prototype.planeConvex=function(oe,b,g,S,B,z,j,H){var U=qt,ne=ot;ne.set(0,0,1),B.vmult(ne,ne);for(var fe=0,he=I,me=0;me!==b.vertices.length;me++){U.copy(b.vertices[me]),z.vmult(U,U),S.vadd(U,U),U.vsub(g,he);var ae=ne.dot(he);if(ae<=0){var ue=this.createContactEquation(j,H,oe,b),Ae=G;ne.mult(ne.dot(he),Ae),U.vsub(Ae,Ae),Ae.vsub(g,ue.ri),ue.ni.copy(ne),U.vsub(S,ue.rj),ue.ri.vadd(g,ue.ri),ue.ri.vsub(j.position,ue.ri),ue.rj.vadd(S,ue.rj),ue.rj.vsub(H.position,ue.rj),this.result.push(ue),fe++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(ue,this.frictionResult)}}this.enableFrictionReduction&&fe&&this.createFrictionFromAverage(fe)};var Q=new u,ge=new u;h.prototype[o.types.CONVEXPOLYHEDRON]=h.prototype.convexConvex=function(oe,b,g,S,B,z,j,H,U,ne,fe,he){var me=Q;if(!(g.distanceTo(S)>oe.boundingSphereRadius+b.boundingSphereRadius)&&oe.findSeparatingAxis(b,g,B,S,z,me,fe,he)){var ae=[],ue=ge;oe.clipAgainstHull(g,B,b,S,z,me,-100,100,ae);for(var Ae=0,Ue=0;Ue!==ae.length;Ue++){var Be=this.createContactEquation(j,H,oe,b,U,ne),ie=Be.ri,Ve=Be.rj;me.negate(Be.ni),ae[Ue].normal.negate(ue),ue.mult(ae[Ue].depth,ue),ae[Ue].point.vadd(ue,ie),Ve.copy(ae[Ue].point),ie.vsub(g,ie),Ve.vsub(S,Ve),ie.vadd(g,ie),ie.vsub(j.position,ie),Ve.vadd(S,Ve),Ve.vsub(H.position,Ve),this.result.push(Be),Ae++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Be,this.frictionResult)}this.enableFrictionReduction&&Ae&&this.createFrictionFromAverage(Ae)}};var be=new u,Ne=new u,Ce=new u;h.prototype[o.types.PLANE|o.types.PARTICLE]=h.prototype.planeParticle=function(oe,b,g,S,B,z,j,H){var U=be;U.set(0,0,1),j.quaternion.vmult(U,U);var ne=Ne;S.vsub(j.position,ne);var fe=U.dot(ne);if(fe<=0){var he=this.createContactEquation(H,j,b,oe);he.ni.copy(U),he.ni.negate(he.ni),he.ri.set(0,0,0);var me=Ce;U.mult(U.dot(S),me),S.vsub(me,me),he.rj.copy(me),this.result.push(he),this.createFrictionEquationsFromContact(he,this.frictionResult)}};var ut=new u;h.prototype[o.types.PARTICLE|o.types.SPHERE]=h.prototype.sphereParticle=function(oe,b,g,S,B,z,j,H){var U=ut;U.set(0,0,1),S.vsub(g,U);var ne=U.norm2();if(ne<=oe.radius*oe.radius){var fe=this.createContactEquation(H,j,b,oe);U.normalize(),fe.rj.copy(U),fe.rj.mult(oe.radius,fe.rj),fe.ni.copy(U),fe.ni.negate(fe.ni),fe.ri.set(0,0,0),this.result.push(fe),this.createFrictionEquationsFromContact(fe,this.frictionResult)}};var At=new f,ct=new u,en=new u,un=new u,mn=new u,Cn=new u;h.prototype[o.types.PARTICLE|o.types.CONVEXPOLYHEDRON]=h.prototype.convexParticle=function(oe,b,g,S,B,z,j,H){var U=-1,ne=un,fe=Cn,he=null,me=0,ae=ct;if(ae.copy(S),ae.vsub(g,ae),B.conjugate(At),At.vmult(ae,ae),oe.pointIsInside(ae)){oe.worldVerticesNeedsUpdate&&oe.computeWorldVertices(g,B),oe.worldFaceNormalsNeedsUpdate&&oe.computeWorldFaceNormals(B);for(var ue=0,Ae=oe.faces.length;ue!==Ae;ue++){var Ue=[oe.worldVertices[oe.faces[ue][0]]],Be=oe.worldFaceNormals[ue];S.vsub(Ue[0],mn);var ie=-Be.dot(mn);(he===null||Math.abs(ie)<Math.abs(he))&&(he=ie,U=ue,ne.copy(Be),me++)}if(U!==-1){var Ve=this.createContactEquation(H,j,b,oe);ne.mult(he,fe),fe.vadd(S,fe),fe.vsub(g,fe),Ve.rj.copy(fe),ne.negate(Ve.ni),Ve.ri.set(0,0,0);var Ke=Ve.ri,qe=Ve.rj;Ke.vadd(S,Ke),Ke.vsub(H.position,Ke),qe.vadd(g,qe),qe.vsub(j.position,qe),this.result.push(Ve),this.createFrictionEquationsFromContact(Ve,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},h.prototype[o.types.BOX|o.types.HEIGHTFIELD]=h.prototype.boxHeightfield=function(oe,b,g,S,B,z,j,H){oe.convexPolyhedronRepresentation.material=oe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,this.convexHeightfield(oe.convexPolyhedronRepresentation,b,g,S,B,z,j,H)};var Or=new u,vo=new u,ko=[0];h.prototype[o.types.CONVEXPOLYHEDRON|o.types.HEIGHTFIELD]=h.prototype.convexHeightfield=function(oe,b,g,S,B,z,j,H){var U=b.data,ne=b.elementSize,fe=oe.boundingSphereRadius,he=vo,me=ko,ae=Or;p.pointToLocalFrame(S,z,g,ae);var ue=Math.floor((ae.x-fe)/ne)-1,Ae=Math.ceil((ae.x+fe)/ne)+1,Ue=Math.floor((ae.y-fe)/ne)-1,Be=Math.ceil((ae.y+fe)/ne)+1;if(!(Ae<0||Be<0||ue>U.length||Ue>U[0].length)){ue<0&&(ue=0),Ae<0&&(Ae=0),Ue<0&&(Ue=0),Be<0&&(Be=0),ue>=U.length&&(ue=U.length-1),Ae>=U.length&&(Ae=U.length-1),Be>=U[0].length&&(Be=U[0].length-1),Ue>=U[0].length&&(Ue=U[0].length-1);var ie=[];b.getRectMinMax(ue,Ue,Ae,Be,ie);var Ve=ie[0],Ke=ie[1];if(!(ae.z-fe>Ke||ae.z+fe<Ve))for(var qe=ue;qe<Ae;qe++)for(var Ze=Ue;Ze<Be;Ze++)b.getConvexTrianglePillar(qe,Ze,!1),p.pointToWorldFrame(S,z,b.pillarOffset,he),g.distanceTo(he)<b.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.convexConvex(oe,b.pillarConvex,g,he,B,z,j,H,null,null,me,null),b.getConvexTrianglePillar(qe,Ze,!0),p.pointToWorldFrame(S,z,b.pillarOffset,he),g.distanceTo(he)<b.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.convexConvex(oe,b.pillarConvex,g,he,B,z,j,H,null,null,me,null)}};var Mr=new u,Oo=new u;h.prototype[o.types.SPHERE|o.types.HEIGHTFIELD]=h.prototype.sphereHeightfield=function(oe,b,g,S,B,z,j,H){var U=b.data,ne=oe.radius,fe=b.elementSize,he=Oo,me=Mr;p.pointToLocalFrame(S,z,g,me);var ae=Math.floor((me.x-ne)/fe)-1,ue=Math.ceil((me.x+ne)/fe)+1,Ae=Math.floor((me.y-ne)/fe)-1,Ue=Math.ceil((me.y+ne)/fe)+1;if(!(ue<0||Ue<0||ae>U.length||Ue>U[0].length)){ae<0&&(ae=0),ue<0&&(ue=0),Ae<0&&(Ae=0),Ue<0&&(Ue=0),ae>=U.length&&(ae=U.length-1),ue>=U.length&&(ue=U.length-1),Ue>=U[0].length&&(Ue=U[0].length-1),Ae>=U[0].length&&(Ae=U[0].length-1);var Be=[];b.getRectMinMax(ae,Ae,ue,Ue,Be);var ie=Be[0],Ve=Be[1];if(!(me.z-ne>Ve||me.z+ne<ie))for(var Ke=this.result,qe=ae;qe<ue;qe++)for(var Ze=Ae;Ze<Ue;Ze++){var ke=Ke.length;b.getConvexTrianglePillar(qe,Ze,!1),p.pointToWorldFrame(S,z,b.pillarOffset,he),g.distanceTo(he)<b.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.sphereConvex(oe,b.pillarConvex,g,he,B,z,j,H),b.getConvexTrianglePillar(qe,Ze,!0),p.pointToWorldFrame(S,z,b.pillarOffset,he),g.distanceTo(he)<b.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.sphereConvex(oe,b.pillarConvex,g,he,B,z,j,H);var xt=Ke.length-ke;if(xt>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,a,r){a.exports=M;var c=t("../shapes/Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../solver/GSSolver"),p=t("../utils/Vec3Pool"),m=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation"),y=t("./Narrowphase"),l=t("../utils/EventTarget"),d=t("../collision/ArrayCollisionMatrix"),v=t("../material/Material"),h=t("../material/ContactMaterial"),x=t("../objects/Body"),w=t("../utils/TupleDictionary"),k=t("../collision/RaycastResult"),N=t("../collision/AABB"),A=t("../collision/Ray"),P=t("../collision/NaiveBroadphase");function M(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new P,this.bodies=[],this.solver=new u,this.constraints=[],this.narrowphase=new y(this),this.collisionMatrix=new d,this.collisionMatrixPrevious=new d,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new w,this.defaultMaterial=new v("default"),this.defaultContactMaterial=new h(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}M.prototype=new l;var W=new N,$=[],E=new A;if(M.prototype.getContactMaterial=function(C,te){return this.contactMaterialTable.get(C.id,te.id)},M.prototype.numObjects=function(){return this.bodies.length},M.prototype.collisionMatrixTick=function(){var C=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=C,this.collisionMatrix.reset()},M.prototype.add=M.prototype.addBody=function(C){this.bodies.indexOf(C)===-1&&(C.index=this.bodies.length,this.bodies.push(C),C.world=this,C.initPosition.copy(C.position),C.initVelocity.copy(C.velocity),C.timeLastSleepy=this.time,C instanceof x&&(C.initAngularVelocity.copy(C.angularVelocity),C.initQuaternion.copy(C.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=C,this.dispatchEvent(this.addBodyEvent))},M.prototype.addConstraint=function(C){this.constraints.push(C)},M.prototype.removeConstraint=function(C){var te=this.constraints.indexOf(C);te!==-1&&this.constraints.splice(te,1)},M.prototype.rayTest=function(C,te,se){se instanceof k?this.raycastClosest(C,te,{skipBackfaces:!0},se):this.raycastAll(C,te,{skipBackfaces:!0},se)},M.prototype.raycastAll=function(C,te,se,le){return se.mode=A.ALL,se.from=C,se.to=te,se.callback=le,E.intersectWorld(this,se)},M.prototype.raycastAny=function(C,te,se,le){return se.mode=A.ANY,se.from=C,se.to=te,se.result=le,E.intersectWorld(this,se)},M.prototype.raycastClosest=function(C,te,se,le){return se.mode=A.CLOSEST,se.from=C,se.to=te,se.result=le,E.intersectWorld(this,se)},M.prototype.remove=function(C){C.world=null;var te=this.bodies.length-1,se=this.bodies,le=se.indexOf(C);if(le!==-1){se.splice(le,1);for(var pe=0;pe!==se.length;pe++)se[pe].index=pe;this.collisionMatrix.setNumObjects(te),this.removeBodyEvent.body=C,this.dispatchEvent(this.removeBodyEvent)}},M.prototype.removeBody=M.prototype.remove,M.prototype.addMaterial=function(C){this.materials.push(C)},M.prototype.addContactMaterial=function(C){this.contactmaterials.push(C),this.contactMaterialTable.set(C.materials[0].id,C.materials[1].id,C)},typeof performance>"u"&&(performance={}),!performance.now){var _=Date.now();performance.timing&&performance.timing.navigationStart&&(_=performance.timing.navigationStart),performance.now=function(){return Date.now()-_}}var O=new o;M.prototype.step=function(C,te,se){if(se=se||10,te=te||0,te===0)this.internalStep(C),this.time+=C;else{var le=Math.floor((this.time+te)/C)-Math.floor(this.time/C);le=Math.min(le,se);for(var pe=performance.now(),ve=0;ve!==le&&(this.internalStep(C),!(performance.now()-pe>C*1e3));ve++);this.time+=te;for(var xe=this.time%C,Se=xe/C,Re=O,Fe=this.bodies,Me=0;Me!==Fe.length;Me++){var Te=Fe[Me];Te.type!==x.STATIC&&Te.sleepState!==x.SLEEPING?(Te.position.vsub(Te.previousPosition,Re),Re.scale(Se,Re),Te.position.vadd(Re,Te.interpolatedPosition)):(Te.interpolatedPosition.copy(Te.position),Te.interpolatedQuaternion.copy(Te.quaternion))}}};var V={type:"postStep"},D={type:"preStep"},J={type:"collide",body:null,contact:null},ee=[],K=[],de=[],_e=[],ze=new o,Oe=new o,je=new o,Pe=new o,q=new o,R=new o,F=new o,Z=new o,T=new o,L=new i,re=new i,ye=new i,Y=new o;M.prototype.internalStep=function(C){this.dt=C;var te=this,se=this,le=this.contacts,pe=de,ve=_e,xe=this.numObjects(),Se=this.bodies,Re=this.solver,Fe=this.gravity,Me=this.doProfiling,Te=this.profile,Xe=x.DYNAMIC,Ge,et=this.constraints,nt=K,yt=Fe.norm(),wt=Fe.x,mt=Fe.y,Dt=Fe.z,Ie=0;for(Me&&(Ge=performance.now()),Ie=0;Ie!==xe;Ie++){var Le=Se[Ie];if(Le.type&Xe){var Pt=Le.force,Kt=Le.mass;Pt.x+=Kt*wt,Pt.y+=Kt*mt,Pt.z+=Kt*Dt}}for(var Ie=0,qt=this.subsystems.length;Ie!==qt;Ie++)this.subsystems[Ie].update();Me&&(Ge=performance.now()),pe.length=0,ve.length=0,this.broadphase.collisionPairs(this,pe,ve),Me&&(Te.broadphase=performance.now()-Ge);var vo=et.length;for(Ie=0;Ie!==vo;Ie++){var ot=et[Ie];if(!ot.collideConnected)for(var I=pe.length-1;I>=0;I-=1)(ot.bodyA===pe[I]&&ot.bodyB===ve[I]||ot.bodyB===pe[I]&&ot.bodyA===ve[I])&&(pe.splice(I,1),ve.splice(I,1))}this.collisionMatrixTick(),Me&&(Ge=performance.now());var G=ee,Q=le.length;for(Ie=0;Ie!==Q;Ie++)G.push(le[Ie]);le.length=0;var ge=this.frictionEquations.length;for(Ie=0;Ie!==ge;Ie++)nt.push(this.frictionEquations[Ie]);this.frictionEquations.length=0,this.narrowphase.getContacts(pe,ve,this,le,G,this.frictionEquations,nt),Me&&(Te.narrowphase=performance.now()-Ge),Me&&(Ge=performance.now());for(var Ie=0;Ie<this.frictionEquations.length;Ie++)Re.addEquation(this.frictionEquations[Ie]);for(var be=le.length,Ne=0;Ne!==be;Ne++){var ot=le[Ne],Le=ot.bi,Ce=ot.bj,ut=ot.si,At=ot.sj,ct;Le.material&&Ce.material?ct=this.getContactMaterial(Le.material,Ce.material)||this.defaultContactMaterial:ct=this.defaultContactMaterial;var en=ct.friction;if(Le.material&&Ce.material&&(Le.material.friction>=0&&Ce.material.friction>=0&&(en=Le.material.friction*Ce.material.friction),Le.material.restitution>=0&&Ce.material.restitution>=0&&(ot.restitution=Le.material.restitution*Ce.material.restitution)),Re.addEquation(ot),Le.allowSleep&&Le.type===x.DYNAMIC&&Le.sleepState===x.SLEEPING&&Ce.sleepState===x.AWAKE&&Ce.type!==x.STATIC){var un=Ce.velocity.norm2()+Ce.angularVelocity.norm2(),mn=Math.pow(Ce.sleepSpeedLimit,2);un>=mn*2&&(Le._wakeUpAfterNarrowphase=!0)}if(Ce.allowSleep&&Ce.type===x.DYNAMIC&&Ce.sleepState===x.SLEEPING&&Le.sleepState===x.AWAKE&&Le.type!==x.STATIC){var Cn=Le.velocity.norm2()+Le.angularVelocity.norm2(),Or=Math.pow(Le.sleepSpeedLimit,2);Cn>=Or*2&&(Ce._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(Le,Ce,!0),this.collisionMatrixPrevious.get(Le,Ce)||(J.body=Ce,J.contact=ot,Le.dispatchEvent(J),J.body=Le,Ce.dispatchEvent(J))}for(Me&&(Te.makeContactConstraints=performance.now()-Ge,Ge=performance.now()),Ie=0;Ie!==xe;Ie++){var Le=Se[Ie];Le._wakeUpAfterNarrowphase&&(Le.wakeUp(),Le._wakeUpAfterNarrowphase=!1)}var vo=et.length;for(Ie=0;Ie!==vo;Ie++){var ot=et[Ie];ot.update();for(var I=0,ko=ot.equations.length;I!==ko;I++){var Mr=ot.equations[I];Re.addEquation(Mr)}}Re.solve(C,this),Me&&(Te.solve=performance.now()-Ge),Re.removeAllEquations();var Oo=Math.pow;for(Ie=0;Ie!==xe;Ie++){var Le=Se[Ie];if(Le.type&Xe){var oe=Oo(1-Le.linearDamping,C),b=Le.velocity;b.mult(oe,b);var g=Le.angularVelocity;if(g){var S=Oo(1-Le.angularDamping,C);g.mult(S,g)}}}for(this.dispatchEvent(D),Ie=0;Ie!==xe;Ie++){var Le=Se[Ie];Le.preStep&&Le.preStep.call(Le)}Me&&(Ge=performance.now());var B=L,z=re,j=ye,H=this.stepnumber,U=x.DYNAMIC|x.KINEMATIC,ne=H%(this.quatNormalizeSkip+1)===0,fe=this.quatNormalizeFast,he=C*.5,me=c.types.PLANE,ae=c.types.CONVEXPOLYHEDRON;for(Ie=0;Ie!==xe;Ie++){var ue=Se[Ie],Ae=ue.force,Ue=ue.torque;if(ue.type&U&&ue.sleepState!==x.SLEEPING){var Be=ue.velocity,ie=ue.angularVelocity,Ve=ue.position,Ke=ue.quaternion,qe=ue.invMass,Ze=ue.invInertiaWorld;Be.x+=Ae.x*qe*C,Be.y+=Ae.y*qe*C,Be.z+=Ae.z*qe*C,ue.angularVelocity&&(Ze.vmult(Ue,Y),Y.mult(C,Y),Y.vadd(ie,ie)),Ve.x+=Be.x*C,Ve.y+=Be.y*C,Ve.z+=Be.z*C,ue.angularVelocity&&(z.set(ie.x,ie.y,ie.z,0),z.mult(Ke,j),Ke.x+=he*j.x,Ke.y+=he*j.y,Ke.z+=he*j.z,Ke.w+=he*j.w,ne&&(fe?Ke.normalizeFast():Ke.normalize())),ue.aabb&&(ue.aabbNeedsUpdate=!0),ue.updateInertiaWorld&&ue.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,Me&&(Te.integrate=performance.now()-Ge),this.time+=C,this.stepnumber+=1,this.dispatchEvent(V),Ie=0;Ie!==xe;Ie++){var Le=Se[Ie],ke=Le.postStep;ke&&ke.call(Le)}if(this.allowSleep)for(Ie=0;Ie!==xe;Ie++)Se[Ie].sleepTick(this.time)},M.prototype.clearForces=function(){for(var C=this.bodies,te=C.length,se=0;se!==te;se++){var le=C[se],pe=le.force,ve=le.torque;le.force.set(0,0,0),le.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})});var mm={};dd(mm,{main:()=>La,onStart:()=>hm,onUpdate:()=>pm,rendererTransport:()=>Da});module.exports=pd(mm);var Eo=$e(Qe());function Sd(){return{states:[]}}var Po;(function(e){function n(t,a=Eo.default.Writer.create()){for(let r of t.states)hi.encode(r,a.uint32(10).fork()).ldelim();return a}e.encode=n;function s(t,a){let r=t instanceof Eo.default.Reader?t:Eo.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Sd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.states.push(hi.decode(r,r.uint32()));continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Po||(Po={}));function Td(){return{clip:"",playing:void 0,weight:void 0,speed:void 0,loop:void 0,shouldReset:void 0}}var hi;(function(e){function n(t,a=Eo.default.Writer.create()){return t.clip!==""&&a.uint32(18).string(t.clip),t.playing!==void 0&&a.uint32(24).bool(t.playing),t.weight!==void 0&&a.uint32(37).float(t.weight),t.speed!==void 0&&a.uint32(45).float(t.speed),t.loop!==void 0&&a.uint32(48).bool(t.loop),t.shouldReset!==void 0&&a.uint32(56).bool(t.shouldReset),a}e.encode=n;function s(t,a){let r=t instanceof Eo.default.Reader?t:Eo.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Td();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 2:if(i!==18)break;o.clip=r.string();continue;case 3:if(i!==24)break;o.playing=r.bool();continue;case 4:if(i!==37)break;o.weight=r.float();continue;case 5:if(i!==45)break;o.speed=r.float();continue;case 6:if(i!==48)break;o.loop=r.bool();continue;case 7:if(i!==56)break;o.shouldReset=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(hi||(hi={}));var Yc={COMPONENT_ID:1042,serialize(e,n){let s=Po.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Po.decode(e.buffer(),e.remainingBytes())},create(){return Po.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAnimator"}};var mi=$e(Qe());function Ad(){return{playing:void 0,volume:void 0,loop:void 0,pitch:void 0,audioClipUrl:""}}var zo;(function(e){function n(t,a=mi.default.Writer.create()){return t.playing!==void 0&&a.uint32(8).bool(t.playing),t.volume!==void 0&&a.uint32(21).float(t.volume),t.loop!==void 0&&a.uint32(24).bool(t.loop),t.pitch!==void 0&&a.uint32(37).float(t.pitch),t.audioClipUrl!==""&&a.uint32(42).string(t.audioClipUrl),a}e.encode=n;function s(t,a){let r=t instanceof mi.default.Reader?t:mi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ad();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.playing=r.bool();continue;case 2:if(i!==21)break;o.volume=r.float();continue;case 3:if(i!==24)break;o.loop=r.bool();continue;case 4:if(i!==37)break;o.pitch=r.float();continue;case 5:if(i!==42)break;o.audioClipUrl=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(zo||(zo={}));var $c={COMPONENT_ID:1020,serialize(e,n){let s=zo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return zo.decode(e.buffer(),e.remainingBytes())},create(){return zo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAudioSource"}};var yi=$e(Qe());function _d(){return{playing:void 0,volume:void 0,url:""}}var Fo;(function(e){function n(t,a=yi.default.Writer.create()){return t.playing!==void 0&&a.uint32(8).bool(t.playing),t.volume!==void 0&&a.uint32(21).float(t.volume),t.url!==""&&a.uint32(26).string(t.url),a}e.encode=n;function s(t,a){let r=t instanceof yi.default.Reader?t:yi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=_d();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.playing=r.bool();continue;case 2:if(i!==21)break;o.volume=r.float();continue;case 3:if(i!==26)break;o.url=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Fo||(Fo={}));var Xc={COMPONENT_ID:1021,serialize(e,n){let s=Fo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Fo.decode(e.buffer(),e.remainingBytes())},create(){return Fo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAudioStream"}};var vi=$e(Qe());var Zc;(function(e){e[e.AAPT_POSITION=0]="AAPT_POSITION",e[e.AAPT_NAME_TAG=1]="AAPT_NAME_TAG",e[e.AAPT_LEFT_HAND=2]="AAPT_LEFT_HAND",e[e.AAPT_RIGHT_HAND=3]="AAPT_RIGHT_HAND"})(Zc||(Zc={}));function Rd(){return{avatarId:void 0,anchorPointId:0}}var Uo;(function(e){function n(t,a=vi.default.Writer.create()){return t.avatarId!==void 0&&a.uint32(10).string(t.avatarId),t.anchorPointId!==0&&a.uint32(16).int32(t.anchorPointId),a}e.encode=n;function s(t,a){let r=t instanceof vi.default.Reader?t:vi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Rd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.avatarId=r.string();continue;case 2:if(i!==16)break;o.anchorPointId=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Uo||(Uo={}));var Qc={COMPONENT_ID:1073,serialize(e,n){let s=Uo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Uo.decode(e.buffer(),e.remainingBytes())},create(){return Uo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAvatarAttach"}};var xi=$e(Qe());var yn=$e(Qe());function Nd(){return{x:0,y:0,z:0}}var Jc;(function(e){function n(t,a=yn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.z!==0&&a.uint32(29).float(t.z),a}e.encode=n;function s(t,a){let r=t instanceof yn.default.Reader?t:yn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Nd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.z=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Jc||(Jc={}));function Cd(){return{x:0,y:0,z:0}}var tt;(function(e){function n(t,a=yn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.z!==0&&a.uint32(29).float(t.z),a}e.encode=n;function s(t,a){let r=t instanceof yn.default.Reader?t:yn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Cd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.z=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(tt||(tt={}));function Bd(){return{x:0,y:0}}var Kc;(function(e){function n(t,a=yn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),a}e.encode=n;function s(t,a){let r=t instanceof yn.default.Reader?t:yn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Bd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Kc||(Kc={}));function Id(){return{x:0,y:0,z:0,w:0}}var go;(function(e){function n(t,a=yn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.z!==0&&a.uint32(29).float(t.z),t.w!==0&&a.uint32(37).float(t.w),a}e.encode=n;function s(t,a){let r=t instanceof yn.default.Reader?t:yn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Id();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.z=r.float();continue;case 4:if(i!==37)break;o.w=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(go||(go={}));var eu;(function(e){e[e.AMT_HIDE_AVATARS=0]="AMT_HIDE_AVATARS",e[e.AMT_DISABLE_PASSPORTS=1]="AMT_DISABLE_PASSPORTS"})(eu||(eu={}));function kd(){return{area:void 0,excludeIds:[],modifiers:[]}}var Lo;(function(e){function n(t,a=xi.default.Writer.create()){t.area!==void 0&&tt.encode(t.area,a.uint32(10).fork()).ldelim();for(let r of t.excludeIds)a.uint32(18).string(r);a.uint32(26).fork();for(let r of t.modifiers)a.int32(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof xi.default.Reader?t:xi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=kd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.area=tt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.excludeIds.push(r.string());continue;case 3:if(i===24){o.modifiers.push(r.int32());continue}if(i===26){let u=r.uint32()+r.pos;for(;r.pos<u;)o.modifiers.push(r.int32());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Lo||(Lo={}));var tu={COMPONENT_ID:1070,serialize(e,n){let s=Lo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Lo.decode(e.buffer(),e.remainingBytes())},create(){return Lo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAvatarModifierArea"}};var Sn=null;try{Sn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Et(e,n,s){this.low=e|0,this.high=n|0,this.unsigned=!!s}Et.prototype.__isLong__;Object.defineProperty(Et.prototype,"__isLong__",{value:!0});function nn(e){return(e&&e.__isLong__)===!0}function nu(e){var n=Math.clz32(e&-e);return e?31-n:n}Et.isLong=nn;var ou={},ru={};function wo(e,n){var s,t,a;return n?(e>>>=0,(a=0<=e&&e<256)&&(t=ru[e],t)?t:(s=at(e,0,!0),a&&(ru[e]=s),s)):(e|=0,(a=-128<=e&&e<128)&&(t=ou[e],t)?t:(s=at(e,e<0?-1:0,!1),a&&(ou[e]=s),s))}Et.fromInt=wo;function Tn(e,n){if(isNaN(e))return n?jn:On;if(n){if(e<0)return jn;if(e>=cu)return lu}else{if(e<=-au)return ln;if(e+1>=au)return fu}return e<0?Tn(-e,n).neg():at(e%Do|0,e/Do|0,n)}Et.fromNumber=Tn;function at(e,n,s){return new Et(e,n,s)}Et.fromBits=at;var bi=Math.pow;function rs(e,n,s){if(e.length===0)throw Error("empty string");if(typeof n=="number"?(s=n,n=!1):n=!!n,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return n?jn:On;if(s=s||10,s<2||36<s)throw RangeError("radix");var t;if((t=e.indexOf("-"))>0)throw Error("interior hyphen");if(t===0)return rs(e.substring(1),n,s).neg();for(var a=Tn(bi(s,8)),r=On,c=0;c<e.length;c+=8){var o=Math.min(8,e.length-c),i=parseInt(e.substring(c,c+o),s);if(o<8){var u=Tn(bi(s,o));r=r.mul(u).add(Tn(i))}else r=r.mul(a),r=r.add(Tn(i))}return r.unsigned=n,r}Et.fromString=rs;function Mn(e,n){return typeof e=="number"?Tn(e,n):typeof e=="string"?rs(e,n):at(e.low,e.high,typeof n=="boolean"?n:e.unsigned)}Et.fromValue=Mn;var iu=65536,Od=1<<24,Do=iu*iu,cu=Do*Do,au=cu/2,su=wo(Od),On=wo(0);Et.ZERO=On;var jn=wo(0,!0);Et.UZERO=jn;var Vo=wo(1);Et.ONE=Vo;var uu=wo(1,!0);Et.UONE=uu;var os=wo(-1);Et.NEG_ONE=os;var fu=at(-1,2147483647,!1);Et.MAX_VALUE=fu;var lu=at(-1,-1,!0);Et.MAX_UNSIGNED_VALUE=lu;var ln=at(0,-2147483648,!1);Et.MIN_VALUE=ln;var Ee=Et.prototype;Ee.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ee.toNumber=function(){return this.unsigned?(this.high>>>0)*Do+(this.low>>>0):this.high*Do+(this.low>>>0)};Ee.toString=function(n){if(n=n||10,n<2||36<n)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ln)){var s=Tn(n),t=this.div(s),a=t.mul(s).sub(this);return t.toString(n)+a.toInt().toString(n)}else return"-"+this.neg().toString(n);for(var r=Tn(bi(n,6),this.unsigned),c=this,o="";;){var i=c.div(r),u=c.sub(i.mul(r)).toInt()>>>0,p=u.toString(n);if(c=i,c.isZero())return p+o;for(;p.length<6;)p="0"+p;o=""+p+o}};Ee.getHighBits=function(){return this.high};Ee.getHighBitsUnsigned=function(){return this.high>>>0};Ee.getLowBits=function(){return this.low};Ee.getLowBitsUnsigned=function(){return this.low>>>0};Ee.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ln)?64:this.neg().getNumBitsAbs();for(var n=this.high!=0?this.high:this.low,s=31;s>0&&!(n&1<<s);s--);return this.high!=0?s+33:s+1};Ee.isZero=function(){return this.high===0&&this.low===0};Ee.eqz=Ee.isZero;Ee.isNegative=function(){return!this.unsigned&&this.high<0};Ee.isPositive=function(){return this.unsigned||this.high>=0};Ee.isOdd=function(){return(this.low&1)===1};Ee.isEven=function(){return(this.low&1)===0};Ee.equals=function(n){return nn(n)||(n=Mn(n)),this.unsigned!==n.unsigned&&this.high>>>31===1&&n.high>>>31===1?!1:this.high===n.high&&this.low===n.low};Ee.eq=Ee.equals;Ee.notEquals=function(n){return!this.eq(n)};Ee.neq=Ee.notEquals;Ee.ne=Ee.notEquals;Ee.lessThan=function(n){return this.comp(n)<0};Ee.lt=Ee.lessThan;Ee.lessThanOrEqual=function(n){return this.comp(n)<=0};Ee.lte=Ee.lessThanOrEqual;Ee.le=Ee.lessThanOrEqual;Ee.greaterThan=function(n){return this.comp(n)>0};Ee.gt=Ee.greaterThan;Ee.greaterThanOrEqual=function(n){return this.comp(n)>=0};Ee.gte=Ee.greaterThanOrEqual;Ee.ge=Ee.greaterThanOrEqual;Ee.compare=function(n){if(nn(n)||(n=Mn(n)),this.eq(n))return 0;var s=this.isNegative(),t=n.isNegative();return s&&!t?-1:!s&&t?1:this.unsigned?n.high>>>0>this.high>>>0||n.high===this.high&&n.low>>>0>this.low>>>0?-1:1:this.sub(n).isNegative()?-1:1};Ee.comp=Ee.compare;Ee.negate=function(){return!this.unsigned&&this.eq(ln)?ln:this.not().add(Vo)};Ee.neg=Ee.negate;Ee.add=function(n){nn(n)||(n=Mn(n));var s=this.high>>>16,t=this.high&65535,a=this.low>>>16,r=this.low&65535,c=n.high>>>16,o=n.high&65535,i=n.low>>>16,u=n.low&65535,p=0,m=0,f=0,y=0;return y+=r+u,f+=y>>>16,y&=65535,f+=a+i,m+=f>>>16,f&=65535,m+=t+o,p+=m>>>16,m&=65535,p+=s+c,p&=65535,at(f<<16|y,p<<16|m,this.unsigned)};Ee.subtract=function(n){return nn(n)||(n=Mn(n)),this.add(n.neg())};Ee.sub=Ee.subtract;Ee.multiply=function(n){if(this.isZero())return this;if(nn(n)||(n=Mn(n)),Sn){var s=Sn.mul(this.low,this.high,n.low,n.high);return at(s,Sn.get_high(),this.unsigned)}if(n.isZero())return this.unsigned?jn:On;if(this.eq(ln))return n.isOdd()?ln:On;if(n.eq(ln))return this.isOdd()?ln:On;if(this.isNegative())return n.isNegative()?this.neg().mul(n.neg()):this.neg().mul(n).neg();if(n.isNegative())return this.mul(n.neg()).neg();if(this.lt(su)&&n.lt(su))return Tn(this.toNumber()*n.toNumber(),this.unsigned);var t=this.high>>>16,a=this.high&65535,r=this.low>>>16,c=this.low&65535,o=n.high>>>16,i=n.high&65535,u=n.low>>>16,p=n.low&65535,m=0,f=0,y=0,l=0;return l+=c*p,y+=l>>>16,l&=65535,y+=r*p,f+=y>>>16,y&=65535,y+=c*u,f+=y>>>16,y&=65535,f+=a*p,m+=f>>>16,f&=65535,f+=r*u,m+=f>>>16,f&=65535,f+=c*i,m+=f>>>16,f&=65535,m+=t*p+a*u+r*i+c*o,m&=65535,at(y<<16|l,m<<16|f,this.unsigned)};Ee.mul=Ee.multiply;Ee.divide=function(n){if(nn(n)||(n=Mn(n)),n.isZero())throw Error("division by zero");if(Sn){if(!this.unsigned&&this.high===-2147483648&&n.low===-1&&n.high===-1)return this;var s=(this.unsigned?Sn.div_u:Sn.div_s)(this.low,this.high,n.low,n.high);return at(s,Sn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?jn:On;var t,a,r;if(this.unsigned){if(n.unsigned||(n=n.toUnsigned()),n.gt(this))return jn;if(n.gt(this.shru(1)))return uu;r=jn}else{if(this.eq(ln)){if(n.eq(Vo)||n.eq(os))return ln;if(n.eq(ln))return Vo;var c=this.shr(1);return t=c.div(n).shl(1),t.eq(On)?n.isNegative()?Vo:os:(a=this.sub(n.mul(t)),r=t.add(a.div(n)),r)}else if(n.eq(ln))return this.unsigned?jn:On;if(this.isNegative())return n.isNegative()?this.neg().div(n.neg()):this.neg().div(n).neg();if(n.isNegative())return this.div(n.neg()).neg();r=On}for(a=this;a.gte(n);){t=Math.max(1,Math.floor(a.toNumber()/n.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),i=o<=48?1:bi(2,o-48),u=Tn(t),p=u.mul(n);p.isNegative()||p.gt(a);)t-=i,u=Tn(t,this.unsigned),p=u.mul(n);u.isZero()&&(u=Vo),r=r.add(u),a=a.sub(p)}return r};Ee.div=Ee.divide;Ee.modulo=function(n){if(nn(n)||(n=Mn(n)),Sn){var s=(this.unsigned?Sn.rem_u:Sn.rem_s)(this.low,this.high,n.low,n.high);return at(s,Sn.get_high(),this.unsigned)}return this.sub(this.div(n).mul(n))};Ee.mod=Ee.modulo;Ee.rem=Ee.modulo;Ee.not=function(){return at(~this.low,~this.high,this.unsigned)};Ee.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Ee.clz=Ee.countLeadingZeros;Ee.countTrailingZeros=function(){return this.low?nu(this.low):nu(this.high)+32};Ee.ctz=Ee.countTrailingZeros;Ee.and=function(n){return nn(n)||(n=Mn(n)),at(this.low&n.low,this.high&n.high,this.unsigned)};Ee.or=function(n){return nn(n)||(n=Mn(n)),at(this.low|n.low,this.high|n.high,this.unsigned)};Ee.xor=function(n){return nn(n)||(n=Mn(n)),at(this.low^n.low,this.high^n.high,this.unsigned)};Ee.shiftLeft=function(n){return nn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?at(this.low<<n,this.high<<n|this.low>>>32-n,this.unsigned):at(0,this.low<<n-32,this.unsigned)};Ee.shl=Ee.shiftLeft;Ee.shiftRight=function(n){return nn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?at(this.low>>>n|this.high<<32-n,this.high>>n,this.unsigned):at(this.high>>n-32,this.high>=0?0:-1,this.unsigned)};Ee.shr=Ee.shiftRight;Ee.shiftRightUnsigned=function(n){return nn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?at(this.low>>>n|this.high<<32-n,this.high>>>n,this.unsigned):n===32?at(this.high,0,this.unsigned):at(this.high>>>n-32,0,this.unsigned)};Ee.shru=Ee.shiftRightUnsigned;Ee.shr_u=Ee.shiftRightUnsigned;Ee.rotateLeft=function(n){var s;return nn(n)&&(n=n.toInt()),(n&=63)===0?this:n===32?at(this.high,this.low,this.unsigned):n<32?(s=32-n,at(this.low<<n|this.high>>>s,this.high<<n|this.low>>>s,this.unsigned)):(n-=32,s=32-n,at(this.high<<n|this.low>>>s,this.low<<n|this.high>>>s,this.unsigned))};Ee.rotl=Ee.rotateLeft;Ee.rotateRight=function(n){var s;return nn(n)&&(n=n.toInt()),(n&=63)===0?this:n===32?at(this.high,this.low,this.unsigned):n<32?(s=32-n,at(this.high<<s|this.low>>>n,this.low<<s|this.high>>>n,this.unsigned)):(n-=32,s=32-n,at(this.low<<s|this.high>>>n,this.high<<s|this.low>>>n,this.unsigned))};Ee.rotr=Ee.rotateRight;Ee.toSigned=function(){return this.unsigned?at(this.low,this.high,!1):this};Ee.toUnsigned=function(){return this.unsigned?this:at(this.low,this.high,!0)};Ee.toBytes=function(n){return n?this.toBytesLE():this.toBytesBE()};Ee.toBytesLE=function(){var n=this.high,s=this.low;return[s&255,s>>>8&255,s>>>16&255,s>>>24,n&255,n>>>8&255,n>>>16&255,n>>>24]};Ee.toBytesBE=function(){var n=this.high,s=this.low;return[n>>>24,n>>>16&255,n>>>8&255,n&255,s>>>24,s>>>16&255,s>>>8&255,s&255]};Et.fromBytes=function(n,s,t){return t?Et.fromBytesLE(n,s):Et.fromBytesBE(n,s)};Et.fromBytesLE=function(n,s){return new Et(n[0]|n[1]<<8|n[2]<<16|n[3]<<24,n[4]|n[5]<<8|n[6]<<16|n[7]<<24,s)};Et.fromBytesBE=function(n,s){return new Et(n[4]<<24|n[5]<<16|n[6]<<8|n[7],n[0]<<24|n[1]<<16|n[2]<<8|n[3],s)};var is=Et;var To=$e(Qe());var So=$e(Qe());function Md(){return{r:0,g:0,b:0}}var Ot;(function(e){function n(t,a=So.default.Writer.create()){return t.r!==0&&a.uint32(13).float(t.r),t.g!==0&&a.uint32(21).float(t.g),t.b!==0&&a.uint32(29).float(t.b),a}e.encode=n;function s(t,a){let r=t instanceof So.default.Reader?t:So.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Md();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.r=r.float();continue;case 2:if(i!==21)break;o.g=r.float();continue;case 3:if(i!==29)break;o.b=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ot||(Ot={}));function Pd(){return{r:0,g:0,b:0,a:0}}var Ct;(function(e){function n(t,a=So.default.Writer.create()){return t.r!==0&&a.uint32(13).float(t.r),t.g!==0&&a.uint32(21).float(t.g),t.b!==0&&a.uint32(29).float(t.b),t.a!==0&&a.uint32(37).float(t.a),a}e.encode=n;function s(t,a){let r=t instanceof So.default.Reader?t:So.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Pd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.r=r.float();continue;case 2:if(i!==21)break;o.g=r.float();continue;case 3:if(i!==29)break;o.b=r.float();continue;case 4:if(i!==37)break;o.a=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ct||(Ct={}));function zd(){return{id:"",name:void 0,bodyShape:void 0,skinColor:void 0,hairColor:void 0,eyeColor:void 0,expressionTriggerId:void 0,expressionTriggerTimestamp:void 0,talking:void 0,wearables:[],emotes:[]}}var Wo;(function(e){function n(t,a=To.default.Writer.create()){t.id!==""&&a.uint32(10).string(t.id),t.name!==void 0&&a.uint32(18).string(t.name),t.bodyShape!==void 0&&a.uint32(26).string(t.bodyShape),t.skinColor!==void 0&&Ot.encode(t.skinColor,a.uint32(34).fork()).ldelim(),t.hairColor!==void 0&&Ot.encode(t.hairColor,a.uint32(42).fork()).ldelim(),t.eyeColor!==void 0&&Ot.encode(t.eyeColor,a.uint32(50).fork()).ldelim(),t.expressionTriggerId!==void 0&&a.uint32(58).string(t.expressionTriggerId),t.expressionTriggerTimestamp!==void 0&&a.uint32(64).int64(t.expressionTriggerTimestamp),t.talking!==void 0&&a.uint32(72).bool(t.talking);for(let r of t.wearables)a.uint32(82).string(r);for(let r of t.emotes)a.uint32(90).string(r);return a}e.encode=n;function s(t,a){let r=t instanceof To.default.Reader?t:To.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=zd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.id=r.string();continue;case 2:if(i!==18)break;o.name=r.string();continue;case 3:if(i!==26)break;o.bodyShape=r.string();continue;case 4:if(i!==34)break;o.skinColor=Ot.decode(r,r.uint32());continue;case 5:if(i!==42)break;o.hairColor=Ot.decode(r,r.uint32());continue;case 6:if(i!==50)break;o.eyeColor=Ot.decode(r,r.uint32());continue;case 7:if(i!==58)break;o.expressionTriggerId=r.string();continue;case 8:if(i!==64)break;o.expressionTriggerTimestamp=Ud(r.int64());continue;case 9:if(i!==72)break;o.talking=r.bool();continue;case 10:if(i!==82)break;o.wearables.push(r.string());continue;case 11:if(i!==90)break;o.emotes.push(r.string());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Wo||(Wo={}));var Fd=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global;throw"Unable to locate global object"})();function Ud(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new Fd.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}To.default.util.Long!==is&&(To.default.util.Long=is,To.default.configure());var du={COMPONENT_ID:1080,serialize(e,n){let s=Wo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Wo.decode(e.buffer(),e.remainingBytes())},create(){return Wo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAvatarShape"}};var Ei=$e(Qe());var pu;(function(e){e[e.BM_NONE=0]="BM_NONE",e[e.BM_X=1]="BM_X",e[e.BM_Y=2]="BM_Y",e[e.BM_Z=4]="BM_Z",e[e.BM_ALL=7]="BM_ALL"})(pu||(pu={}));function Ld(){return{billboardMode:void 0}}var qo;(function(e){function n(t,a=Ei.default.Writer.create()){return t.billboardMode!==void 0&&a.uint32(8).int32(t.billboardMode),a}e.encode=n;function s(t,a){let r=t instanceof Ei.default.Reader?t:Ei.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ld();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.billboardMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(qo||(qo={}));var hu={COMPONENT_ID:1090,serialize(e,n){let s=qo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return qo.decode(e.buffer(),e.remainingBytes())},create(){return qo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBBillboard"}};var gi=$e(Qe());function Vd(){return{mode:0}}var Ho;(function(e){function n(t,a=gi.default.Writer.create()){return t.mode!==0&&a.uint32(8).int32(t.mode),a}e.encode=n;function s(t,a){let r=t instanceof gi.default.Reader?t:gi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Vd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.mode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ho||(Ho={}));var mu={COMPONENT_ID:1072,serialize(e,n){let s=Ho.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Ho.decode(e.buffer(),e.remainingBytes())},create(){return Ho.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBCameraMode"}};var wi=$e(Qe());function Dd(){return{area:void 0,mode:0}}var Go;(function(e){function n(t,a=wi.default.Writer.create()){return t.area!==void 0&&tt.encode(t.area,a.uint32(10).fork()).ldelim(),t.mode!==0&&a.uint32(16).int32(t.mode),a}e.encode=n;function s(t,a){let r=t instanceof wi.default.Reader?t:wi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Dd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.area=tt.decode(r,r.uint32());continue;case 2:if(i!==16)break;o.mode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Go||(Go={}));var yu={COMPONENT_ID:1071,serialize(e,n){let s=Go.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Go.decode(e.buffer(),e.remainingBytes())},create(){return Go.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBCameraModeArea"}};var Si=$e(Qe());function Wd(){return{frameNumber:0,totalRuntime:0,tickNumber:0}}var jo;(function(e){function n(t,a=Si.default.Writer.create()){return t.frameNumber!==0&&a.uint32(8).uint32(t.frameNumber),t.totalRuntime!==0&&a.uint32(21).float(t.totalRuntime),t.tickNumber!==0&&a.uint32(24).uint32(t.tickNumber),a}e.encode=n;function s(t,a){let r=t instanceof Si.default.Reader?t:Si.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Wd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.frameNumber=r.uint32();continue;case 2:if(i!==21)break;o.totalRuntime=r.float();continue;case 3:if(i!==24)break;o.tickNumber=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(jo||(jo={}));var vu={COMPONENT_ID:1048,serialize(e,n){let s=jo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return jo.decode(e.buffer(),e.remainingBytes())},create(){return jo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBEngineInfo"}};var Ti=$e(Qe());function qd(){return{src:"",visibleMeshesCollisionMask:void 0,invisibleMeshesCollisionMask:void 0}}var Yo;(function(e){function n(t,a=Ti.default.Writer.create()){return t.src!==""&&a.uint32(10).string(t.src),t.visibleMeshesCollisionMask!==void 0&&a.uint32(32).uint32(t.visibleMeshesCollisionMask),t.invisibleMeshesCollisionMask!==void 0&&a.uint32(40).uint32(t.invisibleMeshesCollisionMask),a}e.encode=n;function s(t,a){let r=t instanceof Ti.default.Reader?t:Ti.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=qd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.src=r.string();continue;case 4:if(i!==32)break;o.visibleMeshesCollisionMask=r.uint32();continue;case 5:if(i!==40)break;o.invisibleMeshesCollisionMask=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Yo||(Yo={}));var xu={COMPONENT_ID:1041,serialize(e,n){let s=Yo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Yo.decode(e.buffer(),e.remainingBytes())},create(){return Yo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBGltfContainer"}};var Ai=$e(Qe());function Hd(){return{currentState:0}}var $o;(function(e){function n(t,a=Ai.default.Writer.create()){return t.currentState!==0&&a.uint32(8).int32(t.currentState),a}e.encode=n;function s(t,a){let r=t instanceof Ai.default.Reader?t:Ai.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Hd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.currentState=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})($o||($o={}));var bu={COMPONENT_ID:1049,serialize(e,n){let s=$o.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return $o.decode(e.buffer(),e.remainingBytes())},create(){return $o.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBGltfContainerLoadingState"}};var Wn=$e(Qe());var vn=$e(Qe());var Eu;(function(e){e[e.TWM_REPEAT=0]="TWM_REPEAT",e[e.TWM_CLAMP=1]="TWM_CLAMP",e[e.TWM_MIRROR=2]="TWM_MIRROR"})(Eu||(Eu={}));var gu;(function(e){e[e.TFM_POINT=0]="TFM_POINT",e[e.TFM_BILINEAR=1]="TFM_BILINEAR",e[e.TFM_TRILINEAR=2]="TFM_TRILINEAR"})(gu||(gu={}));function Gd(){return{src:"",wrapMode:void 0,filterMode:void 0}}var _i;(function(e){function n(t,a=vn.default.Writer.create()){return t.src!==""&&a.uint32(10).string(t.src),t.wrapMode!==void 0&&a.uint32(16).int32(t.wrapMode),t.filterMode!==void 0&&a.uint32(24).int32(t.filterMode),a}e.encode=n;function s(t,a){let r=t instanceof vn.default.Reader?t:vn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Gd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.src=r.string();continue;case 2:if(i!==16)break;o.wrapMode=r.int32();continue;case 3:if(i!==24)break;o.filterMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(_i||(_i={}));function jd(){return{userId:"",wrapMode:void 0,filterMode:void 0}}var Ri;(function(e){function n(t,a=vn.default.Writer.create()){return t.userId!==""&&a.uint32(10).string(t.userId),t.wrapMode!==void 0&&a.uint32(16).int32(t.wrapMode),t.filterMode!==void 0&&a.uint32(24).int32(t.filterMode),a}e.encode=n;function s(t,a){let r=t instanceof vn.default.Reader?t:vn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=jd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.userId=r.string();continue;case 2:if(i!==16)break;o.wrapMode=r.int32();continue;case 3:if(i!==24)break;o.filterMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ri||(Ri={}));function Yd(){return{videoPlayerEntity:0,wrapMode:void 0,filterMode:void 0}}var Ni;(function(e){function n(t,a=vn.default.Writer.create()){return t.videoPlayerEntity!==0&&a.uint32(8).uint32(t.videoPlayerEntity),t.wrapMode!==void 0&&a.uint32(16).int32(t.wrapMode),t.filterMode!==void 0&&a.uint32(24).int32(t.filterMode),a}e.encode=n;function s(t,a){let r=t instanceof vn.default.Reader?t:vn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Yd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.videoPlayerEntity=r.uint32();continue;case 2:if(i!==16)break;o.wrapMode=r.int32();continue;case 3:if(i!==24)break;o.filterMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ni||(Ni={}));function $d(){return{tex:void 0}}var on;(function(e){function n(t,a=vn.default.Writer.create()){switch(t.tex?.$case){case"texture":_i.encode(t.tex.texture,a.uint32(10).fork()).ldelim();break;case"avatarTexture":Ri.encode(t.tex.avatarTexture,a.uint32(18).fork()).ldelim();break;case"videoTexture":Ni.encode(t.tex.videoTexture,a.uint32(26).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof vn.default.Reader?t:vn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=$d();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.tex={$case:"texture",texture:_i.decode(r,r.uint32())};continue;case 2:if(i!==18)break;o.tex={$case:"avatarTexture",avatarTexture:Ri.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.tex={$case:"videoTexture",videoTexture:Ni.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(on||(on={}));var wu;(function(e){e[e.MTM_OPAQUE=0]="MTM_OPAQUE",e[e.MTM_ALPHA_TEST=1]="MTM_ALPHA_TEST",e[e.MTM_ALPHA_BLEND=2]="MTM_ALPHA_BLEND",e[e.MTM_ALPHA_TEST_AND_ALPHA_BLEND=3]="MTM_ALPHA_TEST_AND_ALPHA_BLEND",e[e.MTM_AUTO=4]="MTM_AUTO"})(wu||(wu={}));function Xd(){return{material:void 0}}var Xo;(function(e){function n(t,a=Wn.default.Writer.create()){switch(t.material?.$case){case"unlit":Ci.encode(t.material.unlit,a.uint32(10).fork()).ldelim();break;case"pbr":Bi.encode(t.material.pbr,a.uint32(18).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof Wn.default.Reader?t:Wn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Xd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.material={$case:"unlit",unlit:Ci.decode(r,r.uint32())};continue;case 2:if(i!==18)break;o.material={$case:"pbr",pbr:Bi.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Xo||(Xo={}));function Zd(){return{texture:void 0,alphaTest:void 0,castShadows:void 0,diffuseColor:void 0}}var Ci;(function(e){function n(t,a=Wn.default.Writer.create()){return t.texture!==void 0&&on.encode(t.texture,a.uint32(10).fork()).ldelim(),t.alphaTest!==void 0&&a.uint32(21).float(t.alphaTest),t.castShadows!==void 0&&a.uint32(24).bool(t.castShadows),t.diffuseColor!==void 0&&Ct.encode(t.diffuseColor,a.uint32(34).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Wn.default.Reader?t:Wn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Zd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.texture=on.decode(r,r.uint32());continue;case 2:if(i!==21)break;o.alphaTest=r.float();continue;case 3:if(i!==24)break;o.castShadows=r.bool();continue;case 4:if(i!==34)break;o.diffuseColor=Ct.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ci||(Ci={}));function Qd(){return{texture:void 0,alphaTest:void 0,castShadows:void 0,alphaTexture:void 0,emissiveTexture:void 0,bumpTexture:void 0,albedoColor:void 0,emissiveColor:void 0,reflectivityColor:void 0,transparencyMode:void 0,metallic:void 0,roughness:void 0,specularIntensity:void 0,emissiveIntensity:void 0,directIntensity:void 0}}var Bi;(function(e){function n(t,a=Wn.default.Writer.create()){return t.texture!==void 0&&on.encode(t.texture,a.uint32(10).fork()).ldelim(),t.alphaTest!==void 0&&a.uint32(21).float(t.alphaTest),t.castShadows!==void 0&&a.uint32(24).bool(t.castShadows),t.alphaTexture!==void 0&&on.encode(t.alphaTexture,a.uint32(34).fork()).ldelim(),t.emissiveTexture!==void 0&&on.encode(t.emissiveTexture,a.uint32(42).fork()).ldelim(),t.bumpTexture!==void 0&&on.encode(t.bumpTexture,a.uint32(50).fork()).ldelim(),t.albedoColor!==void 0&&Ct.encode(t.albedoColor,a.uint32(58).fork()).ldelim(),t.emissiveColor!==void 0&&Ot.encode(t.emissiveColor,a.uint32(66).fork()).ldelim(),t.reflectivityColor!==void 0&&Ot.encode(t.reflectivityColor,a.uint32(74).fork()).ldelim(),t.transparencyMode!==void 0&&a.uint32(80).int32(t.transparencyMode),t.metallic!==void 0&&a.uint32(93).float(t.metallic),t.roughness!==void 0&&a.uint32(101).float(t.roughness),t.specularIntensity!==void 0&&a.uint32(117).float(t.specularIntensity),t.emissiveIntensity!==void 0&&a.uint32(125).float(t.emissiveIntensity),t.directIntensity!==void 0&&a.uint32(133).float(t.directIntensity),a}e.encode=n;function s(t,a){let r=t instanceof Wn.default.Reader?t:Wn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Qd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.texture=on.decode(r,r.uint32());continue;case 2:if(i!==21)break;o.alphaTest=r.float();continue;case 3:if(i!==24)break;o.castShadows=r.bool();continue;case 4:if(i!==34)break;o.alphaTexture=on.decode(r,r.uint32());continue;case 5:if(i!==42)break;o.emissiveTexture=on.decode(r,r.uint32());continue;case 6:if(i!==50)break;o.bumpTexture=on.decode(r,r.uint32());continue;case 7:if(i!==58)break;o.albedoColor=Ct.decode(r,r.uint32());continue;case 8:if(i!==66)break;o.emissiveColor=Ot.decode(r,r.uint32());continue;case 9:if(i!==74)break;o.reflectivityColor=Ot.decode(r,r.uint32());continue;case 10:if(i!==80)break;o.transparencyMode=r.int32();continue;case 11:if(i!==93)break;o.metallic=r.float();continue;case 12:if(i!==101)break;o.roughness=r.float();continue;case 14:if(i!==117)break;o.specularIntensity=r.float();continue;case 15:if(i!==125)break;o.emissiveIntensity=r.float();continue;case 16:if(i!==133)break;o.directIntensity=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Bi||(Bi={}));var Su={COMPONENT_ID:1017,serialize(e,n){let s=Xo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Xo.decode(e.buffer(),e.remainingBytes())},create(){return Xo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMaterial"}};var rn=$e(Qe());var Tu;(function(e){e[e.CL_NONE=0]="CL_NONE",e[e.CL_POINTER=1]="CL_POINTER",e[e.CL_PHYSICS=2]="CL_PHYSICS",e[e.CL_RESERVED1=4]="CL_RESERVED1",e[e.CL_RESERVED2=8]="CL_RESERVED2",e[e.CL_RESERVED3=16]="CL_RESERVED3",e[e.CL_RESERVED4=32]="CL_RESERVED4",e[e.CL_RESERVED5=64]="CL_RESERVED5",e[e.CL_RESERVED6=128]="CL_RESERVED6",e[e.CL_CUSTOM1=256]="CL_CUSTOM1",e[e.CL_CUSTOM2=512]="CL_CUSTOM2",e[e.CL_CUSTOM3=1024]="CL_CUSTOM3",e[e.CL_CUSTOM4=2048]="CL_CUSTOM4",e[e.CL_CUSTOM5=4096]="CL_CUSTOM5",e[e.CL_CUSTOM6=8192]="CL_CUSTOM6",e[e.CL_CUSTOM7=16384]="CL_CUSTOM7",e[e.CL_CUSTOM8=32768]="CL_CUSTOM8"})(Tu||(Tu={}));function Jd(){return{collisionMask:void 0,mesh:void 0}}var Zo;(function(e){function n(t,a=rn.default.Writer.create()){switch(t.collisionMask!==void 0&&a.uint32(8).uint32(t.collisionMask),t.mesh?.$case){case"box":Ii.encode(t.mesh.box,a.uint32(18).fork()).ldelim();break;case"sphere":Mi.encode(t.mesh.sphere,a.uint32(26).fork()).ldelim();break;case"cylinder":ki.encode(t.mesh.cylinder,a.uint32(34).fork()).ldelim();break;case"plane":Oi.encode(t.mesh.plane,a.uint32(42).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof rn.default.Reader?t:rn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Jd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.collisionMask=r.uint32();continue;case 2:if(i!==18)break;o.mesh={$case:"box",box:Ii.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.mesh={$case:"sphere",sphere:Mi.decode(r,r.uint32())};continue;case 4:if(i!==34)break;o.mesh={$case:"cylinder",cylinder:ki.decode(r,r.uint32())};continue;case 5:if(i!==42)break;o.mesh={$case:"plane",plane:Oi.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Zo||(Zo={}));function Kd(){return{}}var Ii;(function(e){function n(t,a=rn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof rn.default.Reader?t:rn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Kd();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ii||(Ii={}));function ep(){return{radiusTop:void 0,radiusBottom:void 0}}var ki;(function(e){function n(t,a=rn.default.Writer.create()){return t.radiusTop!==void 0&&a.uint32(13).float(t.radiusTop),t.radiusBottom!==void 0&&a.uint32(21).float(t.radiusBottom),a}e.encode=n;function s(t,a){let r=t instanceof rn.default.Reader?t:rn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ep();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.radiusTop=r.float();continue;case 2:if(i!==21)break;o.radiusBottom=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ki||(ki={}));function tp(){return{}}var Oi;(function(e){function n(t,a=rn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof rn.default.Reader?t:rn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=tp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Oi||(Oi={}));function np(){return{}}var Mi;(function(e){function n(t,a=rn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof rn.default.Reader?t:rn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=np();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Mi||(Mi={}));var Au={COMPONENT_ID:1019,serialize(e,n){let s=Zo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Zo.decode(e.buffer(),e.remainingBytes())},create(){return Zo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMeshCollider"}};var an=$e(Qe());function op(){return{mesh:void 0}}var Qo;(function(e){function n(t,a=an.default.Writer.create()){switch(t.mesh?.$case){case"box":Pi.encode(t.mesh.box,a.uint32(10).fork()).ldelim();break;case"sphere":Ui.encode(t.mesh.sphere,a.uint32(18).fork()).ldelim();break;case"cylinder":zi.encode(t.mesh.cylinder,a.uint32(26).fork()).ldelim();break;case"plane":Fi.encode(t.mesh.plane,a.uint32(34).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof an.default.Reader?t:an.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=op();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.mesh={$case:"box",box:Pi.decode(r,r.uint32())};continue;case 2:if(i!==18)break;o.mesh={$case:"sphere",sphere:Ui.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.mesh={$case:"cylinder",cylinder:zi.decode(r,r.uint32())};continue;case 4:if(i!==34)break;o.mesh={$case:"plane",plane:Fi.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Qo||(Qo={}));function rp(){return{uvs:[]}}var Pi;(function(e){function n(t,a=an.default.Writer.create()){a.uint32(10).fork();for(let r of t.uvs)a.float(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof an.default.Reader?t:an.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=rp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i===13){o.uvs.push(r.float());continue}if(i===10){let u=r.uint32()+r.pos;for(;r.pos<u;)o.uvs.push(r.float());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Pi||(Pi={}));function ip(){return{radiusTop:void 0,radiusBottom:void 0}}var zi;(function(e){function n(t,a=an.default.Writer.create()){return t.radiusTop!==void 0&&a.uint32(13).float(t.radiusTop),t.radiusBottom!==void 0&&a.uint32(21).float(t.radiusBottom),a}e.encode=n;function s(t,a){let r=t instanceof an.default.Reader?t:an.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ip();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.radiusTop=r.float();continue;case 2:if(i!==21)break;o.radiusBottom=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(zi||(zi={}));function ap(){return{uvs:[]}}var Fi;(function(e){function n(t,a=an.default.Writer.create()){a.uint32(10).fork();for(let r of t.uvs)a.float(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof an.default.Reader?t:an.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ap();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i===13){o.uvs.push(r.float());continue}if(i===10){let u=r.uint32()+r.pos;for(;r.pos<u;)o.uvs.push(r.float());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Fi||(Fi={}));function sp(){return{}}var Ui;(function(e){function n(t,a=an.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof an.default.Reader?t:an.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=sp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ui||(Ui={}));var _u={COMPONENT_ID:1018,serialize(e,n){let s=Qo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Qo.decode(e.buffer(),e.remainingBytes())},create(){return Qo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMeshRenderer"}};var Li=$e(Qe());var Ru;(function(e){e[e.NFT_CLASSIC=0]="NFT_CLASSIC",e[e.NFT_BAROQUE_ORNAMENT=1]="NFT_BAROQUE_ORNAMENT",e[e.NFT_DIAMOND_ORNAMENT=2]="NFT_DIAMOND_ORNAMENT",e[e.NFT_MINIMAL_WIDE=3]="NFT_MINIMAL_WIDE",e[e.NFT_MINIMAL_GREY=4]="NFT_MINIMAL_GREY",e[e.NFT_BLOCKY=5]="NFT_BLOCKY",e[e.NFT_GOLD_EDGES=6]="NFT_GOLD_EDGES",e[e.NFT_GOLD_CARVED=7]="NFT_GOLD_CARVED",e[e.NFT_GOLD_WIDE=8]="NFT_GOLD_WIDE",e[e.NFT_GOLD_ROUNDED=9]="NFT_GOLD_ROUNDED",e[e.NFT_METAL_MEDIUM=10]="NFT_METAL_MEDIUM",e[e.NFT_METAL_WIDE=11]="NFT_METAL_WIDE",e[e.NFT_METAL_SLIM=12]="NFT_METAL_SLIM",e[e.NFT_METAL_ROUNDED=13]="NFT_METAL_ROUNDED",e[e.NFT_PINS=14]="NFT_PINS",e[e.NFT_MINIMAL_BLACK=15]="NFT_MINIMAL_BLACK",e[e.NFT_MINIMAL_WHITE=16]="NFT_MINIMAL_WHITE",e[e.NFT_TAPE=17]="NFT_TAPE",e[e.NFT_WOOD_SLIM=18]="NFT_WOOD_SLIM",e[e.NFT_WOOD_WIDE=19]="NFT_WOOD_WIDE",e[e.NFT_WOOD_TWIGS=20]="NFT_WOOD_TWIGS",e[e.NFT_CANVAS=21]="NFT_CANVAS",e[e.NFT_NONE=22]="NFT_NONE"})(Ru||(Ru={}));function cp(){return{urn:"",style:void 0,color:void 0}}var Jo;(function(e){function n(t,a=Li.default.Writer.create()){return t.urn!==""&&a.uint32(10).string(t.urn),t.style!==void 0&&a.uint32(16).int32(t.style),t.color!==void 0&&Ot.encode(t.color,a.uint32(26).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Li.default.Reader?t:Li.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=cp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.urn=r.string();continue;case 2:if(i!==16)break;o.style=r.int32();continue;case 3:if(i!==26)break;o.color=Ot.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Jo||(Jo={}));var Nu={COMPONENT_ID:1040,serialize(e,n){let s=Jo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Jo.decode(e.buffer(),e.remainingBytes())},create(){return Jo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBNftShape"}};var qn=$e(Qe());function up(){return{pointerEvents:[]}}var Ko;(function(e){function n(t,a=qn.default.Writer.create()){for(let r of t.pointerEvents)Di.encode(r,a.uint32(10).fork()).ldelim();return a}e.encode=n;function s(t,a){let r=t instanceof qn.default.Reader?t:qn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=up();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.pointerEvents.push(Di.decode(r,r.uint32()));continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ko||(Ko={}));function fp(){return{button:void 0,hoverText:void 0,maxDistance:void 0,showFeedback:void 0}}var Vi;(function(e){function n(t,a=qn.default.Writer.create()){return t.button!==void 0&&a.uint32(8).int32(t.button),t.hoverText!==void 0&&a.uint32(18).string(t.hoverText),t.maxDistance!==void 0&&a.uint32(29).float(t.maxDistance),t.showFeedback!==void 0&&a.uint32(32).bool(t.showFeedback),a}e.encode=n;function s(t,a){let r=t instanceof qn.default.Reader?t:qn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=fp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.button=r.int32();continue;case 2:if(i!==18)break;o.hoverText=r.string();continue;case 3:if(i!==29)break;o.maxDistance=r.float();continue;case 4:if(i!==32)break;o.showFeedback=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Vi||(Vi={}));function lp(){return{eventType:0,eventInfo:void 0}}var Di;(function(e){function n(t,a=qn.default.Writer.create()){return t.eventType!==0&&a.uint32(8).int32(t.eventType),t.eventInfo!==void 0&&Vi.encode(t.eventInfo,a.uint32(18).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof qn.default.Reader?t:qn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=lp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.eventType=r.int32();continue;case 2:if(i!==18)break;o.eventInfo=Vi.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Di||(Di={}));var Cu={COMPONENT_ID:1062,serialize(e,n){let s=Ko.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Ko.decode(e.buffer(),e.remainingBytes())},create(){return Ko.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBPointerEvents"}};var qi=$e(Qe());var Wi=$e(Qe());function dp(){return{position:void 0,globalOrigin:void 0,direction:void 0,normalHit:void 0,length:0,meshName:void 0,entityId:void 0}}var io;(function(e){function n(t,a=Wi.default.Writer.create()){return t.position!==void 0&&tt.encode(t.position,a.uint32(10).fork()).ldelim(),t.globalOrigin!==void 0&&tt.encode(t.globalOrigin,a.uint32(18).fork()).ldelim(),t.direction!==void 0&&tt.encode(t.direction,a.uint32(26).fork()).ldelim(),t.normalHit!==void 0&&tt.encode(t.normalHit,a.uint32(34).fork()).ldelim(),t.length!==0&&a.uint32(45).float(t.length),t.meshName!==void 0&&a.uint32(50).string(t.meshName),t.entityId!==void 0&&a.uint32(56).uint32(t.entityId),a}e.encode=n;function s(t,a){let r=t instanceof Wi.default.Reader?t:Wi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=dp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.position=tt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.globalOrigin=tt.decode(r,r.uint32());continue;case 3:if(i!==26)break;o.direction=tt.decode(r,r.uint32());continue;case 4:if(i!==34)break;o.normalHit=tt.decode(r,r.uint32());continue;case 5:if(i!==45)break;o.length=r.float();continue;case 6:if(i!==50)break;o.meshName=r.string();continue;case 7:if(i!==56)break;o.entityId=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(io||(io={}));function pp(){return{button:0,hit:void 0,state:0,timestamp:0,analog:void 0,tickNumber:0}}var er;(function(e){function n(t,a=qi.default.Writer.create()){return t.button!==0&&a.uint32(8).int32(t.button),t.hit!==void 0&&io.encode(t.hit,a.uint32(18).fork()).ldelim(),t.state!==0&&a.uint32(32).int32(t.state),t.timestamp!==0&&a.uint32(40).uint32(t.timestamp),t.analog!==void 0&&a.uint32(53).float(t.analog),t.tickNumber!==0&&a.uint32(56).uint32(t.tickNumber),a}e.encode=n;function s(t,a){let r=t instanceof qi.default.Reader?t:qi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=pp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.button=r.int32();continue;case 2:if(i!==18)break;o.hit=io.decode(r,r.uint32());continue;case 4:if(i!==32)break;o.state=r.int32();continue;case 5:if(i!==40)break;o.timestamp=r.uint32();continue;case 6:if(i!==53)break;o.analog=r.float();continue;case 7:if(i!==56)break;o.tickNumber=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(er||(er={}));var Bu={COMPONENT_ID:1063,serialize(e,n){let s=er.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return er.decode(e.buffer(),e.remainingBytes())},create(){return er.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBPointerEventsResult"}};var Hi=$e(Qe());function hp(){return{isPointerLocked:!1}}var tr;(function(e){function n(t,a=Hi.default.Writer.create()){return t.isPointerLocked===!0&&a.uint32(8).bool(t.isPointerLocked),a}e.encode=n;function s(t,a){let r=t instanceof Hi.default.Reader?t:Hi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=hp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.isPointerLocked=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(tr||(tr={}));var Iu={COMPONENT_ID:1074,serialize(e,n){let s=tr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return tr.decode(e.buffer(),e.remainingBytes())},create(){return tr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBPointerLock"}};var Gi=$e(Qe());var ku;(function(e){e[e.RQT_HIT_FIRST=0]="RQT_HIT_FIRST",e[e.RQT_QUERY_ALL=1]="RQT_QUERY_ALL",e[e.RQT_NONE=2]="RQT_NONE"})(ku||(ku={}));function mp(){return{timestamp:void 0,originOffset:void 0,direction:void 0,maxDistance:0,queryType:0,continuous:void 0,collisionMask:void 0}}var nr;(function(e){function n(t,a=Gi.default.Writer.create()){switch(t.timestamp!==void 0&&a.uint32(8).uint32(t.timestamp),t.originOffset!==void 0&&tt.encode(t.originOffset,a.uint32(18).fork()).ldelim(),t.direction?.$case){case"localDirection":tt.encode(t.direction.localDirection,a.uint32(50).fork()).ldelim();break;case"globalDirection":tt.encode(t.direction.globalDirection,a.uint32(26).fork()).ldelim();break;case"globalTarget":tt.encode(t.direction.globalTarget,a.uint32(58).fork()).ldelim();break;case"targetEntity":a.uint32(80).uint32(t.direction.targetEntity);break}return t.maxDistance!==0&&a.uint32(37).float(t.maxDistance),t.queryType!==0&&a.uint32(40).int32(t.queryType),t.continuous!==void 0&&a.uint32(64).bool(t.continuous),t.collisionMask!==void 0&&a.uint32(72).uint32(t.collisionMask),a}e.encode=n;function s(t,a){let r=t instanceof Gi.default.Reader?t:Gi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=mp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.timestamp=r.uint32();continue;case 2:if(i!==18)break;o.originOffset=tt.decode(r,r.uint32());continue;case 6:if(i!==50)break;o.direction={$case:"localDirection",localDirection:tt.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.direction={$case:"globalDirection",globalDirection:tt.decode(r,r.uint32())};continue;case 7:if(i!==58)break;o.direction={$case:"globalTarget",globalTarget:tt.decode(r,r.uint32())};continue;case 10:if(i!==80)break;o.direction={$case:"targetEntity",targetEntity:r.uint32()};continue;case 4:if(i!==37)break;o.maxDistance=r.float();continue;case 5:if(i!==40)break;o.queryType=r.int32();continue;case 8:if(i!==64)break;o.continuous=r.bool();continue;case 9:if(i!==72)break;o.collisionMask=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(nr||(nr={}));var Ou={COMPONENT_ID:1067,serialize(e,n){let s=nr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return nr.decode(e.buffer(),e.remainingBytes())},create(){return nr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBRaycast"}};var ji=$e(Qe());function yp(){return{timestamp:void 0,globalOrigin:void 0,direction:void 0,hits:[],tickNumber:0}}var or;(function(e){function n(t,a=ji.default.Writer.create()){t.timestamp!==void 0&&a.uint32(8).uint32(t.timestamp),t.globalOrigin!==void 0&&tt.encode(t.globalOrigin,a.uint32(18).fork()).ldelim(),t.direction!==void 0&&tt.encode(t.direction,a.uint32(26).fork()).ldelim();for(let r of t.hits)io.encode(r,a.uint32(34).fork()).ldelim();return t.tickNumber!==0&&a.uint32(40).uint32(t.tickNumber),a}e.encode=n;function s(t,a){let r=t instanceof ji.default.Reader?t:ji.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=yp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.timestamp=r.uint32();continue;case 2:if(i!==18)break;o.globalOrigin=tt.decode(r,r.uint32());continue;case 3:if(i!==26)break;o.direction=tt.decode(r,r.uint32());continue;case 4:if(i!==34)break;o.hits.push(io.decode(r,r.uint32()));continue;case 5:if(i!==40)break;o.tickNumber=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(or||(or={}));var Mu={COMPONENT_ID:1068,serialize(e,n){let s=or.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return or.decode(e.buffer(),e.remainingBytes())},create(){return or.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBRaycastResult"}};var Yi=$e(Qe());function vp(){return{text:"",font:void 0,fontSize:void 0,fontAutoSize:void 0,textAlign:void 0,width:void 0,height:void 0,paddingTop:void 0,paddingRight:void 0,paddingBottom:void 0,paddingLeft:void 0,lineSpacing:void 0,lineCount:void 0,textWrapping:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,outlineWidth:void 0,shadowColor:void 0,outlineColor:void 0,textColor:void 0}}var rr;(function(e){function n(t,a=Yi.default.Writer.create()){return t.text!==""&&a.uint32(10).string(t.text),t.font!==void 0&&a.uint32(16).int32(t.font),t.fontSize!==void 0&&a.uint32(29).float(t.fontSize),t.fontAutoSize!==void 0&&a.uint32(32).bool(t.fontAutoSize),t.textAlign!==void 0&&a.uint32(40).int32(t.textAlign),t.width!==void 0&&a.uint32(53).float(t.width),t.height!==void 0&&a.uint32(61).float(t.height),t.paddingTop!==void 0&&a.uint32(69).float(t.paddingTop),t.paddingRight!==void 0&&a.uint32(77).float(t.paddingRight),t.paddingBottom!==void 0&&a.uint32(85).float(t.paddingBottom),t.paddingLeft!==void 0&&a.uint32(93).float(t.paddingLeft),t.lineSpacing!==void 0&&a.uint32(101).float(t.lineSpacing),t.lineCount!==void 0&&a.uint32(104).int32(t.lineCount),t.textWrapping!==void 0&&a.uint32(112).bool(t.textWrapping),t.shadowBlur!==void 0&&a.uint32(125).float(t.shadowBlur),t.shadowOffsetX!==void 0&&a.uint32(133).float(t.shadowOffsetX),t.shadowOffsetY!==void 0&&a.uint32(141).float(t.shadowOffsetY),t.outlineWidth!==void 0&&a.uint32(149).float(t.outlineWidth),t.shadowColor!==void 0&&Ot.encode(t.shadowColor,a.uint32(154).fork()).ldelim(),t.outlineColor!==void 0&&Ot.encode(t.outlineColor,a.uint32(162).fork()).ldelim(),t.textColor!==void 0&&Ct.encode(t.textColor,a.uint32(170).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Yi.default.Reader?t:Yi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=vp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.text=r.string();continue;case 2:if(i!==16)break;o.font=r.int32();continue;case 3:if(i!==29)break;o.fontSize=r.float();continue;case 4:if(i!==32)break;o.fontAutoSize=r.bool();continue;case 5:if(i!==40)break;o.textAlign=r.int32();continue;case 6:if(i!==53)break;o.width=r.float();continue;case 7:if(i!==61)break;o.height=r.float();continue;case 8:if(i!==69)break;o.paddingTop=r.float();continue;case 9:if(i!==77)break;o.paddingRight=r.float();continue;case 10:if(i!==85)break;o.paddingBottom=r.float();continue;case 11:if(i!==93)break;o.paddingLeft=r.float();continue;case 12:if(i!==101)break;o.lineSpacing=r.float();continue;case 13:if(i!==104)break;o.lineCount=r.int32();continue;case 14:if(i!==112)break;o.textWrapping=r.bool();continue;case 15:if(i!==125)break;o.shadowBlur=r.float();continue;case 16:if(i!==133)break;o.shadowOffsetX=r.float();continue;case 17:if(i!==141)break;o.shadowOffsetY=r.float();continue;case 18:if(i!==149)break;o.outlineWidth=r.float();continue;case 19:if(i!==154)break;o.shadowColor=Ot.decode(r,r.uint32());continue;case 20:if(i!==162)break;o.outlineColor=Ot.decode(r,r.uint32());continue;case 21:if(i!==170)break;o.textColor=Ct.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(rr||(rr={}));var Pu={COMPONENT_ID:1030,serialize(e,n){let s=rr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return rr.decode(e.buffer(),e.remainingBytes())},create(){return rr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTextShape"}};var xn=$e(Qe());var zu;(function(e){e[e.EF_LINEAR=0]="EF_LINEAR",e[e.EF_EASEINQUAD=1]="EF_EASEINQUAD",e[e.EF_EASEOUTQUAD=2]="EF_EASEOUTQUAD",e[e.EF_EASEQUAD=3]="EF_EASEQUAD",e[e.EF_EASEINSINE=4]="EF_EASEINSINE",e[e.EF_EASEOUTSINE=5]="EF_EASEOUTSINE",e[e.EF_EASESINE=6]="EF_EASESINE",e[e.EF_EASEINEXPO=7]="EF_EASEINEXPO",e[e.EF_EASEOUTEXPO=8]="EF_EASEOUTEXPO",e[e.EF_EASEEXPO=9]="EF_EASEEXPO",e[e.EF_EASEINELASTIC=10]="EF_EASEINELASTIC",e[e.EF_EASEOUTELASTIC=11]="EF_EASEOUTELASTIC",e[e.EF_EASEELASTIC=12]="EF_EASEELASTIC",e[e.EF_EASEINBOUNCE=13]="EF_EASEINBOUNCE",e[e.EF_EASEOUTBOUNCE=14]="EF_EASEOUTBOUNCE",e[e.EF_EASEBOUNCE=15]="EF_EASEBOUNCE",e[e.EF_EASEINCUBIC=16]="EF_EASEINCUBIC",e[e.EF_EASEOUTCUBIC=17]="EF_EASEOUTCUBIC",e[e.EF_EASECUBIC=18]="EF_EASECUBIC",e[e.EF_EASEINQUART=19]="EF_EASEINQUART",e[e.EF_EASEOUTQUART=20]="EF_EASEOUTQUART",e[e.EF_EASEQUART=21]="EF_EASEQUART",e[e.EF_EASEINQUINT=22]="EF_EASEINQUINT",e[e.EF_EASEOUTQUINT=23]="EF_EASEOUTQUINT",e[e.EF_EASEQUINT=24]="EF_EASEQUINT",e[e.EF_EASEINCIRC=25]="EF_EASEINCIRC",e[e.EF_EASEOUTCIRC=26]="EF_EASEOUTCIRC",e[e.EF_EASECIRC=27]="EF_EASECIRC",e[e.EF_EASEINBACK=28]="EF_EASEINBACK",e[e.EF_EASEOUTBACK=29]="EF_EASEOUTBACK",e[e.EF_EASEBACK=30]="EF_EASEBACK"})(zu||(zu={}));function xp(){return{duration:0,easingFunction:0,mode:void 0,playing:void 0,currentTime:void 0}}var Yn;(function(e){function n(t,a=xn.default.Writer.create()){switch(t.duration!==0&&a.uint32(13).float(t.duration),t.easingFunction!==0&&a.uint32(16).int32(t.easingFunction),t.mode?.$case){case"move":$i.encode(t.mode.move,a.uint32(26).fork()).ldelim();break;case"rotate":Xi.encode(t.mode.rotate,a.uint32(34).fork()).ldelim();break;case"scale":Zi.encode(t.mode.scale,a.uint32(42).fork()).ldelim();break}return t.playing!==void 0&&a.uint32(48).bool(t.playing),t.currentTime!==void 0&&a.uint32(61).float(t.currentTime),a}e.encode=n;function s(t,a){let r=t instanceof xn.default.Reader?t:xn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=xp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.duration=r.float();continue;case 2:if(i!==16)break;o.easingFunction=r.int32();continue;case 3:if(i!==26)break;o.mode={$case:"move",move:$i.decode(r,r.uint32())};continue;case 4:if(i!==34)break;o.mode={$case:"rotate",rotate:Xi.decode(r,r.uint32())};continue;case 5:if(i!==42)break;o.mode={$case:"scale",scale:Zi.decode(r,r.uint32())};continue;case 6:if(i!==48)break;o.playing=r.bool();continue;case 7:if(i!==61)break;o.currentTime=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Yn||(Yn={}));function bp(){return{start:void 0,end:void 0,faceDirection:void 0}}var $i;(function(e){function n(t,a=xn.default.Writer.create()){return t.start!==void 0&&tt.encode(t.start,a.uint32(10).fork()).ldelim(),t.end!==void 0&&tt.encode(t.end,a.uint32(18).fork()).ldelim(),t.faceDirection!==void 0&&a.uint32(24).bool(t.faceDirection),a}e.encode=n;function s(t,a){let r=t instanceof xn.default.Reader?t:xn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=bp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.start=tt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.end=tt.decode(r,r.uint32());continue;case 3:if(i!==24)break;o.faceDirection=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})($i||($i={}));function Ep(){return{start:void 0,end:void 0}}var Xi;(function(e){function n(t,a=xn.default.Writer.create()){return t.start!==void 0&&go.encode(t.start,a.uint32(10).fork()).ldelim(),t.end!==void 0&&go.encode(t.end,a.uint32(18).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof xn.default.Reader?t:xn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ep();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.start=go.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.end=go.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Xi||(Xi={}));function gp(){return{start:void 0,end:void 0}}var Zi;(function(e){function n(t,a=xn.default.Writer.create()){return t.start!==void 0&&tt.encode(t.start,a.uint32(10).fork()).ldelim(),t.end!==void 0&&tt.encode(t.end,a.uint32(18).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof xn.default.Reader?t:xn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=gp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.start=tt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.end=tt.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Zi||(Zi={}));var Fu={COMPONENT_ID:1102,serialize(e,n){let s=Yn.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Yn.decode(e.buffer(),e.remainingBytes())},create(){return Yn.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTween"}};var Qi=$e(Qe());var Uu;(function(e){e[e.TL_RESTART=0]="TL_RESTART",e[e.TL_YOYO=1]="TL_YOYO"})(Uu||(Uu={}));function wp(){return{sequence:[],loop:void 0}}var ir;(function(e){function n(t,a=Qi.default.Writer.create()){for(let r of t.sequence)Yn.encode(r,a.uint32(10).fork()).ldelim();return t.loop!==void 0&&a.uint32(16).int32(t.loop),a}e.encode=n;function s(t,a){let r=t instanceof Qi.default.Reader?t:Qi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=wp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.sequence.push(Yn.decode(r,r.uint32()));continue;case 2:if(i!==16)break;o.loop=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ir||(ir={}));var Lu={COMPONENT_ID:1104,serialize(e,n){let s=ir.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return ir.decode(e.buffer(),e.remainingBytes())},create(){return ir.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTweenSequence"}};var Ji=$e(Qe());var Vu;(function(e){e[e.TS_ACTIVE=0]="TS_ACTIVE",e[e.TS_COMPLETED=1]="TS_COMPLETED",e[e.TS_PAUSED=2]="TS_PAUSED"})(Vu||(Vu={}));function Sp(){return{state:0,currentTime:0}}var ar;(function(e){function n(t,a=Ji.default.Writer.create()){return t.state!==0&&a.uint32(8).int32(t.state),t.currentTime!==0&&a.uint32(21).float(t.currentTime),a}e.encode=n;function s(t,a){let r=t instanceof Ji.default.Reader?t:Ji.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Sp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.state=r.int32();continue;case 2:if(i!==21)break;o.currentTime=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ar||(ar={}));var Du={COMPONENT_ID:1103,serialize(e,n){let s=ar.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return ar.decode(e.buffer(),e.remainingBytes())},create(){return ar.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTweenState"}};var Ki=$e(Qe());var Ao=$e(Qe());function Tp(){return{top:0,left:0,right:0,bottom:0}}var ao;(function(e){function n(t,a=Ao.default.Writer.create()){return t.top!==0&&a.uint32(13).float(t.top),t.left!==0&&a.uint32(21).float(t.left),t.right!==0&&a.uint32(29).float(t.right),t.bottom!==0&&a.uint32(37).float(t.bottom),a}e.encode=n;function s(t,a){let r=t instanceof Ao.default.Reader?t:Ao.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Tp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.top=r.float();continue;case 2:if(i!==21)break;o.left=r.float();continue;case 3:if(i!==29)break;o.right=r.float();continue;case 4:if(i!==37)break;o.bottom=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ao||(ao={}));function Ap(){return{x:0,y:0,width:0,height:0}}var Wu;(function(e){function n(t,a=Ao.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.width!==0&&a.uint32(29).float(t.width),t.height!==0&&a.uint32(37).float(t.height),a}e.encode=n;function s(t,a){let r=t instanceof Ao.default.Reader?t:Ao.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ap();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.width=r.float();continue;case 4:if(i!==37)break;o.height=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Wu||(Wu={}));var qu;(function(e){e[e.NINE_SLICES=0]="NINE_SLICES",e[e.CENTER=1]="CENTER",e[e.STRETCH=2]="STRETCH"})(qu||(qu={}));function _p(){return{color:void 0,texture:void 0,textureMode:0,textureSlices:void 0,uvs:[]}}var sr;(function(e){function n(t,a=Ki.default.Writer.create()){t.color!==void 0&&Ct.encode(t.color,a.uint32(10).fork()).ldelim(),t.texture!==void 0&&on.encode(t.texture,a.uint32(18).fork()).ldelim(),t.textureMode!==0&&a.uint32(24).int32(t.textureMode),t.textureSlices!==void 0&&ao.encode(t.textureSlices,a.uint32(34).fork()).ldelim(),a.uint32(42).fork();for(let r of t.uvs)a.float(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Ki.default.Reader?t:Ki.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=_p();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.color=Ct.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.texture=on.decode(r,r.uint32());continue;case 3:if(i!==24)break;o.textureMode=r.int32();continue;case 4:if(i!==34)break;o.textureSlices=ao.decode(r,r.uint32());continue;case 5:if(i===45){o.uvs.push(r.float());continue}if(i===42){let u=r.uint32()+r.pos;for(;r.pos<u;)o.uvs.push(r.float());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(sr||(sr={}));var Hu={COMPONENT_ID:1053,serialize(e,n){let s=sr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return sr.decode(e.buffer(),e.remainingBytes())},create(){return sr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiBackground"}};var ea=$e(Qe());function Rp(){return{devicePixelRatio:0,width:0,height:0,interactableArea:void 0}}var cr;(function(e){function n(t,a=ea.default.Writer.create()){return t.devicePixelRatio!==0&&a.uint32(13).float(t.devicePixelRatio),t.width!==0&&a.uint32(16).int32(t.width),t.height!==0&&a.uint32(24).int32(t.height),t.interactableArea!==void 0&&ao.encode(t.interactableArea,a.uint32(34).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof ea.default.Reader?t:ea.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Rp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.devicePixelRatio=r.float();continue;case 2:if(i!==16)break;o.width=r.int32();continue;case 3:if(i!==24)break;o.height=r.int32();continue;case 4:if(i!==34)break;o.interactableArea=ao.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(cr||(cr={}));var Gu={COMPONENT_ID:1054,serialize(e,n){let s=cr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return cr.decode(e.buffer(),e.remainingBytes())},create(){return cr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiCanvasInformation"}};var ta=$e(Qe());function Np(){return{acceptEmpty:!1,emptyLabel:void 0,options:[],selectedIndex:void 0,disabled:!1,color:void 0,textAlign:void 0,font:void 0,fontSize:void 0}}var ur;(function(e){function n(t,a=ta.default.Writer.create()){t.acceptEmpty===!0&&a.uint32(8).bool(t.acceptEmpty),t.emptyLabel!==void 0&&a.uint32(18).string(t.emptyLabel);for(let r of t.options)a.uint32(26).string(r);return t.selectedIndex!==void 0&&a.uint32(32).int32(t.selectedIndex),t.disabled===!0&&a.uint32(40).bool(t.disabled),t.color!==void 0&&Ct.encode(t.color,a.uint32(50).fork()).ldelim(),t.textAlign!==void 0&&a.uint32(80).int32(t.textAlign),t.font!==void 0&&a.uint32(88).int32(t.font),t.fontSize!==void 0&&a.uint32(96).int32(t.fontSize),a}e.encode=n;function s(t,a){let r=t instanceof ta.default.Reader?t:ta.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Np();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.acceptEmpty=r.bool();continue;case 2:if(i!==18)break;o.emptyLabel=r.string();continue;case 3:if(i!==26)break;o.options.push(r.string());continue;case 4:if(i!==32)break;o.selectedIndex=r.int32();continue;case 5:if(i!==40)break;o.disabled=r.bool();continue;case 6:if(i!==50)break;o.color=Ct.decode(r,r.uint32());continue;case 10:if(i!==80)break;o.textAlign=r.int32();continue;case 11:if(i!==88)break;o.font=r.int32();continue;case 12:if(i!==96)break;o.fontSize=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ur||(ur={}));var ju={COMPONENT_ID:1094,serialize(e,n){let s=ur.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return ur.decode(e.buffer(),e.remainingBytes())},create(){return ur.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiDropdown"}};var na=$e(Qe());function Cp(){return{value:0}}var fr;(function(e){function n(t,a=na.default.Writer.create()){return t.value!==0&&a.uint32(8).int32(t.value),a}e.encode=n;function s(t,a){let r=t instanceof na.default.Reader?t:na.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Cp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.value=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(fr||(fr={}));var Yu={COMPONENT_ID:1096,serialize(e,n){let s=fr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return fr.decode(e.buffer(),e.remainingBytes())},create(){return fr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiDropdownResult"}};var oa=$e(Qe());function Bp(){return{placeholder:"",color:void 0,placeholderColor:void 0,disabled:!1,textAlign:void 0,font:void 0,fontSize:void 0,value:void 0}}var lr;(function(e){function n(t,a=oa.default.Writer.create()){return t.placeholder!==""&&a.uint32(10).string(t.placeholder),t.color!==void 0&&Ct.encode(t.color,a.uint32(18).fork()).ldelim(),t.placeholderColor!==void 0&&Ct.encode(t.placeholderColor,a.uint32(26).fork()).ldelim(),t.disabled===!0&&a.uint32(32).bool(t.disabled),t.textAlign!==void 0&&a.uint32(80).int32(t.textAlign),t.font!==void 0&&a.uint32(88).int32(t.font),t.fontSize!==void 0&&a.uint32(96).int32(t.fontSize),t.value!==void 0&&a.uint32(106).string(t.value),a}e.encode=n;function s(t,a){let r=t instanceof oa.default.Reader?t:oa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Bp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.placeholder=r.string();continue;case 2:if(i!==18)break;o.color=Ct.decode(r,r.uint32());continue;case 3:if(i!==26)break;o.placeholderColor=Ct.decode(r,r.uint32());continue;case 4:if(i!==32)break;o.disabled=r.bool();continue;case 10:if(i!==80)break;o.textAlign=r.int32();continue;case 11:if(i!==88)break;o.font=r.int32();continue;case 12:if(i!==96)break;o.fontSize=r.int32();continue;case 13:if(i!==106)break;o.value=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(lr||(lr={}));var $u={COMPONENT_ID:1093,serialize(e,n){let s=lr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return lr.decode(e.buffer(),e.remainingBytes())},create(){return lr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiInput"}};var ra=$e(Qe());function Ip(){return{value:"",isSubmit:void 0}}var dr;(function(e){function n(t,a=ra.default.Writer.create()){return t.value!==""&&a.uint32(10).string(t.value),t.isSubmit!==void 0&&a.uint32(16).bool(t.isSubmit),a}e.encode=n;function s(t,a){let r=t instanceof ra.default.Reader?t:ra.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ip();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.value=r.string();continue;case 2:if(i!==16)break;o.isSubmit=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(dr||(dr={}));var Xu={COMPONENT_ID:1095,serialize(e,n){let s=dr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return dr.decode(e.buffer(),e.remainingBytes())},create(){return dr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiInputResult"}};var ia=$e(Qe());function kp(){return{value:"",color:void 0,textAlign:void 0,font:void 0,fontSize:void 0}}var pr;(function(e){function n(t,a=ia.default.Writer.create()){return t.value!==""&&a.uint32(10).string(t.value),t.color!==void 0&&Ct.encode(t.color,a.uint32(18).fork()).ldelim(),t.textAlign!==void 0&&a.uint32(24).int32(t.textAlign),t.font!==void 0&&a.uint32(32).int32(t.font),t.fontSize!==void 0&&a.uint32(40).int32(t.fontSize),a}e.encode=n;function s(t,a){let r=t instanceof ia.default.Reader?t:ia.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=kp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.value=r.string();continue;case 2:if(i!==18)break;o.color=Ct.decode(r,r.uint32());continue;case 3:if(i!==24)break;o.textAlign=r.int32();continue;case 4:if(i!==32)break;o.font=r.int32();continue;case 5:if(i!==40)break;o.fontSize=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(pr||(pr={}));var Zu={COMPONENT_ID:1052,serialize(e,n){let s=pr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return pr.decode(e.buffer(),e.remainingBytes())},create(){return pr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiText"}};var aa=$e(Qe());var Qu;(function(e){e[e.YGPT_RELATIVE=0]="YGPT_RELATIVE",e[e.YGPT_ABSOLUTE=1]="YGPT_ABSOLUTE"})(Qu||(Qu={}));var Ju;(function(e){e[e.YGA_AUTO=0]="YGA_AUTO",e[e.YGA_FLEX_START=1]="YGA_FLEX_START",e[e.YGA_CENTER=2]="YGA_CENTER",e[e.YGA_FLEX_END=3]="YGA_FLEX_END",e[e.YGA_STRETCH=4]="YGA_STRETCH",e[e.YGA_BASELINE=5]="YGA_BASELINE",e[e.YGA_SPACE_BETWEEN=6]="YGA_SPACE_BETWEEN",e[e.YGA_SPACE_AROUND=7]="YGA_SPACE_AROUND"})(Ju||(Ju={}));var Ku;(function(e){e[e.YGU_UNDEFINED=0]="YGU_UNDEFINED",e[e.YGU_POINT=1]="YGU_POINT",e[e.YGU_PERCENT=2]="YGU_PERCENT",e[e.YGU_AUTO=3]="YGU_AUTO"})(Ku||(Ku={}));var ef;(function(e){e[e.YGFD_ROW=0]="YGFD_ROW",e[e.YGFD_COLUMN=1]="YGFD_COLUMN",e[e.YGFD_COLUMN_REVERSE=2]="YGFD_COLUMN_REVERSE",e[e.YGFD_ROW_REVERSE=3]="YGFD_ROW_REVERSE"})(ef||(ef={}));var tf;(function(e){e[e.YGW_NO_WRAP=0]="YGW_NO_WRAP",e[e.YGW_WRAP=1]="YGW_WRAP",e[e.YGW_WRAP_REVERSE=2]="YGW_WRAP_REVERSE"})(tf||(tf={}));var nf;(function(e){e[e.YGJ_FLEX_START=0]="YGJ_FLEX_START",e[e.YGJ_CENTER=1]="YGJ_CENTER",e[e.YGJ_FLEX_END=2]="YGJ_FLEX_END",e[e.YGJ_SPACE_BETWEEN=3]="YGJ_SPACE_BETWEEN",e[e.YGJ_SPACE_AROUND=4]="YGJ_SPACE_AROUND",e[e.YGJ_SPACE_EVENLY=5]="YGJ_SPACE_EVENLY"})(nf||(nf={}));var of;(function(e){e[e.YGO_VISIBLE=0]="YGO_VISIBLE",e[e.YGO_HIDDEN=1]="YGO_HIDDEN",e[e.YGO_SCROLL=2]="YGO_SCROLL"})(of||(of={}));var rf;(function(e){e[e.YGD_FLEX=0]="YGD_FLEX",e[e.YGD_NONE=1]="YGD_NONE"})(rf||(rf={}));var af;(function(e){e[e.YGE_LEFT=0]="YGE_LEFT",e[e.YGE_TOP=1]="YGE_TOP",e[e.YGE_RIGHT=2]="YGE_RIGHT",e[e.YGE_BOTTOM=3]="YGE_BOTTOM",e[e.YGE_START=4]="YGE_START",e[e.YGE_END=5]="YGE_END",e[e.YGE_HORIZONTAL=6]="YGE_HORIZONTAL",e[e.YGE_VERTICAL=7]="YGE_VERTICAL",e[e.YGE_ALL=8]="YGE_ALL"})(af||(af={}));var sf;(function(e){e[e.PFM_NONE=0]="PFM_NONE",e[e.PFM_BLOCK=1]="PFM_BLOCK"})(sf||(sf={}));function Op(){return{parent:0,rightOf:0,alignContent:void 0,alignItems:void 0,flexWrap:void 0,flexShrink:void 0,positionType:0,alignSelf:0,flexDirection:0,justifyContent:0,overflow:0,display:0,flexBasisUnit:0,flexBasis:0,flexGrow:0,widthUnit:0,width:0,heightUnit:0,height:0,minWidthUnit:0,minWidth:0,minHeightUnit:0,minHeight:0,maxWidthUnit:0,maxWidth:0,maxHeightUnit:0,maxHeight:0,positionLeftUnit:0,positionLeft:0,positionTopUnit:0,positionTop:0,positionRightUnit:0,positionRight:0,positionBottomUnit:0,positionBottom:0,marginLeftUnit:0,marginLeft:0,marginTopUnit:0,marginTop:0,marginRightUnit:0,marginRight:0,marginBottomUnit:0,marginBottom:0,paddingLeftUnit:0,paddingLeft:0,paddingTopUnit:0,paddingTop:0,paddingRightUnit:0,paddingRight:0,paddingBottomUnit:0,paddingBottom:0,pointerFilter:void 0}}var hr;(function(e){function n(t,a=aa.default.Writer.create()){return t.parent!==0&&a.uint32(8).int32(t.parent),t.rightOf!==0&&a.uint32(16).int32(t.rightOf),t.alignContent!==void 0&&a.uint32(24).int32(t.alignContent),t.alignItems!==void 0&&a.uint32(32).int32(t.alignItems),t.flexWrap!==void 0&&a.uint32(40).int32(t.flexWrap),t.flexShrink!==void 0&&a.uint32(53).float(t.flexShrink),t.positionType!==0&&a.uint32(56).int32(t.positionType),t.alignSelf!==0&&a.uint32(64).int32(t.alignSelf),t.flexDirection!==0&&a.uint32(72).int32(t.flexDirection),t.justifyContent!==0&&a.uint32(80).int32(t.justifyContent),t.overflow!==0&&a.uint32(88).int32(t.overflow),t.display!==0&&a.uint32(96).int32(t.display),t.flexBasisUnit!==0&&a.uint32(104).int32(t.flexBasisUnit),t.flexBasis!==0&&a.uint32(117).float(t.flexBasis),t.flexGrow!==0&&a.uint32(125).float(t.flexGrow),t.widthUnit!==0&&a.uint32(128).int32(t.widthUnit),t.width!==0&&a.uint32(141).float(t.width),t.heightUnit!==0&&a.uint32(144).int32(t.heightUnit),t.height!==0&&a.uint32(157).float(t.height),t.minWidthUnit!==0&&a.uint32(160).int32(t.minWidthUnit),t.minWidth!==0&&a.uint32(173).float(t.minWidth),t.minHeightUnit!==0&&a.uint32(176).int32(t.minHeightUnit),t.minHeight!==0&&a.uint32(189).float(t.minHeight),t.maxWidthUnit!==0&&a.uint32(192).int32(t.maxWidthUnit),t.maxWidth!==0&&a.uint32(205).float(t.maxWidth),t.maxHeightUnit!==0&&a.uint32(208).int32(t.maxHeightUnit),t.maxHeight!==0&&a.uint32(221).float(t.maxHeight),t.positionLeftUnit!==0&&a.uint32(224).int32(t.positionLeftUnit),t.positionLeft!==0&&a.uint32(237).float(t.positionLeft),t.positionTopUnit!==0&&a.uint32(240).int32(t.positionTopUnit),t.positionTop!==0&&a.uint32(253).float(t.positionTop),t.positionRightUnit!==0&&a.uint32(256).int32(t.positionRightUnit),t.positionRight!==0&&a.uint32(269).float(t.positionRight),t.positionBottomUnit!==0&&a.uint32(272).int32(t.positionBottomUnit),t.positionBottom!==0&&a.uint32(285).float(t.positionBottom),t.marginLeftUnit!==0&&a.uint32(288).int32(t.marginLeftUnit),t.marginLeft!==0&&a.uint32(301).float(t.marginLeft),t.marginTopUnit!==0&&a.uint32(304).int32(t.marginTopUnit),t.marginTop!==0&&a.uint32(317).float(t.marginTop),t.marginRightUnit!==0&&a.uint32(320).int32(t.marginRightUnit),t.marginRight!==0&&a.uint32(333).float(t.marginRight),t.marginBottomUnit!==0&&a.uint32(336).int32(t.marginBottomUnit),t.marginBottom!==0&&a.uint32(349).float(t.marginBottom),t.paddingLeftUnit!==0&&a.uint32(352).int32(t.paddingLeftUnit),t.paddingLeft!==0&&a.uint32(365).float(t.paddingLeft),t.paddingTopUnit!==0&&a.uint32(368).int32(t.paddingTopUnit),t.paddingTop!==0&&a.uint32(381).float(t.paddingTop),t.paddingRightUnit!==0&&a.uint32(384).int32(t.paddingRightUnit),t.paddingRight!==0&&a.uint32(397).float(t.paddingRight),t.paddingBottomUnit!==0&&a.uint32(400).int32(t.paddingBottomUnit),t.paddingBottom!==0&&a.uint32(413).float(t.paddingBottom),t.pointerFilter!==void 0&&a.uint32(416).int32(t.pointerFilter),a}e.encode=n;function s(t,a){let r=t instanceof aa.default.Reader?t:aa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Op();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.parent=r.int32();continue;case 2:if(i!==16)break;o.rightOf=r.int32();continue;case 3:if(i!==24)break;o.alignContent=r.int32();continue;case 4:if(i!==32)break;o.alignItems=r.int32();continue;case 5:if(i!==40)break;o.flexWrap=r.int32();continue;case 6:if(i!==53)break;o.flexShrink=r.float();continue;case 7:if(i!==56)break;o.positionType=r.int32();continue;case 8:if(i!==64)break;o.alignSelf=r.int32();continue;case 9:if(i!==72)break;o.flexDirection=r.int32();continue;case 10:if(i!==80)break;o.justifyContent=r.int32();continue;case 11:if(i!==88)break;o.overflow=r.int32();continue;case 12:if(i!==96)break;o.display=r.int32();continue;case 13:if(i!==104)break;o.flexBasisUnit=r.int32();continue;case 14:if(i!==117)break;o.flexBasis=r.float();continue;case 15:if(i!==125)break;o.flexGrow=r.float();continue;case 16:if(i!==128)break;o.widthUnit=r.int32();continue;case 17:if(i!==141)break;o.width=r.float();continue;case 18:if(i!==144)break;o.heightUnit=r.int32();continue;case 19:if(i!==157)break;o.height=r.float();continue;case 20:if(i!==160)break;o.minWidthUnit=r.int32();continue;case 21:if(i!==173)break;o.minWidth=r.float();continue;case 22:if(i!==176)break;o.minHeightUnit=r.int32();continue;case 23:if(i!==189)break;o.minHeight=r.float();continue;case 24:if(i!==192)break;o.maxWidthUnit=r.int32();continue;case 25:if(i!==205)break;o.maxWidth=r.float();continue;case 26:if(i!==208)break;o.maxHeightUnit=r.int32();continue;case 27:if(i!==221)break;o.maxHeight=r.float();continue;case 28:if(i!==224)break;o.positionLeftUnit=r.int32();continue;case 29:if(i!==237)break;o.positionLeft=r.float();continue;case 30:if(i!==240)break;o.positionTopUnit=r.int32();continue;case 31:if(i!==253)break;o.positionTop=r.float();continue;case 32:if(i!==256)break;o.positionRightUnit=r.int32();continue;case 33:if(i!==269)break;o.positionRight=r.float();continue;case 34:if(i!==272)break;o.positionBottomUnit=r.int32();continue;case 35:if(i!==285)break;o.positionBottom=r.float();continue;case 36:if(i!==288)break;o.marginLeftUnit=r.int32();continue;case 37:if(i!==301)break;o.marginLeft=r.float();continue;case 38:if(i!==304)break;o.marginTopUnit=r.int32();continue;case 39:if(i!==317)break;o.marginTop=r.float();continue;case 40:if(i!==320)break;o.marginRightUnit=r.int32();continue;case 41:if(i!==333)break;o.marginRight=r.float();continue;case 42:if(i!==336)break;o.marginBottomUnit=r.int32();continue;case 43:if(i!==349)break;o.marginBottom=r.float();continue;case 44:if(i!==352)break;o.paddingLeftUnit=r.int32();continue;case 45:if(i!==365)break;o.paddingLeft=r.float();continue;case 46:if(i!==368)break;o.paddingTopUnit=r.int32();continue;case 47:if(i!==381)break;o.paddingTop=r.float();continue;case 48:if(i!==384)break;o.paddingRightUnit=r.int32();continue;case 49:if(i!==397)break;o.paddingRight=r.float();continue;case 50:if(i!==400)break;o.paddingBottomUnit=r.int32();continue;case 51:if(i!==413)break;o.paddingBottom=r.float();continue;case 52:if(i!==416)break;o.pointerFilter=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(hr||(hr={}));var cf={COMPONENT_ID:1050,serialize(e,n){let s=hr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return hr.decode(e.buffer(),e.remainingBytes())},create(){return hr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiTransform"}};var sa=$e(Qe());var uf;(function(e){e[e.VS_NONE=0]="VS_NONE",e[e.VS_ERROR=1]="VS_ERROR",e[e.VS_LOADING=2]="VS_LOADING",e[e.VS_READY=3]="VS_READY",e[e.VS_PLAYING=4]="VS_PLAYING",e[e.VS_BUFFERING=5]="VS_BUFFERING",e[e.VS_SEEKING=6]="VS_SEEKING",e[e.VS_PAUSED=7]="VS_PAUSED"})(uf||(uf={}));function Mp(){return{timestamp:0,tickNumber:0,currentOffset:0,videoLength:0,state:0}}var mr;(function(e){function n(t,a=sa.default.Writer.create()){return t.timestamp!==0&&a.uint32(8).uint32(t.timestamp),t.tickNumber!==0&&a.uint32(16).uint32(t.tickNumber),t.currentOffset!==0&&a.uint32(29).float(t.currentOffset),t.videoLength!==0&&a.uint32(37).float(t.videoLength),t.state!==0&&a.uint32(40).int32(t.state),a}e.encode=n;function s(t,a){let r=t instanceof sa.default.Reader?t:sa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Mp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.timestamp=r.uint32();continue;case 2:if(i!==16)break;o.tickNumber=r.uint32();continue;case 3:if(i!==29)break;o.currentOffset=r.float();continue;case 4:if(i!==37)break;o.videoLength=r.float();continue;case 5:if(i!==40)break;o.state=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(mr||(mr={}));var ff={COMPONENT_ID:1044,serialize(e,n){let s=mr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return mr.decode(e.buffer(),e.remainingBytes())},create(){return mr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBVideoEvent"}};var ca=$e(Qe());function Pp(){return{src:"",playing:void 0,position:void 0,volume:void 0,playbackRate:void 0,loop:void 0}}var yr;(function(e){function n(t,a=ca.default.Writer.create()){return t.src!==""&&a.uint32(10).string(t.src),t.playing!==void 0&&a.uint32(16).bool(t.playing),t.position!==void 0&&a.uint32(29).float(t.position),t.volume!==void 0&&a.uint32(37).float(t.volume),t.playbackRate!==void 0&&a.uint32(45).float(t.playbackRate),t.loop!==void 0&&a.uint32(48).bool(t.loop),a}e.encode=n;function s(t,a){let r=t instanceof ca.default.Reader?t:ca.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Pp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.src=r.string();continue;case 2:if(i!==16)break;o.playing=r.bool();continue;case 3:if(i!==29)break;o.position=r.float();continue;case 4:if(i!==37)break;o.volume=r.float();continue;case 5:if(i!==45)break;o.playbackRate=r.float();continue;case 6:if(i!==48)break;o.loop=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(yr||(yr={}));var lf={COMPONENT_ID:1043,serialize(e,n){let s=yr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return yr.decode(e.buffer(),e.remainingBytes())},create(){return yr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBVideoPlayer"}};var ua=$e(Qe());function zp(){return{visible:void 0}}var vr;(function(e){function n(t,a=ua.default.Writer.create()){return t.visible!==void 0&&a.uint32(8).bool(t.visible),a}e.encode=n;function s(t,a){let r=t instanceof ua.default.Reader?t:ua.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=zp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.visible=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(vr||(vr={}));var df={COMPONENT_ID:1081,serialize(e,n){let s=vr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return vr.decode(e.buffer(),e.remainingBytes())},create(){return vr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBVisibilityComponent"}};var as=e=>e.defineComponentFromSchema("core::Animator",Yc),ss=e=>e.defineComponentFromSchema("core::AudioSource",$c),pf=e=>e.defineComponentFromSchema("core::AudioStream",Xc),cs=e=>e.defineComponentFromSchema("core::AvatarAttach",Qc),hf=e=>e.defineComponentFromSchema("core::AvatarModifierArea",tu),mf=e=>e.defineComponentFromSchema("core::AvatarShape",du),yf=e=>e.defineComponentFromSchema("core::Billboard",hu),vf=e=>e.defineComponentFromSchema("core::CameraMode",mu),xf=e=>e.defineComponentFromSchema("core::CameraModeArea",yu),bf=e=>e.defineComponentFromSchema("core::EngineInfo",vu),us=e=>e.defineComponentFromSchema("core::GltfContainer",xu),Ef=e=>e.defineComponentFromSchema("core::GltfContainerLoadingState",bu),fs=e=>e.defineComponentFromSchema("core::Material",Su),gf=e=>e.defineComponentFromSchema("core::MeshCollider",Au),ls=e=>e.defineComponentFromSchema("core::MeshRenderer",_u),ds=e=>e.defineComponentFromSchema("core::NftShape",Nu),Ur=e=>e.defineComponentFromSchema("core::PointerEvents",Cu),fa=e=>e.defineValueSetComponentFromSchema("core::PointerEventsResult",Bu,{timestampFunction:n=>n.timestamp,maxElements:100}),wf=e=>e.defineComponentFromSchema("core::PointerLock",Iu),ps=e=>e.defineComponentFromSchema("core::Raycast",Ou),hs=e=>e.defineComponentFromSchema("core::RaycastResult",Mu),Sf=e=>e.defineComponentFromSchema("core::TextShape",Pu),ms=e=>e.defineComponentFromSchema("core::Tween",Fu),la=e=>e.defineComponentFromSchema("core::TweenSequence",Lu),da=e=>e.defineComponentFromSchema("core::TweenState",Du),Tf=e=>e.defineComponentFromSchema("core::UiBackground",Hu),Af=e=>e.defineComponentFromSchema("core::UiCanvasInformation",Gu),_f=e=>e.defineComponentFromSchema("core::UiDropdown",ju),Rf=e=>e.defineComponentFromSchema("core::UiDropdownResult",Yu),Nf=e=>e.defineComponentFromSchema("core::UiInput",$u),Cf=e=>e.defineComponentFromSchema("core::UiInputResult",Xu),Bf=e=>e.defineComponentFromSchema("core::UiText",Zu),If=e=>e.defineComponentFromSchema("core::UiTransform",cf),ys=e=>e.defineValueSetComponentFromSchema("core::VideoEvent",ff,{timestampFunction:n=>n.timestamp,maxElements:100}),pa=e=>e.defineComponentFromSchema("core::VideoPlayer",lf),vs=e=>e.defineComponentFromSchema("core::VisibilityComponent",df),xs={"core::Animator":as,"core::AudioSource":ss,"core::AudioStream":pf,"core::AvatarAttach":cs,"core::AvatarModifierArea":hf,"core::AvatarShape":mf,"core::Billboard":yf,"core::CameraMode":vf,"core::CameraModeArea":xf,"core::EngineInfo":bf,"core::GltfContainer":us,"core::GltfContainerLoadingState":Ef,"core::Material":fs,"core::MeshCollider":gf,"core::MeshRenderer":ls,"core::NftShape":ds,"core::PointerEvents":Ur,"core::PointerEventsResult":fa,"core::PointerLock":wf,"core::Raycast":ps,"core::RaycastResult":hs,"core::TextShape":Sf,"core::Tween":ms,"core::TweenSequence":la,"core::TweenState":da,"core::UiBackground":Tf,"core::UiCanvasInformation":Af,"core::UiDropdown":_f,"core::UiDropdownResult":Rf,"core::UiInput":Nf,"core::UiInputResult":Cf,"core::UiText":Bf,"core::UiTransform":If,"core::VideoEvent":ys,"core::VideoPlayer":pa,"core::VisibilityComponent":vs};function kf(e){let n=as(e);function s(t,a){let r=n.getMutableOrNull(t);if(!r)return[null,null];let c=r.states.find(o=>o.clip===a);return c?[r,c]:[r,null]}return{...n,getClipOrNull(t,a){let[r,c]=s(t,a);return c},getClip(t,a){let[r,c]=s(t,a);if(!r)throw new Error(`There is no Animator found in the entity ${t}`);if(!c)throw new Error(`The Animator component of ${t} has no the state ${a}`);return c},playSingleAnimation(t,a,r=!0){let[c,o]=s(t,a);if(!c||!o)return!1;for(let i of c.states)i.playing=!1,i.shouldReset=!0;return o.playing=!0,o.shouldReset=r,!0},stopAllAnimations(t,a=!0){let r=n.getMutableOrNull(t);if(!r)return!1;for(let c of r.states)c.playing=!1,c.shouldReset=a;return!0}}}var Up={Common(e){return{tex:{$case:"texture",texture:e}}},Avatar(e){return{tex:{$case:"avatarTexture",avatarTexture:e}}},Video(e){return{tex:{$case:"videoTexture",videoTexture:e}}}};function Of(e){let n=fs(e);return{...n,Texture:Up,setBasicMaterial(s,t){n.createOrReplace(s,{material:{$case:"unlit",unlit:t}})},setPbrMaterial(s,t){n.createOrReplace(s,{material:{$case:"pbr",pbr:t}})}}}function Mf(e){let n=ls(e);return{...n,setBox(s,t){n.createOrReplace(s,{mesh:{$case:"box",box:{uvs:t||[]}}})},setPlane(s,t){n.createOrReplace(s,{mesh:{$case:"plane",plane:{uvs:t||[]}}})},setCylinder(s,t,a){n.createOrReplace(s,{mesh:{$case:"cylinder",cylinder:{radiusBottom:t,radiusTop:a}}})},setSphere(s){n.createOrReplace(s,{mesh:{$case:"sphere",sphere:{}}})}}}var Lp={Move(e){return{$case:"move",move:e}},Rotate(e){return{$case:"rotate",rotate:e}},Scale(e){return{$case:"scale",scale:e}}};function Pf(e){return{...ms(e),Mode:Lp}}var ha=e=>({serialize(n,s){s.writeUint32(n.length);for(let t of n)e.serialize(t,s)},deserialize(n){let s=[],t=n.readUint32();for(let a=0;a<t;a++)s.push(e.deserialize(n));return s},create(){return[]},jsonSchema:{type:"array",items:e.jsonSchema,serializationType:"array"}});var Lr={serialize(e,n){n.writeInt8(e?1:0)},deserialize(e){return e.readInt8()===1},create(){return!1},jsonSchema:{type:"boolean",serializationType:"boolean"}};var Vr={serialize(e,n){n.writeInt64(BigInt(e))},deserialize(e){return Number(e.readInt64())},create(){return 0},jsonSchema:{type:"integer",serializationType:"int64"}},so={serialize(e,n){n.writeInt32(e)},deserialize(e){return e.readInt32()},create(){return 0},jsonSchema:{type:"integer",serializationType:"int32"}},Dr={serialize(e,n){n.writeInt16(e)},deserialize(e){return e.readInt16()},create(){return 0},jsonSchema:{type:"integer",serializationType:"int16"}},Wr={serialize(e,n){n.writeInt8(e)},deserialize(e){return e.readInt8()},create(){return 0},jsonSchema:{type:"integer",serializationType:"int8"}};var ma={serialize(e,n){n.writeUtf8String(e)},deserialize(e){return e.readUtf8String()},create(){return""},jsonSchema:{type:"string",serializationType:"utf8-string"}},qr=ma;function Vp(e){let t=0,a=0;for(let r in e){if(typeof e[r]=="number"){if(e[r]>2147483647||e[r]<-2147483648)throw new Error("Enum member values must be numbers within the range of -2147483648 to 2147483647.");t++}a++}if(a!==t*2)throw new Error("All enum member values must be of numeric type.")}function Dp(e){for(let n in e)if(typeof e[n]!="string")throw new Error("All enum member values must be of string type.")}var Wp="enum-int",ya=(e,n)=>(Vp(e),{serialize(s,t){so.serialize(s,t)},deserialize(s){return so.deserialize(s)},create(){return n},jsonSchema:{type:"integer",enum:Object.values(e).filter(s=>Number.isInteger(s)),default:n,serializationType:Wp,enumObject:e}}),qp="enum-string",va=(e,n)=>(Dp(e),{serialize(s,t){ma.serialize(s,t)},deserialize(s){return ma.deserialize(s)},create(){return n},jsonSchema:{type:"string",enum:Object.values(e),default:n,serializationType:qp,enumObject:e}});var xr={serialize(e,n){n.writeFloat32(e)},deserialize(e){return e.readFloat32()},create(){return 0},jsonSchema:{type:"number",serializationType:"float32"}},Hr={serialize(e,n){n.writeFloat64(e)},deserialize(e){return e.readFloat64()},create(){return 0},jsonSchema:{type:"number",serializationType:"float64"}};var Gr={serialize(e,n){n.writeFloat32(e.r),n.writeFloat32(e.g),n.writeFloat32(e.b)},deserialize(e){return{r:e.readFloat32(),g:e.readFloat32(),b:e.readFloat32()}},create(){return{r:0,g:0,b:0}},jsonSchema:{type:"object",properties:{r:{type:"number"},g:{type:"number"},b:{type:"number"}},serializationType:"color3"}};var jr={serialize(e,n){n.writeFloat32(e.r),n.writeFloat32(e.g),n.writeFloat32(e.b),n.writeFloat32(e.a)},deserialize(e){return{r:e.readFloat32(),g:e.readFloat32(),b:e.readFloat32(),a:e.readFloat32()}},create(){return{r:0,g:0,b:0,a:0}},jsonSchema:{type:"object",properties:{r:{type:"number"},g:{type:"number"},b:{type:"number"},a:{type:"number"}},serializationType:"color4"}};var Yr={serialize(e,n){n.writeInt32(e)},deserialize(e){return e.readInt32()},create(){return 0},jsonSchema:{type:"integer",serializationType:"entity"}};var $r={serialize(e,n){n.writeFloat32(e.x),n.writeFloat32(e.y),n.writeFloat32(e.z),n.writeFloat32(e.w)},deserialize(e){return{x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32(),w:e.readFloat32()}},create(){return{x:0,y:0,z:0,w:0}},jsonSchema:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}},serializationType:"quaternion"}};var Xr={serialize(e,n){n.writeFloat32(e.x),n.writeFloat32(e.y),n.writeFloat32(e.z)},deserialize(e){return{x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32()}},create(){return{x:0,y:0,z:0}},jsonSchema:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}},serializationType:"vector3"}};var xa=(e,n)=>{let s=Object.keys(e).reduce((t,a)=>(t[a]=e[a].jsonSchema,t),{});return{serialize(t,a){for(let r in e)e[r].serialize(t[r],a)},deserialize(t){let a={};for(let r in e)a[r]=e[r].deserialize(t);return a},create(){let t={};for(let a in e)t[a]=e[a].create();return{...t,...n}},extend:t=>{let a={};for(let r in e)a[r]=e[r].create();return{...a,...n,...t}},jsonSchema:{type:"object",properties:s,serializationType:"map"}}};var ba=e=>({serialize(n,s){n?(s.writeInt8(1),e.serialize(n,s)):s.writeInt8(0)},deserialize(n){if(n.readInt8())return e.deserialize(n)},create(){},jsonSchema:{type:e.jsonSchema.type,serializationType:"optional",optionalJsonSchema:e.jsonSchema}});var Ea=e=>{let n=Object.keys(e),s=n.reduce((a,r,c)=>(a[r]=c,a),{}),t=n.reduce((a,r)=>(a[r]=e[r].jsonSchema,a),{});return{serialize({$case:a,value:r},c){let o=s[a.toString()]+1;c.writeUint8(o),e[a].serialize(r,c)},deserialize(a){let r=n[a.readInt8()-1],c=e[r].deserialize(a);return{$case:r,value:c}},create(){return{}},jsonSchema:{type:"object",properties:t,serializationType:"one-of"}}};var zf=(e,n)=>n.includes(e.serializationType),Hp=e=>zf(e,["one-of"]),Gp=()=>({type:{type:"object",serializationType:"unknown"},value:void 0}),ga=e=>zf(e,["array","map"]),bs=(e,n,s)=>{let t=e[s],a=n[s];if(Hp(t)){let r=a;if(!r.$case)return Gp();let c=t.properties[r.$case];return ga(c)&&(n[s]={[r.$case]:r.value}),{type:c,value:r.value}}return{type:t,value:a}};var Ff={[Lr.jsonSchema.serializationType]:Lr,[qr.jsonSchema.serializationType]:qr,[xr.jsonSchema.serializationType]:xr,[Hr.jsonSchema.serializationType]:Hr,[Wr.jsonSchema.serializationType]:Wr,[Dr.jsonSchema.serializationType]:Dr,[so.jsonSchema.serializationType]:so,[Vr.jsonSchema.serializationType]:Vr,[Xr.jsonSchema.serializationType]:Xr,[$r.jsonSchema.serializationType]:$r,[Gr.jsonSchema.serializationType]:Gr,[jr.jsonSchema.serializationType]:jr,[Yr.jsonSchema.serializationType]:Yr};function br(e){if(Ff[e.serializationType])return Ff[e.serializationType];if(e.serializationType==="map"){let n=e,s={};for(let t in n.properties)s[t]=br(n.properties[t]);return xa(s)}if(e.serializationType==="optional")return ba(br(e.optionalJsonSchema));if(e.serializationType==="array")return ha(br(e.items));if(e.serializationType==="enum-int"){let n=e;return ya(n.enumObject,n.default)}if(e.serializationType==="enum-string"){let n=e;return va(n.enumObject,n.default)}if(e.serializationType==="one-of"){let n=e,s={};for(let t in n.properties)s[t]=br(n.properties[t]);return Ea(s)}throw new Error(`${e.serializationType} is not supported as reverse schema generation.`)}function wa(e,n,s){if(e.serializationType==="map"){let{properties:t}=e,a=n;for(let r in t){let{type:c,value:o}=bs(t,a,r);if(c.serializationType!=="unknown")if(ga(c))wa(c,o,s);else{let i=s(o,c);i.changed&&(a[r]=i.value)}}}else if(e.serializationType==="array"){let{items:t}=e,a=n;for(let r=0,c=a.length;r<c;r++){let{type:o,value:i}=bs({items:t},{items:a[r]},"items");if(ga(o))wa(o,i,s);else{let u=s(i,o);u.changed&&(a[r]=u.value)}}}}var ce;(function(e){e.Boolean=Lr,e.String=qr,e.Float=xr,e.Double=Hr,e.Byte=Wr,e.Short=Dr,e.Int=so,e.Int64=Vr,e.Number=xr,e.Vector3=Xr,e.Quaternion=$r,e.Color3=Gr,e.Color4=jr,e.Entity=Yr,e.EnumNumber=ya,e.EnumString=va,e.Array=ha,e.Map=xa,e.Optional=ba,e.OneOf=Ea,e.fromJson=br,e.mutateNestedValues=wa})(ce||(ce={}));function jp(e){return e.defineComponent("core-schema::Name",{value:ce.String})}var Uf=jp;var Es={serialize(e,n){let s=n.incrementWriteOffset(44);n.setFloat32(s,e.position.x),n.setFloat32(s+4,e.position.y),n.setFloat32(s+8,e.position.z),n.setFloat32(s+12,e.rotation.x),n.setFloat32(s+16,e.rotation.y),n.setFloat32(s+20,e.rotation.z),n.setFloat32(s+24,e.rotation.w),n.setFloat32(s+28,e.scale.x),n.setFloat32(s+32,e.scale.y),n.setFloat32(s+36,e.scale.z),n.setUint32(s+40,e.parent||0)},deserialize(e){let n=e.incrementReadOffset(44);return{position:{x:e.getFloat32(n),y:e.getFloat32(n+4),z:e.getFloat32(n+8)},rotation:{x:e.getFloat32(n+12),y:e.getFloat32(n+16),z:e.getFloat32(n+20),w:e.getFloat32(n+24)},scale:{x:e.getFloat32(n+28),y:e.getFloat32(n+32),z:e.getFloat32(n+36)},parent:e.getUint32(n+40)}},create(){return{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1},parent:0}},extend(e){return{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1},parent:0,...e}},jsonSchema:{type:"object",properties:{position:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},scale:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},rotation:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}}},parent:{type:"integer"}},serializationType:"transform"}};function Lf(e){let n=e.defineComponentFromSchema("core::Transform",Es);return{...n,create(s,t){return n.create(s,Es.extend(t))},createOrReplace(s,t){return n.createOrReplace(s,Es.extend(t))}}}var _o=e=>Lf(e),Vf=e=>Of(e),Df=e=>kf(e),Wf=e=>Mf(e);var gs=e=>Pf(e),Sa=e=>Uf(e);var ws={"core::Transform":1,"core::Animator":1042,"core::AudioSource":1020,"core::AudioStream":1021,"core::AvatarAttach":1073,"core::AvatarBase":1087,"core::AvatarEmoteCommand":1088,"core::AvatarEquippedData":1091,"core::AvatarModifierArea":1070,"core::AvatarShape":1080,"core::Billboard":1090,"core::CameraMode":1072,"core::CameraModeArea":1071,"core::EngineInfo":1048,"core::GltfContainer":1041,"core::GltfContainerLoadingState":1049,"core::Material":1017,"core::MeshCollider":1019,"core::MeshRenderer":1018,"core::NftShape":1040,"core::PlayerIdentityData":1089,"core::PointerEvents":1062,"core::PointerEventsResult":1063,"core::PointerLock":1074,"core::Raycast":1067,"core::RaycastResult":1068,"core::TextShape":1030,"core::Tween":1102,"core::TweenSequence":1104,"core::TweenState":1103,"core::UiBackground":1053,"core::UiCanvasInformation":1054,"core::UiDropdown":1094,"core::UiDropdownResult":1096,"core::UiInput":1093,"core::UiInputResult":1095,"core::UiText":1052,"core::UiTransform":1050,"core::VideoEvent":1044,"core::VideoPlayer":1043,"core::VisibilityComponent":1081};var Hf=$e(li());var Yp=new Int32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function $p(e,n){let s=~~n^-1;for(let t=0;t<e.length;t++)s=Yp[(s^e[t])&255]^s>>>8;return s^-1}function qf(e,n=0){return $p(e,n)>>>0}var Ss=2048;function Hn(e){if(ws[e])return ws[e];let n=new Uint8Array(128);return Hf.write(e,n,0),(qf(n)+Ss&4294967295)>>>0}var Ts=typeof process=="object"&&!1||!1;function Zr(e,n){if(Ts&&e&&typeof e=="object"&&typeof e.then=="function")throw new Error(n);return e}function Gf(){let e=new Map;return{addTo(n,s){if(s<0)return!1;let t=e.get(n);return t!==void 0&&t>=s||e.set(n,s),!0},has(n,s){let t=e.get(n);return t!==void 0&&t>=s},getMap(){return e}}}var Ro=65535,Xp=4294901760,tx=Ro+1,As=Ro,Ta=512,Zp=As,Pn;(function(e){function n(t){return[(t&Ro)>>>0,((t&Xp)>>16&Ro)>>>0]}e.fromEntityId=n;function s(t,a){return(t&Ro|(a&Ro)<<16)>>>0}e.toEntityId=s})(Pn||(Pn={}));var Ut;(function(e){e[e.Unknown=0]="Unknown",e[e.UsedEntity=1]="UsedEntity",e[e.Removed=2]="Removed",e[e.Reserved=3]="Reserved"})(Ut||(Ut={}));function jf(){let e=Ta,n,s,t=new Set,a=[],r=Gf(),c=Zp;function o(d,v){c=d,s=v,n=v[0]}function i(d){if(e>As-1)throw new Error(`It fails trying to generate an entity out of range ${As}.`);if(d&&n>s[1])throw new Error(`Max amount of network entities reached ${s[1]} `);if(!d&&e>=c)throw new Error(`Max amount of local entities reached ${c}`);let v=d?n++:e++,h=r.getMap().has(v)?r.getMap().get(v)+1:0,x=Pn.toEntityId(v,h);return t.has(x)?i():(t.add(x),x)}function u(d){if(d&&!s)throw new Error("Network entities ranged not initialized. Connect to a CRDT Server");let v=(s&&[...t.values()].filter(x=>{let[w]=Pn.fromEntityId(x);return w>=s[0]&&w<=s[1]}).length)??0,h=t.size-v;if(!d&&h+Ta>=e||d&&v+s[0]>=n)return i(d);for(let[x,w]of r.getMap())if(w<Ro){if(d&&(x<s[0]||x>s[1])||!d&&x>=c)continue;let k=Pn.toEntityId(x,w+1);if(!t.has(k)&&!a.includes(k))return t.add(k),k}return i(d)}function p(d){return d<Ta?!1:(t.has(d)?(t.delete(d),a.push(d)):f(d),!0)}function m(){let d=a;if(d.length){a=[];for(let v of d){let[h,x]=Pn.fromEntityId(v);r.addTo(h,x)}}return d}function f(d){let[v,h]=Pn.fromEntityId(d);r.addTo(v,h);for(let x=0;x<=h;x++)t.delete(Pn.toEntityId(v,x));return!0}function y(d){let[v,h]=Pn.fromEntityId(d);if(r.has(v,h))return!1;if(h>0){for(let x=0;x<=h-1;x++)t.delete(Pn.toEntityId(v,x));r.addTo(v,h-1)}return t.add(d),!0}function l(d){let[v,h]=Pn.fromEntityId(d);if(v<Ta)return Ut.Reserved;if(t.has(d))return Ut.UsedEntity;let x=r.getMap().get(v);return x!==void 0&&x>=h?Ut.Removed:Ut.Unknown}return{setNetworkEntitiesRange:o,generateEntity:u,removeEntity:p,getExistingEntities(){return new Set(t)},getEntityState:l,releaseRemovedEntities:m,updateRemovedEntity:f,updateUsedEntity:y}}var Er=$e(li()),lt=function(e,n,s,t){if(s==="a"&&!t)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?e!==n||!t:!n.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?t:s==="a"?t.call(e):t?t.value:n.get(e)},st,dn,Xt;function Qp(e,n){let s=Math.max(e,n)+1024;return Math.ceil(s/1024)*1024}var Jp=10240,Mt=class{constructor(n,s,t){st.add(this),this._buffer=n||new Uint8Array(Jp),this.view=new DataView(this._buffer.buffer,this._buffer.byteOffset),this.woffset=t??(n?this._buffer.length:null)??0,this.roffset=s??0}buffer(){return this._buffer}bufferLength(){return this._buffer.length}resetBuffer(){this.roffset=0,this.woffset=0}currentReadOffset(){return this.roffset}currentWriteOffset(){return this.woffset}incrementReadOffset(n){return lt(this,st,"m",Xt).call(this,n)}remainingBytes(){return this.woffset-this.roffset}readFloat32(){return this.view.getFloat32(lt(this,st,"m",Xt).call(this,4),!0)}readFloat64(){return this.view.getFloat64(lt(this,st,"m",Xt).call(this,8),!0)}readInt8(){return this.view.getInt8(lt(this,st,"m",Xt).call(this,1))}readInt16(){return this.view.getInt16(lt(this,st,"m",Xt).call(this,2),!0)}readInt32(){return this.view.getInt32(lt(this,st,"m",Xt).call(this,4),!0)}readInt64(){return this.view.getBigInt64(lt(this,st,"m",Xt).call(this,8),!0)}readUint8(){return this.view.getUint8(lt(this,st,"m",Xt).call(this,1))}readUint16(){return this.view.getUint16(lt(this,st,"m",Xt).call(this,2),!0)}readUint32(){return this.view.getUint32(lt(this,st,"m",Xt).call(this,4),!0)}readUint64(){return this.view.getBigUint64(lt(this,st,"m",Xt).call(this,8),!0)}readBuffer(){let n=this.view.getUint32(lt(this,st,"m",Xt).call(this,4),!0);return this._buffer.subarray(lt(this,st,"m",Xt).call(this,n),lt(this,st,"m",Xt).call(this,0))}readUtf8String(){let n=this.view.getUint32(lt(this,st,"m",Xt).call(this,4),!0);return Er.read(this._buffer,lt(this,st,"m",Xt).call(this,n),lt(this,st,"m",Xt).call(this,0))}incrementWriteOffset(n){return lt(this,st,"m",dn).call(this,n)}toBinary(){return this._buffer.subarray(0,this.woffset)}toCopiedBinary(){return new Uint8Array(this.toBinary())}writeBuffer(n,s=!0){s&&this.writeUint32(n.byteLength);let t=lt(this,st,"m",dn).call(this,n.byteLength);this._buffer.set(n,t)}writeUtf8String(n,s=!0){let t=Er.length(n);s&&this.writeUint32(t);let a=lt(this,st,"m",dn).call(this,t);Er.write(n,this._buffer,a)}writeFloat32(n){let s=lt(this,st,"m",dn).call(this,4);this.view.setFloat32(s,n,!0)}writeFloat64(n){let s=lt(this,st,"m",dn).call(this,8);this.view.setFloat64(s,n,!0)}writeInt8(n){let s=lt(this,st,"m",dn).call(this,1);this.view.setInt8(s,n)}writeInt16(n){let s=lt(this,st,"m",dn).call(this,2);this.view.setInt16(s,n,!0)}writeInt32(n){let s=lt(this,st,"m",dn).call(this,4);this.view.setInt32(s,n,!0)}writeInt64(n){let s=lt(this,st,"m",dn).call(this,8);this.view.setBigInt64(s,n,!0)}writeUint8(n){let s=lt(this,st,"m",dn).call(this,1);this.view.setUint8(s,n)}writeUint16(n){let s=lt(this,st,"m",dn).call(this,2);this.view.setUint16(s,n,!0)}writeUint32(n){let s=lt(this,st,"m",dn).call(this,4);this.view.setUint32(s,n,!0)}writeUint64(n){let s=lt(this,st,"m",dn).call(this,8);this.view.setBigUint64(s,n,!0)}getFloat32(n){return this.view.getFloat32(n,!0)}getFloat64(n){return this.view.getFloat64(n,!0)}getInt8(n){return this.view.getInt8(n)}getInt16(n){return this.view.getInt16(n,!0)}getInt32(n){return this.view.getInt32(n,!0)}getInt64(n){return this.view.getBigInt64(n,!0)}getUint8(n){return this.view.getUint8(n)}getUint16(n){return this.view.getUint16(n,!0)}getUint32(n){return this.view.getUint32(n,!0)}getUint64(n){return this.view.getBigUint64(n,!0)}setFloat32(n,s){this.view.setFloat32(n,s,!0)}setFloat64(n,s){this.view.setFloat64(n,s,!0)}setInt8(n,s){this.view.setInt8(n,s)}setInt16(n,s){this.view.setInt16(n,s,!0)}setInt32(n,s){this.view.setInt32(n,s,!0)}setInt64(n,s){this.view.setBigInt64(n,s,!0)}setUint8(n,s){this.view.setUint8(n,s)}setUint16(n,s){this.view.setUint16(n,s,!0)}setUint32(n,s){this.view.setUint32(n,s,!0)}setUint64(n,s){this.view.setBigUint64(n,s,!0)}};st=new WeakSet,dn=function(n){if(this.woffset+n>this._buffer.byteLength){let s=Qp(this._buffer.byteLength,this.woffset+n),t=new Uint8Array(s);t.set(this._buffer);let a=this._buffer.byteOffset;this._buffer=t,this.view=new DataView(this._buffer.buffer,a)}return this.woffset+=n,this.woffset-n},Xt=function(n){if(this.roffset+n>this.woffset)throw new Error("Outside of the bounds of writen data.");return this.roffset+=n,this.roffset-n};var Je;(function(e){e[e.RESERVED=0]="RESERVED",e[e.PUT_COMPONENT=1]="PUT_COMPONENT",e[e.DELETE_COMPONENT=2]="DELETE_COMPONENT",e[e.DELETE_ENTITY=3]="DELETE_ENTITY",e[e.APPEND_VALUE=4]="APPEND_VALUE",e[e.MAX_MESSAGE_TYPE=5]="MAX_MESSAGE_TYPE"})(Je||(Je={}));var An=8,bn;(function(e){e[e.StateUpdatedTimestamp=1]="StateUpdatedTimestamp",e[e.StateOutdatedTimestamp=2]="StateOutdatedTimestamp",e[e.NoChanges=3]="NoChanges",e[e.StateOutdatedData=4]="StateOutdatedData",e[e.StateUpdatedData=5]="StateUpdatedData",e[e.EntityWasDeleted=6]="EntityWasDeleted",e[e.EntityDeleted=7]="EntityDeleted"})(bn||(bn={}));var _n;(function(e){function n(r){let c=r.remainingBytes();if(c<An)return!1;let o=r.getUint32(r.currentReadOffset());return!(c<o)}e.validate=n;function s(r){return n(r)?{length:r.readUint32(),type:r.readUint32()}:null}e.readHeader=s;function t(r){if(!n(r))return null;let c=r.currentReadOffset();return{length:r.getUint32(c),type:r.getUint32(c+4)}}e.getHeader=t;function a(r){let c=t(r);return c?(r.incrementReadOffset(c.length),!0):!1}e.consumeMessage=a})(_n||(_n={}));var co;(function(e){e.MESSAGE_HEADER_LENGTH=12;function n(t,a,r,c){let o=An+e.MESSAGE_HEADER_LENGTH,i=c.incrementWriteOffset(o);c.setUint32(i,o),c.setUint32(i+4,Je.DELETE_COMPONENT),c.setUint32(i+8,t),c.setUint32(i+12,a),c.setUint32(i+16,r)}e.write=n;function s(t){let a=_n.readHeader(t);if(!a)return null;if(a.type!==Je.DELETE_COMPONENT)throw new Error("DeleteComponentOperation tried to read another message type.");return{...a,entityId:t.readUint32(),componentId:t.readUint32(),timestamp:t.readUint32()}}e.read=s})(co||(co={}));var No;(function(e){e.MESSAGE_HEADER_LENGTH=16;function n(t,a,r,c,o){let i=o.incrementWriteOffset(An+e.MESSAGE_HEADER_LENGTH);o.writeBuffer(c,!1);let u=o.currentWriteOffset()-i;o.setUint32(i,u),o.setUint32(i+4,Je.APPEND_VALUE),o.setUint32(i+8,t),o.setUint32(i+12,r),o.setUint32(i+16,a);let p=u-e.MESSAGE_HEADER_LENGTH-An;o.setUint32(i+20,p)}e.write=n;function s(t){let a=_n.readHeader(t);if(!a)return null;if(a.type!==Je.APPEND_VALUE)throw new Error("AppendValueOperation tried to read another message type.");return{...a,entityId:t.readUint32(),componentId:t.readUint32(),timestamp:t.readUint32(),data:t.readBuffer()}}e.read=s})(No||(No={}));var Qr;(function(e){e.MESSAGE_HEADER_LENGTH=4;function n(t,a){a.writeUint32(An+4),a.writeUint32(Je.DELETE_ENTITY),a.writeUint32(t)}e.write=n;function s(t){let a=_n.readHeader(t);if(!a)return null;if(a.type!==Je.DELETE_ENTITY)throw new Error("DeleteEntity tried to read another message type.");return{...a,entityId:t.readUint32()}}e.read=s})(Qr||(Qr={}));var uo;(function(e){e.MESSAGE_HEADER_LENGTH=16;function n(t,a,r,c,o){let i=o.incrementWriteOffset(An+e.MESSAGE_HEADER_LENGTH);o.writeBuffer(c,!1);let u=o.currentWriteOffset()-i;o.setUint32(i,u),o.setUint32(i+4,Je.PUT_COMPONENT),o.setUint32(i+8,t),o.setUint32(i+12,r),o.setUint32(i+16,a);let p=u-e.MESSAGE_HEADER_LENGTH-An;o.setUint32(i+20,p)}e.write=n;function s(t){let a=_n.readHeader(t);if(!a)return null;if(a.type!==Je.PUT_COMPONENT)throw new Error("PutComponentOperation tried to read another message type.");return{...a,entityId:t.readUint32(),componentId:t.readUint32(),timestamp:t.readUint32(),data:t.readBuffer()}}e.read=s})(uo||(uo={}));function Yf(e,n){let s=[],t=[],a=[],r=[];function c(m){return function(y){let l=new Mt(y),d;for(;d=_n.getHeader(l);){let v=l.currentReadOffset();if(d.type===Je.DELETE_COMPONENT){let h=co.read(l);t.push({...h,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else if(d.type===Je.PUT_COMPONENT){let h=uo.read(l);t.push({...h,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else if(d.type===Je.DELETE_ENTITY){let h=Qr.read(l);t.push({...h,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else if(d.type===Je.APPEND_VALUE){let h=No.read(l);t.push({...h,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else l.incrementReadOffset(d.length)}}}function o(m){return m.splice(0,m.length)}async function i(){let m=o(t),f=new Mt,y=[];for(let l of m)if(l.type===Je.DELETE_ENTITY)y.push(l.entityId),a.push(l);else{let d=e.entityContainer.getEntityState(l.entityId);if(d===Ut.Removed)continue;d===Ut.Unknown&&e.entityContainer.updateUsedEntity(l.entityId);let v=e.getComponentOrNull(l.componentId);if(v){let[h,x]=v.updateFromCrdt(l);if(h){let w=f.currentWriteOffset();h.type===Je.PUT_COMPONENT?uo.write(l.entityId,h.timestamp,h.componentId,h.data,f):h.type===Je.DELETE_COMPONENT&&co.write(l.entityId,v.componentId,h.timestamp,f),r.push({...l,messageBuffer:f.buffer().subarray(w,f.currentWriteOffset())})}else a.push(l),n&&n(l.entityId,l.type,v,x)}else a.push(l)}for(let l of y){for(let d=r.length-1;d>=0;d--)r[d].entityId===l&&r[d].type!==Je.DELETE_ENTITY&&r.splice(d,1);for(let d of e.componentsIter())d.entityDeleted(l,!0);e.entityContainer.updateRemovedEntity(l),n&&n(l,Je.DELETE_ENTITY)}}async function u(m){let f=o(a),y=o(r),l=new Mt;for(let v of e.componentsIter())for(let h of v.getCrdtUpdates()){let x=l.currentWriteOffset();if(s.some(w=>w.filter(h))&&(h.type===Je.PUT_COMPONENT?uo.write(h.entityId,h.timestamp,h.componentId,h.data,l):h.type===Je.DELETE_COMPONENT?co.write(h.entityId,v.componentId,h.timestamp,l):h.type===Je.APPEND_VALUE&&No.write(h.entityId,h.timestamp,h.componentId,h.data,l),f.push({...h,messageBuffer:l.buffer().subarray(x,l.currentWriteOffset())}),n)){let w=h.type===Je.PUT_COMPONENT||h.type===Je.APPEND_VALUE?v.get(h.entityId):void 0;n(h.entityId,h.type,v,w)}}for(let v of m){let h=l.currentWriteOffset();Qr.write(v,l),f.push({type:Je.DELETE_ENTITY,entityId:v,messageBuffer:l.buffer().subarray(h,l.currentWriteOffset())}),n&&n(v,Je.DELETE_ENTITY)}let d=new Mt;for(let v in s){let h=Number(v),x=s[h];d.resetBuffer();for(let k of y)k.transportId===h&&!f.find(N=>N.entityId===k.entityId&&N.componentId&&N.componentId===k.componentId)&&d.writeBuffer(k.messageBuffer,!1);for(let k of f)k.transportId!==h&&x.filter(k)&&d.writeBuffer(k.messageBuffer,!1);let w=d.currentWriteOffset()?d.toBinary():new Uint8Array([]);await x.send(w)}}function p(m){let f=s.push(m)-1;m.onmessage=c(f)}return{sendMessages:u,receiveMessages:i,addTransport:p}}var $f;(function(e){let n;(function(s){s[s.NETWORKED=0]="NETWORKED",s[s.RENDERER=1]="RENDERER"})(n=e.SynchronizedEntityType||(e.SynchronizedEntityType={}))})($f||($f={}));function Jr(e,n){if(e===n)return 0;if(e===null&&n!==null)return-1;if(e!==null&&n===null)return 1;if(e instanceof Uint8Array&&n instanceof Uint8Array){let s=e.byteLength-n.byteLength;if(s!==0)return s>0?1:-1;let t;for(let a=0,r=e.byteLength;a<r;a++)if(t=e[a]-n[a],t!==0)return t>0?1:-1;return 0}if(typeof e=="string"){let s=e.length-n.length;return s!==0?s>0?1:-1:e.localeCompare(n)}return e>n?1:-1}function _s(e){return Object.freeze({...e})}function Kp(e,n){let s=(n.get(e)||0)+1;return n.set(e,s),s}function eh(e,n,s,t){return function(r,c){for(let[o,i]of n)if(!(c&&!c(o)))if(t.has(o)){let u=t.get(o),p=new Mt;s.serialize(u,p),uo.write(o,i,e,p.toBinary(),r)}else co.write(o,e,i,r)}}function th(e,n,s,t){function a(r){let{entityId:c,timestamp:o}=r,i=n.get(c);if(i===void 0||i<o)return bn.StateUpdatedTimestamp;if(i>o)return bn.StateOutdatedTimestamp;if(r.type===Je.DELETE_COMPONENT&&!t.has(c))return bn.NoChanges;let u=0;if(t.has(c)){let p=new Mt;s.serialize(t.get(c),p),u=Jr(p.toBinary(),r.data||null)}else u=Jr(null,r.data);return u===0?bn.NoChanges:u>0?bn.StateOutdatedData:bn.StateUpdatedData}return r=>{if(r.type!==Je.PUT_COMPONENT&&r.type!==Je.DELETE_COMPONENT)return[null,t.get(r.entityId)];let c=a(r),o=r.entityId;switch(c){case bn.StateUpdatedData:case bn.StateUpdatedTimestamp:{if(n.set(o,r.timestamp),r.type===Je.PUT_COMPONENT){let i=new Mt(r.data);t.set(o,s.deserialize(i))}else t.delete(o);return[null,t.get(o)]}case bn.StateOutdatedTimestamp:case bn.StateOutdatedData:if(t.has(o)){let i=new Mt;return s.serialize(t.get(o),i),[{type:Je.PUT_COMPONENT,componentId:e,data:i.toBinary(),entityId:o,timestamp:n.get(o)},t.get(o)]}else return[{type:Je.DELETE_COMPONENT,componentId:e,entityId:o,timestamp:n.get(o)},void 0]}return[null,t.get(o)]}}function nh(e,n,s,t,a){return function*(){for(let r of s){let c=Kp(r,n);if(a.has(r)){let o=new Mt;t.serialize(a.get(r),o),yield{type:Je.PUT_COMPONENT,componentId:e,entityId:r,data:o.toBinary(),timestamp:c}}else yield{type:Je.DELETE_COMPONENT,componentId:e,entityId:r,timestamp:c}}s.clear()}}function Rs(e,n,s){let t=new Map,a=new Set,r=new Map;return{get componentId(){return n},get componentName(){return e},get componentType(){return 0},schema:s,has(c){return t.has(c)},deleteFrom(c,o=!0){let i=t.get(c);return t.delete(c)&&o&&a.add(c),i||null},entityDeleted(c,o){t.delete(c)&&o&&a.add(c)},getOrNull(c){let o=t.get(c);return o?_s(o):null},get(c){let o=t.get(c);if(!o)throw new Error(`[getFrom] Component ${e} for entity #${c} not found`);return _s(o)},create(c,o){if(t.get(c))throw new Error(`[create] Component ${e} for ${c} already exists`);let u=o===void 0?s.create():s.extend?s.extend(o):o;return t.set(c,u),a.add(c),u},createOrReplace(c,o){let i=o===void 0?s.create():s.extend?s.extend(o):o;return t.set(c,i),a.add(c),i},getMutableOrNull(c){let o=t.get(c);return o?(a.add(c),o):null},getOrCreateMutable(c,o){let i=t.get(c);return i?(a.add(c),i):this.create(c,o)},getMutable(c){let o=this.getMutableOrNull(c);if(o===null)throw new Error(`[mutable] Component ${e} for ${c} not found`);return o},*iterator(){for(let[c,o]of t)yield[c,o]},*dirtyIterator(){for(let c of a)yield c},getCrdtUpdates:nh(n,r,a,s,t),updateFromCrdt:th(n,r,s,t),dumpCrdtStateToBuffer:eh(n,r,s,t)}}function Xf(){let e=[];function n(){e.sort((a,r)=>r.priority-a.priority)}function s(a,r,c){let o=c??a.name;if(e.find(i=>i.fn===a))throw new Error(`System ${JSON.stringify(o)} already added to the engine`);e.push({fn:a,priority:r,name:o}),n()}function t(a){let r=-1;return typeof a=="string"?r=e.findIndex(c=>c.name===a):r=e.findIndex(c=>c.fn===a),r===-1?!1:(e.splice(r,1),n(),!0)}return{add:s,remove:t,getSystems(){return e}}}var Ns=Qf(new Set);function Zf(){throw new Error("The set is frozen")}function Qf(e){return e.add=Zf,e.clear=Zf,e}function oh(e,n){return e.timestamp>n.timestamp?1:-1}function Jf(e,n,s,t){let a=new Map,r=new Set,c=[];function o(m){let f=m.raw.length;return f>1&&m.raw[f-1].timestamp<=m.raw[f-2].timestamp}function i(m){let f=a.get(m);if(f){for(o(f)&&f.raw.sort(oh);f.raw.length>t.maxElements;)f.raw.shift();let y=Qf(new Set(f?.raw.map(l=>l.value)));return f.frozenSet=y,y}else return Ns}function u(m,f){let y=a.get(m);y||(y={raw:[],frozenSet:Ns},a.set(m,y));let l=s.extend?s.extend(f):f,d=t.timestampFunction(l);return Ts&&Object.freeze(l),y.raw.push({value:l,timestamp:d}),{set:i(m),value:l}}return{get componentId(){return n},get componentName(){return e},get componentType(){return 1},schema:s,has(m){return a.has(m)},entityDeleted(m){a.delete(m)},get(m){let f=a.get(m);return f?f.frozenSet:Ns},addValue(m,f){let{set:y,value:l}=u(m,f);r.add(m);let d=new Mt;return s.serialize(l,d),c.push({componentId:n,data:d.toBinary(),entityId:m,timestamp:0,type:Je.APPEND_VALUE}),y},*iterator(){for(let[m,f]of a)yield[m,f.frozenSet]},*dirtyIterator(){for(let m of r)yield m},getCrdtUpdates(){return r.clear(),c.splice(0,c.length)},updateFromCrdt(m){if(m.type===Je.APPEND_VALUE){let f=new Mt(m.data);u(m.entityId,s.deserialize(f))}return[null,void 0]},dumpCrdtStateToBuffer:function(m,f){for(let[y,{raw:l}]of a)if(!(f&&!f(y)))for(let d of l){let v=new Mt;s.serialize(d.value,v),No.write(y,0,n,v.toBinary(),m)}}}}function*Kf(e,n){if(n.has(e)){n.delete(e);for(let[s,t]of n)t.parent===e&&(yield*Kf(s,n));yield e}}function rh(e,n,s){let t=new Map(e.getEntitiesWith(s));return Kf(n,t)}function el(e,n){let s=_o(e);for(let t of rh(e,n,s))e.removeEntity(t)}var tl=[0,1,2,4,5,6,7,8,9,10,11,12,13],ih=1<<20;function nl(e){let n=fa(e),s={previousFrameMaxTimestamp:0,currentFrameMaxTimestamp:0,buttonState:new Map,thisFrameCommands:[]};function t(d,v,h){let x=n.get(h);for(let w of Array.from(x).reverse())if(w.button===v&&w.state===d)return w}function*a(d,v){let h=n.get(v);for(let x of Array.from(h).reverse())x.button===d&&(yield x)}function r(){let d=s.currentFrameMaxTimestamp;s.previousFrameMaxTimestamp=d,s.thisFrameCommands.length&&(s.thisFrameCommands=[]);for(let[,v]of e.getEntitiesWith(n)){let h=Array.from(v);for(let x=h.length-1;x>=0;x--){let w=h[x];if(w.timestamp>d&&(d=w.timestamp),w.timestamp>s.previousFrameMaxTimestamp&&s.thisFrameCommands.push(w),w.state===0||w.state===1){let k=s.buttonState.get(w.button);if(!k||w.timestamp>k.timestamp)s.buttonState.set(w.button,w);else break}}}s.currentFrameMaxTimestamp=d}e.addSystem(r,ih,"@dcl/ecs#inputSystem");function c(d){return d>s.previousFrameMaxTimestamp&&d<=s.currentFrameMaxTimestamp}function o(d,v){if(d!==3)return i(d,v);for(let h of tl){let x=i(h,v);if(x)return x}return null}function i(d,v){let h=null,x=null;for(let w of a(d,v))if(x){if(!h&&w.state===1){h=w;break}}else if(w.state===0){x=w;continue}return!x||!h?null:h.timestamp<x.timestamp&&c(x.timestamp)?{up:x,down:h}:null}function u(d,v,h){if(d!==3)return m(d,v,h);for(let x of tl){let w=m(x,v,h);if(w)return w}return null}function p(d,v,h){if(h)return u(d,v,h);for(let x of s.thisFrameCommands)if((x.button===d||d===3)&&x.state===v)return x;return null}function m(d,v,h){let x=t(v,d,h);return x&&c(x.timestamp)?x:null}function f(d,v){return o(d,v)!==null}function y(d,v,h){if(h){let x=t(v,d,h);return x&&c(x.timestamp)||!1}else{for(let x of s.thisFrameCommands)if((x.button===d||d===3)&&x.state===v)return!0;return!1}}function l(d){return s.buttonState.get(d)?.state===1}return{isPressed:l,getClick:o,getInputCommand:p,isClicked:f,isTriggered:y}}var ol;(function(e){e[e.LastWriteWinElementSet=0]="LastWriteWinElementSet",e[e.GrowOnlyValueSet=1]="GrowOnlyValueSet"})(ol||(ol={}));function sh(){let e=jf(),n=new Map,s=Xf(),t,a=!1;function r(W,$=1e5,E){s.add(W,$,E)}function c(W){return s.remove(W)}function o(){if(!t)throw new Error("Network manager not initialized. Start CRDT Server");return t}function i(W,$){return e.setNetworkEntitiesRange(W,$),t={addEntity:()=>e.generateEntity(!0)},t}function u(){return e.generateEntity()}function p(W){for(let[,$]of n)$.entityDeleted(W,!0);return e.removeEntity(W)}function m(W){return el({removeEntity:p,defineComponentFromSchema:y,getEntitiesWith:x},W)}function f(W,$){if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let E=Hn(W);if(n.get(E))throw new Error(`Component number ${E} was already registered.`);if($.componentName!==W)throw new Error(`Component name doesn't match componentDefinition.componentName ${W} != ${$.componentName}`);if($.componentId!==E)throw new Error(`Component number doesn't match componentDefinition.componentId ${E} != ${$.componentId}`);return n.set(E,$),$}function y(W,$){let E=Hn(W),_=n.get(E);if(_)return _;if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let O=Rs(W,E,$);return n.set(E,O),O}function l(W,$,E){let _=Hn(W),O=n.get(_);if(O)return O;if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let V=Jf(W,_,$,E);return n.set(_,V),V}function d(W,$,E){let _=Hn(W),O=n.get(_);if(O)return O;if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let V=ce.Map($,E),D=Rs(W,_,V),J={...D,create(ee,K){return D.create(ee,K)},createOrReplace(ee,K){return D.createOrReplace(ee,K)}};return n.set(_,J),J}function v(W){let $=typeof W=="number"?W:Hn(W),E=n.get($);if(!E)throw new Error(`Component ${$} not found. You need to declare the components at the beginnig of the engine declaration`);return E}function h(W){let $=typeof W=="number"?W:Hn(W);return n.get($)??null}function*x(...W){for(let[$,...E]of k(...W))yield[$,...E.map(_=>_.get($))]}function w(W){let $=Sa({defineComponent:d});for(let[E,_]of x($))if(_.value===W)return E;return null}function*k(...W){let[$,...E]=W;for(let[_]of $.iterator()){let O=!0;for(let V of E)if(!V.has(_)){O=!1;break}O&&(yield[_,...W])}}function N(){return s.getSystems()}function A(){return n.values()}function P(W){if(a)throw new Error("Engine is already sealed. No components can be removed at this stage");let $=typeof W=="number"?W:Hn(W);n.delete($)}_o({defineComponentFromSchema:y});function M(){a||(a=!0)}return{addEntity:u,removeEntity:p,removeEntityWithChildren:m,addSystem:r,getSystems:N,removeSystem:c,defineComponent:d,defineComponentFromSchema:y,defineValueSetComponentFromSchema:l,getEntitiesWith:x,getComponent:v,getComponentOrNull:h,getEntityOrNullByName:w,removeComponentDefinition:P,registerComponentDefinition:f,entityContainer:e,componentsIter:A,seal:M,addNetworkManager:i,getNetworkManager:o}}function rl(e){let n=sh(),s=Yf(n,e?.onChangeFunction||null);async function t(a){await s.receiveMessages();for(let c of n.getSystems()){let o=c.fn(a);Zr(o,`A system (${c.name||"anonymous"}) returned a thenable. Systems cannot be async functions. Documentation: https://dcl.gg/sdk/sync-systems`)}let r=n.entityContainer.releaseRemovedEntities();await s.sendMessages(r)}return{addEntity:n.addEntity,removeEntity:n.removeEntity,removeEntityWithChildren:n.removeEntityWithChildren,addSystem:n.addSystem,removeSystem:n.removeSystem,defineComponent:n.defineComponent,defineComponentFromSchema:n.defineComponentFromSchema,defineValueSetComponentFromSchema:n.defineValueSetComponentFromSchema,registerComponentDefinition:n.registerComponentDefinition,getEntitiesWith:n.getEntitiesWith,getComponent:n.getComponent,getComponentOrNull:n.getComponentOrNull,removeComponentDefinition:n.removeComponentDefinition,componentsIter:n.componentsIter,seal:n.seal,getEntityOrNullByName:n.getEntityOrNullByName,update:t,RootEntity:0,PlayerEntity:1,CameraEntity:2,getEntityState:n.entityContainer.getEntityState,addTransport:s.addTransport,entityContainer:n.entityContainer,addNetworkManager:n.addNetworkManager,getNetworkManager:n.getNetworkManager}}function il(e,n){let s=Ur(e),t;(function(y){y[y.Click=0]="Click",y[y.Down=1]="Down",y[y.Up=2]="Up"})(t||(t={}));let a=(y={})=>({button:3,...y}),r=new Map;function c(y){return r.get(y)||r.set(y,new Map).get(y)}function o(y,l,d){(d.hoverText||d.showFeedback)&&(s.getMutableOrNull(y)||s.create(y)).pointerEvents.push({eventType:l,eventInfo:{button:d.button,showFeedback:d.showFeedback,hoverText:d.hoverText,maxDistance:d.maxDistance}})}function i(y,l,d){let v=s.getMutableOrNull(y);v&&(v.pointerEvents=v.pointerEvents.filter(h=>!(h.eventInfo?.button===d&&h.eventType===l)))}function u(y){return y===t.Up?0:1}function p(y,l){let d=c(y),v=d.get(l);v?.opts.hoverText&&i(y,u(l),v.opts.button),d.delete(l)}e.addSystem(function(){for(let[l,d]of r){if(e.getEntityState(l)===Ut.Removed){r.delete(l);continue}for(let[v,{cb:h,opts:x}]of d){if(v===t.Click){let w=n.getClick(x.button,l);w&&Zr(h(w.up),"Click event returned a thenable. Only synchronous functions are allowed")}if(v===t.Down||v===t.Up){let w=n.getInputCommand(x.button,u(v),l);w&&Zr(h(w),"Event handler returned a thenable. Only synchronous functions are allowed")}}}});let m=(...y)=>{let[l,d,v]=y;if(typeof l=="number")return m({entity:l,opts:v??{}},d);let{entity:h,opts:x}=l,w=a(x);p(h,t.Down),c(h).set(t.Down,{cb:d,opts:w}),o(h,1,w)},f=(...y)=>{let[l,d,v]=y;if(typeof l=="number")return f({entity:l,opts:v??{}},d);let{entity:h,opts:x}=l,w=a(x);p(h,t.Up),c(h).set(t.Up,{cb:d,opts:w}),o(h,0,w)};return{removeOnClick(y){p(y,t.Click)},removeOnPointerDown(y){p(y,t.Down)},removeOnPointerUp(y){p(y,t.Up)},onClick(y,l){let{entity:d}=y,v=a(y.opts);p(d,t.Click),c(d).set(t.Click,{cb:l,opts:v}),o(d,1,v)},onPointerDown:m,onPointerUp:f}}function al(e){let n=gs(e),s=da(e),t=la(e),a=new Map;function r(u){let p=s.getOrNull(u),m=n.getOrNull(u),f=a.get(u);return!p||!m?!1:!!((c(u)||p.state===1)&&!f?.completed&&(f?.frames??0)>2)}function c(u){let p=n.getOrNull(u),m=a.get(u)?.tween;if(p&&!m||!p&&m)return!0;let f=new Mt;return n.schema.serialize(p,f),Jr(f.toBinary(),m)}let o=[];e.addSystem(()=>{for(let u of o)u();o.length=0;for(let[u,p]of e.getEntitiesWith(n)){if(c(u)){let f=new Mt;n.schema.serialize(p,f),a.set(u,{tween:f.toBinary(),frames:0,completed:!1,changed:!0});continue}let m=a.get(u);if(m.frames+=1,m.changed=!1,r(u)){m.frames=0,m.completed=!0;let f=t.getOrNull(u);if(!f)continue;let{sequence:y}=f;if(y&&y.length){let[l,...d]=y;n.createOrReplace(u,l);let v=t.getMutable(u);v.sequence=d,f.loop===0&&v.sequence.push(p)}else f.loop===1?n.createOrReplace(u,i(p)):f.loop===0&&(n.deleteFrom(u),a.delete(u),o.push(()=>{n.createOrReplace(u,p)}))}}},Number.NEGATIVE_INFINITY);function i(u){if(u.mode?.$case==="move"&&u.mode.move)return{...u,mode:{...u.mode,move:{start:u.mode.move.end,end:u.mode.move.start}}};if(u.mode?.$case==="rotate"&&u.mode.rotate)return{...u,mode:{...u.mode,rotate:{start:u.mode.rotate.end,end:u.mode.rotate.start}}};if(u.mode?.$case==="scale"&&u.mode.scale)return{...u,mode:{...u.mode,scale:{start:u.mode.scale.end,end:u.mode.scale.start}}};throw new Error("Invalid tween")}return{tweenCompleted:r}}var we=rl(),gr=nl(we),Cs=il(we,gr);var Ib=al(we);var Bs=ss(we);var sl=cs(we);var wr=us(we);var vt=ds(we),cl=Ur(we);var ul=pa(we),Aa=vs(we);var fl;(function(e){e[e.CT_FIRST_PERSON=0]="CT_FIRST_PERSON",e[e.CT_THIRD_PERSON=1]="CT_THIRD_PERSON",e[e.CT_CINEMATIC=2]="CT_CINEMATIC"})(fl||(fl={}));var Xn;(function(e){e[e.IA_POINTER=0]="IA_POINTER",e[e.IA_PRIMARY=1]="IA_PRIMARY",e[e.IA_SECONDARY=2]="IA_SECONDARY",e[e.IA_ANY=3]="IA_ANY",e[e.IA_FORWARD=4]="IA_FORWARD",e[e.IA_BACKWARD=5]="IA_BACKWARD",e[e.IA_RIGHT=6]="IA_RIGHT",e[e.IA_LEFT=7]="IA_LEFT",e[e.IA_JUMP=8]="IA_JUMP",e[e.IA_WALK=9]="IA_WALK",e[e.IA_ACTION_3=10]="IA_ACTION_3",e[e.IA_ACTION_4=11]="IA_ACTION_4",e[e.IA_ACTION_5=12]="IA_ACTION_5",e[e.IA_ACTION_6=13]="IA_ACTION_6"})(Xn||(Xn={}));var Zn;(function(e){e[e.PET_UP=0]="PET_UP",e[e.PET_DOWN=1]="PET_DOWN",e[e.PET_HOVER_ENTER=2]="PET_HOVER_ENTER",e[e.PET_HOVER_LEAVE=3]="PET_HOVER_LEAVE"})(Zn||(Zn={}));var ll;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.LOADING=1]="LOADING",e[e.NOT_FOUND=2]="NOT_FOUND",e[e.FINISHED_WITH_ERROR=3]="FINISHED_WITH_ERROR",e[e.FINISHED=4]="FINISHED"})(ll||(ll={}));var dl;(function(e){e[e.TAM_TOP_LEFT=0]="TAM_TOP_LEFT",e[e.TAM_TOP_CENTER=1]="TAM_TOP_CENTER",e[e.TAM_TOP_RIGHT=2]="TAM_TOP_RIGHT",e[e.TAM_MIDDLE_LEFT=3]="TAM_MIDDLE_LEFT",e[e.TAM_MIDDLE_CENTER=4]="TAM_MIDDLE_CENTER",e[e.TAM_MIDDLE_RIGHT=5]="TAM_MIDDLE_RIGHT",e[e.TAM_BOTTOM_LEFT=6]="TAM_BOTTOM_LEFT",e[e.TAM_BOTTOM_CENTER=7]="TAM_BOTTOM_CENTER",e[e.TAM_BOTTOM_RIGHT=8]="TAM_BOTTOM_RIGHT"})(dl||(dl={}));var pl;(function(e){e[e.F_SANS_SERIF=0]="F_SANS_SERIF",e[e.F_SERIF=1]="F_SERIF",e[e.F_MONOSPACE=2]="F_MONOSPACE"})(pl||(pl={}));function Is(e){let n=e.getComponentOrNull("composite::root");return n||e.defineComponent("composite::root",{src:ce.String,entities:ce.Array(ce.Map({src:ce.Entity,dest:ce.Entity}))})}var ch="/";function uh(e,n=!1){let s="",t=0,a=-1,r=0,c;for(let o=0;o<=e.length;++o){if(o<e.length)c=e.charCodeAt(o);else{if(c===47)break;c=47}if(c===47){if(!(a===o-1||r===1))if(a!==o-1&&r===2){if(s.length<2||t!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){let i=s.lastIndexOf("/");if(i!==s.length-1){i===-1?(s="",t=0):(s=s.slice(0,i),t=s.length-1-s.lastIndexOf("/")),a=o,r=0;continue}}else if(s.length===2||s.length===1){s="",t=0,a=o,r=0;continue}}n&&(s.length>0?s+="/..":s="..",t=2)}else s.length>0?s+="/"+e.slice(a+1,o):s=e.slice(a+1,o),t=o-a-1;a=o,r=0}else c===46&&r!==-1?++r:r=-1}return s}function _a(...e){let n="",s=!1,t;for(let a=e.length-1;a>=-1&&!s;a--){let r;a>=0?r=e[a]:(t===void 0&&(t=ch),r=t),r.length!==0&&(n=r+"/"+n,s=r.charCodeAt(0)===47)}return n=uh(n,!s),s?n.length>0?"/"+n:"/":n.length>0?n:"."}function hl(e){if(e.length===0)return".";let n=e.charCodeAt(0),s=n===47,t=-1,a=!0;for(let r=e.length-1;r>=1;--r)if(n=e.charCodeAt(r),n===47){if(!a){t=r;break}}else a=!1;return t===-1?s?"/":".":s&&t===1?"//":e.slice(0,t)}function Ra(e,n){return(e.startsWith(".")?_a(n,e):_a(e)).substring(1)}var Sr;(function(e){e[e.EMM_NONE=0]="EMM_NONE",e[e.EMM_NEXT_AVAILABLE=1]="EMM_NEXT_AVAILABLE",e[e.EMM_DIRECT_MAPPING=2]="EMM_DIRECT_MAPPING"})(Sr||(Sr={}));function ml(e,n){return n.data?.$case==="json"?n.data.json:e.schema.deserialize(new Mt(n.data?.binary))}function lh(e,n){let s=e.getComponentOrNull(n.name);if(s)return s;if(n.name.startsWith("core::")){if(n.name in xs)return xs[n.name](e);throw new Error(`The core component ${n.name} was not found.`)}else{if(n.jsonSchema)return e.defineComponentFromSchema(n.name,ce.fromJson(n.jsonSchema));throw new Error(`${n.name} is not defined and there is no schema to define it.`)}}function dh(e,n,s,{entityMapping:t}){let a=s.get(n);if(a)return a;if(t?.type===Sr.EMM_DIRECT_MAPPING){let c=t.getCompositeEntity(n);return s.set(n,c),c}let r=t?.type===Sr.EMM_NEXT_AVAILABLE?t.getNextAvailableEntity():e.addEntity();if(r===null)throw new Error("There is no more entities to allocate");return s.set(n,r),r}function ks(e,n,s,t){let{rootEntity:a,alreadyRequestedSrc:r,entityMapping:c}=t,o=r||new Set,i=hl(_a(n.src)),u=Hn("core::Transform"),p=Is(e),m=new Map,f=v=>dh(e,v,m,t),y=a??f(0);a&&m.set(0,a);let l=n.composite.components.find(v=>v.name===p.componentName);if(l)for(let[v,h]of l.data){let x=ml(p,h),w=Ra(x.src,i),k=s.getCompositeOrNull(w),N=f(v);if(k){if(o.has(k.src)||k.src===n.src)throw new Error(`Composite ${n.src} has a recursive instanciation while try to instance ${k.src}. Previous instances: ${o.toString()}`);ks(e,k,s,{rootEntity:N,alreadyRequestedSrc:new Set(o).add(k.src),entityMapping:c?.type===Sr.EMM_NEXT_AVAILABLE?c:void 0})}}for(let v of n.composite.components){if(v.name===p.componentName)continue;let h=lh(e,v);for(let[x,w]of v.data){let k=ml(h,w),N=f(x),A=h.create(N,k);if(h.componentId===u){let P=A;P.parent?P.parent=f(P.parent):P.parent=f(0)}else ce.mutateNestedValues(h.schema.jsonSchema,A,(P,M)=>M.serializationType==="entity"?{changed:!0,value:f(P)}:{changed:!1})}}let d=p.getMutableOrNull(y)||p.create(y);for(let[v,h]of m)d.entities.push({src:v,dest:h});return d.src=n.src,y}var gn=$e(Qe());var En=$e(Qe());var yl;(function(e){e[e.NULL_VALUE=0]="NULL_VALUE"})(yl||(yl={}));function ph(e){switch(e){case 0:case"NULL_VALUE":return 0;default:throw new El.Error("Unrecognized enum value "+e+" for enum NullValue")}}function hh(e){switch(e){case 0:return"NULL_VALUE";default:throw new El.Error("Unrecognized enum value "+e+" for enum NullValue")}}function vl(){return{fields:new Map}}var Tr;(function(e){function n(o,i=En.default.Writer.create()){return o.fields.forEach((u,p)=>{u!==void 0&&Na.encode({key:p,value:u},i.uint32(10).fork()).ldelim()}),i}e.encode=n;function s(o,i){let u=o instanceof En.default.Reader?o:En.default.Reader.create(o),p=i===void 0?u.len:u.pos+i,m=vl();for(;u.pos<p;){let f=u.uint32();switch(f>>>3){case 1:if(f!==10)break;let y=Na.decode(u,u.uint32());y.value!==void 0&&m.fields.set(y.key,y.value);continue}if((f&7)===4||f===0)break;u.skipType(f&7)}return m}e.decode=s;function t(o){return{fields:yh(o.fields)?Object.entries(o.fields).reduce((i,[u,p])=>(i.set(u,p),i),new Map):new Map}}e.fromJSON=t;function a(o){let i={};return i.fields={},o.fields&&o.fields.forEach((u,p)=>{i.fields[p]=u}),i}e.toJSON=a;function r(o){let i=vl();return o!==void 0&&Object.keys(o).forEach(u=>{i.fields.set(u,o[u])}),i}e.wrap=r;function c(o){let i={};return[...o.fields.keys()].forEach(u=>{i[u]=o.fields.get(u)}),i}e.unwrap=c})(Tr||(Tr={}));function mh(){return{key:"",value:void 0}}var Na;(function(e){function n(r,c=En.default.Writer.create()){return r.key!==""&&c.uint32(10).string(r.key),r.value!==void 0&&Gt.encode(Gt.wrap(r.value),c.uint32(18).fork()).ldelim(),c}e.encode=n;function s(r,c){let o=r instanceof En.default.Reader?r:En.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=mh();for(;o.pos<i;){let p=o.uint32();switch(p>>>3){case 1:if(p!==10)break;u.key=o.string();continue;case 2:if(p!==18)break;u.value=Gt.unwrap(Gt.decode(o,o.uint32()));continue}if((p&7)===4||p===0)break;o.skipType(p&7)}return u}e.decode=s;function t(r){return{key:fo(r.key)?String(r.key):"",value:fo(r?.value)?r.value:void 0}}e.fromJSON=t;function a(r){let c={};return r.key!==void 0&&(c.key=r.key),r.value!==void 0&&(c.value=r.value),c}e.toJSON=a})(Na||(Na={}));function xl(){return{kind:void 0}}var Gt;(function(e){function n(o,i=En.default.Writer.create()){switch(o.kind?.$case){case"nullValue":i.uint32(8).int32(o.kind.nullValue);break;case"numberValue":i.uint32(17).double(o.kind.numberValue);break;case"stringValue":i.uint32(26).string(o.kind.stringValue);break;case"boolValue":i.uint32(32).bool(o.kind.boolValue);break;case"structValue":Tr.encode(Tr.wrap(o.kind.structValue),i.uint32(42).fork()).ldelim();break;case"listValue":Ar.encode(Ar.wrap(o.kind.listValue),i.uint32(50).fork()).ldelim();break}return i}e.encode=n;function s(o,i){let u=o instanceof En.default.Reader?o:En.default.Reader.create(o),p=i===void 0?u.len:u.pos+i,m=xl();for(;u.pos<p;){let f=u.uint32();switch(f>>>3){case 1:if(f!==8)break;m.kind={$case:"nullValue",nullValue:u.int32()};continue;case 2:if(f!==17)break;m.kind={$case:"numberValue",numberValue:u.double()};continue;case 3:if(f!==26)break;m.kind={$case:"stringValue",stringValue:u.string()};continue;case 4:if(f!==32)break;m.kind={$case:"boolValue",boolValue:u.bool()};continue;case 5:if(f!==42)break;m.kind={$case:"structValue",structValue:Tr.unwrap(Tr.decode(u,u.uint32()))};continue;case 6:if(f!==50)break;m.kind={$case:"listValue",listValue:Ar.unwrap(Ar.decode(u,u.uint32()))};continue}if((f&7)===4||f===0)break;u.skipType(f&7)}return m}e.decode=s;function t(o){return{kind:fo(o.nullValue)?{$case:"nullValue",nullValue:ph(o.nullValue)}:fo(o.numberValue)?{$case:"numberValue",numberValue:Number(o.numberValue)}:fo(o.stringValue)?{$case:"stringValue",stringValue:String(o.stringValue)}:fo(o.boolValue)?{$case:"boolValue",boolValue:!!o.boolValue}:fo(o.structValue)?{$case:"structValue",structValue:o.structValue}:fo(o.listValue)?{$case:"listValue",listValue:[...o.listValue]}:void 0}}e.fromJSON=t;function a(o){let i={};return o.kind?.$case==="nullValue"&&(i.nullValue=o.kind?.nullValue!==void 0?hh(o.kind?.nullValue):void 0),o.kind?.$case==="numberValue"&&(i.numberValue=o.kind?.numberValue),o.kind?.$case==="stringValue"&&(i.stringValue=o.kind?.stringValue),o.kind?.$case==="boolValue"&&(i.boolValue=o.kind?.boolValue),o.kind?.$case==="structValue"&&(i.structValue=o.kind?.structValue),o.kind?.$case==="listValue"&&(i.listValue=o.kind?.listValue),i}e.toJSON=a;function r(o){let i=xl();if(o===null)i.kind={$case:"nullValue",nullValue:0};else if(typeof o=="boolean")i.kind={$case:"boolValue",boolValue:o};else if(typeof o=="number")i.kind={$case:"numberValue",numberValue:o};else if(typeof o=="string")i.kind={$case:"stringValue",stringValue:o};else if(Array.isArray(o))i.kind={$case:"listValue",listValue:o};else if(typeof o=="object")i.kind={$case:"structValue",structValue:o};else if(typeof o<"u")throw new Error("Unsupported any value type: "+typeof o);return i}e.wrap=r;function c(o){return o.kind?.$case==="nullValue"?null:o.kind?.$case==="numberValue"?o.kind?.numberValue:o.kind?.$case==="stringValue"?o.kind?.stringValue:o.kind?.$case==="boolValue"?o.kind?.boolValue:o.kind?.$case==="structValue"?o.kind?.structValue:o.kind?.$case==="listValue"?o.kind?.listValue:void 0}e.unwrap=c})(Gt||(Gt={}));function bl(){return{values:[]}}var Ar;(function(e){function n(o,i=En.default.Writer.create()){for(let u of o.values)Gt.encode(Gt.wrap(u),i.uint32(10).fork()).ldelim();return i}e.encode=n;function s(o,i){let u=o instanceof En.default.Reader?o:En.default.Reader.create(o),p=i===void 0?u.len:u.pos+i,m=bl();for(;u.pos<p;){let f=u.uint32();switch(f>>>3){case 1:if(f!==10)break;m.values.push(Gt.unwrap(Gt.decode(u,u.uint32())));continue}if((f&7)===4||f===0)break;u.skipType(f&7)}return m}e.decode=s;function t(o){return{values:Array.isArray(o?.values)?[...o.values]:[]}}e.fromJSON=t;function a(o){let i={};return o.values?i.values=o.values.map(u=>u):i.values=[],i}e.toJSON=a;function r(o){let i=bl();return i.values=o??[],i}e.wrap=r;function c(o){return o?.hasOwnProperty("values")&&Array.isArray(o.values)?o.values:o}e.unwrap=c})(Ar||(Ar={}));var El=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global;throw"Unable to locate global object"})();function yh(e){return typeof e=="object"&&e!==null}function fo(e){return e!=null}function vh(){return{data:void 0}}var lo;(function(e){function n(r,c=gn.default.Writer.create()){switch(r.data?.$case){case"json":Gt.encode(Gt.wrap(r.data.json),c.uint32(10).fork()).ldelim();break;case"binary":c.uint32(18).bytes(r.data.binary);break}return c}e.encode=n;function s(r,c){let o=r instanceof gn.default.Reader?r:gn.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=vh();for(;o.pos<i;){let p=o.uint32();switch(p>>>3){case 1:if(p!==10)break;u.data={$case:"json",json:Gt.unwrap(Gt.decode(o,o.uint32()))};continue;case 2:if(p!==18)break;u.data={$case:"binary",binary:o.bytes()};continue}if((p&7)===4||p===0)break;o.skipType(p&7)}return u}e.decode=s;function t(r){return{data:Bo(r.json)?{$case:"json",json:r.json}:Bo(r.binary)?{$case:"binary",binary:gh(r.binary)}:void 0}}e.fromJSON=t;function a(r){let c={};return r.data?.$case==="json"&&(c.json=r.data?.json),r.data?.$case==="binary"&&(c.binary=r.data?.binary!==void 0?wh(r.data?.binary):void 0),c}e.toJSON=a})(lo||(lo={}));function xh(){return{name:"",jsonSchema:void 0,data:new Map}}var _r;(function(e){function n(r,c=gn.default.Writer.create()){return r.name!==""&&c.uint32(10).string(r.name),r.jsonSchema!==void 0&&Gt.encode(Gt.wrap(r.jsonSchema),c.uint32(18).fork()).ldelim(),r.data.forEach((o,i)=>{Ca.encode({key:i,value:o},c.uint32(26).fork()).ldelim()}),c}e.encode=n;function s(r,c){let o=r instanceof gn.default.Reader?r:gn.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=xh();for(;o.pos<i;){let p=o.uint32();switch(p>>>3){case 1:if(p!==10)break;u.name=o.string();continue;case 2:if(p!==18)break;u.jsonSchema=Gt.unwrap(Gt.decode(o,o.uint32()));continue;case 3:if(p!==26)break;let m=Ca.decode(o,o.uint32());m.value!==void 0&&u.data.set(m.key,m.value);continue}if((p&7)===4||p===0)break;o.skipType(p&7)}return u}e.decode=s;function t(r){return{name:Bo(r.name)?String(r.name):"",jsonSchema:Bo(r?.jsonSchema)?r.jsonSchema:void 0,data:Sh(r.data)?Object.entries(r.data).reduce((c,[o,i])=>(c.set(Number(o),lo.fromJSON(i)),c),new Map):new Map}}e.fromJSON=t;function a(r){let c={};return r.name!==void 0&&(c.name=r.name),r.jsonSchema!==void 0&&(c.jsonSchema=r.jsonSchema),c.data={},r.data&&r.data.forEach((o,i)=>{c.data[i]=lo.toJSON(o)}),c}e.toJSON=a})(_r||(_r={}));function bh(){return{key:0,value:void 0}}var Ca;(function(e){function n(r,c=gn.default.Writer.create()){return r.key!==0&&c.uint32(8).int32(r.key),r.value!==void 0&&lo.encode(r.value,c.uint32(18).fork()).ldelim(),c}e.encode=n;function s(r,c){let o=r instanceof gn.default.Reader?r:gn.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=bh();for(;o.pos<i;){let p=o.uint32();switch(p>>>3){case 1:if(p!==8)break;u.key=o.int32();continue;case 2:if(p!==18)break;u.value=lo.decode(o,o.uint32());continue}if((p&7)===4||p===0)break;o.skipType(p&7)}return u}e.decode=s;function t(r){return{key:Bo(r.key)?Number(r.key):0,value:Bo(r.value)?lo.fromJSON(r.value):void 0}}e.fromJSON=t;function a(r){let c={};return r.key!==void 0&&(c.key=Math.round(r.key)),r.value!==void 0&&(c.value=r.value?lo.toJSON(r.value):void 0),c}e.toJSON=a})(Ca||(Ca={}));function Eh(){return{version:0,components:[]}}var Co;(function(e){function n(r,c=gn.default.Writer.create()){r.version!==0&&c.uint32(8).int32(r.version);for(let o of r.components)_r.encode(o,c.uint32(18).fork()).ldelim();return c}e.encode=n;function s(r,c){let o=r instanceof gn.default.Reader?r:gn.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=Eh();for(;o.pos<i;){let p=o.uint32();switch(p>>>3){case 1:if(p!==8)break;u.version=o.int32();continue;case 2:if(p!==18)break;u.components.push(_r.decode(o,o.uint32()));continue}if((p&7)===4||p===0)break;o.skipType(p&7)}return u}e.decode=s;function t(r){return{version:Bo(r.version)?Number(r.version):0,components:Array.isArray(r?.components)?r.components.map(c=>_r.fromJSON(c)):[]}}e.fromJSON=t;function a(r){let c={};return r.version!==void 0&&(c.version=Math.round(r.version)),r.components?c.components=r.components.map(o=>o?_r.toJSON(o):void 0):c.components=[],c}e.toJSON=a})(Co||(Co={}));var Rr=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global;throw"Unable to locate global object"})();function gh(e){if(Rr.Buffer)return Uint8Array.from(Rr.Buffer.from(e,"base64"));{let n=Rr.atob(e),s=new Uint8Array(n.length);for(let t=0;t<n.length;++t)s[t]=n.charCodeAt(t);return s}}function wh(e){if(Rr.Buffer)return Rr.Buffer.from(e).toString("base64");{let n=[];return e.forEach(s=>{n.push(String.fromCharCode(s))}),Rr.btoa(n.join(""))}}function Sh(e){return typeof e=="object"&&e!==null}function Bo(e){return e!=null}var po;(function(e){function n(o){return Co.fromJSON(o)}e.fromJson=n;function s(o){return Co.decode(o)}e.fromBinary=s;function t(o){return Co.toJSON(o)}e.toJson=t;function a(o){return Co.encode(o).finish()}e.toBinary=a;function r(o,i,u,p={}){ks(o,i,u,p)}e.instance=r;function c(o,i="/"){return Ra(o,i)}e.resolveAndNormalizePath=c})(po||(po={}));var De=_o(we),gl=Df(we),Rn=Vf(we),Gn=Wf(we);var w3=Sa(we);var ho=.45454545454545453,mo=2.2,wl=1e-6,Kr=Math.PI/180,ei=360/(Math.PI*2);var dt;(function(e){e.TwoPi=Math.PI*2;function n(A,P,M=1401298e-51){let W=A-P;return-M<=W&&W<=M}e.withinEpsilon=n;function s(A){let P=A.toString(16);return A<=15?("0"+P).toUpperCase():P.toUpperCase()}e.toHex=s;function t(A){let P=+A;return P===0||isNaN(P)?P:P>0?1:-1}e.sign=t;function a(A,P=0,M=1){return Math.min(M,Math.max(P,A))}e.clamp=a;function r(A){return Math.log(A)*Math.LOG2E}e.log2=r;function c(A,P){return A-Math.floor(A/P)*P}e.repeat=c;function o(A,P,M){return(A-P)/(M-P)}e.normalize=o;function i(A,P,M){return A*(M-P)+P}e.denormalize=i;function u(A,P){let M=c(P-A,360);return M>180&&(M-=360),M}e.deltaAngle=u;function p(A,P){let M=c(A,P*2);return P-Math.abs(M-P)}e.pingPong=p;function m(A,P,M){let W=a(M);return W=-2*W*W*W+3*W*W,P*W+A*(1-W)}e.smoothStep=m;function f(A,P,M){let W=0;return Math.abs(P-A)<=M?W=P:W=A+t(P-A)*M,W}e.moveTowards=f;function y(A,P,M){let W=u(A,P),$=0;return-M<W&&W<M?$=P:$=f(A,A+W,M),$}e.moveTowardsAngle=y;function l(A,P,M){return A+(P-A)*M}e.lerp=l;function d(A,P,M){let W=c(P-A,360);return W>180&&(W-=360),A+W*a(M)}e.lerpAngle=d;function v(A,P,M){let W=0;return A!==P?W=a((M-A)/(P-A)):W=0,W}e.inverseLerp=v;function h(A,P,M,W,$){let E=$*$,_=$*E,O=2*_-3*E+1,V=-2*_+3*E,D=_-2*E+$,J=_-E;return A*O+M*V+P*D+W*J}e.hermite=h;function x(A,P){return A===P?A:Math.random()*(P-A)+A}e.randomRange=x;function w(A,P,M){return(A-P)/(M-P)}e.rangeToPercent=w;function k(A,P,M){return(M-P)*A+P}e.percentToRange=k;function N(A){return A-e.TwoPi*Math.floor((A+Math.PI)/e.TwoPi)}e.normalizeRadians=N})(dt||(dt={}));var X;(function(e){function n(I){let G=Math.abs(I.x),Q=Math.abs(I.y);if(G!==Q)return!0;let ge=Math.abs(I.z);return G!==ge}e.isNonUniform=n;function s(I=0,G=0,Q=0){return{x:I,y:G,z:Q}}e.create=s;function t(I,G){return{x:I.x+G.x,y:I.y+G.y,z:I.z+G.z}}e.add=t;function a(I,G,Q){Q.x=I.x+G.x,Q.y=I.y+G.y,Q.z=I.z+G.z}e.addToRef=a;function r(I,G){return{x:I.x-G.x,y:I.y-G.y,z:I.z-G.z}}e.subtract=r;function c(I,G,Q){Q.x=I.x-G.x,Q.y=I.y-G.y,Q.z=I.z-G.z}e.subtractToRef=c;function o(I,G,Q,ge,be){be.x=I.x-G,be.y=I.y-Q,be.z=I.z-ge}e.subtractFromFloatsToRef=o;function i(I){return{x:-I.x,y:-I.y,z:-I.z}}e.negate=i;function u(I,G){G.x=I.x,G.y=I.y,G.z=I.z}e.copyFrom=u;function p(I,G,Q,ge){ge.x=I,ge.y=G,ge.z=Q}e.copyFromFloats=p;function m(I){return s(I.x,I.y,I.z)}e.clone=m;function f(I,G,Q,ge){let be=$(I,Q)-ge,Ne=$(G,Q)-ge;return be/(be-Ne)}e.getClipFactor=f;function y(I,G,Q){let ge=M(I),be=M(G),Ne=$(ge,be),Ce=s();return K(ge,be,Ce),$(Ce,Q)>0?Math.acos(Ne):-Math.acos(Ne)}e.getAngleBetweenVectors=y;function l(I,G=0){return s(I[G],I[G+1],I[G+2])}e.fromArray=l;function d(I,G){return l(I,G)}e.fromFloatArray=d;function v(I,G,Q){Q.x=I[G],Q.y=I[G+1],Q.z=I[G+2]}e.fromArrayToRef=v;function h(I,G,Q){return v(I,G,Q)}e.fromFloatArrayToRef=h;function x(I){return Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z)}e.length=x;function w(I){return I.x*I.x+I.y*I.y+I.z*I.z}e.lengthSquared=w;function k(I,G,Q){Q.x=I.x*G,Q.y=I.y*G,Q.z=I.z*G}e.scaleToRef=k;function N(I,G){return s(I.x*G,I.y*G,I.z*G)}e.scale=N;function A(I,G){let Q=s(0,0,0);return P(I,G,Q),Q}e.normalizeFromLength=A;function P(I,G,Q){if(G===0||G===1){u(I,Q);return}k(I,1/G,Q)}e.normalizeFromLengthToRef=P;function M(I){return A(I,x(I))}e.normalize=M;function W(I,G){P(I,x(I),G)}e.normalizeToRef=W;function $(I,G){return I.x*G.x+I.y*G.y+I.z*G.z}e.dot=$;function E(I,G){let Q=m(I);return _(I,G,Q),Q}e.applyMatrix4=E;function _(I,G,Q){let{x:ge,y:be,z:Ne}=I,Ce=G._m,ut=1/(Ce[3]*ge+Ce[7]*be+Ce[11]*Ne+Ce[15]);Q.x=(Ce[0]*ge+Ce[4]*be+Ce[8]*Ne+Ce[12])*ut,Q.y=(Ce[1]*ge+Ce[5]*be+Ce[9]*Ne+Ce[13])*ut,Q.z=(Ce[2]*ge+Ce[6]*be+Ce[10]*Ne+Ce[14])*ut}e.applyMatrix4ToRef=_;function O(I,G){let Q=s();return V(I,G,Q),Q}e.rotate=O;function V(I,G,Q){let{x:ge,y:be,z:Ne}=I,{x:Ce,y:ut,z:At,w:ct}=G,en=ct*ge+ut*Ne-At*be,un=ct*be+At*ge-Ce*Ne,mn=ct*Ne+Ce*be-ut*ge,Cn=-Ce*ge-ut*be-At*Ne;Q.x=en*ct+Cn*-Ce+un*-At-mn*-ut,Q.y=un*ct+Cn*-ut+mn*-Ce-en*-At,Q.z=mn*ct+Cn*-At+en*-ut-un*-Ce}e.rotateToRef=V;function D(I,G,Q){let ge=s(0,0,0);return J(I,G,Q,ge),ge}e.lerp=D;function J(I,G,Q,ge){ge.x=I.x+(G.x-I.x)*Q,ge.y=I.y+(G.y-I.y)*Q,ge.z=I.z+(G.z-I.z)*Q}e.lerpToRef=J;function ee(I,G){let Q=wt();return K(I,G,Q),Q}e.cross=ee;function K(I,G,Q){Q.x=I.y*G.z-I.z*G.y,Q.y=I.z*G.x-I.x*G.z,Q.z=I.x*G.y-I.y*G.x}e.crossToRef=K;function de(I,G){let Q=wt();return _e(I,G,Q),Q}e.transformCoordinates=de;function _e(I,G,Q){return ze(I.x,I.y,I.z,G,Q)}e.transformCoordinatesToRef=_e;function ze(I,G,Q,ge,be){let Ne=ge._m,Ce=I*Ne[0]+G*Ne[4]+Q*Ne[8]+Ne[12],ut=I*Ne[1]+G*Ne[5]+Q*Ne[9]+Ne[13],At=I*Ne[2]+G*Ne[6]+Q*Ne[10]+Ne[14],ct=1/(I*Ne[3]+G*Ne[7]+Q*Ne[11]+Ne[15]);be.x=Ce*ct,be.y=ut*ct,be.z=At*ct}e.transformCoordinatesFromFloatsToRef=ze;function Oe(I,G){let Q=wt();return je(I,G,Q),Q}e.transformNormal=Oe;function je(I,G,Q){Pe(I.x,I.y,I.z,G,Q)}e.transformNormalToRef=je;function Pe(I,G,Q,ge,be){let Ne=ge._m;be.x=I*Ne[0]+G*Ne[4]+Q*Ne[8],be.y=I*Ne[1]+G*Ne[5]+Q*Ne[9],be.z=I*Ne[2]+G*Ne[6]+Q*Ne[10]}e.transformNormalFromFloatsToRef=Pe;function q(I,G,Q,ge,be){let Ne=be*be,Ce=be*Ne,ut=.5*(2*G.x+(-I.x+Q.x)*be+(2*I.x-5*G.x+4*Q.x-ge.x)*Ne+(-I.x+3*G.x-3*Q.x+ge.x)*Ce),At=.5*(2*G.y+(-I.y+Q.y)*be+(2*I.y-5*G.y+4*Q.y-ge.y)*Ne+(-I.y+3*G.y-3*Q.y+ge.y)*Ce),ct=.5*(2*G.z+(-I.z+Q.z)*be+(2*I.z-5*G.z+4*Q.z-ge.z)*Ne+(-I.z+3*G.z-3*Q.z+ge.z)*Ce);return s(ut,At,ct)}e.catmullRom=q;function R(I,G,Q){let ge=s();return F(I,G,Q,ge),ge}e.clamp=R;function F(I,G,Q,ge){let be=I.x;be=be>Q.x?Q.x:be,be=be<G.x?G.x:be;let Ne=I.y;Ne=Ne>Q.y?Q.y:Ne,Ne=Ne<G.y?G.y:Ne;let Ce=I.z;Ce=Ce>Q.z?Q.z:Ce,Ce=Ce<G.z?G.z:Ce,p(be,Ne,Ce,ge)}e.clampToRef=F;function Z(I,G,Q,ge,be){let Ne=be*be,Ce=be*Ne,ut=2*Ce-3*Ne+1,At=-2*Ce+3*Ne,ct=Ce-2*Ne+be,en=Ce-Ne,un=I.x*ut+Q.x*At+G.x*ct+ge.x*en,mn=I.y*ut+Q.y*At+G.y*ct+ge.y*en,Cn=I.z*ut+Q.z*At+G.z*ct+ge.z*en;return s(un,mn,Cn)}e.hermite=Z;function T(I,G){let Q=s();return et(G,I.x,I.y,I.z,Q),Q}e.minimize=T;function L(I,G){let Q=s();return Ge(I,G.x,G.y,G.z,Q),Q}e.maximize=L;function re(I,G){return Math.sqrt(ye(I,G))}e.distance=re;function ye(I,G){let Q=I.x-G.x,ge=I.y-G.y,be=I.z-G.z;return Q*Q+ge*ge+be*be}e.distanceSquared=ye;function Y(I,G){let Q=t(I,G);return k(Q,.5,Q),Q}e.center=Y;function C(I,G,Q){let ge=wt();return te(I,G,Q,ge),ge}e.rotationFromAxis=C;function te(I,G,Q,ge){let be=We.create();We.fromAxisToRotationQuaternionToRef(I,G,Q,be),u(We.toEulerAngles(be),ge)}e.rotationFromAxisToRef=te;function se(I){return`(${I.x}, ${I.y}, ${I.z})`}e.toString=se;function le(I){let G=I.x||0;return G=G*397^(I.y||0),G=G*397^(I.z||0),G}e.getHashCode=le;function pe(I,G){return I.x===G.x&&I.y===G.y&&I.z===G.z}e.equals=pe;function ve(I,G,Q=wl){return dt.withinEpsilon(I.x,G.x,Q)&&dt.withinEpsilon(I.y,G.y,Q)&&dt.withinEpsilon(I.z,G.z,Q)}e.equalsWithEpsilon=ve;function xe(I,G,Q,ge){return I.x===G&&I.y===Q&&I.z===ge}e.equalsToFloats=xe;function Se(I,G){let Q=s();return Re(I,G,Q),Q}e.multiply=Se;function Re(I,G,Q){Q.x=I.x*G.x,Q.y=I.y*G.y,Q.z=I.z*G.z}e.multiplyToRef=Re;function Fe(I,G,Q,ge,be){be.x=I.x*G,be.y=I.y*Q,be.z=I.z*ge}e.multiplyByFloatsToRef=Fe;function Me(I,G,Q,ge){let be=s();return Fe(I,G,Q,ge,be),be}e.multiplyByFloats=Me;function Te(I,G){return{x:I.x/G.x,y:I.y/G.y,z:I.z/G.z}}e.divide=Te;function Xe(I,G,Q){Q.x=I.x/G.x,Q.y=I.y/G.y,Q.z=I.z/G.z}e.divideToRef=Xe;function Ge(I,G,Q,ge,be){G>I.x?be.x=G:be.x=I.x,Q>I.y?be.y=Q:be.y=I.y,ge>I.z?be.z=ge:be.z=I.z}e.maximizeInPlaceFromFloatsToRef=Ge;function et(I,G,Q,ge,be){G<I.x?be.x=G:be.x=I.x,Q<I.y?be.y=Q:be.y=I.y,ge<I.z?be.z=ge:be.z=I.z}e.minimizeInPlaceFromFloatsToRef=et;function nt(I){return s(Math.floor(I.x),Math.floor(I.y),Math.floor(I.z))}e.floor=nt;function yt(I){return s(I.x-Math.floor(I.x),I.y-Math.floor(I.y),I.z-Math.floor(I.z))}e.fract=yt;function wt(){return s(0,0,0)}e.Zero=wt;function mt(){return s(1,1,1)}e.One=mt;function Dt(){return s(0,1,0)}e.Up=Dt;function Ie(){return s(0,-1,0)}e.Down=Ie;function Le(){return s(0,0,1)}e.Forward=Le;function Pt(){return s(0,0,-1)}e.Backward=Pt;function Kt(){return s(1,0,0)}e.Right=Kt;function qt(){return s(-1,0,0)}e.Left=qt;function ot(){return s(Math.random(),Math.random(),Math.random())}e.Random=ot})(X||(X={}));var Ba;(function(e){function n(d,v,h,x){return{normal:X.create(d,v,h),d:x}}e.create=n;function s(d){return n(d[0],d[1],d[2],d[3])}e.fromArray=s;function t(d,v,h){return n(0,0,0,0)}e.fromPoints=t;function a(d,v){let h=n(0,0,0,0);return h.normal=X.normalize(v),h.d=-(v.x*d.x+v.y*d.y+v.z*d.z),h}e.romPositionAndNormal=a;function r(d,v,h){let x=-(v.x*d.x+v.y*d.y+v.z*d.z);return X.dot(h,v)+x}e.signedDistanceToPlaneFromPositionAndNormal=r;function c(d){return[d.normal.x,d.normal.y,d.normal.z,d.d]}e.asArray=c;function o(d){return n(d.normal.x,d.normal.y,d.normal.z,d.d)}e.clone=o;function i(d){return 0}e.getHashCode=i;function u(d){let v=n(0,0,0,0),h=Math.sqrt(d.normal.x*d.normal.x+d.normal.y*d.normal.y+d.normal.z*d.normal.z),x=0;return h!==0&&(x=1/h),v.normal.x=d.normal.x*x,v.normal.y=d.normal.y*x,v.normal.z=d.normal.z*x,v.d*=x,d}e.normalize=u;function p(d,v){let h=zn.create();zn.transposeToRef(v,h);let x=h._m,w=d.normal.x,k=d.normal.y,N=d.normal.z,A=d.d,P=w*x[0]+k*x[1]+N*x[2]+A*x[3],M=w*x[4]+k*x[5]+N*x[6]+A*x[7],W=w*x[8]+k*x[9]+N*x[10]+A*x[11],$=w*x[12]+k*x[13]+N*x[14]+A*x[15];return n(P,M,W,$)}e.transform=p;function m(d,v){return d.normal.x*v.x+d.normal.y*v.y+d.normal.z*v.z+d.d}e.dotCoordinate=m;function f(d,v,h){let x=v.x-d.x,w=v.y-d.y,k=v.z-d.z,N=h.x-d.x,A=h.y-d.y,P=h.z-d.z,M=w*P-k*A,W=k*N-x*P,$=x*A-w*N,E=Math.sqrt(M*M+W*W+$*$),_;E!==0?_=1/E:_=0;let O=X.create(M*_,W*_,$*_);return{normal:O,d:-(O.x*d.x+O.y*d.y+O.z*d.z)}}e.copyFromPoints=f;function y(d,v,h){return X.dot(d.normal,v)<=h}e.isFrontFacingTo=y;function l(d,v){return X.dot(v,d.normal)+d.d}e.signedDistanceTo=l})(Ba||(Ba={}));var zn;(function(e){function n(b){return b._m}e.m=n;let s=0,t={};function a(){return t}e.IdentityReadonly=a;function r(){let b={updateFlag:0,isIdentity:!1,isIdentity3x2:!0,_isIdentityDirty:!0,_isIdentity3x2Dirty:!0,_m:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};return oe(b,!1),b}e.create=r;function c(b,g=0){let S=r();return o(b,g,S),S}e.fromArray=c;function o(b,g,S){for(let B=0;B<16;B++)S._m[B]=b[B+g];Re(S)}e.fromArrayToRef=o;function i(b,g,S,B){for(let z=0;z<16;z++)B._m[z]=b[z+g]*S;Re(B)}e.fromFloatArrayToRefScaled=i;function u(b,g,S,B,z,j,H,U,ne,fe,he,me,ae,ue,Ae,Ue,Be){let ie=Be._m;ie[0]=b,ie[1]=g,ie[2]=S,ie[3]=B,ie[4]=z,ie[5]=j,ie[6]=H,ie[7]=U,ie[8]=ne,ie[9]=fe,ie[10]=he,ie[11]=me,ie[12]=ae,ie[13]=ue,ie[14]=Ae,ie[15]=Ue,Re(Be)}e.fromValuesToRef=u;function p(b,g,S,B,z,j,H,U,ne,fe,he,me,ae,ue,Ae,Ue){let Be=r(),ie=Be._m;return ie[0]=b,ie[1]=g,ie[2]=S,ie[3]=B,ie[4]=z,ie[5]=j,ie[6]=H,ie[7]=U,ie[8]=ne,ie[9]=fe,ie[10]=he,ie[11]=me,ie[12]=ae,ie[13]=ue,ie[14]=Ae,ie[15]=Ue,Re(Be),Be}e.fromValues=p;function m(b,g,S){let B=r();return f(b,g,S,B),B}e.compose=m;function f(b,g,S,B){let z=[r(),r(),r()];E(b.x,b.y,b.z,z[1]),Se(g,z[0]),be(z[1],z[0],B),Kt(B,S)}e.composeToRef=f;function y(){let b=p(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return oe(b,!0),b}e.Identity=y;function l(b){u(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,b),oe(b,!0)}e.IdentityToRef=l;function d(){let b=p(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return oe(b,!1),b}e.Zero=d;function v(b){let g=r();return h(b,g),g}e.RotationX=v;function h(b,g){let S=Math.sin(b),B=Math.cos(b);u(1,0,0,0,0,B,S,0,0,-S,B,0,0,0,0,1,g),oe(g,B===1&&S===0)}e.rotationXToRef=h;function x(b){let g=r();return w(b,g),g}e.rotationY=x;function w(b,g){let S=Math.sin(b),B=Math.cos(b);u(B,0,-S,0,0,1,0,0,S,0,B,0,0,0,0,1,g),oe(g,B===1&&S===0)}e.rotationYToRef=w;function k(b){let g=r();return N(b,g),g}e.rotationZ=k;function N(b,g){let S=Math.sin(b),B=Math.cos(b);u(B,S,0,0,-S,B,0,0,0,0,1,0,0,0,0,1,g),oe(g,B===1&&S===0)}e.rotationZToRef=N;function A(b,g){let S=r();return P(b,g,S),S}e.rotationAxis=A;function P(b,g,S){let B=Math.sin(-g),z=Math.cos(-g),j=1-z,H=X.normalize(b),U=S._m;U[0]=H.x*H.x*j+z,U[1]=H.x*H.y*j-H.z*B,U[2]=H.x*H.z*j+H.y*B,U[3]=0,U[4]=H.y*H.x*j+H.z*B,U[5]=H.y*H.y*j+z,U[6]=H.y*H.z*j-H.x*B,U[7]=0,U[8]=H.z*H.x*j-H.y*B,U[9]=H.z*H.y*j+H.x*B,U[10]=H.z*H.z*j+z,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,Re(S)}e.rotationAxisToRef=P;function M(b,g,S){let B=r();return W(b,g,S,B),B}e.rotationYawPitchRoll=M;function W(b,g,S,B){let z=We.Zero();We.fromRotationYawPitchRollToRef(b,g,S,z),Se(z,B)}e.rotationYawPitchRollToRef=W;function $(b,g,S){let B=r();return E(b,g,S,B),B}e.scaling=$;function E(b,g,S,B){u(b,0,0,0,0,g,0,0,0,0,S,0,0,0,0,1,B),oe(B,b===1&&g===1&&S===1)}e.scalingToRef=E;function _(b,g,S){let B=r();return O(b,g,S,B),B}e.translation=_;function O(b,g,S,B){u(1,0,0,0,0,1,0,0,0,0,1,0,b,g,S,1,B),oe(B,b===0&&g===0&&S===0)}e.translationToRef=O;function V(b,g,S){let B=r();return D(b,g,S,B),B}e.lerp=V;function D(b,g,S,B){for(let z=0;z<16;z++)B._m[z]=b._m[z]*(1-S)+g._m[z]*S;Re(B)}e.lerpToRef=D;function J(b,g,S){let B=r();return ee(b,g,S,B),B}e.decomposeLerp=J;function ee(b,g,S,B){let z=X.Zero(),j=We.Zero(),H=X.Zero();ct(b,z,j,H);let U=X.Zero(),ne=We.Zero(),fe=X.Zero();ct(g,U,ne,fe);let he=X.Zero();X.lerpToRef(z,U,S,he);let me=We.Zero();We.slerpToRef(j,ne,S,me);let ae=X.Zero();X.lerpToRef(H,fe,S,ae),f(he,me,ae,B)}e.decomposeLerpToRef=ee;function K(b,g,S){let B=r();return de(b,g,S,B),B}e.LookAtLH=K;function de(b,g,S,B){let z=X.Zero(),j=X.Zero(),H=X.Zero();X.subtractToRef(g,b,H),X.normalizeToRef(H,H),X.crossToRef(S,H,z);let U=X.lengthSquared(z);U===0?z.x=1:X.normalizeFromLengthToRef(z,Math.sqrt(U),z),X.crossToRef(H,z,j),X.normalizeToRef(j,j);let ne=-X.dot(z,b),fe=-X.dot(j,b),he=-X.dot(H,b);u(z.x,j.x,H.x,0,z.y,j.y,H.y,0,z.z,j.z,H.z,0,ne,fe,he,1,B)}e.lookAtLHToRef=de;function _e(b,g,S){let B=r();return ze(b,g,S,B),B}e.lookAtRH=_e;function ze(b,g,S,B){let z=X.Zero(),j=X.Zero(),H=X.Zero();X.subtractToRef(b,g,H),X.normalizeToRef(H,H),X.crossToRef(S,H,z);let U=X.lengthSquared(z);U===0?z.x=1:X.normalizeFromLengthToRef(z,Math.sqrt(U),z),X.crossToRef(H,z,j),X.normalizeToRef(j,j);let ne=-X.dot(z,b),fe=-X.dot(j,b),he=-X.dot(H,b);u(z.x,j.x,H.x,0,z.y,j.y,H.y,0,z.z,j.z,H.z,0,ne,fe,he,1,B)}e.lookAtRHToRef=ze;function Oe(b,g,S,B){let z=r();return je(b,g,S,B,z),z}e.orthoLH=Oe;function je(b,g,S,B,z){let j=S,H=B,U=2/b,ne=2/g,fe=2/(H-j),he=-(H+j)/(H-j);u(U,0,0,0,0,ne,0,0,0,0,fe,0,0,0,he,1,z),oe(z,U===1&&ne===1&&fe===1&&he===0)}e.orthoLHToRef=je;function Pe(b,g,S,B,z,j){let H=r();return q(b,g,S,B,z,j,H),H}e.OrthoOffCenterLH=Pe;function q(b,g,S,B,z,j,H){let U=z,ne=j,fe=2/(g-b),he=2/(B-S),me=2/(ne-U),ae=-(ne+U)/(ne-U),ue=(b+g)/(b-g),Ae=(B+S)/(S-B);u(fe,0,0,0,0,he,0,0,0,0,me,0,ue,Ae,ae,1,H),Re(H)}e.orthoOffCenterLHToRef=q;function R(b,g,S,B,z,j){let H=r();return F(b,g,S,B,z,j,H),H}e.orthoOffCenterRH=R;function F(b,g,S,B,z,j,H){q(b,g,S,B,z,j,H),H._m[10]*=-1}e.orthoOffCenterRHToRef=F;function Z(b,g,S,B){let z=r(),j=S,H=B,U=2*j/b,ne=2*j/g,fe=(H+j)/(H-j),he=-2*H*j/(H-j);return u(U,0,0,0,0,ne,0,0,0,0,fe,1,0,0,he,0,z),oe(z,!1),z}e.perspectiveLH=Z;function T(b,g,S,B){let z=r();return L(b,g,S,B,z),z}e.perspectiveFovLH=T;function L(b,g,S,B,z,j=!0){let H=S,U=B,ne=1/Math.tan(b*.5),fe=j?ne/g:ne,he=j?ne:ne*g,me=(U+H)/(U-H),ae=-2*U*H/(U-H);u(fe,0,0,0,0,he,0,0,0,0,me,1,0,0,ae,0,z),oe(z,!1)}e.perspectiveFovLHToRef=L;function re(b,g,S,B){let z=r();return ye(b,g,S,B,z),z}e.PerspectiveFovRH=re;function ye(b,g,S,B,z,j=!0){let H=S,U=B,ne=1/Math.tan(b*.5),fe=j?ne/g:ne,he=j?ne:ne*g,me=-(U+H)/(U-H),ae=-2*U*H/(U-H);u(fe,0,0,0,0,he,0,0,0,0,me,-1,0,0,ae,0,z),oe(z,!1)}e.perspectiveFovRHToRef=ye;function Y(b,g,S,B,z=!1){let j=z?-1:1,H=Math.tan(b.upDegrees*Math.PI/180),U=Math.tan(b.downDegrees*Math.PI/180),ne=Math.tan(b.leftDegrees*Math.PI/180),fe=Math.tan(b.rightDegrees*Math.PI/180),he=2/(ne+fe),me=2/(H+U),ae=B._m;ae[0]=he,ae[1]=ae[2]=ae[3]=ae[4]=0,ae[5]=me,ae[6]=ae[7]=0,ae[8]=(ne-fe)*he*.5,ae[9]=-((H-U)*me*.5),ae[10]=-S/(g-S),ae[11]=1*j,ae[12]=ae[13]=ae[15]=0,ae[14]=-(2*S*g)/(S-g),Re(B)}e.perspectiveFovWebVRToRef=Y;function C(b){return[b._m[0],b._m[1],b._m[4],b._m[5]]}e.GetAsMatrix2x2=C;function te(b){return[b._m[0],b._m[1],b._m[2],b._m[4],b._m[5],b._m[6],b._m[8],b._m[9],b._m[10]]}e.GetAsMatrix3x3=te;function se(b){let g=r();return le(b,g),g}e.transpose=se;function le(b,g){let S=g._m,B=b._m;S[0]=B[0],S[1]=B[4],S[2]=B[8],S[3]=B[12],S[4]=B[1],S[5]=B[5],S[6]=B[9],S[7]=B[13],S[8]=B[2],S[9]=B[6],S[10]=B[10],S[11]=B[14],S[12]=B[3],S[13]=B[7],S[14]=B[11],S[15]=B[15],oe(g,b.isIdentity,b._isIdentityDirty)}e.transposeToRef=le;function pe(b){let g=r();return ve(b,g),g}e.reflection=pe;function ve(b,g){let S=Ba.normalize(b),B=S.normal.x,z=S.normal.y,j=S.normal.z,H=-2*B,U=-2*z,ne=-2*j;u(H*B+1,U*B,ne*B,0,H*z,U*z+1,ne*z,0,H*j,U*j,ne*j+1,0,H*S.d,U*S.d,ne*S.d,1,g)}e.reflectionToRef=ve;function xe(b,g,S,B){u(b.x,b.y,b.z,0,g.x,g.y,g.z,0,S.x,S.y,S.z,0,0,0,0,1,B)}e.fromXYZAxesToRef=xe;function Se(b,g){let S=b.x*b.x,B=b.y*b.y,z=b.z*b.z,j=b.x*b.y,H=b.z*b.w,U=b.z*b.x,ne=b.y*b.w,fe=b.y*b.z,he=b.x*b.w;g._m[0]=1-2*(B+z),g._m[1]=2*(j+H),g._m[2]=2*(U-ne),g._m[3]=0,g._m[4]=2*(j-H),g._m[5]=1-2*(z+S),g._m[6]=2*(fe+he),g._m[7]=0,g._m[8]=2*(U+ne),g._m[9]=2*(fe-he),g._m[10]=1-2*(B+S),g._m[11]=0,g._m[12]=0,g._m[13]=0,g._m[14]=0,g._m[15]=1,Re(g)}e.fromQuaternionToRef=Se;function Re(b){b.updateFlag=s++,b.isIdentity=!1,b.isIdentity3x2=!1,b._isIdentityDirty=!0,b._isIdentity3x2Dirty=!0}function Fe(b){if(b._isIdentityDirty){b._isIdentityDirty=!1;let g=b._m;b.isIdentity=g[0]===1&&g[1]===0&&g[2]===0&&g[3]===0&&g[4]===0&&g[5]===1&&g[6]===0&&g[7]===0&&g[8]===0&&g[9]===0&&g[10]===1&&g[11]===0&&g[12]===0&&g[13]===0&&g[14]===0&&g[15]===1}return b.isIdentity}e.isIdentityUpdate=Fe;function Me(b){return b._isIdentity3x2Dirty&&(b._isIdentity3x2Dirty=!1,b._m[0]!==1||b._m[5]!==1||b._m[15]!==1||b._m[1]!==0||b._m[2]!==0||b._m[3]!==0||b._m[4]!==0||b._m[6]!==0||b._m[7]!==0||b._m[8]!==0||b._m[9]!==0||b._m[10]!==0||b._m[11]!==0||b._m[12]!==0||b._m[13]!==0||b._m[14]!==0?b.isIdentity3x2=!1:b.isIdentity3x2=!0),b.isIdentity3x2}e.isIdentityAs3x2Update=Me;function Te(b){if(b.isIdentity===!0)return 1;let g=b._m,S=g[0],B=g[1],z=g[2],j=g[3],H=g[4],U=g[5],ne=g[6],fe=g[7],he=g[8],me=g[9],ae=g[10],ue=g[11],Ae=g[12],Ue=g[13],Be=g[14],ie=g[15],Ve=ae*ie-Be*ue,Ke=me*ie-Ue*ue,qe=me*Be-Ue*ae,Ze=he*ie-Ae*ue,ke=he*Be-ae*Ae,xt=he*Ue-Ae*me,_t=+(U*Ve-ne*Ke+fe*qe),Rt=-(H*Ve-ne*Ze+fe*ke),Bt=+(H*Ke-U*Ze+fe*xt),Yt=-(H*qe-U*ke+ne*xt);return S*_t+B*Rt+z*Bt+j*Yt}e.determinant=Te;function Xe(b){return b._m}e.toArray=Xe;function Ge(b){return b._m}e.asArray=Ge;function et(b){u(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b),oe(b,!1)}e.reset=et;function nt(b,g){let S=r();return yt(b,g,S),S}e.add=nt;function yt(b,g,S){for(let B=0;B<16;B++)S._m[B]=b._m[B]+g._m[B];Re(S)}e.addToRef=yt;function wt(b,g){for(let S=0;S<16;S++)b._m[S]+=g._m[S];Re(b)}e.addToSelf=wt;function mt(b){let g=r();return Dt(b,g),g}e.invert=mt;function Dt(b,g){if(b.isIdentity===!0){Q(b,g);return}let S=b._m,B=S[0],z=S[1],j=S[2],H=S[3],U=S[4],ne=S[5],fe=S[6],he=S[7],me=S[8],ae=S[9],ue=S[10],Ae=S[11],Ue=S[12],Be=S[13],ie=S[14],Ve=S[15],Ke=ue*Ve-ie*Ae,qe=ae*Ve-Be*Ae,Ze=ae*ie-Be*ue,ke=me*Ve-Ue*Ae,xt=me*ie-ue*Ue,_t=me*Be-Ue*ae,Rt=+(ne*Ke-fe*qe+he*Ze),Bt=-(U*Ke-fe*ke+he*xt),Yt=+(U*qe-ne*ke+he*_t),It=-(U*Ze-ne*xt+fe*_t),rt=B*Rt+z*Bt+j*Yt+H*It;if(rt===0){Q(b,g);return}let ht=1/rt,ft=fe*Ve-ie*he,Zt=ne*Ve-Be*he,kt=ne*ie-Be*fe,Nt=U*Ve-Ue*he,St=U*ie-Ue*fe,Wt=U*Be-Ue*ne,Qt=fe*Ae-ue*he,Ye=ne*Ae-ae*he,tn=ne*ue-ae*fe,zt=U*Ae-me*he,Ln=U*ue-me*fe,Vn=U*ae-me*ne,Wa=-(z*Ke-j*qe+H*Ze),qa=+(B*Ke-j*ke+H*xt),bt=-(B*qe-z*ke+H*_t),Jl=+(B*Ze-z*xt+j*_t),Kl=+(z*ft-j*Zt+H*kt),ed=-(B*ft-j*Nt+H*St),td=+(B*Zt-z*Nt+H*Wt),nd=-(B*kt-z*St+j*Wt),od=-(z*Qt-j*Ye+H*tn),rd=+(B*Qt-j*zt+H*Ln),id=-(B*Ye-z*zt+H*Vn),ad=+(B*tn-z*Ln+j*Vn);u(Rt*ht,Wa*ht,Kl*ht,od*ht,Bt*ht,qa*ht,ed*ht,rd*ht,Yt*ht,bt*ht,td*ht,id*ht,It*ht,Jl*ht,nd*ht,ad*ht,g)}e.invertToRef=Dt;function Ie(b,g,S){b._m[g]+=S,Re(b)}e.addAtIndex=Ie;function Le(b,g,S){return b._m[g]*=S,Re(b),b}e.multiplyAtIndex=Le;function Pt(b,g,S,B){b._m[12]=g,b._m[13]=S,b._m[14]=B,Re(b)}e.setTranslationFromFloats=Pt;function Kt(b,g){Pt(b,g.x,g.y,g.z)}e.setTranslation=Kt;function qt(b){return X.create(b._m[12],b._m[13],b._m[14])}e.getTranslation=qt;function ot(b,g){g.x=b._m[12],g.y=b._m[13],g.z=b._m[14]}e.getTranslationToRef=ot;function I(b){let g=b._m;return u(1,0,0,0,0,1,0,0,0,0,1,0,g[12],g[13],g[14],g[15],b),oe(b,g[12]===0&&g[13]===0&&g[14]===0&&g[15]===1),b}e.removeRotationAndScaling=I;function G(b,g){let S=r();return be(b,g,S),S}e.multiply=G;function Q(b,g){ge(b,g._m),oe(g,b.isIdentity,b._isIdentityDirty,b.isIdentity3x2,b._isIdentity3x2Dirty)}e.copy=Q;function ge(b,g,S=0){for(let B=0;B<16;B++)g[S+B]=b._m[B]}e.copyToArray=ge;function be(b,g,S){if(b.isIdentity){Q(g,S);return}if(g.isIdentity){Q(b,S);return}Ne(b,g,S._m,0),Re(S)}e.multiplyToRef=be;function Ne(b,g,S,B){let z=b._m,j=g._m,H=z[0],U=z[1],ne=z[2],fe=z[3],he=z[4],me=z[5],ae=z[6],ue=z[7],Ae=z[8],Ue=z[9],Be=z[10],ie=z[11],Ve=z[12],Ke=z[13],qe=z[14],Ze=z[15],ke=j[0],xt=j[1],_t=j[2],Rt=j[3],Bt=j[4],Yt=j[5],It=j[6],rt=j[7],ht=j[8],ft=j[9],Zt=j[10],kt=j[11],Nt=j[12],St=j[13],Wt=j[14],Qt=j[15];S[B]=H*ke+U*Bt+ne*ht+fe*Nt,S[B+1]=H*xt+U*Yt+ne*ft+fe*St,S[B+2]=H*_t+U*It+ne*Zt+fe*Wt,S[B+3]=H*Rt+U*rt+ne*kt+fe*Qt,S[B+4]=he*ke+me*Bt+ae*ht+ue*Nt,S[B+5]=he*xt+me*Yt+ae*ft+ue*St,S[B+6]=he*_t+me*It+ae*Zt+ue*Wt,S[B+7]=he*Rt+me*rt+ae*kt+ue*Qt,S[B+8]=Ae*ke+Ue*Bt+Be*ht+ie*Nt,S[B+9]=Ae*xt+Ue*Yt+Be*ft+ie*St,S[B+10]=Ae*_t+Ue*It+Be*Zt+ie*Wt,S[B+11]=Ae*Rt+Ue*rt+Be*kt+ie*Qt,S[B+12]=Ve*ke+Ke*Bt+qe*ht+Ze*Nt,S[B+13]=Ve*xt+Ke*Yt+qe*ft+Ze*St,S[B+14]=Ve*_t+Ke*It+qe*Zt+Ze*Wt,S[B+15]=Ve*Rt+Ke*rt+qe*kt+Ze*Qt}e.multiplyToArray=Ne;function Ce(b,g){let S=g;if(!S)return!1;if((b.isIdentity||S.isIdentity)&&!b._isIdentityDirty&&!S._isIdentityDirty)return b.isIdentity&&S.isIdentity;let B=b._m,z=S._m;return B[0]===z[0]&&B[1]===z[1]&&B[2]===z[2]&&B[3]===z[3]&&B[4]===z[4]&&B[5]===z[5]&&B[6]===z[6]&&B[7]===z[7]&&B[8]===z[8]&&B[9]===z[9]&&B[10]===z[10]&&B[11]===z[11]&&B[12]===z[12]&&B[13]===z[13]&&B[14]===z[14]&&B[15]===z[15]}e.equals=Ce;function ut(b){let g=r();return Q(b,g),g}e.clone=ut;function At(b){let g=b._m[0]||0;for(let S=1;S<16;S++)g=g*397^(b._m[S]||0);return g}e.getHashCode=At;function ct(b,g,S,B){if(b.isIdentity)return B&&(B.x=0,B.y=0,B.z=0),g&&(g.x=1,g.y=1,g.z=1),S&&(S.w=1,S.x=0,S.y=0,S.z=0),!0;let z=b._m;B&&(B.x=z[12],B.y=z[13],B.z=z[14]);let j=g||X.Zero();if(j.x=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),j.y=Math.sqrt(z[4]*z[4]+z[5]*z[5]+z[6]*z[6]),j.z=Math.sqrt(z[8]*z[8]+z[9]*z[9]+z[10]*z[10]),Te(b)<=0&&(j.y*=-1),j.x===0||j.y===0||j.z===0)return S&&(S.w=1,S.x=0,S.y=0,S.z=0),!1;if(S){let H=1/j.x,U=1/j.y,ne=1/j.z,fe=r();u(z[0]*H,z[1]*H,z[2]*H,0,z[4]*U,z[5]*U,z[6]*U,0,z[8]*ne,z[9]*ne,z[10]*ne,0,0,0,0,1,fe),We.fromRotationMatrixToRef(fe,S)}return!0}e.decompose=ct;function en(b,g,S,B,z,j){if(g<0||g>3)return;let H=g*4;b._m[H+0]=S,b._m[H+1]=B,b._m[H+2]=z,b._m[H+3]=j,Re(b)}e.setRowFromFloats=en;function un(b,g){let S=r();return mn(b,g,S),S}e.scale=un;function mn(b,g,S){for(let B=0;B<16;B++)S._m[B]=b._m[B]*g;Re(S)}e.scaleToRef=mn;function Cn(b,g,S){for(let B=0;B<16;B++)S._m[B]+=b._m[B]*g;Re(S)}e.scaleAndAddToRef=Cn;function Or(b,g){let S=r();Dt(b,S),le(S,g);let B=g._m;u(B[0],B[1],B[2],0,B[4],B[5],B[6],0,B[8],B[9],B[10],0,0,0,0,1,g)}e.normalMatrixToRef=Or;function vo(b){let g=r();return ko(b,g),g}e.getRotationMatrix=vo;function ko(b,g){let S=X.Zero();if(!ct(b,S)){g=y();return}let B=b._m,z=1/S.x,j=1/S.y,H=1/S.z;u(B[0]*z,B[1]*z,B[2]*z,0,B[4]*j,B[5]*j,B[6]*j,0,B[8]*H,B[9]*H,B[10]*H,0,0,0,0,1,g)}e.getRotationMatrixToRef=ko;function Mr(b){b._m[2]*=-1,b._m[6]*=-1,b._m[8]*=-1,b._m[9]*=-1,b._m[14]*=-1,Re(b)}e.toggleModelMatrixHandInPlace=Mr;function Oo(b){b._m[8]*=-1,b._m[9]*=-1,b._m[10]*=-1,b._m[11]*=-1,Re(b)}e.toggleProjectionMatrixHandInPlace=Oo;function oe(b,g,S=!1,B=!1,z=!0){b.updateFlag=s++,b.isIdentity=g,b.isIdentity3x2=g||B,b._isIdentityDirty=b.isIdentity?!1:S,b._isIdentity3x2Dirty=b.isIdentity3x2?!1:z}})(zn||(zn={}));var We;(function(e){function n(E=0,_=0,O=0,V=1){return{x:E,y:_,z:O,w:V}}e.create=n;function s(E,_){return{x:E.x+_.x,y:E.y+_.y,z:E.z+_.z,w:E.w+_.w}}e.add=s;function t(E,_,O){let V=_*.5,D=E*.5,J=O*.5,ee=Math.cos(V),K=Math.cos(D),de=Math.cos(J),_e=Math.sin(V),ze=Math.sin(D),Oe=Math.sin(J);return n(K*_e*de+ze*ee*Oe,ze*ee*de-K*_e*Oe,K*ee*Oe-ze*_e*de,K*ee*de+ze*_e*Oe)}e.fromRotationYawPitchRoll=t;function a(E,_,O){return t(_*Kr,E*Kr,O*Kr)}e.fromEulerDegrees=a;function r(E){return Math.sqrt(c(E))}e.length=r;function c(E){return E.x*E.x+E.y*E.y+E.z*E.z+E.w*E.w}e.lengthSquared=c;function o(E,_){return E.x*_.x+E.y*_.y+E.z*_.z+E.w*_.w}e.dot=o;function i(E,_){let O=o(E,_);return Math.acos(Math.min(Math.abs(O),1))*2*ei}e.angle=i;function u(E,_,O){let V=i(E,_);if(V===0)return _;let D=Math.min(1,O/V);return h(E,_,D)}e.rotateTowards=u;function p(E,_={x:0,y:1,z:0}){let O=X.normalize(E),V=X.normalize(X.cross(_,O)),D=X.cross(O,V),J=V.x,ee=V.y,K=V.z,de=D.x,_e=D.y,ze=D.z,Oe=O.x,je=O.y,Pe=O.z,q=J+_e+Pe,R=n();if(q>0){let T=Math.sqrt(q+1);return R.w=T*.5,T=.5/T,R.x=(ze-je)*T,R.y=(Oe-K)*T,R.z=(ee-de)*T,R}if(J>=_e&&J>=Pe){let T=Math.sqrt(1+J-_e-Pe),L=.5/T;return R.x=.5*T,R.y=(ee+de)*L,R.z=(K+Oe)*L,R.w=(ze-je)*L,R}if(_e>Pe){let T=Math.sqrt(1+_e-J-Pe),L=.5/T;return R.x=(de+ee)*L,R.y=.5*T,R.z=(je+ze)*L,R.w=(Oe-K)*L,R}let F=Math.sqrt(1+Pe-J-_e),Z=.5/F;return R.x=(Oe+K)*Z,R.y=(je+ze)*Z,R.z=.5*F,R.w=(ee-de)*Z,R}e.lookRotation=p;function m(E){let _=1/r(E);return n(E.x*_,E.y*_,E.z*_,E.w*_)}e.normalize=m;function f(E,_,O=X.Up()){let V=X.normalize(E),D=X.normalize(_),J=X.cross(V,D),ee=Math.sqrt(X.lengthSquared(V)*X.lengthSquared(D))+X.dot(V,D);return X.lengthSquared(J)<1e-4?Math.abs(ee)<1e-4?m(n(O.x,O.y,O.z,0)):y():m(n(J.x,J.y,J.z,ee))}e.fromToRotation=f;function y(){return n(0,0,0,1)}e.Identity=y;function l(E){let _=X.create(),O=E.x*E.x+E.y*E.y+E.z*E.z+E.w*E.w,V=E.x*E.w-E.y*E.z;return V>.4995*O?(_.x=Math.PI/2,_.y=2*Math.atan2(E.y,E.x),_.z=0):V<-.4995*O?(_.x=-Math.PI/2,_.y=-2*Math.atan2(E.y,E.x),_.z=0):(_.x=Math.asin(2*(E.w*E.x-E.y*E.z)),_.y=Math.atan2(2*E.w*E.y+2*E.z*E.x,1-2*(E.x*E.x+E.y*E.y)),_.z=Math.atan2(2*E.w*E.z+2*E.x*E.y,1-2*(E.z*E.z+E.x*E.x))),_.x*=ei,_.y*=ei,_.z*=ei,_.x=dt.repeat(_.x,360),_.y=dt.repeat(_.y,360),_.z=dt.repeat(_.z,360),_}e.toEulerAngles=l;function d(E,_,O,V){let D=_*.5,J=E*.5,ee=O*.5,K=Math.cos(D),de=Math.cos(J),_e=Math.cos(ee),ze=Math.sin(D),Oe=Math.sin(J),je=Math.sin(ee);V.x=de*ze*_e+Oe*K*je,V.y=Oe*K*_e-de*ze*je,V.z=de*K*je-Oe*ze*_e,V.w=de*K*_e+Oe*ze*je}e.fromRotationYawPitchRollToRef=d;function v(E,_){let O=E._m,V=O[0],D=O[4],J=O[8],ee=O[1],K=O[5],de=O[9],_e=O[2],ze=O[6],Oe=O[10],je=V+K+Oe,Pe;je>0?(Pe=.5/Math.sqrt(je+1),_.w=.25/Pe,_.x=(ze-de)*Pe,_.y=(J-_e)*Pe,_.z=(ee-D)*Pe):V>K&&V>Oe?(Pe=2*Math.sqrt(1+V-K-Oe),_.w=(ze-de)/Pe,_.x=.25*Pe,_.y=(D+ee)/Pe,_.z=(J+_e)/Pe):K>Oe?(Pe=2*Math.sqrt(1+K-V-Oe),_.w=(J-_e)/Pe,_.x=(D+ee)/Pe,_.y=.25*Pe,_.z=(de+ze)/Pe):(Pe=2*Math.sqrt(1+Oe-V-K),_.w=(ee-D)/Pe,_.x=(J+_e)/Pe,_.y=(de+ze)/Pe,_.z=.25*Pe)}e.fromRotationMatrixToRef=v;function h(E,_,O){let V=e.Identity();return e.slerpToRef(E,_,O,V),V}e.slerp=h;function x(E,_,O,V){let D,J,ee=E.x*_.x+E.y*_.y+E.z*_.z+E.w*_.w,K=!1;if(ee<0&&(K=!0,ee=-ee),ee>.999999)J=1-O,D=K?-O:O;else{let de=Math.acos(ee),_e=1/Math.sin(de);J=Math.sin((1-O)*de)*_e,D=K?-Math.sin(O*de)*_e:Math.sin(O*de)*_e}V.x=J*E.x+D*_.x,V.y=J*E.y+D*_.y,V.z=J*E.z+D*_.z,V.w=J*E.w+D*_.w}e.slerpToRef=x;function w(E,_){let O=n(0,0,0,1);return k(E,_,O),O}e.multiply=w;function k(E,_,O){O.x=E.x*_.w+E.y*_.z-E.z*_.y+E.w*_.x,O.y=-E.x*_.z+E.y*_.w+E.z*_.x+E.w*_.y,O.z=E.x*_.y-E.y*_.x+E.z*_.w+E.w*_.z,O.w=-E.x*_.x-E.y*_.y-E.z*_.z+E.w*_.w}e.multiplyToRef=k;function N(E,_){if(X.lengthSquared(_)===0)return e.Identity();let O=y(),V=E*Kr;V*=.5;let D=X.normalize(_);return X.scaleToRef(D,Math.sin(V),D),O.x=D.x,O.y=D.y,O.z=D.z,O.w=Math.cos(V),m(O)}e.fromAngleAxis=N;function A(E,_,O){let V=e.create(0,0,0,0);return P(E,_,O,V),V}e.fromAxisToRotationQuaternion=A;function P(E,_,O,V){let D=zn.create();zn.fromXYZAxesToRef(X.normalize(E),X.normalize(_),X.normalize(O),D),e.fromRotationMatrixToRef(D,V)}e.fromAxisToRotationQuaternionToRef=P;function M(){return n(0,0,0,0)}e.Zero=M;function W(E,_,O=X.Up()){let V=e.Identity();return $(E,_,O,V),V}e.fromLookAt=W;function $(E,_,O=X.Up(),V){let D=zn.Identity();zn.lookAtLHToRef(E,_,O,D),zn.invertToRef(D,D),e.fromRotationMatrixToRef(D,V)}e.fromLookAtToRef=$})(We||(We={}));var Nn;(function(e){function n(R=0,F=0,Z=0,T=1){return{r:R,g:F,b:Z,a:T}}e.create=n;function s(R){if(R.substring(0,1)!=="#"||R.length!==7&&R.length!==9)return n(0,0,0,1);let F=parseInt(R.substring(1,3),16),Z=parseInt(R.substring(3,5),16),T=parseInt(R.substring(5,7),16),L=R.substring(7,9),re=L?parseInt(L,16):255;return e.fromInts(F,Z,T,re)}e.fromHexString=s;function t(R,F,Z){let T=n(0,0,0,0);return e.lerpToRef(R,F,Z,T),T}e.lerp=t;function a(R,F,Z,T){T.r=R.r+(F.r-R.r)*Z,T.g=R.g+(F.g-R.g)*Z,T.b=R.b+(F.b-R.b)*Z,T.a=R.a+(F.a-R.a)*Z}e.lerpToRef=a;function r(){return n(1,0,0,1)}e.Red=r;function c(){return n(0,1,0,1)}e.Green=c;function o(){return n(0,0,1,1)}e.Blue=o;function i(){return n(0,0,0,1)}e.Black=i;function u(){return n(1,1,1,1)}e.White=u;function p(){return n(.5,0,.5,1)}e.Purple=p;function m(){return n(1,0,1,1)}e.Magenta=m;function f(){return n(1,1,0,1)}e.Yellow=f;function y(){return n(.5,.5,.5,1)}e.Gray=y;function l(){return n(0,1,1,1)}e.Teal=l;function d(){return n(0,0,0,0)}e.Clear=d;function v(R,F=1){return n(R.r,R.g,R.b,F)}e.fromColor3=v;function h(R,F=0){return n(R[F],R[F+1],R[F+2],R[F+3])}e.fromArray=h;function x(R,F,Z,T){return n(R/255,F/255,Z/255,T/255)}e.fromInts=x;function w(R,F){if(R.length===F*3){let Z=[];for(let T=0;T<R.length;T+=3){let L=T/3*4;Z[L]=R[T],Z[L+1]=R[T+1],Z[L+2]=R[T+2],Z[L+3]=1}return Z}return R}e.checkColors4=w;function k(R,F,Z){Z.r=R.r+F.r,Z.g=R.g+F.g,Z.b=R.b+F.b,Z.a=R.a+F.a}e.addToRef=k;function N(R,F,Z=0){F[Z]=R.r,F[Z+1]=R.g,F[Z+2]=R.b,F[Z+3]=R.a}e.toArray=N;function A(R,F){let Z=d();return k(R,F,Z),Z}e.add=A;function P(R,F){let Z=d();return M(R,F,Z),Z}e.subtract=P;function M(R,F,Z){Z.r=R.r-F.r,Z.g=R.g-F.g,Z.b=R.b-F.b,Z.a=R.a-F.a}e.subtractToRef=M;function W(R,F){return n(R.r*F,R.g*F,R.b*F,R.a*F)}e.scale=W;function $(R,F,Z){Z.r=R.r*F,Z.g=R.g*F,Z.b=R.b*F,Z.a=R.a*F}e.scaleToRef=$;function E(R,F,Z){Z.r+=R.r*F,Z.g+=R.g*F,Z.b+=R.b*F,Z.a+=R.a*F}e.scaleAndAddToRef=E;function _(R,F=0,Z=1,T){T.r=dt.clamp(R.r,F,Z),T.g=dt.clamp(R.g,F,Z),T.b=dt.clamp(R.b,F,Z),T.a=dt.clamp(R.a,F,Z)}e.clampToRef=_;function O(R,F){return n(R.r*F.r,R.g*F.g,R.b*F.b,R.a*F.a)}e.multiply=O;function V(R,F,Z){Z.r=R.r*F.r,Z.g=R.g*F.g,Z.b=R.b*F.b,Z.a=R.a*F.a}e.multiplyToRef=V;function D(R){return"{R: "+R.r+" G:"+R.g+" B:"+R.b+" A:"+R.a+"}"}e.toString=D;function J(R){let F=R.r||0;return F=F*397^(R.g||0),F=F*397^(R.b||0),F=F*397^(R.a||0),F}e.getHashCode=J;function ee(R){return n(R.r,R.g,R.b,R.a)}e.clone=ee;function K(R,F){F.r=R.r,F.g=R.g,F.b=R.b,F.a=R.a}e.copyFrom=K;function de(R,F,Z,T,L){L.r=R,L.g=F,L.b=Z,L.a=T}e.copyFromFloats=de;function _e(R,F,Z,T,L){L.r=R,L.g=F,L.b=Z,L.a=T}e.set=_e;function ze(R){let F=R.r*255|0,Z=R.g*255|0,T=R.b*255|0,L=R.a*255|0;return"#"+dt.toHex(F)+dt.toHex(Z)+dt.toHex(T)+dt.toHex(L)}e.toHexString=ze;function Oe(R){let F=n();return je(R,F),F}e.toLinearSpace=Oe;function je(R,F){F.r=Math.pow(R.r,mo),F.g=Math.pow(R.g,mo),F.b=Math.pow(R.b,mo),F.a=R.a}e.toLinearSpaceToRef=je;function Pe(R){let F=n();return q(R,F),F}e.toGammaSpace=Pe;function q(R,F){F.r=Math.pow(R.r,ho),F.g=Math.pow(R.g,ho),F.b=Math.pow(R.b,ho),F.a=R.a}e.toGammaSpaceToRef=q})(Nn||(Nn={}));var Nr;(function(e){function n(T=0,L=0,re=0){return{r:T,g:L,b:re}}e.create=n;function s(T){if(T.substring(0,1)!=="#"||T.length!==7)return n(0,0,0);let L=parseInt(T.substring(1,3),16),re=parseInt(T.substring(3,5),16),ye=parseInt(T.substring(5,7),16);return a(L,re,ye)}e.fromHexString=s;function t(T,L=0){return n(T[L],T[L+1],T[L+2])}e.fromArray=t;function a(T,L,re){return n(T/255,L/255,re/255)}e.fromInts=a;function r(T,L,re){let ye=n(0,0,0);return e.lerpToRef(T,L,re,ye),ye}e.lerp=r;function c(T,L,re,ye){ye.r=T.r+(L.r-T.r)*re,ye.g=T.g+(L.g-T.g)*re,ye.b=T.b+(L.b-T.b)*re}e.lerpToRef=c;function o(){return n(1,0,0)}e.Red=o;function i(){return n(0,1,0)}e.Green=i;function u(){return n(0,0,1)}e.Blue=u;function p(){return n(0,0,0)}e.Black=p;function m(){return n(1,1,1)}e.White=m;function f(){return n(.5,0,.5)}e.Purple=f;function y(){return n(1,0,1)}e.Magenta=y;function l(){return n(1,1,0)}e.Yellow=l;function d(){return n(.5,.5,.5)}e.Gray=d;function v(){return n(0,1,1)}e.Teal=v;function h(){return n(Math.random(),Math.random(),Math.random())}e.Random=h;function x(T){return"{R: "+T.r+" G:"+T.g+" B:"+T.b+"}"}e.toString=x;function w(T){let L=T.r||0;return L=L*397^(T.g||0),L=L*397^(T.b||0),L}e.getHashCode=w;function k(T,L,re=0){L[re]=T.r,L[re+1]=T.g,L[re+2]=T.b}e.toArray=k;function N(T,L=1){return Nn.create(T.r,T.g,T.b,L)}e.toColor4=N;function A(T){let L=new Array;return k(T,L,0),L}e.asArray=A;function P(T){return T.r*.3+T.g*.59+T.b*.11}e.toLuminance=P;function M(T,L){return n(T.r*L.r,T.g*L.g,T.b*L.b)}e.multiply=M;function W(T,L,re){re.r=T.r*L.r,re.g=T.g*L.g,re.b=T.b*L.b}e.multiplyToRef=W;function $(T,L){return L&&T.r===L.r&&T.g===L.g&&T.b===L.b}e.equals=$;function E(T,L,re,ye){return T.r===L&&T.g===re&&T.b===ye}e.equalsFloats=E;function _(T,L){return n(T.r*L,T.g*L,T.b*L)}e.scale=_;function O(T,L,re){re.r=T.r*L,re.g=T.g*L,re.b=T.b*L}e.scaleToRef=O;function V(T,L,re){re.r+=T.r*L,re.g+=T.g*L,re.b+=T.b*L}e.scaleAndAddToRef=V;function D(T,L=0,re=1,ye){ye.r=dt.clamp(T.r,L,re),ye.g=dt.clamp(T.g,L,re),ye.b=dt.clamp(T.b,L,re)}e.clampToRef=D;function J(T,L=0,re=1){let ye=e.Black();return D(T,L,re,ye),ye}e.clamp=J;function ee(T,L){return n(T.r+L.r,T.g+L.g,T.b+L.b)}e.add=ee;function K(T,L,re){re.r=T.r+L.r,re.g=T.g+L.g,re.b=T.b+L.b}e.addToRef=K;function de(T,L){return n(T.r-L.r,T.g-L.g,T.b-L.b)}e.subtract=de;function _e(T,L,re){re.r=T.r-L.r,re.g=T.g-L.g,re.b=T.b-L.b}e.subtractToRef=_e;function ze(T){return n(T.r,T.g,T.b)}e.clone=ze;function Oe(T,L){L.r=T.r,L.g=T.g,L.b=T.b}e.copyFrom=Oe;function je(T,L,re,ye){T.r=L,T.g=re,T.b=ye}e.set=je;function Pe(T){let L=T.r*255|0,re=T.g*255|0,ye=T.b*255|0;return"#"+dt.toHex(L)+dt.toHex(re)+dt.toHex(ye)}e.toHexString=Pe;function q(T){let L=n();return R(T,L),L}e.toLinearSpace=q;function R(T,L){L.r=Math.pow(T.r,mo),L.g=Math.pow(T.g,mo),L.b=Math.pow(T.b,mo)}e.toLinearSpaceToRef=R;function F(T){let L=n();return Z(T,L),L}e.toGammaSpace=F;function Z(T,L){L.r=Math.pow(T.r,ho),L.g=Math.pow(T.g,ho),L.b=Math.pow(T.b,ho)}e.toGammaSpaceToRef=Z})(Nr||(Nr={}));var ti=we.defineComponent("BoxBody",{boxBodyId:ce.Number}),pn=we.defineComponent("Marker",{mouseConstraintId:ce.Number,isPointerPressed:ce.Boolean,isEKeyPressed:ce.Boolean,markerDistance:ce.Number}),Ia=1,Os={albedoColor:Nn.create(5,2.5,1)},Sl={albedoColor:Nn.create(5,1,3.5)};var gt=$e(Ps());var Lt;function Al(){Lt=new gt.World,Lt.quatNormalizeSkip=0,Lt.quatNormalizeFast=!1,Lt.gravity.set(0,-9.82,0),Lt.broadphase=new gt.NaiveBroadphase;let e=new gt.Plane,n=new gt.Body({mass:0});n.addShape(e),n.quaternion.setFromAxisAngle(new gt.Vec3(1,0,0),-Math.PI/2),n.position.y=.1,Lt.addBody(n);let s=new gt.Box(new gt.Vec3(32,50,1)),t=new gt.Body({mass:0,shape:s,position:new gt.Vec3(40,29,94)});Lt.addBody(t);let a=new gt.Body({mass:0,shape:s,position:new gt.Vec3(40,25,1.5)});Lt.addBody(a);let r=new gt.Body({mass:0,shape:s,position:new gt.Vec3(1.5,25,48)});r.quaternion.setFromAxisAngle(new gt.Vec3(0,1,0),-Math.PI/2),Lt.addBody(r);let c=new gt.Body({mass:0,shape:s,position:new gt.Vec3(32,25,16)});c.quaternion.setFromAxisAngle(new gt.Vec3(0,1,0),-Math.PI/2),Lt.addBody(c)}var Th=1e3;function Qn(e){let n=we.addEntity(),s=ti.create(n,{boxBodyId:Th++});De.create(n,{position:e}),Rn.setPbrMaterial(n,{albedoColor:Nn.Red()}),wr.create(n,{src:"models/crate.glb"}),cl.create(n,{pointerEvents:[{eventType:Zn.PET_DOWN,eventInfo:{button:Xn.IA_POINTER}}]});let t=new gt.Box(new gt.Vec3(.5,.5,.5)),a=new gt.Body({mass:5});a.addShape(t),a.id=s.boxBodyId,a.position.set(e.x,e.y,e.z),a.linearDamping=.4,a.angularDamping=.4,Lt.addBody(a)}function _l(e){Lt.step(e);for(let[n,s]of we.getEntitiesWith(ti)){let t=Lt.bodies.find(a=>a.id===s.boxBodyId);if(t){let a=De.getMutable(n);a.position=X.create(t.position.x,t.position.y,t.position.z),a.rotation=We.create(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w)}}}function Rl(e){Lt.addBody(e)}function Nl(e){Lt.addConstraint(e)}function Cl(){Lt.constraints=[]}function Bl(e){Lt.removeConstraint(e)}function ka(e){return Lt.bodies.find(n=>n.id===e)}function zs(e){let n=Lt.constraints.find(s=>s.id===e);return n||(console.log("CONSTRAINT NOT FOUND. ID: ",e," FULL LIST: ",Lt),console.log(Lt),null)}var Jn=$e(Ps());function Io(){let e=Array.from(we.getEntitiesWith(pn));if(e.length>0)return e[0][0];throw new Error("No marker found")}function Il(){let e=we.addEntity();Gn.setSphere(e),De.create(e,{scale:X.Zero()}),Rn.setPbrMaterial(e,Os),pn.create(e);let n=new Jn.Sphere(.1),s=new Jn.Body({mass:0});s.addShape(n),s.collisionFilterGroup=0,s.collisionFilterMask=0,s.id=Ia,Rl(s)}function Ah(e,n,s,t){let a=ka(t);if(!a)return;let r=new Jn.Vec3(e,n,s).vsub(a.position),o=a.quaternion.inverse().vmult(r),i=ka(Ia);if(!i)return;i.position.set(e,n,s);let u=new Jn.PointToPointConstraint(a,o,i,new Jn.Vec3(0,0,0));u.id=pn.getMutable(Io()).mouseConstraintId++,Nl(u)}function _h(e,n,s){ka(Ia)?.position.set(e,n,s),zs(pn.getMutable(Io()).mouseConstraintId)?.update()}function Rh(){let e=pn.get(Io()),n=zs(e.mouseConstraintId);console.log("MARKER REMOVED",e,n),n?Bl(n):Cl()}function kl(){let e=Io(),n=pn.get(e),s=gr.getInputCommand(Xn.IA_POINTER,Zn.PET_DOWN);if(s&&!n.isPointerPressed){let t=pn.getMutable(e);if(t.isPointerPressed=!0,s.hit&&s.hit.length!==0&&s.hit.entityId){let a=ti.getOrNull(s.hit.entityId);if(a){De.getMutable(e).scale=X.create(.1,.1,.1),t.markerDistance=s.hit.length;let r=s.hit?.position;r&&Ah(r.x,r.y,r.z,a.boxBodyId)}}}if(gr.isTriggered(Xn.IA_POINTER,Zn.PET_UP)&&n.isPointerPressed){let t=pn.getMutable(e);De.getMutable(e).scale=X.Zero(),t.isPointerPressed=!1,t.markerDistance=0,Rh()}gr.isTriggered(Xn.IA_PRIMARY,Zn.PET_DOWN)&&(pn.getMutable(e).isEKeyPressed=!0,Rn.setPbrMaterial(e,Sl)),gr.isTriggered(Xn.IA_PRIMARY,Zn.PET_UP)&&(pn.getMutable(e).isEKeyPressed=!1,Rn.setPbrMaterial(e,Os))}function Ol(e){let n=pn.get(Io());if(n.isPointerPressed&&n.markerDistance!==0){let s=Io(),t=De.get(we.CameraEntity),a=X.rotate(X.scale(X.Forward(),pn.getMutable(s).markerDistance),t.rotation),r=X.add(t.position,a);De.getMutable(s).position=r;let c=De.get(s).position;_h(c.x,c.y,c.z)}n.isEKeyPressed&&n.markerDistance!==0&&n.markerDistance>1&&(pn.getMutable(Io()).markerDistance-=5*e)}function Ml(e,n,s){let a=Cr(Vt.ACTION_TYPES,e).getOrCreateMutable(e.RootEntity),r={type:n,jsonSchema:JSON.stringify(s?.jsonSchema||ce.Map({}).jsonSchema)};a.value=[...a.value.filter(c=>c.type!==r.type),r]}function cn(e){return JSON.parse(e.jsonPayload)}var Vt;(function(e){e.ACTION_TYPES="asset-packs::ActionTypes",e.ACTIONS="asset-packs::Actions",e.COUNTER="asset-packs::Counter",e.TRIGGERS="asset-packs::Triggers",e.STATES="asset-packs::States"})(Vt||(Vt={}));var Kn;(function(e){e.MOVE_ITEM="move_item",e.ROTATE_ITEM="rotate_item",e.SCALE_ITEM="scale_item"})(Kn||(Kn={}));var ni;(function(e){e.LINEAR="linear",e.EASEINQUAD="easeinquad",e.EASEOUTQUAD="easeoutquad",e.EASEQUAD="easequad",e.EASEINSINE="easeinsine",e.EASEOUTSINE="easeoutsine",e.EASESINE="easeinoutsine",e.EASEINEXPO="easeinexpo",e.EASEOUTEXPO="easeoutexpo",e.EASEEXPO="easeinoutexpo",e.EASEINELASTIC="easeinelastic",e.EASEOUTELASTIC="easeoutelastic",e.EASEELASTIC="easeinoutelastic",e.EASEINBOUNCE="easeinbounce",e.EASEOUTEBOUNCE="easeoutbounce",e.EASEBOUNCE="easeinoutbounce"})(ni||(ni={}));var pt;(function(e){e.PLAY_ANIMATION="play_animation",e.STOP_ANIMATION="stop_animation",e.SET_STATE="set_state",e.START_TWEEN="start_tween",e.SET_COUNTER="set_counter",e.INCREMENT_COUNTER="increment_counter",e.DECREASE_COUNTER="decrease_counter",e.PLAY_SOUND="play_sound",e.STOP_SOUND="stop_sound",e.SET_VISIBILITY="set_visibility",e.ATTACH_TO_PLAYER="attach_to_player",e.DETACH_FROM_PLAYER="detach_from_player"})(pt||(pt={}));var jt;(function(e){e.ON_CLICK="on_click",e.ON_STATE_CHANGE="on_state_change",e.ON_SPAWN="on_spawn",e.ON_TWEEN_END="on_tween_end",e.ON_COUNTER_CHANGE="on_counter_change",e.ON_PLAYER_ENTERS_AREA="on_player_enters_area",e.ON_PLAYER_LEAVES_AREA="on_player_leaves_area"})(jt||(jt={}));var sn;(function(e){e.WHEN_STATE_IS="when_state_is",e.WHEN_STATE_IS_NOT="when_state_is_not",e.WHEN_COUNTER_EQUALS="when_counter_equals",e.WHEN_COUNTER_IS_GREATER_THAN="when_counter_is_greater_than",e.WHEN_COUNTER_IS_LESS_THAN="when_counter_is_less_than"})(sn||(sn={}));var eo;(function(e){e.AND="and",e.OR="or"})(eo||(eo={}));function Fs(e){return{all:e=e||new Map,on:function(n,s){var t=e.get(n);t?t.push(s):e.set(n,[s])},off:function(n,s){var t=e.get(n);t&&(s?t.splice(t.indexOf(s)>>>0,1):e.set(n,[]))},emit:function(n,s){var t=e.get(n);t&&t.slice().map(function(a){a(s)}),(t=e.get("*"))&&t.slice().map(function(a){a(n,s)})}}}var Us=new Map,Ls=new Map;function Fn(e){return Us.has(e)||Us.set(e,Fs()),Us.get(e)}function Oa(e){return Ls.has(e)||Ls.set(e,Fs()),Ls.get(e)}function Ma(e,n){return!!n&&e.value.includes(n)}function Vs(e){return Ma(e,e.currentValue)?e.currentValue:Ds(e)}function Ds(e){if(Ma(e,e.defaultValue))return e.defaultValue;if(e.value.length>0)return e.value[0]}var Nh={[pt.PLAY_ANIMATION]:ce.Map({animation:ce.String,loop:ce.Optional(ce.Boolean)}),[pt.STOP_ANIMATION]:ce.Map({}),[pt.SET_STATE]:ce.Map({state:ce.String}),[pt.START_TWEEN]:ce.Map({type:ce.EnumString(Kn,Kn.MOVE_ITEM),end:ce.Vector3,interpolationType:ce.EnumString(ni,ni.LINEAR),duration:ce.Float,relative:ce.Boolean}),[pt.SET_COUNTER]:ce.Map({counter:ce.Int}),[pt.INCREMENT_COUNTER]:ce.Map({}),[pt.DECREASE_COUNTER]:ce.Map({}),[pt.PLAY_SOUND]:ce.Map({src:ce.String,loop:ce.Optional(ce.Boolean),volume:ce.Optional(ce.Float)}),[pt.STOP_SOUND]:ce.Map({}),[pt.SET_VISIBILITY]:ce.Map({visible:ce.Boolean,physicsCollider:ce.Optional(ce.Boolean)}),[pt.ATTACH_TO_PLAYER]:ce.Map({anchorPointId:ce.Int}),[pt.DETACH_FROM_PLAYER]:ce.Map({})};function Cr(e,n){try{return n.getComponent(e)}catch(s){throw console.error(`Error using getComponent with componentName="${e}"`),s}}function Pa(e){return{Actions:Cr(Vt.ACTIONS,e),States:Cr(Vt.STATES,e),Counter:Cr(Vt.COUNTER,e),Triggers:Cr(Vt.TRIGGERS,e)}}function Pl(e){let n=e.defineComponent(Vt.ACTION_TYPES,{value:ce.Array(ce.Map({type:ce.String,jsonSchema:ce.String}))}),s=e.defineComponent(Vt.ACTIONS,{id:ce.Int,value:ce.Array(ce.Map({name:ce.String,type:ce.String,jsonPayload:ce.String}))}),t=e.defineComponent(Vt.COUNTER,{id:ce.Number,value:ce.Int}),a=e.defineComponent(Vt.TRIGGERS,{value:ce.Array(ce.Map({type:ce.EnumString(jt,jt.ON_CLICK),conditions:ce.Optional(ce.Array(ce.Map({id:ce.Optional(ce.Int),type:ce.EnumString(sn,sn.WHEN_STATE_IS),value:ce.String}))),operation:ce.Optional(ce.EnumString(eo,eo.AND)),actions:ce.Array(ce.Map({id:ce.Optional(ce.Int),name:ce.Optional(ce.String)}))}))}),r=e.defineComponent(Vt.STATES,{id:ce.Number,value:ce.Array(ce.String),defaultValue:ce.Optional(ce.String),currentValue:ce.Optional(ce.String)});return{ActionTypes:n,Actions:s,Counter:t,Triggers:a,States:r}}function zl(e){let n=Object.values(pt);for(let a of n){let r=a;Ml(e,r,Nh[r])}let t=e.getComponent(Vt.COUNTER).getOrCreateMutable(e.RootEntity);t.value=t.value||0}function Fl(e){switch(e){case Vt.STATES:return[sn.WHEN_STATE_IS,sn.WHEN_STATE_IS_NOT];case Vt.COUNTER:return[sn.WHEN_COUNTER_EQUALS,sn.WHEN_COUNTER_IS_GREATER_THAN,sn.WHEN_COUNTER_IS_LESS_THAN];default:return[]}}function oi(e){let n=De.getOrNull(e);if(!n)return X.Zero();let s=n.parent;if(s){let t=De.get(s).rotation;return X.add(oi(s),X.rotate(n.position,t))}else return n.position}function ri(e){let n=De.getOrNull(e);if(!n)return We.Identity();let s=n.parent;return s?We.multiply(n.rotation,ri(s)):n.rotation}var Tt;(function(e){e.LINEAR="linear",e.EASEINQUAD="easeinquad",e.EASEOUTQUAD="easeoutquad",e.EASEQUAD="easequad",e.EASEINSINE="easeinsine",e.EASEOUTSINE="easeoutsine",e.EASESINE="easeinoutsine",e.EASEINEXPO="easeinexpo",e.EASEOUTEXPO="easeoutexpo",e.EASEEXPO="easeinoutexpo",e.EASEINELASTIC="easeinelastic",e.EASEOUTELASTIC="easeoutelastic",e.EASEELASTIC="easeinoutelastic",e.EASEINBOUNCE="easeinbounce",e.EASEOUTEBOUNCE="easeoutbounce",e.EASEBOUNCE="easeinoutbounce"})(Tt||(Tt={}));function Ws(e,n){switch(e){case Tt.LINEAR:return n;case Tt.EASEINQUAD:return Ch(n);case Tt.EASEOUTQUAD:return Bh(n);case Tt.EASEQUAD:return Ih(n);case Tt.EASEINSINE:return kh(n);case Tt.EASEOUTSINE:return Oh(n);case Tt.EASESINE:return Mh(n);case Tt.EASEINEXPO:return Ph(n);case Tt.EASEOUTEXPO:return zh(n);case Tt.EASEEXPO:return Fh(n);case Tt.EASEINELASTIC:return Uh(n);case Tt.EASEOUTELASTIC:return Lh(n);case Tt.EASEELASTIC:return Vh(n);case Tt.EASEINBOUNCE:return Dh(n);case Tt.EASEOUTEBOUNCE:return Wh(n);case Tt.EASEBOUNCE:return qh(n);default:return n}}function Ch(e){return e*e}function Bh(e){return e*(2-e)}function Ih(e){return e*e/(2*(e*e-e)+1)}function kh(e){return 1-Math.cos(e*Math.PI/2)}function Oh(e){return Math.sin(e*Math.PI/2)}function Mh(e){return-(Math.cos(Math.PI*e)-1)/2}function Ph(e){return e===0?0:Math.pow(2,10*e-10)}function zh(e){return e===1?1:1-Math.pow(2,-10*e)}function Fh(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}function Uh(e){let n=2*Math.PI/3;return e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*n)}function Lh(e){let n=2*Math.PI/3;return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*n)+1}function Vh(e){let n=2*Math.PI/4.5;return e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*n))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*n)/2+1}function Dh(e){return 1-za(1-e)}function Wh(e){return za(e)}function qh(e){return e<.5?(1-za(1-2*e))/2:(1+za(2*e-1))/2}function za(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Ul(e,n,s){let t=new Array,a=1/n,r=0;if(s){let c=e.length;for(let o=0;o<c;o++){r=0;for(let i=0;i<n;i++)t.push(X.catmullRom(e[o%c],e[(o+1)%c],e[(o+2)%c],e[(o+3)%c],r)),r+=a}t.push(t[0])}else{let c=new Array;c.push(X.clone(e[0])),Array.prototype.push.apply(c,e),c.push(X.clone(e[e.length-1]));let o=0;for(;o<c.length-3;o++){r=0;for(let i=0;i<n;i++)t.push(X.catmullRom(c[o],c[o+1],c[o+2],c[o+3],r)),r+=a}o--,t.push(X.catmullRom(c[o],c[o+1],c[o+2],c[o+3],r))}return t}function Ll(e,n,s,t){return e.x<=t.x&&n.x>=s.x&&e.y<=t.y&&n.y>=s.y&&e.z<=t.z&&n.z>=s.z}function Vl(e,n,s,t){let a=X.distanceSquared(e,s),r=n+t;return a<r*r}function qs(e,n,s,t){let a=0;return s.x<e.x&&(a+=(e.x-s.x)*(e.x-s.x)),s.x>n.x&&(a+=(s.x-n.x)*(s.x-n.x)),s.y<e.y&&(a+=(e.y-s.y)*(e.y-s.y)),s.y>n.y&&(a+=(s.y-n.y)*(s.y-n.y)),s.z<e.z&&(a+=(e.z-s.z)*(e.z-s.z)),s.z>n.z&&(a+=(s.z-n.z)*(s.z-n.z)),a<t*t}var Jt;(function(e){e.TimerSystemPriority=1e5+256,e.TweenSystemPriority=1e5+192,e.PerpetualMotionSystemPriority=1e5+192,e.PathSystemPriority=1e5+192,e.TriggerSystemPriority=1e5+128,e.ActionSystemPriority=1e5+64})(Jt||(Jt={}));function Hh(e){let n={start:ce.Vector3,end:ce.Vector3,interpolationType:ce.EnumString(Tt,Tt.LINEAR),speed:ce.Float,normalizedTime:ce.Float},s=e.defineComponent("dcl.utils.PositionTween",n),t=e.defineComponent("dcl.utils.ScaleTween",n),a=e.defineComponent("dcl.utils.RotationTween",{start:ce.Quaternion,end:ce.Quaternion,interpolationType:ce.EnumString(Tt,Tt.LINEAR),speed:ce.Float,normalizedTime:ce.Float}),r=new Map,c=new Map,o=new Map;function i(f,y,l){return function(v){let h=[];for(let x of y.keys()){if(e.getEntityState(x)==Ut.Removed||!f.has(x)){y.delete(x);continue}let w=f.getMutable(x);w.normalizedTime=dt.clamp(w.normalizedTime+v*w.speed,0,1);let k=Ws(w.interpolationType,w.normalizedTime);l(De.getMutable(x),w.start,w.end,k),w.normalizedTime>=1&&h.push(x)}for(let x of h){let w=y.get(x);f.deleteFrom(x),y.delete(x),w&&w()}}}function u(f,y){return function(l){f.deleteFrom(l),y.delete(l)}}function p(f,y){return function(l,d,v,h,x=Tt.LINEAR,w){y.set(l,w),f.createOrReplace(l,{start:d,end:v,speed:h==0?0:1/h,interpolationType:x,normalizedTime:h==0?1:0})}}function m(f){return function(y){if(!f.has(y))throw new Error(`Entity ${y} is not registered with tweens system`);return f.get(y)}}return e.addSystem(i(s,r,function(f,y,l,d){f.position=X.lerp(y,l,d)}),Jt.TweenSystemPriority),e.addSystem(i(a,c,function(f,y,l,d){f.rotation=We.slerp(y,l,d)}),Jt.TweenSystemPriority),e.addSystem(i(t,o,function(f,y,l,d){f.scale=X.lerp(y,l,d)}),Jt.TweenSystemPriority),{startTranslation:p(s,r),stopTranslation:u(s,r),startRotation:p(a,c),stopRotation:u(a,c),startScaling:p(t,o),stopScaling:u(t,o),getTranslationOnFinishCallback:m(r),getRotationOnFinishCallback:m(c),getScalingOnFinishCallback:m(o)}}var ii=Hh(we);var Dl=new Set;function Wl(e,n){let{Animator:s,Transform:t,AudioSource:a,AvatarAttach:r,VisibilityComponent:c,GltfContainer:o}=n,{Actions:i,States:u,Counter:p}=Pa(e);return function(_){let O=e.getEntitiesWith(i);for(let[V,D]of O){if(Dl.has(V))continue;let J=D.value.reduce((K,de)=>K.add(de.type),new Set);for(let K of J)switch(K){case pt.PLAY_ANIMATION:{m(V);break}default:break}let ee=Oa(V);for(let K of D.value)ee.on(K.name,()=>{switch(K.type){case pt.PLAY_ANIMATION:{f(V,cn(K));break}case pt.STOP_ANIMATION:{y(V,cn(K));break}case pt.SET_STATE:{l(V,cn(K));break}case pt.START_TWEEN:{d(V,cn(K));break}case pt.SET_COUNTER:{w(V,cn(K));break}case pt.INCREMENT_COUNTER:{k(V,cn(K));break}case pt.DECREASE_COUNTER:{N(V,cn(K));break}case pt.PLAY_SOUND:{A(V,cn(K));break}case pt.STOP_SOUND:{P(V,cn(K));break}case pt.SET_VISIBILITY:{M(V,cn(K));break}case pt.ATTACH_TO_PLAYER:{W(V,cn(K));break}case pt.DETACH_FROM_PLAYER:{$(V,cn(K));break}default:break}});Dl.add(V)}};function m(E){s.create(E,{states:[]}),s.stopAllAnimations(E)}function f(E,_){let{animation:O,loop:V}=_,D=s.getMutable(E);D.states.some(ee=>ee.clip===O)||(D.states=[...D.states,{clip:O}]),s.stopAllAnimations(E);let J=s.getClip(E,O);J.playing=!0,J.loop=V??!1}function y(E,_){s.has(E)&&s.stopAllAnimations(E)}function l(E,_){let O=u.getMutableOrNull(E);if(O){let V=_.state;V=Ma(O,V)?V:Ds(O),O.currentValue=V,Fn(E).emit(jt.ON_STATE_CHANGE)}}function d(E,_){if(_){let O=Fn(E),V=()=>O.emit(jt.ON_TWEEN_END);switch(_.type){case Kn.MOVE_ITEM:{v(E,_,V);break}case Kn.ROTATE_ITEM:{h(E,_,V);break}case Kn.SCALE_ITEM:{x(E,_,V);break}default:throw new Error(`Unknown tween type: ${_.type}`)}}}function v(E,_,O){let V=t.get(E),{duration:D,interpolationType:J,relative:ee}=_,K=X.create(_.end.x,_.end.y,_.end.z),de=ee?X.add(V.position,K):K;ii.startTranslation(E,V.position,de,D,J,O)}function h(E,_,O){let V=t.get(E),{duration:D,interpolationType:J,relative:ee}=_,K=We.fromEulerDegrees(_.end.x,_.end.y,_.end.z),de=ee?We.multiply(V.rotation,K):K;ii.startRotation(E,V.rotation,de,D,J,O)}function x(E,_,O){let V=t.get(E),{duration:D,interpolationType:J,relative:ee}=_,K=X.create(_.end.x,_.end.y,_.end.z),de=ee?X.add(V.scale,K):K;ii.startScaling(E,V.scale,de,D,J,O)}function w(E,_){let O=p.getMutableOrNull(E);O&&(O.value=_.counter,Fn(E).emit(jt.ON_COUNTER_CHANGE))}function k(E,_){let O=p.getMutableOrNull(E);O&&(O.value+=1,Fn(E).emit(jt.ON_COUNTER_CHANGE))}function N(E,_){let O=p.getMutableOrNull(E);O&&(O.value-=1,Fn(E).emit(jt.ON_COUNTER_CHANGE))}function A(E,_){let{src:O,loop:V,volume:D}=_;a.createOrReplace(E,{audioClipUrl:O,loop:V,playing:!0,volume:D??1})}function P(E,_){let O=a.getMutableOrNull(E);O&&(O.playing=!1)}function M(E,_){let{visible:O,physicsCollider:V}=_;c.createOrReplace(E,{visible:O});let D=o.getMutableOrNull(E);D&&V!==void 0&&(D.invisibleMeshesCollisionMask=V?2:0)}function W(E,_){let{anchorPointId:O}=_;r.createOrReplace(E,{anchorPointId:O})}function $(E,_){r.has(E)&&r.deleteFrom(E)}}function Gh(e){let n=new Map,s=0;function t(a){let r=[],c=[];for(let[o,i]of n)i.accumulatedTime+=1e3*a,!(i.accumulatedTime<i.interval)&&(c.push(i.callback),i.recurrent?i.accumulatedTime-=Math.floor(i.accumulatedTime/i.interval)*i.interval:r.push(o));for(let o of r)n.delete(o);for(let o of c)o()}return e.addSystem(t,Jt.TimerSystemPriority),{setTimeout(a,r){let c=s++;return n.set(c,{callback:a,interval:r,recurrent:!1,accumulatedTime:0}),c},clearTimeout(a){n.delete(a)},setInterval(a,r){let c=s++;return n.set(c,{callback:a,interval:r,recurrent:!0,accumulatedTime:0}),c},clearInterval(a){n.delete(a)}}}var ai=Gh(we);var Br;(function(e){e[e.Off=0]="Off",e[e.On=1]="On"})(Br||(Br={}));function jh(e,n){let s=e.defineComponent("dcl.utils.Toggle",{state:ce.EnumNumber(Br,Br.Off)}),t=new Map;return n.setInterval(function(){for(let a of t.keys())(e.getEntityState(a)==Ut.Removed||!s.has(a))&&t.delete(a)},5e3),{addToggle(a,r,c){t.set(a,c),s.createOrReplace(a,{state:r})},removeToggle(a){t.delete(a),s.deleteFrom(a)},setCallback(a,r){t.set(a,r)},set(a,r){if(s.get(a).state!=r){s.getMutable(a).state=r;let o=t.get(a);o&&o(r)}},flip(a){this.set(a,1-s.get(a).state)},isOn(a){return s.get(a).state==Br.On}}}var Yh=jh(we,ai);function $h(e){let n=e.defineComponent("dcl.utils.PerpetualRotation",{velocity:ce.Quaternion});function s(t){for(let[a,r]of e.getEntitiesWith(n,De)){let c=We.slerp(We.Identity(),r.velocity,t),o=De.getMutable(a);o.rotation=We.normalize(We.multiply(o.rotation,c))}}return e.addSystem(s,Jt.PerpetualMotionSystemPriority),{startRotation(t,a){n.createOrReplace(t,{velocity:a})},stopRotation(t){n.deleteFrom(t)}}}var Xh=$h(we);function Zh(e){let n=e.defineComponent("dcl.utils.FollowPath",{points:ce.Array(ce.Vector3),faceDirection:ce.Boolean,speed:ce.Number,normalizedTime:ce.Number,currentIndex:ce.Number,segmentTimes:ce.Array(ce.Number),curveSegmentCount:ce.Number}),s=new Map,t=new Map;function a(o){s.delete(o),t.delete(o),n.deleteFrom(o)}function r(o){let i=[],u=[];for(let p of s.keys()){if(e.getEntityState(p)==Ut.Removed||!n.has(p)){a(p);continue}let m=De.getMutable(p),f=n.getMutable(p);for(f.normalizedTime=dt.clamp(f.normalizedTime+o*f.speed,0,1),f.normalizedTime>=1&&i.push(p);f.normalizedTime>=f.segmentTimes[f.currentIndex]&&f.currentIndex<f.points.length-1;){if(f.faceDirection){let d=X.subtract(f.points[f.currentIndex+1],f.points[f.currentIndex]);m.rotation=We.lookRotation(d)}if(f.currentIndex>0&&f.currentIndex%f.curveSegmentCount==0){let d=f.currentIndex/f.curveSegmentCount,v=f.points[f.currentIndex],h=f.points[f.currentIndex+f.curveSegmentCount];u.push({entity:p,index:d,coords:v,nextCoords:h})}f.currentIndex+=1}let y=f.segmentTimes[f.currentIndex]-f.segmentTimes[f.currentIndex-1],l=(f.segmentTimes[f.currentIndex]-f.normalizedTime)/y;m.position=X.lerp(f.points[f.currentIndex],f.points[f.currentIndex-1],l)}for(let p of u){let m=t.get(p.entity);m&&m(p.index,p.coords,p.nextCoords)}for(let p of i){let m=s.get(p);a(p),m&&m()}}e.addSystem(r,Jt.PathSystemPriority);function c(o,i,u,p,m,f,y){if(i.length<2)throw new Error("At least 2 points are required to form a path.");if(u==0)throw new Error("Path duration must not be zero");if(m){let h=X.equals(i[0],i[i.length-1]);h&&(i.pop(),i.unshift(i.pop())),i=Ul(i,m,h)}else m=1;s.set(o,f),t.set(o,y);let l=0,d=[];for(let h=0;h<i.length-1;h++){let x=X.distance(i[h],i[h+1]);l+=x,d.push(x)}let v=[0];for(let h=0;h<d.length;h++)v.push(d[h]/l+v[h]);n.createOrReplace(o,{points:i,segmentTimes:v,curveSegmentCount:m,speed:1/u,normalizedTime:0,currentIndex:0,faceDirection:p})}return{startStraightPath(o,i,u,p,m,f){return c(o,i,u,p,0,m,f)},startSmoothPath(o,i,u,p,m,f,y){if(p<2||!Number.isInteger(p))throw new Error(`segmentCount must be an integer that is greater than 2, got: ${p}`);return c(o,i,u,m,p,f,y)},stopPath(o){a(o)},getOnFinishCallback(o){if(!s.has(o))throw new Error(`Entity ${o} is not registered in triggers system`);return s.get(o)}}}var Qh=Zh(we);var Fa=1;var to=255,yo=0;function Jh(e){let n=we.defineComponent("dcl.utils.Trigger",{active:ce.Boolean,layerMask:ce.Int,triggeredByMask:ce.Int,areas:ce.Array(ce.OneOf({box:ce.Map({position:ce.Vector3,scale:ce.Vector3}),sphere:ce.Map({position:ce.Vector3,radius:ce.Number})})),debugColor:ce.Color3}),s=new Map,t=new Map,a=!1,r=new Map,c=new Map;function o(l){if(l)for(let[d,v]of e.getEntitiesWith(n,De)){let h=c.get(d),x=v.areas.length;for(;h.length>x;)e.removeEntity(h.pop());for(;h.length<x;)h.push(e.addEntity());let w=oi(d),k=ri(d);for(let N=0;N<x;++N){let A=v.areas[N],P=h[N],M;if(A.$case=="box")M=A.value.scale,Gn.setBox(P);else{let $=A.value.radius;M={x:$,y:$,z:$},Gn.setSphere(P)}De.createOrReplace(P,{position:X.add(w,X.rotate(A.value.position,k)),scale:M});let W=v.active?v.debugColor:Nr.Black();Rn.setPbrMaterial(P,{albedoColor:Nn.fromInts(255*W.r,255*W.g,255*W.b,75)})}}}function i(l,d,v,h){for(let x=0;x<d.areas.length;++x){let w=l[x],k=d.areas[x];if(k.$case=="box"){let N=k.value,A=X.subtract(w,X.scale(N.scale,.5)),P=X.add(A,N.scale);for(let M=0;M<h.areas.length;++M){let W=v[M],$=h.areas[M];if($.$case=="box"){let E=$.value,_=X.subtract(W,X.scale(E.scale,.5)),O=X.add(_,E.scale);if(Ll(A,P,_,O))return!0}else if(qs(A,P,W,$.value.radius))return!0}}else{let N=k.value.radius;for(let A=0;A<h.areas.length;++A){let P=v[A],M=h.areas[A];if(M.$case=="box"){let W=M.value,$=X.subtract(P,X.scale(W.scale,.5)),E=X.add($,W.scale);if(qs($,E,w,N))return!0}else if(Vl(w,N,P,M.value.radius))return!0}}}return!1}function u(l,d){let v=new Set,h=n.get(l);if(!h.active)return v;for(let[x,w]of e.getEntitiesWith(n,De)){if(x==l||!w.active||!(h.triggeredByMask&w.layerMask))continue;i(d.get(l),h,d.get(x),w)&&v.add(x)}return v}function p(){let l=[],d=[],v=new Map;for(let h of r.keys()){if(e.getEntityState(h)==Ut.Removed||!n.has(h)){for(let A of c.get(h))e.removeEntity(A);for(let A of r.values())A.has(h)&&A.delete(h);c.delete(h),r.delete(h),s.delete(h),t.delete(h);continue}let x=[],w=oi(h),k=ri(h),N=n.get(h);for(let A of N.areas)x.push(X.add(w,X.rotate(A.value.position,k)));v.set(h,x)}for(let h of r.keys()){let x=u(h,v),w=r.get(h);for(let k of w)x.has(k)||d.push([h,k]);for(let k of x)w.has(k)||l.push([h,k]);r.set(h,x)}for(let[h,x]of l){let w=s.get(h);w&&w(x)}for(let[h,x]of d){let w=t.get(h);w&&w(x)}}function m(l){p(),o(a)}e.addSystem(m,Jt.TriggerSystemPriority);function f(l){l||(l=[{type:"box"}]);let d=[];for(let v of l)v.type=="box"?d.push({$case:"box",value:{position:v.position?v.position:X.Zero(),scale:v.scale?v.scale:X.One()}}):d.push({$case:"sphere",value:{position:v.position?v.position:X.Zero(),radius:v.radius?v.radius:1}});return d}let y={addTrigger(l,d=yo,v=yo,h,x,w,k){if(d<0||d>to||!Number.isInteger(d))throw new Error(`Bad layerMask: ${d}. Expected a non-negative integer no greater than ${to}`);if(v<0||v>to||!Number.isInteger(v))throw new Error(`Bad triggeredByMask: ${v}. Expected a non-negative integer no greater than ${to}`);c.set(l,[]),r.set(l,new Set),s.set(l,x),t.set(l,w),n.createOrReplace(l,{active:!0,layerMask:d,triggeredByMask:v,areas:f(h),debugColor:k||Nr.Red()})},removeTrigger(l){let d=r.get(l),v=t.get(l);for(let x of c.get(l))e.removeEntity(x);c.delete(l),r.delete(l),s.delete(l),t.delete(l),n.deleteFrom(l);let h=[];for(let[x,w]of r)w.has(l)&&(w.delete(l),h.push(x));if(v)for(let x of d)v(x);for(let x of h){let w=t.get(x);w&&w(l)}},oneTimeTrigger(l,d=yo,v=yo,h,x,w){this.addTrigger(l,d,v,h,function(k){Ir.removeTrigger(l),x&&x(k)},void 0,w)},enableTrigger(l,d){n.getMutable(l).active=d},isTriggerEnabled(l){return n.get(l).active},getLayerMask(l){return n.get(l).layerMask},setLayerMask(l,d){if(d<0||d>to||!Number.isInteger(d))throw new Error(`Bad layerMask: ${d}. Expected a non-negative integer no greater than ${to}`);n.getMutable(l).layerMask=d},getTriggeredByMask(l){return n.get(l).triggeredByMask},setTriggeredByMask(l,d){if(d<0||d>to||!Number.isInteger(d))throw new Error(`Bad layerMask: ${d}. Expected a non-negative integer no greater than ${to}`);n.getMutable(l).triggeredByMask=d},getAreas(l){return n.get(l).areas},setAreas(l,d){n.getMutable(l).areas=f(d)},setOnEnterCallback(l,d){s.set(l,d)},setOnExitCallback(l,d){t.set(l,d)},enableDebugDraw(l){if(a=l,!l)for(let d of c.values()){for(let v of d)e.removeEntity(v);d.length=0}},isDebugDrawEnabled(){return a}};return y.addTrigger(e.PlayerEntity,Fa,yo,[{type:"box",scale:{x:.65,y:1.92,z:.65},position:{x:0,y:.15,z:0}}],void 0,void 0,Nr.Green()),y}var Ir=Jh(we);var Hs;(function(e){class n{constructor(p,m,f){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,this.engine=p,this.systemFn=y=>{this.update(y)},this.engine.addSystem(this.systemFn,Jt.ActionSystemPriority),m&&this.startSequence(m),f&&this.setOnFinishCallback(f)}startSequence(p){this.beginSequenceNode=p.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1}destroy(){this.engine.removeSystem(this.systemFn)}setOnFinishCallback(p){this.onFinishCallback=p}isRunning(){return this.running}stop(){this.running=!1}resume(){this.beginSequenceNode!=null&&(this.running=!0)}reset(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1}getRunningAction(){let p=this.currentSequenceNode;if(this.currentSequenceNode instanceof a)do p=p.currentInnerSequence;while(p instanceof a);return p.action}update(p){if(this.running){if(!this.started){this.currentSequenceNode.onStart(),this.started=!0;return}if(!this.currentSequenceNode.hasFinish()){this.currentSequenceNode.update(p);return}this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())}}}e.SequenceRunner=n;class s{constructor(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}then(p){if(this.currentSequenceNode==null)this.currentSequenceNode=new t,this.currentSequenceNode.action=p,this.beginSequenceNode=this.currentSequenceNode;else{let m=new t;m.action=p,this.currentSequenceNode=this.currentSequenceNode.then(m)}return this}if(p){let m=new r(p);return this.currentSequenceNode==null?(this.currentSequenceNode=m,this.beginSequenceNode=m):this.currentSequenceNode=this.currentSequenceNode.then(m),this}else(){let p=this.currentSequenceNode.getSequence();if(p instanceof r){p.closed=!0;let m=new c(p);this.currentSequenceNode=this.currentSequenceNode.then(m)}else throw new Error("IF statement is needed to be called before ELSE statement.");return this}endIf(){let p=this.currentSequenceNode.getSequence();if(p instanceof r||p instanceof c)p.closed=!0;else throw new Error("IF statement is needed to be called before ENDIF statement.");return this}while(p){let m=new o(p);return this.currentSequenceNode==null?(this.currentSequenceNode=m,this.beginSequenceNode=m):this.currentSequenceNode=this.currentSequenceNode.then(m),this.whileNodeStack.push(m),this}endWhile(){let p=this.currentSequenceNode.getSequence();if(p instanceof o)p.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1);else throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return this}breakWhile(){if(this.whileNodeStack.length>0)this.currentSequenceNode=this.currentSequenceNode.then(new i(this.whileNodeStack[this.whileNodeStack.length-1]));else throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this}}e.SequenceBuilder=s;class t{constructor(){this.action=null,this.next=null}then(p){return this.next=p,p}onStart(){this.action&&this.action.onStart()}update(p){this.action&&this.action.update(p)}onFinish(){this.action&&this.action.onFinish()}hasFinish(){return this.action?this.action.hasFinished:!0}getSequence(){return this}}e.SequenceNode=t;class a extends t{constructor(){super(...arguments),this.currentInnerSequence=null,this.startingInnerSequence=null,this.closed=!1}then(p){if(this.currentInnerSequence==null)this.currentInnerSequence=p,this.startingInnerSequence=p;else{if(this.closed)return this.next=p,p;this.currentInnerSequence=this.currentInnerSequence.then(p)}return this}onStart(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()}update(p){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(p))}onFinish(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()}hasFinish(){return this.currentInnerSequence==null}getSequence(){if(this.currentInnerSequence){let p=this.currentInnerSequence.getSequence();if(p instanceof a&&!p.closed)return p}return this}}class r extends a{constructor(p){super(),this.result=!1,this.condition=p}onStart(){this.result=this.condition(),this.result?super.onStart():this.currentInnerSequence=null}}class c extends a{constructor(p){super(),this.ifSequence=null,this.ifSequence=p}onStart(){this.ifSequence&&!this.ifSequence.result?super.onStart():this.currentInnerSequence=null}}class o extends a{constructor(p){super(),this.breakWhile=!1,this.condition=p}onStart(){this.breakWhile=!1,this.condition()?super.onStart():this.currentInnerSequence=null}update(p){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence==null&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(p))}hasFinish(){return this.breakWhile||!this.condition()}}class i extends t{constructor(p){super(),this.whileNode=p}onStart(){this.whileNode.breakWhile=!0}}})(Hs||(Hs={}));var ql=new Set,Gs=[];function Hl(e,n){let{Actions:s,States:t,Counter:a,Triggers:r}=Pa(e);return function(d){for(;Gs.length>0;){let{entity:h,action:x}=Gs.shift();Oa(h).emit(x.name,cn(x))}let v=e.getEntitiesWith(r);for(let[h,x]of v){if(ql.has(h))continue;let w=x.value.reduce((N,A)=>N.add(A.type),new Set);for(let N of w)switch(N){case jt.ON_CLICK:{f(h);break}case jt.ON_PLAYER_ENTERS_AREA:case jt.ON_PLAYER_LEAVES_AREA:{y(h);break}}let k=Fn(h);for(let N of x.value)k.on(N.type,()=>{if(o(N)){for(let A of N.actions)if(c(A)){let P=p(A);if(P){let M=s.getOrNull(P);if(M){let W=M.value.find($=>$.name===A.name);W&&Gs.push({entity:P,action:W})}}}}});k.emit(jt.ON_SPAWN),ql.add(h)}};function c(l){let{id:d,name:v}=l;return!!d&&!!v}function o(l){if(l.conditions&&l.conditions.length>0){let d=l.conditions.map(i),v=x=>!!x;switch(l.operation||eo.AND){case eo.AND:return d.every(v);case eo.OR:return d.some(v)}}return!0}function i(l){let d=m(l);if(d)try{switch(l.type){case sn.WHEN_STATE_IS:{let v=t.getOrNull(d);if(v!==null)return Vs(v)===l.value;break}case sn.WHEN_STATE_IS_NOT:{let v=t.getOrNull(d);if(v!==null)return Vs(v)!==l.value;break}case sn.WHEN_COUNTER_EQUALS:{let v=a.getOrNull(d);if(v!==null){let h=Number(l.value);if(!isNaN(h))return v.value===h}break}case sn.WHEN_COUNTER_IS_GREATER_THAN:{let v=a.getOrNull(d);if(v!==null){let h=Number(l.value);if(!isNaN(h))return v.value>h}break}case sn.WHEN_COUNTER_IS_LESS_THAN:{let v=a.getOrNull(d);if(v!==null){let h=Number(l.value);if(!isNaN(h))return v.value<h}break}}}catch{console.error("Error in condition",l)}return!1}function u(l,d){let v=e.getComponent(l),x=Array.from(e.getEntitiesWith(v)).find(([w,k])=>k.id===d);return Array.isArray(x)&&x.length>0?x[0]:null}function p(l){if(l.id){let d=u(Vt.ACTIONS,l.id);if(d)return d}return null}function m(l){let d=Object.values(Vt).map(v=>({componentName:v,conditionTypes:Fl(v)})).reduce((v,{componentName:h,conditionTypes:x})=>x.includes(l.type)?h:v,null);if(d&&l.id){let v=u(d,l.id);if(v)return v}return null}function f(l){n.onPointerDown({entity:l,opts:{button:0,hoverText:"Click"}},()=>{Fn(l).emit(jt.ON_CLICK)})}function y(l){Ir.addTrigger(l,yo,Fa,[{type:"box"}],()=>{Fn(l).emit(jt.ON_PLAYER_ENTERS_AREA)},()=>{Fn(l).emit(jt.ON_PLAYER_LEAVES_AREA)})}}function Gl(e,n,s){let t=e,a=n;try{Pl(t),t.addSystem(Wl(t,s)),t.addSystem(Hl(t,a)),zl(t)}catch(r){console.error(`Error initializing Asset Packs: ${r.message}`)}}var js=require("~system/RestrictedActions");var jl=["dance","disco","robot","hammer","tik"],Ua=0,si=!1;function Yl(e,n){let s=we.addEntity();De.create(s,{position:e,scale:n}),Gn.setBox(s),Aa.create(s,{visible:!1}),Ir.addTrigger(s,1,1,[{type:"box",scale:n,position:X.create(0,0,0)}],function(t){si||(si=!0,Ua=0,$l(),console.log("dancing"))},function(t){si&&(si=!1,console.log("noDance"))})}async function $l(){if(si){let e=jl[Ua];await(0,js.triggerEmote)({predefinedEmote:e}),Ua=(Ua+1)%jl.length,ai.setTimeout(()=>{$l()},3e3)}}Gl(we,Cs,{Animator:gl,AudioSource:Bs,AvatarAttach:sl,Transform:De,VisibilityComponent:Aa,GltfContainer:wr});function La(){Al(),Il(),Qn(X.create(48,5,7)),Qn(X.create(62,5,27)),Qn(X.create(69,5,54)),Qn(X.create(67,5,75)),Qn(X.create(14,5,41)),Qn(X.create(16,5,47)),Qn(X.create(16,5,82)),Qn(X.create(8.5,5,4)),we.addSystem(_l),we.addSystem(Ol),we.addSystem(kl);let e=we.addEntity();De.create(e,{position:X.create(40,.01,48)}),wr.create(e,{src:"models/new_2023C.glb"});let n=we.addEntity();De.create(n,{position:X.create(40,.01,48)}),wr.create(n,{src:"models/new_2023D.glb"});let s=we.addEntity();De.create(s,{position:X.create(45,2.5,78.9),rotation:We.fromEulerDegrees(0,-82.9,0),scale:X.create(3.75,3.75,3.75)}),vt.create(s,{urn:"urn:decentraland:ethereum:erc721:0x10daa9f4c0f985430fde4959adb2c791ef2ccf83:10004"});let t=we.addEntity();De.create(t,{position:X.create(43,2.5,71.5),rotation:We.fromEulerDegrees(0,-82.9,0),scale:X.create(3.75,3.75,3.75)}),vt.create(t,{urn:"urn:decentraland:ethereum:erc721:0x10daa9f4c0f985430fde4959adb2c791ef2ccf83:2"});let a=we.addEntity();De.create(a,{position:X.create(38.5,2.5,64),rotation:We.fromEulerDegrees(0,-45,0),scale:X.create(3.75,3.75,3.75)}),vt.create(a,{urn:"urn:decentraland:ethereum:erc721:0x10daa9f4c0f985430fde4959adb2c791ef2ccf83:1"});let r=we.addEntity();De.create(r,{position:X.create(32.5,2.5,59),rotation:We.fromEulerDegrees(0,-40,0),scale:X.create(3.75,3.75,3.75)}),vt.create(r,{urn:"urn:decentraland:ethereum:erc721:0x096de8baf03ed34790b4ce3c595b767cff517b6f:14"});let c=we.addEntity();De.create(c,{position:X.create(26.5,2.5,54),rotation:We.fromEulerDegrees(0,-40,0),scale:X.create(3.75,3.75,3.75)}),vt.create(c,{urn:"urn:decentraland:ethereum:erc721:0xb662f710ef01fc47e7c047fe85d309033e080f41:11"});let o=we.addEntity();De.create(o,{position:X.create(24,2.5,47.5),rotation:We.fromEulerDegrees(0,-78,0),scale:X.create(3.75,3.75,3.75)}),vt.create(o,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:3689"});let i=we.addEntity();De.create(i,{position:X.create(23,2.5,38.5),rotation:We.fromEulerDegrees(0,-78,0),scale:X.create(3.75,3.75,3.75)}),vt.create(i,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:1510"});let u=we.addEntity();De.create(u,{position:X.create(22,2.5,31),rotation:We.fromEulerDegrees(0,-78,0),scale:X.create(3.75,3.75,3.75)}),vt.create(u,{urn:"urn:decentraland:ethereum:erc721:0xb662f710ef01fc47e7c047fe85d309033e080f41:18"});let p=we.addEntity();De.create(p,{position:X.create(57.5,2.5,75.5),rotation:We.fromEulerDegrees(0,110,0),scale:X.create(3.75,3.75,3.75)}),vt.create(p,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:1008"});let m=we.addEntity();De.create(m,{position:X.create(54.5,2.5,67),rotation:We.fromEulerDegrees(0,110,0),scale:X.create(3.75,3.75,3.75)}),vt.create(m,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:1007"});let f=we.addEntity();De.create(f,{position:X.create(51,2.5,58),rotation:We.fromEulerDegrees(0,145,0),scale:X.create(3.75,3.75,3.75)}),vt.create(f,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000723"});let y=we.addEntity();De.create(y,{position:X.create(43.5,2.5,54),rotation:We.fromEulerDegrees(0,145,0),scale:X.create(3.75,3.75,3.75)}),vt.create(y,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000055"});let l=we.addEntity();De.create(l,{position:X.create(36,2.5,50),rotation:We.fromEulerDegrees(0,145,0),scale:X.create(3.75,3.75,3.75)}),vt.create(l,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000719"});let d=we.addEntity();De.create(d,{position:X.create(29,2.5,42.5),rotation:We.fromEulerDegrees(0,101,0),scale:X.create(3.75,3.75,3.75)}),vt.create(d,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000100"});let v=we.addEntity();De.create(v,{position:X.create(26,2.5,32.5),rotation:We.fromEulerDegrees(0,101,0),scale:X.create(3.75,3.75,3.75)}),vt.create(v,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000101"});let h=we.addEntity();De.create(h,{position:X.create(27,2.5,25.5),rotation:We.fromEulerDegrees(0,65,0),scale:X.create(3.75,3.75,3.75)}),vt.create(h,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000112"});let x=we.addEntity();De.create(x,{position:X.create(30.5,2.5,18.5),rotation:We.fromEulerDegrees(0,65,0),scale:X.create(2.7,2.7,2.7)}),vt.create(x,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000110"});let w=we.addEntity();De.create(w,{position:X.create(20,4,39),rotation:We.fromEulerDegrees(0,-80,0),scale:X.create(3.5,3.5,3.5)}),vt.create(w,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000117"});let k=we.addEntity();De.create(k,{position:X.create(21,4,47),rotation:We.fromEulerDegrees(0,-80,0),scale:X.create(3.5,3.5,3.5)}),vt.create(k,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000121"});let N=we.addEntity();De.create(N,{position:X.create(22.5,4.4,55),rotation:We.fromEulerDegrees(0,-45,0),scale:X.create(3.5,3.5,3.5)}),vt.create(N,{urn:"urn:decentraland:ethereum:erc721:0xb662f710ef01fc47e7c047fe85d309033e080f41:1"});let A=we.addEntity();De.create(A,{position:X.create(28.5,4.4,60),rotation:We.fromEulerDegrees(0,-45,0),scale:X.create(3.5,3.5,3.5)}),vt.create(A,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:1"});let P=we.addEntity();De.create(P,{position:X.create(35,4.4,65.5),rotation:We.fromEulerDegrees(0,-45,0),scale:X.create(3.5,3.5,3.5)}),vt.create(P,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:2"});let M=we.addEntity();De.create(M,{position:X.create(39,4.4,71),rotation:We.fromEulerDegrees(0,-72,0),scale:X.create(3.5,3.5,3.5)}),vt.create(M,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:3"});let W=we.addEntity();De.create(W,{position:X.create(42.5,5,39.5),rotation:We.fromEulerDegrees(0,110,0),scale:X.create(3.75,3.75,3.75)}),vt.create(W,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:5"});let $=we.addEntity();De.create($,{position:X.create(40,5,34.5),rotation:We.fromEulerDegrees(0,-115,0),scale:X.create(3.75,3.75,3.75)}),vt.create($,{urn:"urn:decentraland:ethereum:erc721:0xc9a16e8d9e41eaa51e200d9e24d9be81a05fba06:21"});let E=we.addEntity();De.create(E,{position:X.create(40.5,5,42),rotation:We.fromEulerDegrees(0,-10,0),scale:X.create(3.75,3.75,3.75)}),vt.create(E,{urn:"urn:decentraland:ethereum:erc721:0xc9a16e8d9e41eaa51e200d9e24d9be81a05fba06:18"}),Yl(X.create(12.5,1,68),X.create(23,1,19));let _=we.addEntity();Gn.setPlane(_),De.create(_,{position:{x:6,y:6,z:66},scale:X.create(11,7,11),rotation:We.fromEulerDegrees(0,-90,0)}),ul.create(_,{src:"https://bafybeieb7wfh46yjzpbdwdqnbx4kiviiub4kihibcdhjt5td4gs5txglwi.ipfs.w3s.link/ipfs/bafybeieb7wfh46yjzpbdwdqnbx4kiviiub4kihibcdhjt5td4gs5txglwi/C1%20(1)%20(1).mp4",playing:!0});let O=Rn.Texture.Video({videoPlayerEntity:_});Rn.setPbrMaterial(_,{texture:O,roughness:1,specularIntensity:0,metallic:0})}var kr=require("~system/EngineApi");function Xl(e){async function n(t){let a=await e.crdtSendToRenderer({data:new Uint8Array(t)});if(a&&a.data&&a.data.length&&s.onmessage)for(let r of a.data)s.onmessage(r)}let s={async send(t){try{await n(t)}catch(a){console.error(a);debugger}},filter(t){return t.componentId>Ss?!1:!!t}};return s}var Ys=class{constructor(n,s=!1,t,a){this.initalize(n,s,t,a)}initalize(n,s=!1,t,a){return this.mask=n,this.skipNextObservers=s,this.target=t,this.currentTarget=a,this}},$s=class{constructor(n,s,t=null){this.callback=n,this.mask=s,this.scope=t,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1}},hn=class e{constructor(n){this._observers=new Array,this._onObserverAdded=null,this._eventState=new Ys(0),n&&(this._onObserverAdded=n)}add(n,s=-1,t=!1,a=null,r=!1){if(!n)return null;let c=new $s(n,s,a);return c.unregisterOnNextCall=r,t?this._observers.unshift(c):this._observers.push(c),this._onObserverAdded&&this._onObserverAdded(c),c}addOnce(n){return this.add(n,void 0,void 0,void 0,!0)}remove(n){return n&&this._observers.indexOf(n)!==-1?(this._deferUnregister(n),!0):!1}removeCallback(n,s){for(let t=0;t<this._observers.length;t++)if(this._observers[t].callback===n&&(!s||s===this._observers[t].scope))return this._deferUnregister(this._observers[t]),!0;return!1}notifyObservers(n,s=-1,t,a){if(!this._observers.length)return!0;let r=this._eventState;r.mask=s,r.target=t,r.currentTarget=a,r.skipNextObservers=!1,r.lastReturnValue=n;for(let c of this._observers)if(!c._willBeUnregistered&&(c.mask&s&&(c.scope?r.lastReturnValue=c.callback.apply(c.scope,[n,r]):r.lastReturnValue=c.callback(n,r),c.unregisterOnNextCall&&this._deferUnregister(c)),r.skipNextObservers))return!1;return!0}notifyObserversWithPromise(n,s=-1,t,a){let r=Promise.resolve(n);if(!this._observers.length)return r;let c=this._eventState;return c.mask=s,c.target=t,c.currentTarget=a,c.skipNextObservers=!1,this._observers.forEach(o=>{c.skipNextObservers||o._willBeUnregistered||o.mask&s&&(o.scope?r=r.then(i=>(c.lastReturnValue=i,o.callback.apply(o.scope,[n,c]))):r=r.then(i=>(c.lastReturnValue=i,o.callback(n,c))),o.unregisterOnNextCall&&this._deferUnregister(o))}),r.then(()=>n)}notifyObserver(n,s,t=-1){let a=this._eventState;a.mask=t,a.skipNextObservers=!1,n.callback(s,a)}hasObservers(){return this._observers.length>0}clear(){this._observers=new Array,this._onObserverAdded=null}clone(){let n=new e;return n._observers=this._observers.slice(0),n}hasSpecificMask(n=-1){for(let s of this._observers)if(s.mask&n||s.mask===n)return!0;return!1}_deferUnregister(n){n.unregisterOnNextCall=!1,n._willBeUnregistered=!0,Promise.resolve().then.bind(Promise.resolve())(async()=>this._remove(n)).catch(console.error)}_remove(n){if(!n)return!1;let s=this._observers.indexOf(n);return s!==-1?(this._observers.splice(s,1),!0):!1}};var Zl=require("~system/EngineApi"),tm=Zl.subscribe;function Un(e){return()=>{tm({eventId:e}).catch(console.error)}}var nm=new hn(Un("onEnterScene"));var om=new hn(Un("onLeaveScene"));var rm=new hn(Un("sceneStart")),im=new hn(Un("playerExpression")),am=new hn(Un("videoEvent")),sm=new hn(Un("profileChanged")),cm=new hn(Un("playerConnected")),um=new hn(Un("playerDisconnected")),fm=new hn(Un("onRealmChanged")),lm=new hn(Un("playerClicked")),dm=new hn(Un("comms"));async function Ql(e){let{events:n}=await e({actions:[]});for(let s of n)if(s.generic){let t=JSON.parse(s.generic.eventData);switch(s.generic.eventId){case"onEnterScene":{nm.notifyObservers(t);break}case"onLeaveScene":{om.notifyObservers(t);break}case"sceneStart":{rm.notifyObservers(t);break}case"playerExpression":{im.notifyObservers(t);break}case"videoEvent":{let a=t;am.notifyObservers(a);break}case"profileChanged":{sm.notifyObservers(t);break}case"playerConnected":{cm.notifyObservers(t);break}case"playerDisconnected":{um.notifyObservers(t);break}case"onRealmChanged":{fm.notifyObservers(t);break}case"playerClicked":{lm.notifyObservers(t);break}case"comms":{dm.notifyObservers(t);break}}}}var Xs={"assetsscenemain.composite":{version:1,components:[{name:"core::Transform",jsonSchema:{type:"object",properties:{position:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},scale:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},rotation:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}}},parent:{type:"integer"}},serializationType:"transform"},data:{512:{json:{position:{x:8,y:1,z:8},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1},parent:0}}}},{name:"core::MeshRenderer",jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMeshRenderer"},data:{512:{json:{mesh:{$case:"box",box:{uvs:[]}}}}}},{name:"core-schema::Name",jsonSchema:{type:"object",properties:{value:{type:"string",serializationType:"utf8-string"}},serializationType:"map"},data:{512:{json:{value:"Magic Cube"}}}},{name:"inspector::Scene",jsonSchema:{type:"object",properties:{layout:{type:"object",properties:{base:{type:"object",properties:{x:{type:"integer",serializationType:"int32"},y:{type:"integer",serializationType:"int32"}},serializationType:"map"},parcels:{type:"array",items:{type:"object",properties:{x:{type:"integer",serializationType:"int32"},y:{type:"integer",serializationType:"int32"}},serializationType:"map"},serializationType:"array"}},serializationType:"map"}},serializationType:"map"},data:{0:{json:{layout:{base:{x:0,y:0},parcels:[{x:0,y:0}]}}}}},{name:"inspector::Nodes",jsonSchema:{type:"object",properties:{value:{type:"array",items:{type:"object",properties:{entity:{type:"integer",serializationType:"entity"},open:{type:"boolean",serializationType:"optional",optionalJsonSchema:{type:"boolean",serializationType:"boolean"}},children:{type:"array",items:{type:"integer",serializationType:"entity"},serializationType:"array"}},serializationType:"map"},serializationType:"array"}},serializationType:"map"},data:{0:{json:{value:[{entity:512,children:[513],open:!0},{entity:513,children:[]}]}}}},{name:"cube-id",jsonSchema:{type:"object",properties:{},serializationType:"map"},data:{512:{json:{}}}}]}};var Va=[],Zs={getCompositeOrNull(e,n){let s=Xs[e];if(s){try{if(s instanceof Uint8Array){let t=po.fromBinary(s);Va.push({src:e,composite:t})}else if(typeof s=="string"){let t=po.fromJson(JSON.parse(s));Va.push({src:e,composite:t})}else if(typeof s=="object"){let t=po.fromJson(s);Va.push({src:e,composite:t})}}catch(t){console.error(t)}delete Xs[e]}return Va.find(t=>t.src===e)||null}};var Da=Xl({crdtSendToRenderer:kr.crdtSendToRenderer});we.addTransport(Da);async function pm(e){we.seal(),await we.update(e),await Ql(kr.sendBatch)}async function hm(){let e=await(0,kr.crdtGetState)({data:new Uint8Array});if(!e.hasEntities){let n=Zs.getCompositeOrNull("main.composite");if(n)try{po.instance(we,n,Zs)}catch(s){console.log("Warning: main.composite couldn't be instanced."),console.error(s)}}if(Da.onmessage&&e&&e.data&&e.data.length)for(let n of e.data)Da.onmessage(n)}if(La!==void 0){let e=function(){let n=La();n&&typeof n=="object"&&typeof n.then=="function"&&n.catch(console.error),we.removeSystem(e)};we.addSystem(e,1/0)}
/*! Bundled license information:

long/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
