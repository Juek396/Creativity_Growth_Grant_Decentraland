"use strict";var Ud=Object.create;var Ei=Object.defineProperty;var Dd=Object.getOwnPropertyDescriptor;var Vd=Object.getOwnPropertyNames;var Wd=Object.getPrototypeOf,qd=Object.prototype.hasOwnProperty;var jt=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),Hd=(e,n)=>{for(var s in n)Ei(e,s,{get:n[s],enumerable:!0})},vc=(e,n,s,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of Vd(n))!qd.call(e,a)&&a!==s&&Ei(e,a,{get:()=>n[a],enumerable:!(t=Dd(n,a))||t.enumerable});return e};var Ze=(e,n,s)=>(s=e!=null?Ud(Wd(e)):{},vc(n||!e||!e.__esModule?Ei(s,"default",{value:e,enumerable:!0}):s,e)),Gd=e=>vc(Ei({},"__esModule",{value:!0}),e);var Ec=jt((t0,xc)=>{"use strict";xc.exports=Yd;function Yd(e,n){for(var s=new Array(arguments.length-1),t=0,a=2,r=!0;a<arguments.length;)s[t++]=arguments[a++];return new Promise(function(o,i){s[t]=function(h){if(r)if(r=!1,h)i(h);else{for(var m=new Array(arguments.length-1),f=0;f<m.length;)m[f++]=arguments[f];o.apply(null,m)}};try{e.apply(n||null,s)}catch(u){r&&(r=!1,i(u))}})}});var wc=jt(Tc=>{"use strict";var bi=Tc;bi.length=function(n){var s=n.length;if(!s)return 0;for(var t=0;--s%4>1&&n.charAt(s)==="=";)++t;return Math.ceil(n.length*3)/4-t};var Lo=new Array(64),gc=new Array(123);for(On=0;On<64;)gc[Lo[On]=On<26?On+65:On<52?On+71:On<62?On-4:On-59|43]=On++;var On;bi.encode=function(n,s,t){for(var a=null,r=[],c=0,o=0,i;s<t;){var u=n[s++];switch(o){case 0:r[c++]=Lo[u>>2],i=(u&3)<<4,o=1;break;case 1:r[c++]=Lo[i|u>>4],i=(u&15)<<2,o=2;break;case 2:r[c++]=Lo[i|u>>6],r[c++]=Lo[u&63],o=0;break}c>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,r)),c=0)}return o&&(r[c++]=Lo[i],r[c++]=61,o===1&&(r[c++]=61)),a?(c&&a.push(String.fromCharCode.apply(String,r.slice(0,c))),a.join("")):String.fromCharCode.apply(String,r.slice(0,c))};var bc="invalid encoding";bi.decode=function(n,s,t){for(var a=t,r=0,c,o=0;o<n.length;){var i=n.charCodeAt(o++);if(i===61&&r>1)break;if((i=gc[i])===void 0)throw Error(bc);switch(r){case 0:c=i,r=1;break;case 1:s[t++]=c<<2|(i&48)>>4,c=i,r=2;break;case 2:s[t++]=(c&15)<<4|(i&60)>>2,c=i,r=3;break;case 3:s[t++]=(c&3)<<6|i,r=0;break}}if(r===1)throw Error(bc);return t-a};bi.test=function(n){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(n)}});var _c=jt((o0,Sc)=>{"use strict";Sc.exports=gi;function gi(){this._listeners={}}gi.prototype.on=function(n,s,t){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:s,ctx:t||this}),this};gi.prototype.off=function(n,s){if(n===void 0)this._listeners={};else if(s===void 0)this._listeners[n]=[];else for(var t=this._listeners[n],a=0;a<t.length;)t[a].fn===s?t.splice(a,1):++a;return this};gi.prototype.emit=function(n){var s=this._listeners[n];if(s){for(var t=[],a=1;a<arguments.length;)t.push(arguments[a++]);for(a=0;a<s.length;)s[a].fn.apply(s[a++].ctx,t)}return this}});var Oc=jt((r0,Bc)=>{"use strict";Bc.exports=Ac(Ac);function Ac(e){return typeof Float32Array<"u"?function(){var n=new Float32Array([-0]),s=new Uint8Array(n.buffer),t=s[3]===128;function a(i,u,h){n[0]=i,u[h]=s[0],u[h+1]=s[1],u[h+2]=s[2],u[h+3]=s[3]}function r(i,u,h){n[0]=i,u[h]=s[3],u[h+1]=s[2],u[h+2]=s[1],u[h+3]=s[0]}e.writeFloatLE=t?a:r,e.writeFloatBE=t?r:a;function c(i,u){return s[0]=i[u],s[1]=i[u+1],s[2]=i[u+2],s[3]=i[u+3],n[0]}function o(i,u){return s[3]=i[u],s[2]=i[u+1],s[1]=i[u+2],s[0]=i[u+3],n[0]}e.readFloatLE=t?c:o,e.readFloatBE=t?o:c}():function(){function n(t,a,r,c){var o=a<0?1:0;if(o&&(a=-a),a===0)t(1/a>0?0:2147483648,r,c);else if(isNaN(a))t(2143289344,r,c);else if(a>34028234663852886e22)t((o<<31|2139095040)>>>0,r,c);else if(a<11754943508222875e-54)t((o<<31|Math.round(a/1401298464324817e-60))>>>0,r,c);else{var i=Math.floor(Math.log(a)/Math.LN2),u=Math.round(a*Math.pow(2,-i)*8388608)&8388607;t((o<<31|i+127<<23|u)>>>0,r,c)}}e.writeFloatLE=n.bind(null,Rc),e.writeFloatBE=n.bind(null,Nc);function s(t,a,r){var c=t(a,r),o=(c>>31)*2+1,i=c>>>23&255,u=c&8388607;return i===255?u?NaN:o*(1/0):i===0?o*1401298464324817e-60*u:o*Math.pow(2,i-150)*(u+8388608)}e.readFloatLE=s.bind(null,Cc),e.readFloatBE=s.bind(null,Ic)}(),typeof Float64Array<"u"?function(){var n=new Float64Array([-0]),s=new Uint8Array(n.buffer),t=s[7]===128;function a(i,u,h){n[0]=i,u[h]=s[0],u[h+1]=s[1],u[h+2]=s[2],u[h+3]=s[3],u[h+4]=s[4],u[h+5]=s[5],u[h+6]=s[6],u[h+7]=s[7]}function r(i,u,h){n[0]=i,u[h]=s[7],u[h+1]=s[6],u[h+2]=s[5],u[h+3]=s[4],u[h+4]=s[3],u[h+5]=s[2],u[h+6]=s[1],u[h+7]=s[0]}e.writeDoubleLE=t?a:r,e.writeDoubleBE=t?r:a;function c(i,u){return s[0]=i[u],s[1]=i[u+1],s[2]=i[u+2],s[3]=i[u+3],s[4]=i[u+4],s[5]=i[u+5],s[6]=i[u+6],s[7]=i[u+7],n[0]}function o(i,u){return s[7]=i[u],s[6]=i[u+1],s[5]=i[u+2],s[4]=i[u+3],s[3]=i[u+4],s[2]=i[u+5],s[1]=i[u+6],s[0]=i[u+7],n[0]}e.readDoubleLE=t?c:o,e.readDoubleBE=t?o:c}():function(){function n(t,a,r,c,o,i){var u=c<0?1:0;if(u&&(c=-c),c===0)t(0,o,i+a),t(1/c>0?0:2147483648,o,i+r);else if(isNaN(c))t(0,o,i+a),t(2146959360,o,i+r);else if(c>17976931348623157e292)t(0,o,i+a),t((u<<31|2146435072)>>>0,o,i+r);else{var h;if(c<22250738585072014e-324)h=c/5e-324,t(h>>>0,o,i+a),t((u<<31|h/4294967296)>>>0,o,i+r);else{var m=Math.floor(Math.log(c)/Math.LN2);m===1024&&(m=1023),h=c*Math.pow(2,-m),t(h*4503599627370496>>>0,o,i+a),t((u<<31|m+1023<<20|h*1048576&1048575)>>>0,o,i+r)}}}e.writeDoubleLE=n.bind(null,Rc,0,4),e.writeDoubleBE=n.bind(null,Nc,4,0);function s(t,a,r,c,o){var i=t(c,o+a),u=t(c,o+r),h=(u>>31)*2+1,m=u>>>20&2047,f=4294967296*(u&1048575)+i;return m===2047?f?NaN:h*(1/0):m===0?h*5e-324*f:h*Math.pow(2,m-1075)*(f+4503599627370496)}e.readDoubleLE=s.bind(null,Cc,0,4),e.readDoubleBE=s.bind(null,Ic,4,0)}(),e}function Rc(e,n,s){n[s]=e&255,n[s+1]=e>>>8&255,n[s+2]=e>>>16&255,n[s+3]=e>>>24}function Nc(e,n,s){n[s]=e>>>24,n[s+1]=e>>>16&255,n[s+2]=e>>>8&255,n[s+3]=e&255}function Cc(e,n){return(e[n]|e[n+1]<<8|e[n+2]<<16|e[n+3]<<24)>>>0}function Ic(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}});var kc=jt((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}});var Ti=jt(Mc=>{"use strict";var ts=Mc;ts.length=function(n){for(var s=0,t=0,a=0;a<n.length;++a)t=n.charCodeAt(a),t<128?s+=1:t<2048?s+=2:(t&64512)===55296&&(n.charCodeAt(a+1)&64512)===56320?(++a,s+=4):s+=3;return s};ts.read=function(n,s,t){var a=t-s;if(a<1)return"";for(var r=null,c=[],o=0,i;s<t;)i=n[s++],i<128?c[o++]=i:i>191&&i<224?c[o++]=(i&31)<<6|n[s++]&63:i>239&&i<365?(i=((i&7)<<18|(n[s++]&63)<<12|(n[s++]&63)<<6|n[s++]&63)-65536,c[o++]=55296+(i>>10),c[o++]=56320+(i&1023)):c[o++]=(i&15)<<12|(n[s++]&63)<<6|n[s++]&63,o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,c)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,c.slice(0,o))),r.join("")):String.fromCharCode.apply(String,c.slice(0,o))};ts.write=function(n,s,t){for(var a=t,r,c,o=0;o<n.length;++o)r=n.charCodeAt(o),r<128?s[t++]=r:r<2048?(s[t++]=r>>6|192,s[t++]=r&63|128):(r&64512)===55296&&((c=n.charCodeAt(o+1))&64512)===56320?(r=65536+((r&1023)<<10)+(c&1023),++o,s[t++]=r>>18|240,s[t++]=r>>12&63|128,s[t++]=r>>6&63|128,s[t++]=r&63|128):(s[t++]=r>>12|224,s[t++]=r>>6&63|128,s[t++]=r&63|128);return t-a}});var zc=jt((a0,Pc)=>{"use strict";Pc.exports=jd;function jd(e,n,s){var t=s||8192,a=t>>>1,r=null,c=t;return function(i){if(i<1||i>a)return e(i);c+i>t&&(r=e(t),c=0);var u=n.call(r,c,c+=i);return c&7&&(c=(c|7)+1),u}}});var Lc=jt((s0,Fc)=>{"use strict";Fc.exports=Zt;var Hr=io();function Zt(e,n){this.lo=e>>>0,this.hi=n>>>0}var go=Zt.zero=new Zt(0,0);go.toNumber=function(){return 0};go.zzEncode=go.zzDecode=function(){return this};go.length=function(){return 1};var $d=Zt.zeroHash="\0\0\0\0\0\0\0\0";Zt.fromNumber=function(n){if(n===0)return go;var s=n<0;s&&(n=-n);var t=n>>>0,a=(n-t)/4294967296>>>0;return s&&(a=~a>>>0,t=~t>>>0,++t>4294967295&&(t=0,++a>4294967295&&(a=0))),new Zt(t,a)};Zt.from=function(n){if(typeof n=="number")return Zt.fromNumber(n);if(Hr.isString(n))if(Hr.Long)n=Hr.Long.fromString(n);else return Zt.fromNumber(parseInt(n,10));return n.low||n.high?new Zt(n.low>>>0,n.high>>>0):go};Zt.prototype.toNumber=function(n){if(!n&&this.hi>>>31){var s=~this.lo+1>>>0,t=~this.hi>>>0;return s||(t=t+1>>>0),-(s+t*4294967296)}return this.lo+this.hi*4294967296};Zt.prototype.toLong=function(n){return Hr.Long?new Hr.Long(this.lo|0,this.hi|0,!!n):{low:this.lo|0,high:this.hi|0,unsigned:!!n}};var ro=String.prototype.charCodeAt;Zt.fromHash=function(n){return n===$d?go:new Zt((ro.call(n,0)|ro.call(n,1)<<8|ro.call(n,2)<<16|ro.call(n,3)<<24)>>>0,(ro.call(n,4)|ro.call(n,5)<<8|ro.call(n,6)<<16|ro.call(n,7)<<24)>>>0)};Zt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Zt.prototype.zzEncode=function(){var n=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^n)>>>0,this.lo=(this.lo<<1^n)>>>0,this};Zt.prototype.zzDecode=function(){var n=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^n)>>>0,this.hi=(this.hi>>>1^n)>>>0,this};Zt.prototype.length=function(){var n=this.lo,s=(this.lo>>>28|this.hi<<4)>>>0,t=this.hi>>>24;return t===0?s===0?n<16384?n<128?1:2:n<2097152?3:4:s<16384?s<128?5:6:s<2097152?7:8:t<128?9:10}});var io=jt(ns=>{"use strict";var Ye=ns;Ye.asPromise=Ec();Ye.base64=wc();Ye.EventEmitter=_c();Ye.float=Oc();Ye.inquire=kc();Ye.utf8=Ti();Ye.pool=zc();Ye.LongBits=Lc();Ye.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Ye.global=Ye.isNode&&global||!1||typeof self<"u"&&self||ns;Ye.emptyArray=Object.freeze?Object.freeze([]):[];Ye.emptyObject=Object.freeze?Object.freeze({}):{};Ye.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};Ye.isString=function(n){return typeof n=="string"||n instanceof String};Ye.isObject=function(n){return n&&typeof n=="object"};Ye.isset=Ye.isSet=function(n,s){var t=n[s];return t!=null&&n.hasOwnProperty(s)?typeof t!="object"||(Array.isArray(t)?t.length:Object.keys(t).length)>0:!1};Ye.Buffer=function(){try{var e=Ye.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch{return null}}();Ye._Buffer_from=null;Ye._Buffer_allocUnsafe=null;Ye.newBuffer=function(n){return typeof n=="number"?Ye.Buffer?Ye._Buffer_allocUnsafe(n):new Ye.Array(n):Ye.Buffer?Ye._Buffer_from(n):typeof Uint8Array>"u"?n:new Uint8Array(n)};Ye.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ye.Long=Ye.global.dcodeIO&&Ye.global.dcodeIO.Long||Ye.global.Long||Ye.inquire("long");Ye.key2Re=/^true|false|0|1$/;Ye.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ye.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ye.longToHash=function(n){return n?Ye.LongBits.from(n).toHash():Ye.LongBits.zeroHash};Ye.longFromHash=function(n,s){var t=Ye.LongBits.fromHash(n);return Ye.Long?Ye.Long.fromBits(t.lo,t.hi,s):t.toNumber(!!s)};function Uc(e,n,s){for(var t=Object.keys(n),a=0;a<t.length;++a)(e[t[a]]===void 0||!s)&&(e[t[a]]=n[t[a]]);return e}Ye.merge=Uc;Ye.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};function Dc(e){function n(s,t){if(!(this instanceof n))return new n(s,t);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:new Error().stack||""}),t&&Uc(this,t)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}Ye.newError=Dc;Ye.ProtocolError=Dc("ProtocolError");Ye.oneOfGetter=function(n){for(var s={},t=0;t<n.length;++t)s[n[t]]=1;return function(){for(var a=Object.keys(this),r=a.length-1;r>-1;--r)if(s[a[r]]===1&&this[a[r]]!==void 0&&this[a[r]]!==null)return a[r]}};Ye.oneOfSetter=function(n){return function(s){for(var t=0;t<n.length;++t)n[t]!==s&&delete this[n[t]]}};Ye.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ye._configure=function(){var e=Ye.Buffer;if(!e){Ye._Buffer_from=Ye._Buffer_allocUnsafe=null;return}Ye._Buffer_from=e.from!==Uint8Array.from&&e.from||function(s,t){return new e(s,t)},Ye._Buffer_allocUnsafe=e.allocUnsafe||function(s){return new e(s)}}});var us=jt((u0,Hc)=>{"use strict";Hc.exports=st;var An=io(),os,wi=An.LongBits,Vc=An.base64,Wc=An.utf8;function Gr(e,n,s){this.fn=e,this.len=n,this.next=void 0,this.val=s}function is(){}function Xd(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function st(){this.len=0,this.head=new Gr(is,0,0),this.tail=this.head,this.states=null}var qc=function(){return An.Buffer?function(){return(st.create=function(){return new os})()}:function(){return new st}};st.create=qc();st.alloc=function(n){return new An.Array(n)};An.Array!==Array&&(st.alloc=An.pool(st.alloc,An.Array.prototype.subarray));st.prototype._push=function(n,s,t){return this.tail=this.tail.next=new Gr(n,s,t),this.len+=s,this};function as(e,n,s){n[s]=e&255}function Zd(e,n,s){for(;e>127;)n[s++]=e&127|128,e>>>=7;n[s]=e}function ss(e,n){this.len=e,this.next=void 0,this.val=n}ss.prototype=Object.create(Gr.prototype);ss.prototype.fn=Zd;st.prototype.uint32=function(n){return this.len+=(this.tail=this.tail.next=new ss((n=n>>>0)<128?1:n<16384?2:n<2097152?3:n<268435456?4:5,n)).len,this};st.prototype.int32=function(n){return n<0?this._push(cs,10,wi.fromNumber(n)):this.uint32(n)};st.prototype.sint32=function(n){return this.uint32((n<<1^n>>31)>>>0)};function cs(e,n,s){for(;e.hi;)n[s++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)n[s++]=e.lo&127|128,e.lo=e.lo>>>7;n[s++]=e.lo}st.prototype.uint64=function(n){var s=wi.from(n);return this._push(cs,s.length(),s)};st.prototype.int64=st.prototype.uint64;st.prototype.sint64=function(n){var s=wi.from(n).zzEncode();return this._push(cs,s.length(),s)};st.prototype.bool=function(n){return this._push(as,1,n?1:0)};function rs(e,n,s){n[s]=e&255,n[s+1]=e>>>8&255,n[s+2]=e>>>16&255,n[s+3]=e>>>24}st.prototype.fixed32=function(n){return this._push(rs,4,n>>>0)};st.prototype.sfixed32=st.prototype.fixed32;st.prototype.fixed64=function(n){var s=wi.from(n);return this._push(rs,4,s.lo)._push(rs,4,s.hi)};st.prototype.sfixed64=st.prototype.fixed64;st.prototype.float=function(n){return this._push(An.float.writeFloatLE,4,n)};st.prototype.double=function(n){return this._push(An.float.writeDoubleLE,8,n)};var Qd=An.Array.prototype.set?function(n,s,t){s.set(n,t)}:function(n,s,t){for(var a=0;a<n.length;++a)s[t+a]=n[a]};st.prototype.bytes=function(n){var s=n.length>>>0;if(!s)return this._push(as,1,0);if(An.isString(n)){var t=st.alloc(s=Vc.length(n));Vc.decode(n,t,0),n=t}return this.uint32(s)._push(Qd,s,n)};st.prototype.string=function(n){var s=Wc.length(n);return s?this.uint32(s)._push(Wc.write,s,n):this._push(as,1,0)};st.prototype.fork=function(){return this.states=new Xd(this),this.head=this.tail=new Gr(is,0,0),this.len=0,this};st.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Gr(is,0,0),this.len=0),this};st.prototype.ldelim=function(){var n=this.head,s=this.tail,t=this.len;return this.reset().uint32(t),t&&(this.tail.next=n.next,this.tail=s,this.len+=t),this};st.prototype.finish=function(){for(var n=this.head.next,s=this.constructor.alloc(this.len),t=0;n;)n.fn(n.val,s,t),t+=n.len,n=n.next;return s};st._configure=function(e){os=e,st.create=qc(),os._configure()}});var jc=jt((f0,Yc)=>{"use strict";Yc.exports=Wn;var Gc=us();(Wn.prototype=Object.create(Gc.prototype)).constructor=Wn;var ao=io();function Wn(){Gc.call(this)}Wn._configure=function(){Wn.alloc=ao._Buffer_allocUnsafe,Wn.writeBytesBuffer=ao.Buffer&&ao.Buffer.prototype instanceof Uint8Array&&ao.Buffer.prototype.set.name==="set"?function(n,s,t){s.set(n,t)}:function(n,s,t){if(n.copy)n.copy(s,t,0,n.length);else for(var a=0;a<n.length;)s[t++]=n[a++]}};Wn.prototype.bytes=function(n){ao.isString(n)&&(n=ao._Buffer_from(n,"base64"));var s=n.length>>>0;return this.uint32(s),s&&this._push(Wn.writeBytesBuffer,s,n),this};function Jd(e,n,s){e.length<40?ao.utf8.write(e,n,s):n.utf8Write?n.utf8Write(e,s):n.write(e,s)}Wn.prototype.string=function(n){var s=ao.Buffer.byteLength(n);return this.uint32(s),s&&this._push(Jd,s,n),this};Wn._configure()});var ds=jt((l0,Jc)=>{"use strict";Jc.exports=Vt;var kn=io(),ls,Zc=kn.LongBits,Kd=kn.utf8;function Mn(e,n){return RangeError("index out of range: "+e.pos+" + "+(n||1)+" > "+e.len)}function Vt(e){this.buf=e,this.pos=0,this.len=e.length}var $c=typeof Uint8Array<"u"?function(n){if(n instanceof Uint8Array||Array.isArray(n))return new Vt(n);throw Error("illegal buffer")}:function(n){if(Array.isArray(n))return new Vt(n);throw Error("illegal buffer")},Qc=function(){return kn.Buffer?function(s){return(Vt.create=function(a){return kn.Buffer.isBuffer(a)?new ls(a):$c(a)})(s)}:$c};Vt.create=Qc();Vt.prototype._slice=kn.Array.prototype.subarray||kn.Array.prototype.slice;Vt.prototype.uint32=function(){var n=4294967295;return function(){if(n=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(n=(n|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return n;if((this.pos+=5)>this.len)throw this.pos=this.len,Mn(this,10);return n}}();Vt.prototype.int32=function(){return this.uint32()|0};Vt.prototype.sint32=function(){var n=this.uint32();return n>>>1^-(n&1)|0};function fs(){var e=new Zc(0,0),n=0;if(this.len-this.pos>4){for(;n<4;++n)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<n*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;n=0}else{for(;n<3;++n){if(this.pos>=this.len)throw Mn(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<n*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<n*7)>>>0,e}if(this.len-this.pos>4){for(;n<5;++n)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<n*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;n<5;++n){if(this.pos>=this.len)throw Mn(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<n*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Vt.prototype.bool=function(){return this.uint32()!==0};function Si(e,n){return(e[n-4]|e[n-3]<<8|e[n-2]<<16|e[n-1]<<24)>>>0}Vt.prototype.fixed32=function(){if(this.pos+4>this.len)throw Mn(this,4);return Si(this.buf,this.pos+=4)};Vt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Mn(this,4);return Si(this.buf,this.pos+=4)|0};function Xc(){if(this.pos+8>this.len)throw Mn(this,8);return new Zc(Si(this.buf,this.pos+=4),Si(this.buf,this.pos+=4))}Vt.prototype.float=function(){if(this.pos+4>this.len)throw Mn(this,4);var n=kn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,n};Vt.prototype.double=function(){if(this.pos+8>this.len)throw Mn(this,4);var n=kn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,n};Vt.prototype.bytes=function(){var n=this.uint32(),s=this.pos,t=this.pos+n;if(t>this.len)throw Mn(this,n);if(this.pos+=n,Array.isArray(this.buf))return this.buf.slice(s,t);if(s===t){var a=kn.Buffer;return a?a.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,s,t)};Vt.prototype.string=function(){var n=this.bytes();return Kd.read(n,0,n.length)};Vt.prototype.skip=function(n){if(typeof n=="number"){if(this.pos+n>this.len)throw Mn(this,n);this.pos+=n}else do if(this.pos>=this.len)throw Mn(this);while(this.buf[this.pos++]&128);return this};Vt.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Vt._configure=function(e){ls=e,Vt.create=Qc(),ls._configure();var n=kn.Long?"toLong":"toNumber";kn.merge(Vt.prototype,{int64:function(){return fs.call(this)[n](!1)},uint64:function(){return fs.call(this)[n](!0)},sint64:function(){return fs.call(this).zzDecode()[n](!1)},fixed64:function(){return Xc.call(this)[n](!0)},sfixed64:function(){return Xc.call(this)[n](!1)}})}});var nu=jt((d0,tu)=>{"use strict";tu.exports=To;var eu=ds();(To.prototype=Object.create(eu.prototype)).constructor=To;var Kc=io();function To(e){eu.call(this,e)}To._configure=function(){Kc.Buffer&&(To.prototype._slice=Kc.Buffer.prototype.slice)};To.prototype.string=function(){var n=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+n,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+n,this.len))};To._configure()});var ru=jt((p0,ou)=>{"use strict";ou.exports=Yr;var ps=io();(Yr.prototype=Object.create(ps.EventEmitter.prototype)).constructor=Yr;function Yr(e,n,s){if(typeof e!="function")throw TypeError("rpcImpl must be a function");ps.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!n,this.responseDelimited=!!s}Yr.prototype.rpcCall=function e(n,s,t,a,r){if(!a)throw TypeError("request must be specified");var c=this;if(!r)return ps.asPromise(e,c,n,s,t,a);if(!c.rpcImpl){setTimeout(function(){r(Error("already ended"))},0);return}try{return c.rpcImpl(n,s[c.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(i,u){if(i)return c.emit("error",i,n),r(i);if(u===null){c.end(!0);return}if(!(u instanceof t))try{u=t[c.responseDelimited?"decodeDelimited":"decode"](u)}catch(h){return c.emit("error",h,n),r(h)}return c.emit("data",u,n),r(null,u)})}catch(o){c.emit("error",o,n),setTimeout(function(){r(o)},0);return}};Yr.prototype.end=function(n){return this.rpcImpl&&(n||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var au=jt(iu=>{"use strict";var ep=iu;ep.Service=ru()});var cu=jt((m0,su)=>{"use strict";su.exports={}});var lu=jt(fu=>{"use strict";var dn=fu;dn.build="minimal";dn.Writer=us();dn.BufferWriter=jc();dn.Reader=ds();dn.BufferReader=nu();dn.util=io();dn.rpc=au();dn.roots=cu();dn.configure=uu;function uu(){dn.util._configure(),dn.Writer._configure(dn.BufferWriter),dn.Reader._configure(dn.BufferReader)}uu()});var Je=jt((v0,du)=>{"use strict";du.exports=lu()});var Qs=jt((Dl,Zs)=>{"use strict";(function(e){if(typeof Dl=="object"&&typeof Zs<"u")Zs.exports=e();else{var n;typeof global<"u"?n=global:typeof self<"u"&&(n=self),n.CANNON=e()}})(function(){var e,n,s;return function t(a,r,c){function o(h,m){if(!r[h]){if(!a[h]){var f=typeof require=="function"&&require;if(!m&&f)return f(h,!0);if(i)return i(h,!0);throw new Error("Cannot find module '"+h+"'")}var y=r[h]={exports:{}};a[h][0].call(y.exports,function(l){var d=a[h][1][l];return o(d||l)},y,y.exports,t,a,r,c)}return r[h].exports}for(var i=typeof require=="function"&&require,u=0;u<c.length;u++)o(c[u]);return o}({1:[function(t,a,r){a.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,a,r){a.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,a,r){var c=t("../math/Vec3"),o=t("../utils/Utils");a.exports=i;function i(m){m=m||{},this.lowerBound=new c,m.lowerBound&&this.lowerBound.copy(m.lowerBound),this.upperBound=new c,m.upperBound&&this.upperBound.copy(m.upperBound)}var u=new c;i.prototype.setFromPoints=function(m,f,y,l){var d=this.lowerBound,v=this.upperBound,p=y;d.copy(m[0]),p&&p.vmult(d,d),v.copy(d);for(var x=1;x<m.length;x++){var b=m[x];p&&(p.vmult(b,u),b=u),b.x>v.x&&(v.x=b.x),b.x<d.x&&(d.x=b.x),b.y>v.y&&(v.y=b.y),b.y<d.y&&(d.y=b.y),b.z>v.z&&(v.z=b.z),b.z<d.z&&(d.z=b.z)}return f&&(f.vadd(d,d),f.vadd(v,v)),l&&(d.x-=l,d.y-=l,d.z-=l,v.x+=l,v.y+=l,v.z+=l),this},i.prototype.copy=function(m){return this.lowerBound.copy(m.lowerBound),this.upperBound.copy(m.upperBound),this},i.prototype.clone=function(){return new i().copy(this)},i.prototype.extend=function(m){var f=m.lowerBound.x;this.lowerBound.x>f&&(this.lowerBound.x=f);var y=m.upperBound.x;this.upperBound.x<y&&(this.upperBound.x=y);var f=m.lowerBound.y;this.lowerBound.y>f&&(this.lowerBound.y=f);var y=m.upperBound.y;this.upperBound.y<y&&(this.upperBound.y=y);var f=m.lowerBound.z;this.lowerBound.z>f&&(this.lowerBound.z=f);var y=m.upperBound.z;this.upperBound.z<y&&(this.upperBound.z=y)},i.prototype.overlaps=function(m){var f=this.lowerBound,y=this.upperBound,l=m.lowerBound,d=m.upperBound;return(l.x<=y.x&&y.x<=d.x||f.x<=d.x&&d.x<=y.x)&&(l.y<=y.y&&y.y<=d.y||f.y<=d.y&&d.y<=y.y)&&(l.z<=y.z&&y.z<=d.z||f.z<=d.z&&d.z<=y.z)},i.prototype.contains=function(m){var f=this.lowerBound,y=this.upperBound,l=m.lowerBound,d=m.upperBound;return f.x<=l.x&&y.x>=d.x&&f.y<=l.y&&y.y>=d.y&&f.z<=l.z&&y.z>=d.z},i.prototype.getCorners=function(m,f,y,l,d,v,p,x){var b=this.lowerBound,O=this.upperBound;m.copy(b),f.set(O.x,b.y,b.z),y.set(O.x,O.y,b.z),l.set(b.x,O.y,O.z),d.set(O.x,b.y,b.z),v.set(b.x,O.y,b.z),p.set(b.x,b.y,O.z),x.copy(O)};var h=[new c,new c,new c,new c,new c,new c,new c,new c];i.prototype.toLocalFrame=function(m,f){var y=h,l=y[0],d=y[1],v=y[2],p=y[3],x=y[4],b=y[5],O=y[6],N=y[7];this.getCorners(l,d,v,p,x,b,O,N);for(var _=0;_!==8;_++){var P=y[_];m.pointToLocal(P,P)}return f.setFromPoints(y)},i.prototype.toWorldFrame=function(m,f){var y=h,l=y[0],d=y[1],v=y[2],p=y[3],x=y[4],b=y[5],O=y[6],N=y[7];this.getCorners(l,d,v,p,x,b,O,N);for(var _=0;_!==8;_++){var P=y[_];m.pointToWorld(P,P)}return f.setFromPoints(y)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,a,r){a.exports=c;function c(){this.matrix=[]}c.prototype.get=function(o,i){if(o=o.index,i=i.index,i>o){var u=i;i=o,o=u}return this.matrix[(o*(o+1)>>1)+i-1]},c.prototype.set=function(o,i,u){if(o=o.index,i=i.index,i>o){var h=i;i=o,o=h}this.matrix[(o*(o+1)>>1)+i-1]=u?1:0},c.prototype.reset=function(){for(var o=0,i=this.matrix.length;o!==i;o++)this.matrix[o]=0},c.prototype.setNumObjects=function(o){this.matrix.length=o*(o-1)>>1}},{}],5:[function(t,a,r){var c=t("../objects/Body"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../shapes/Shape"),h=t("../shapes/Plane");a.exports=m;function m(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}m.prototype.collisionPairs=function(N,_,P){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var f=c.STATIC|c.KINEMATIC;m.prototype.needBroadphaseCollision=function(N,_){return!(!(N.collisionFilterGroup&_.collisionFilterMask)||!(_.collisionFilterGroup&N.collisionFilterMask)||(N.type&f||N.sleepState===c.SLEEPING)&&(_.type&f||_.sleepState===c.SLEEPING))},m.prototype.intersectionTest=function(N,_,P,M){this.useBoundingBoxes?this.doBoundingBoxBroadphase(N,_,P,M):this.doBoundingSphereBroadphase(N,_,P,M)};var y=new o,l=new o,d=new i,v=new o;m.prototype.doBoundingSphereBroadphase=function(N,_,P,M){var q=y;_.position.vsub(N.position,q);var Q=Math.pow(N.boundingRadius+_.boundingRadius,2),w=q.norm2();w<Q&&(P.push(N),M.push(_))},m.prototype.doBoundingBoxBroadphase=function(N,_,P,M){N.aabbNeedsUpdate&&N.computeAABB(),_.aabbNeedsUpdate&&_.computeAABB(),N.aabb.overlaps(_.aabb)&&(P.push(N),M.push(_))};var p={keys:[]},x=[],b=[];m.prototype.makePairsUnique=function(N,_){for(var P=p,M=x,q=b,Q=N.length,w=0;w!==Q;w++)M[w]=N[w],q[w]=_[w];N.length=0,_.length=0;for(var w=0;w!==Q;w++){var k=M[w].id,V=q[w].id,K=k<V?k+","+V:V+","+k;P[K]=w,P.keys.push(K)}for(var w=0;w!==P.keys.length;w++){var K=P.keys.pop(),H=P[K];N.push(M[H]),_.push(q[H]),delete P[K]}},m.prototype.setWorld=function(N){};var O=new o;m.boundingSphereCheck=function(N,_){var P=O;return N.position.vsub(_.position,P),Math.pow(N.shape.boundingSphereRadius+_.shape.boundingSphereRadius,2)>P.norm2()},m.prototype.aabbQuery=function(N,_,P){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,a,r){a.exports=u;var c=t("./Broadphase"),o=t("../math/Vec3"),i=t("../shapes/Shape");function u(f,y,l,d,v){c.apply(this),this.nx=l||10,this.ny=d||10,this.nz=v||10,this.aabbMin=f||new o(100,100,100),this.aabbMax=y||new o(-100,-100,-100);var p=this.nx*this.ny*this.nz;if(p<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=p,this.binLengths.length=p;for(var x=0;x<p;x++)this.bins[x]=[],this.binLengths[x]=0}u.prototype=new c,u.prototype.constructor=u;var h=new o,m=new o;u.prototype.collisionPairs=function(f,y,l){for(var d=f.numObjects(),v=f.bodies,xe=this.aabbMax,ce=this.aabbMin,p=this.nx,x=this.ny,b=this.nz,O=x*b,N=b,_=1,P=xe.x,M=xe.y,q=xe.z,Q=ce.x,w=ce.y,k=ce.z,V=p/(P-Q),K=x/(M-w),H=b/(q-k),oe=(P-Q)/p,ie=(M-w)/x,ue=(q-k)/b,me=Math.sqrt(oe*oe+ie*ie+ue*ue)*.5,Ae=i.types,Fe=Ae.SPHERE,Me=Ae.PLANE,je=Ae.BOX,Pe=Ae.COMPOUND,D=Ae.CONVEXPOLYHEDRON,A=this.bins,F=this.binLengths,ee=this.bins.length,S=0;S!==ee;S++)F[S]=0;var L=Math.ceil,ce=Math.min,xe=Math.max;function X(De,Ut,tn,Yt,rt,B,Y){var te=(De-Q)*V|0,we=(Ut-w)*K|0,be=(tn-k)*H|0,Ce=L((Yt-Q)*V),Ie=L((rt-w)*K),lt=L((B-k)*H);te<0?te=0:te>=p&&(te=p-1),we<0?we=0:we>=x&&(we=x-1),be<0?be=0:be>=b&&(be=b-1),Ce<0?Ce=0:Ce>=p&&(Ce=p-1),Ie<0?Ie=0:Ie>=x&&(Ie=x-1),lt<0?lt=0:lt>=b&&(lt=b-1),te*=O,we*=N,be*=_,Ce*=O,Ie*=N,lt*=_;for(var Nt=te;Nt<=Ce;Nt+=O)for(var ft=we;ft<=Ie;ft+=N)for(var nn=be;nn<=lt;nn+=_){var ln=Nt+ft+nn;A[ln][F[ln]++]=Y}}for(var S=0;S!==d;S++){var C=v[S],R=C.shape;switch(R.type){case Fe:var W=C.position.x,j=C.position.y,ne=C.position.z,re=R.radius;X(W-re,j-re,ne-re,W+re,j+re,ne+re,C);break;case Me:R.worldNormalNeedsUpdate&&R.computeWorldNormal(C.quaternion);var he=R.worldNormal,Ee=Q+oe*.5-C.position.x,Te=w+ie*.5-C.position.y,Ne=k+ue*.5-C.position.z,ke=h;ke.set(Ee,Te,Ne);for(var _e=0,$e=0;_e!==p;_e++,$e+=O,ke.y=Te,ke.x+=oe)for(var qe=0,Ke=0;qe!==x;qe++,Ke+=N,ke.z=Ne,ke.y+=ie)for(var ot=0,vt=0;ot!==b;ot++,vt+=_,ke.z+=ue)if(ke.dot(he)<me){var St=$e+Ke+vt;A[St][F[St]++]=C}break;default:C.aabbNeedsUpdate&&C.computeAABB(),X(C.aabb.lowerBound.x,C.aabb.lowerBound.y,C.aabb.lowerBound.z,C.aabb.upperBound.x,C.aabb.upperBound.y,C.aabb.upperBound.z,C);break}}for(var S=0;S!==ee;S++){var yt=F[S];if(yt>1)for(var Ht=A[S],_e=0;_e!==yt;_e++)for(var C=Ht[_e],qe=0;qe!==_e;qe++){var Oe=Ht[qe];this.needBroadphaseCollision(C,Oe)&&this.intersectionTest(C,Oe,y,l)}}this.makePairsUnique(y,l)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,a,r){a.exports=i;var c=t("./Broadphase"),o=t("./AABB");function i(){c.apply(this)}i.prototype=new c,i.prototype.constructor=i,i.prototype.collisionPairs=function(h,m,f){var y=h.bodies,l=y.length,d,v,p,x;for(d=0;d!==l;d++)for(v=0;v!==d;v++)p=y[d],x=y[v],this.needBroadphaseCollision(p,x)&&this.intersectionTest(p,x,m,f)};var u=new o;i.prototype.aabbQuery=function(h,m,f){f=f||[];for(var y=0;y<h.bodies.length;y++){var l=h.bodies[y];l.aabbNeedsUpdate&&l.computeAABB(),l.aabb.overlaps(m)&&f.push(l)}return f}},{"./AABB":3,"./Broadphase":5}],8:[function(t,a,r){a.exports=c;function c(){this.matrix={}}c.prototype.get=function(o,i){if(o=o.id,i=i.id,i>o){var u=i;i=o,o=u}return o+"-"+i in this.matrix},c.prototype.set=function(o,i,u){if(o=o.id,i=i.id,i>o){var h=i;i=o,o=h}u?this.matrix[o+"-"+i]=!0:delete this.matrix[o+"-"+i]},c.prototype.reset=function(){this.matrix={}},c.prototype.setNumObjects=function(o){}},{}],9:[function(t,a,r){a.exports=l;var c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("../math/Transform"),u=t("../shapes/ConvexPolyhedron"),h=t("../shapes/Box"),m=t("../collision/RaycastResult"),f=t("../shapes/Shape"),y=t("../collision/AABB");function l(X,C){this.from=X?X.clone():new c,this.to=C?C.clone():new c,this._direction=new c,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=l.ANY,this.result=new m,this.hasHit=!1,this.callback=function(R){}}l.prototype.constructor=l,l.CLOSEST=1,l.ANY=2,l.ALL=4;var d=new y,v=[];l.prototype.intersectWorld=function(X,C){return this.mode=C.mode||l.ANY,this.result=C.result||new m,this.skipBackfaces=!!C.skipBackfaces,this.collisionFilterMask=typeof C.collisionFilterMask<"u"?C.collisionFilterMask:-1,this.collisionFilterGroup=typeof C.collisionFilterGroup<"u"?C.collisionFilterGroup:-1,C.from&&this.from.copy(C.from),C.to&&this.to.copy(C.to),this.callback=C.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(d),v.length=0,X.broadphase.aabbQuery(X,d,v),this.intersectBodies(v),this.hasHit};var p=new c,x=new c;l.pointInTriangle=b;function b(X,C,R,W){W.vsub(C,L),R.vsub(C,p),X.vsub(C,x);var j=L.dot(L),ne=L.dot(p),re=L.dot(x),he=p.dot(p),Ee=p.dot(x),Te,Ne;return(Te=he*re-ne*Ee)>=0&&(Ne=j*Ee-ne*re)>=0&&Te+Ne<j*he-ne*ne}var O=new c,N=new o;l.prototype.intersectBody=function(X,C){C&&(this.result=C,this._updateDirection());var R=this.checkCollisionResponse;if(!(R&&!X.collisionResponse)&&!(!(this.collisionFilterGroup&X.collisionFilterMask)||!(X.collisionFilterGroup&this.collisionFilterMask)))for(var W=O,j=N,ne=0,re=X.shapes.length;ne<re;ne++){var he=X.shapes[ne];if(!(R&&!he.collisionResponse)&&(X.quaternion.mult(X.shapeOrientations[ne],j),X.quaternion.vmult(X.shapeOffsets[ne],W),W.vadd(X.position,W),this.intersectShape(he,j,W,X),this.result._shouldStop))break}},l.prototype.intersectBodies=function(X,C){C&&(this.result=C,this._updateDirection());for(var R=0,W=X.length;!this.result._shouldStop&&R<W;R++)this.intersectBody(X[R])},l.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},l.prototype.intersectShape=function(X,C,R,W){var j=this.from,ne=xe(j,this._direction,R);if(!(ne>X.boundingSphereRadius)){var re=this[X.type];re&&re.call(this,X,C,R,W)}};var _=new c,P=new c,M=new c,q=new c,Q=new c,w=new c,k=new c,V=new m;l.prototype.intersectBox=function(X,C,R,W){return this.intersectConvex(X.convexPolyhedronRepresentation,C,R,W)},l.prototype[f.types.BOX]=l.prototype.intersectBox,l.prototype.intersectPlane=function(X,C,R,W){var j=this.from,ne=this.to,re=this._direction,he=new c(0,0,1);C.vmult(he,he);var Ee=new c;j.vsub(R,Ee);var Te=Ee.dot(he);ne.vsub(R,Ee);var Ne=Ee.dot(he);if(!(Te*Ne>0)&&!(j.distanceTo(ne)<Te)){var ke=he.dot(re);if(!(Math.abs(ke)<this.precision)){var _e=new c,$e=new c,qe=new c;j.vsub(R,_e);var Ke=-he.dot(_e)/ke;re.scale(Ke,$e),j.vadd($e,qe),this.reportIntersection(he,qe,X,W,-1)}}},l.prototype[f.types.PLANE]=l.prototype.intersectPlane,l.prototype.getAABB=function(X){var C=this.to,R=this.from;X.lowerBound.x=Math.min(C.x,R.x),X.lowerBound.y=Math.min(C.y,R.y),X.lowerBound.z=Math.min(C.z,R.z),X.upperBound.x=Math.max(C.x,R.x),X.upperBound.y=Math.max(C.y,R.y),X.upperBound.z=Math.max(C.z,R.z)};var K={faceList:[0]};l.prototype.intersectHeightfield=function(X,C,R,W){var j=X.data,ne=X.elementSize,re=new c,he=new l(this.from,this.to);i.pointToLocalFrame(R,C,he.from,he.from),i.pointToLocalFrame(R,C,he.to,he.to);var Ee=[],Te=null,Ne=null,ke=null,_e=null,$e=X.getIndexOfPosition(he.from.x,he.from.y,Ee,!1);if($e&&(Te=Ee[0],Ne=Ee[1],ke=Ee[0],_e=Ee[1]),$e=X.getIndexOfPosition(he.to.x,he.to.y,Ee,!1),$e&&((Te===null||Ee[0]<Te)&&(Te=Ee[0]),(ke===null||Ee[0]>ke)&&(ke=Ee[0]),(Ne===null||Ee[1]<Ne)&&(Ne=Ee[1]),(_e===null||Ee[1]>_e)&&(_e=Ee[1])),Te!==null){var qe=[];X.getRectMinMax(Te,Ne,ke,_e,qe);for(var Ke=qe[0],ot=qe[1],vt=Te;vt<=ke;vt++)for(var St=Ne;St<=_e;St++){if(this.result._shouldStop||(X.getConvexTrianglePillar(vt,St,!1),i.pointToWorldFrame(R,C,X.pillarOffset,re),this.intersectConvex(X.pillarConvex,C,re,W,K),this.result._shouldStop))return;X.getConvexTrianglePillar(vt,St,!0),i.pointToWorldFrame(R,C,X.pillarOffset,re),this.intersectConvex(X.pillarConvex,C,re,W,K)}}},l.prototype[f.types.HEIGHTFIELD]=l.prototype.intersectHeightfield;var H=new c,oe=new c;l.prototype.intersectSphere=function(X,C,R,W){var j=this.from,ne=this.to,re=X.radius,he=Math.pow(ne.x-j.x,2)+Math.pow(ne.y-j.y,2)+Math.pow(ne.z-j.z,2),Ee=2*((ne.x-j.x)*(j.x-R.x)+(ne.y-j.y)*(j.y-R.y)+(ne.z-j.z)*(j.z-R.z)),Te=Math.pow(j.x-R.x,2)+Math.pow(j.y-R.y,2)+Math.pow(j.z-R.z,2)-Math.pow(re,2),Ne=Math.pow(Ee,2)-4*he*Te,ke=H,_e=oe;if(!(Ne<0))if(Ne===0)j.lerp(ne,Ne,ke),ke.vsub(R,_e),_e.normalize(),this.reportIntersection(_e,ke,X,W,-1);else{var $e=(-Ee-Math.sqrt(Ne))/(2*he),qe=(-Ee+Math.sqrt(Ne))/(2*he);if($e>=0&&$e<=1&&(j.lerp(ne,$e,ke),ke.vsub(R,_e),_e.normalize(),this.reportIntersection(_e,ke,X,W,-1)),this.result._shouldStop)return;qe>=0&&qe<=1&&(j.lerp(ne,qe,ke),ke.vsub(R,_e),_e.normalize(),this.reportIntersection(_e,ke,X,W,-1))}},l.prototype[f.types.SPHERE]=l.prototype.intersectSphere;var ie=new c,ue=new c,me=new c,Ae=new c;l.prototype.intersectConvex=function(C,R,W,j,ne){for(var re=ue,he=ie,Ee=Ae,Te=me,Ne=ne&&ne.faceList||null,ke=C.faces,_e=C.vertices,$e=C.faceNormals,qe=this._direction,Ke=this.from,ot=this.to,vt=Ke.distanceTo(ot),St=-1,yt=Ne?Ne.length:ke.length,Ht=this.result,Oe=0;!Ht._shouldStop&&Oe<yt;Oe++){var De=Ne?Ne[Oe]:Oe,Ut=ke[De],tn=$e[De],Yt=R,rt=W;Ee.copy(_e[Ut[0]]),Yt.vmult(Ee,Ee),Ee.vadd(rt,Ee),Ee.vsub(Ke,Ee),Yt.vmult(tn,he);var B=qe.dot(he);if(!(Math.abs(B)<this.precision)){var Y=he.dot(Ee)/B;if(!(Y<0)){qe.mult(Y,M),M.vadd(Ke,M),q.copy(_e[Ut[0]]),Yt.vmult(q,q),rt.vadd(q,q);for(var te=1;!Ht._shouldStop&&te<Ut.length-1;te++){Q.copy(_e[Ut[te]]),w.copy(_e[Ut[te+1]]),Yt.vmult(Q,Q),Yt.vmult(w,w),rt.vadd(Q,Q),rt.vadd(w,w);var we=M.distanceTo(Ke);!(b(M,q,Q,w)||b(M,Q,q,w))||we>vt||this.reportIntersection(he,M,C,j,De)}}}}},l.prototype[f.types.CONVEXPOLYHEDRON]=l.prototype.intersectConvex;var Fe=new c,Me=new c,je=new c,Pe=new c,D=new c,A=new c,F=new y,ee=[],S=new i;l.prototype.intersectTrimesh=function(C,R,W,j,ne){var re=Fe,he=ee,Ee=S,Te=ue,Ne=Ae,ke=me,_e=F,$e=Me,qe=je,Ke=Pe,ot=A,vt=D,St=ne&&ne.faceList||null,yt=C.indices,Ht=C.vertices,Oe=C.faceNormals,De=this.from,Ut=this.to,tn=this._direction,Yt=-1;Ee.position.copy(W),Ee.quaternion.copy(R),i.vectorToLocalFrame(W,R,tn,$e),i.pointToLocalFrame(W,R,De,qe),i.pointToLocalFrame(W,R,Ut,Ke);var rt=qe.distanceSquared(Ke);C.tree.rayQuery(this,Ee,he);for(var B=0,Y=he.length;!this.result._shouldStop&&B!==Y;B++){var te=he[B];C.getNormal(te,re),C.getVertex(yt[te*3],q),q.vsub(qe,Ne);var we=$e.dot(re),be=re.dot(Ne)/we;if(!(be<0)){$e.scale(be,M),M.vadd(qe,M),C.getVertex(yt[te*3+1],Q),C.getVertex(yt[te*3+2],w);var Ce=M.distanceSquared(qe);!(b(M,Q,q,w)||b(M,q,Q,w))||Ce>rt||(i.vectorToWorldFrame(R,re,vt),i.pointToWorldFrame(W,R,M,ot),this.reportIntersection(vt,ot,C,j,te))}}he.length=0},l.prototype[f.types.TRIMESH]=l.prototype.intersectTrimesh,l.prototype.reportIntersection=function(X,C,R,W,j){var ne=this.from,re=this.to,he=ne.distanceTo(C),Ee=this.result;if(!(this.skipBackfaces&&X.dot(this._direction)>0))switch(Ee.hitFaceIndex=typeof j<"u"?j:-1,this.mode){case l.ALL:this.hasHit=!0,Ee.set(ne,re,X,C,R,W,he),Ee.hasHit=!0,this.callback(Ee);break;case l.CLOSEST:(he<Ee.distance||!Ee.hasHit)&&(this.hasHit=!0,Ee.hasHit=!0,Ee.set(ne,re,X,C,R,W,he));break;case l.ANY:this.hasHit=!0,Ee.hasHit=!0,Ee.set(ne,re,X,C,R,W,he),Ee._shouldStop=!0;break}};var L=new c,ce=new c;function xe(X,C,R){R.vsub(X,L);var W=L.dot(C);C.mult(W,ce),ce.vadd(X,ce);var j=R.distanceTo(ce);return j}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,a,r){var c=t("../math/Vec3");a.exports=o;function o(){this.rayFromWorld=new c,this.rayToWorld=new c,this.hitNormalWorld=new c,this.hitPointWorld=new c,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}o.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},o.prototype.abort=function(){this._shouldStop=!0},o.prototype.set=function(i,u,h,m,f,y,l){this.rayFromWorld.copy(i),this.rayToWorld.copy(u),this.hitNormalWorld.copy(h),this.hitPointWorld.copy(m),this.shape=f,this.body=y,this.distance=l}},{"../math/Vec3":30}],11:[function(t,a,r){var c=t("../shapes/Shape"),o=t("../collision/Broadphase");a.exports=i;function i(u){o.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var h=this.axisList;this._addBodyHandler=function(m){h.push(m.body)},this._removeBodyHandler=function(m){var f=h.indexOf(m.body);f!==-1&&h.splice(f,1)},u&&this.setWorld(u)}i.prototype=new o,i.prototype.setWorld=function(u){this.axisList.length=0;for(var h=0;h<u.bodies.length;h++)this.axisList.push(u.bodies[h]);u.removeEventListener("addBody",this._addBodyHandler),u.removeEventListener("removeBody",this._removeBodyHandler),u.addEventListener("addBody",this._addBodyHandler),u.addEventListener("removeBody",this._removeBodyHandler),this.world=u,this.dirty=!0},i.insertionSortX=function(u){for(var h=1,m=u.length;h<m;h++){for(var f=u[h],y=h-1;y>=0&&!(u[y].aabb.lowerBound.x<=f.aabb.lowerBound.x);y--)u[y+1]=u[y];u[y+1]=f}return u},i.insertionSortY=function(u){for(var h=1,m=u.length;h<m;h++){for(var f=u[h],y=h-1;y>=0&&!(u[y].aabb.lowerBound.y<=f.aabb.lowerBound.y);y--)u[y+1]=u[y];u[y+1]=f}return u},i.insertionSortZ=function(u){for(var h=1,m=u.length;h<m;h++){for(var f=u[h],y=h-1;y>=0&&!(u[y].aabb.lowerBound.z<=f.aabb.lowerBound.z);y--)u[y+1]=u[y];u[y+1]=f}return u},i.prototype.collisionPairs=function(u,h,m){var f=this.axisList,y=f.length,l=this.axisIndex,d,v;for(this.dirty&&(this.sortList(),this.dirty=!1),d=0;d!==y;d++){var p=f[d];for(v=d+1;v<y;v++){var x=f[v];if(this.needBroadphaseCollision(p,x)){if(!i.checkBounds(p,x,l))break;this.intersectionTest(p,x,h,m)}}}},i.prototype.sortList=function(){for(var u=this.axisList,h=this.axisIndex,m=u.length,f=0;f!==m;f++){var y=u[f];y.aabbNeedsUpdate&&y.computeAABB()}h===0?i.insertionSortX(u):h===1?i.insertionSortY(u):h===2&&i.insertionSortZ(u)},i.checkBounds=function(u,h,m){var f,y;m===0?(f=u.position.x,y=h.position.x):m===1?(f=u.position.y,y=h.position.y):m===2&&(f=u.position.z,y=h.position.z);var l=u.boundingRadius,d=h.boundingRadius,v=f-l,p=f+l,x=y-d,b=y+d;return x<p},i.prototype.autoDetectAxis=function(){for(var u=0,h=0,m=0,f=0,y=0,l=0,d=this.axisList,v=d.length,p=1/v,x=0;x!==v;x++){var b=d[x],O=b.position.x;u+=O,h+=O*O;var N=b.position.y;m+=N,f+=N*N;var _=b.position.z;y+=_,l+=_*_}var P=h-u*u*p,M=f-m*m*p,q=l-y*y*p;P>M?P>q?this.axisIndex=0:this.axisIndex=2:M>q?this.axisIndex=1:this.axisIndex=2},i.prototype.aabbQuery=function(u,h,m){m=m||[],this.dirty&&(this.sortList(),this.dirty=!1);var f=this.axisIndex,y="x";f===1&&(y="y"),f===2&&(y="z");for(var l=this.axisList,d=h.lowerBound[y],v=h.upperBound[y],p=0;p<l.length;p++){var x=l[p];x.aabbNeedsUpdate&&x.computeAABB(),x.aabb.overlaps(h)&&m.push(x)}return m}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,a,r){a.exports=f;var c=t("./Constraint"),o=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),u=t("../equations/RotationalEquation"),h=t("../equations/ContactEquation"),m=t("../math/Vec3");function f(d,v,p){p=p||{};var x=typeof p.maxForce<"u"?p.maxForce:1e6,b=p.pivotA?p.pivotA.clone():new m,O=p.pivotB?p.pivotB.clone():new m;this.axisA=p.axisA?p.axisA.clone():new m,this.axisB=p.axisB?p.axisB.clone():new m,o.call(this,d,b,v,O,x),this.collideConnected=!!p.collideConnected,this.angle=typeof p.angle<"u"?p.angle:0;var N=this.coneEquation=new i(d,v,p),_=this.twistEquation=new u(d,v,p);this.twistAngle=typeof p.twistAngle<"u"?p.twistAngle:0,N.maxForce=0,N.minForce=-x,_.maxForce=0,_.minForce=-x,this.equations.push(N,_)}f.prototype=new o,f.constructor=f;var y=new m,l=new m;f.prototype.update=function(){var d=this.bodyA,v=this.bodyB,p=this.coneEquation,x=this.twistEquation;o.prototype.update.call(this),d.vectorToWorldFrame(this.axisA,p.axisA),v.vectorToWorldFrame(this.axisB,p.axisB),this.axisA.tangents(x.axisA,x.axisA),d.vectorToWorldFrame(x.axisA,x.axisA),this.axisB.tangents(x.axisB,x.axisB),v.vectorToWorldFrame(x.axisB,x.axisB),p.angle=this.angle,x.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,a,r){a.exports=o;var c=t("../utils/Utils");function o(i,u,h){h=c.defaults(h,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=i,this.bodyB=u,this.id=o.idCounter++,this.collideConnected=h.collideConnected,h.wakeUpBodies&&(i&&i.wakeUp(),u&&u.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.prototype.enable=function(){for(var i=this.equations,u=0;u<i.length;u++)i[u].enabled=!0},o.prototype.disable=function(){for(var i=this.equations,u=0;u<i.length;u++)i[u].enabled=!1},o.idCounter=0},{"../utils/Utils":53}],14:[function(t,a,r){a.exports=i;var c=t("./Constraint"),o=t("../equations/ContactEquation");function i(u,h,m,f){c.call(this,u,h),typeof m>"u"&&(m=u.position.distanceTo(h.position)),typeof f>"u"&&(f=1e6),this.distance=m;var y=this.distanceEquation=new o(u,h);this.equations.push(y),y.minForce=-f,y.maxForce=f}i.prototype=new c,i.prototype.update=function(){var u=this.bodyA,h=this.bodyB,m=this.distanceEquation,f=this.distance*.5,y=m.ni;h.position.vsub(u.position,y),y.normalize(),y.mult(f,m.ri),y.mult(-f,m.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,a,r){a.exports=f;var c=t("./Constraint"),o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),u=t("../equations/RotationalMotorEquation"),h=t("../equations/ContactEquation"),m=t("../math/Vec3");function f(d,v,p){p=p||{};var x=typeof p.maxForce<"u"?p.maxForce:1e6,b=p.pivotA?p.pivotA.clone():new m,O=p.pivotB?p.pivotB.clone():new m;o.call(this,d,b,v,O,x);var N=this.axisA=p.axisA?p.axisA.clone():new m(1,0,0);N.normalize();var _=this.axisB=p.axisB?p.axisB.clone():new m(1,0,0);_.normalize();var P=this.rotationalEquation1=new i(d,v,p),M=this.rotationalEquation2=new i(d,v,p),q=this.motorEquation=new u(d,v,x);q.enabled=!1,this.equations.push(P,M,q)}f.prototype=new o,f.constructor=f,f.prototype.enableMotor=function(){this.motorEquation.enabled=!0},f.prototype.disableMotor=function(){this.motorEquation.enabled=!1},f.prototype.setMotorSpeed=function(d){this.motorEquation.targetVelocity=d},f.prototype.setMotorMaxForce=function(d){this.motorEquation.maxForce=d,this.motorEquation.minForce=-d};var y=new m,l=new m;f.prototype.update=function(){var d=this.bodyA,v=this.bodyB,p=this.motorEquation,x=this.rotationalEquation1,b=this.rotationalEquation2,O=y,N=l,_=this.axisA,P=this.axisB;o.prototype.update.call(this),d.quaternion.vmult(_,O),v.quaternion.vmult(P,N),O.tangents(x.axisA,b.axisA),x.axisB.copy(N),b.axisB.copy(N),this.motorEquation.enabled&&(d.quaternion.vmult(this.axisA,p.axisA),v.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,a,r){a.exports=f;var c=t("./Constraint"),o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),u=t("../equations/RotationalMotorEquation"),h=t("../equations/ContactEquation"),m=t("../math/Vec3");function f(d,v,p){p=p||{};var x=typeof p.maxForce<"u"?p.maxForce:1e6,b=new m,O=new m,N=new m;d.position.vadd(v.position,N),N.scale(.5,N),v.pointToLocalFrame(N,O),d.pointToLocalFrame(N,b),o.call(this,d,b,v,O,x);var _=this.rotationalEquation1=new i(d,v,p),P=this.rotationalEquation2=new i(d,v,p),M=this.rotationalEquation3=new i(d,v,p);this.equations.push(_,P,M)}f.prototype=new o,f.constructor=f;var y=new m,l=new m;f.prototype.update=function(){var d=this.bodyA,v=this.bodyB,p=this.motorEquation,x=this.rotationalEquation1,b=this.rotationalEquation2,O=this.rotationalEquation3,N=y,_=l;o.prototype.update.call(this),d.vectorToWorldFrame(m.UNIT_X,x.axisA),v.vectorToWorldFrame(m.UNIT_Y,x.axisB),d.vectorToWorldFrame(m.UNIT_Y,b.axisA),v.vectorToWorldFrame(m.UNIT_Z,b.axisB),d.vectorToWorldFrame(m.UNIT_Z,O.axisA),v.vectorToWorldFrame(m.UNIT_X,O.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,a,r){a.exports=u;var c=t("./Constraint"),o=t("../equations/ContactEquation"),i=t("../math/Vec3");function u(h,m,f,y,l){c.call(this,h,f),l=typeof l<"u"?l:1e6,this.pivotA=m?m.clone():new i,this.pivotB=y?y.clone():new i;var d=this.equationX=new o(h,f),v=this.equationY=new o(h,f),p=this.equationZ=new o(h,f);this.equations.push(d,v,p),d.minForce=v.minForce=p.minForce=-l,d.maxForce=v.maxForce=p.maxForce=l,d.ni.set(1,0,0),v.ni.set(0,1,0),p.ni.set(0,0,1)}u.prototype=new c,u.prototype.update=function(){var h=this.bodyA,m=this.bodyB,f=this.equationX,y=this.equationY,l=this.equationZ;h.quaternion.vmult(this.pivotA,f.ri),m.quaternion.vmult(this.pivotB,f.rj),y.ri.copy(f.ri),y.rj.copy(f.rj),l.ri.copy(f.ri),l.rj.copy(f.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Mat3"),i=t("./Equation");function u(f,y,l){l=l||{};var d=typeof l.maxForce<"u"?l.maxForce:1e6;i.call(this,f,y,-d,d),this.axisA=l.axisA?l.axisA.clone():new c(1,0,0),this.axisB=l.axisB?l.axisB.clone():new c(0,1,0),this.angle=typeof l.angle<"u"?l.angle:0}u.prototype=new i,u.prototype.constructor=u;var h=new c,m=new c;u.prototype.computeB=function(f){var y=this.a,l=this.b,d=this.axisA,v=this.axisB,p=h,x=m,b=this.jacobianElementA,O=this.jacobianElementB;d.cross(v,p),v.cross(d,x),b.rotational.copy(x),O.rotational.copy(p);var N=Math.cos(this.angle)-d.dot(v),_=this.computeGW(),P=this.computeGiMf(),M=-N*y-_*l-f*P;return M}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,a,r){a.exports=u;var c=t("./Equation"),o=t("../math/Vec3"),i=t("../math/Mat3");function u(x,b,O){O=typeof O<"u"?O:1e6,c.call(this,x,b,0,O),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}u.prototype=new c,u.prototype.constructor=u;var h=new o,m=new o,f=new o;u.prototype.computeB=function(x){var b=this.a,O=this.b,N=this.bi,_=this.bj,P=this.ri,M=this.rj,q=h,Q=m,w=N.velocity,k=N.angularVelocity,V=N.force,K=N.torque,H=_.velocity,oe=_.angularVelocity,ie=_.force,ue=_.torque,me=f,Ae=this.jacobianElementA,Fe=this.jacobianElementB,Me=this.ni;P.cross(Me,q),M.cross(Me,Q),Me.negate(Ae.spatial),q.negate(Ae.rotational),Fe.spatial.copy(Me),Fe.rotational.copy(Q),me.copy(_.position),me.vadd(M,me),me.vsub(N.position,me),me.vsub(P,me);var je=Me.dot(me),Pe=this.restitution+1,D=Pe*H.dot(Me)-Pe*w.dot(Me)+oe.dot(Q)-k.dot(q),A=this.computeGiMf(),F=-je*b-D*O-x*A;return F};var y=new o,l=new o,d=new o,v=new o,p=new o;u.prototype.getImpactVelocityAlongNormal=function(){var x=y,b=l,O=d,N=v,_=p;return this.bi.position.vadd(this.ri,O),this.bj.position.vadd(this.rj,N),this.bi.getVelocityAtWorldPoint(O,x),this.bj.getVelocityAtWorldPoint(N,b),x.vsub(b,_),this.ni.dot(_)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,a,r){a.exports=i;var c=t("../math/JacobianElement"),o=t("../math/Vec3");function i(N,_,P,M){this.id=i.id++,this.minForce=typeof P>"u"?-1e6:P,this.maxForce=typeof M>"u"?1e6:M,this.bi=N,this.bj=_,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new c,this.jacobianElementB=new c,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}i.prototype.constructor=i,i.id=0,i.prototype.setSpookParams=function(N,_,P){var M=_,q=N,Q=P;this.a=4/(Q*(1+4*M)),this.b=4*M/(1+4*M),this.eps=4/(Q*Q*q*(1+4*M))},i.prototype.computeB=function(N,_,P){var M=this.computeGW(),q=this.computeGq(),Q=this.computeGiMf();return-q*N-M*_-Q*P},i.prototype.computeGq=function(){var N=this.jacobianElementA,_=this.jacobianElementB,P=this.bi,M=this.bj,q=P.position,Q=M.position;return N.spatial.dot(q)+_.spatial.dot(Q)};var u=new o;i.prototype.computeGW=function(){var N=this.jacobianElementA,_=this.jacobianElementB,P=this.bi,M=this.bj,q=P.velocity,Q=M.velocity,w=P.angularVelocity||u,k=M.angularVelocity||u;return N.multiplyVectors(q,w)+_.multiplyVectors(Q,k)},i.prototype.computeGWlambda=function(){var N=this.jacobianElementA,_=this.jacobianElementB,P=this.bi,M=this.bj,q=P.vlambda,Q=M.vlambda,w=P.wlambda||u,k=M.wlambda||u;return N.multiplyVectors(q,w)+_.multiplyVectors(Q,k)};var h=new o,m=new o,f=new o,y=new o;i.prototype.computeGiMf=function(){var N=this.jacobianElementA,_=this.jacobianElementB,P=this.bi,M=this.bj,q=P.force,Q=P.torque,w=M.force,k=M.torque,V=P.invMassSolve,K=M.invMassSolve;return P.invInertiaWorldSolve?P.invInertiaWorldSolve.vmult(Q,f):f.set(0,0,0),M.invInertiaWorldSolve?M.invInertiaWorldSolve.vmult(k,y):y.set(0,0,0),q.mult(V,h),w.mult(K,m),N.multiplyVectors(h,f)+_.multiplyVectors(m,y)};var l=new o;i.prototype.computeGiMGt=function(){var N=this.jacobianElementA,_=this.jacobianElementB,P=this.bi,M=this.bj,q=P.invMassSolve,Q=M.invMassSolve,w=P.invInertiaWorldSolve,k=M.invInertiaWorldSolve,V=q+Q;return w&&(w.vmult(N.rotational,l),V+=l.dot(N.rotational)),k&&(k.vmult(_.rotational,l),V+=l.dot(_.rotational)),V};var d=new o,v=new o,p=new o,x=new o,b=new o,O=new o;i.prototype.addToWlambda=function(N){var _=this.jacobianElementA,P=this.jacobianElementB,M=this.bi,q=this.bj,Q=d;_.spatial.mult(M.invMassSolve*N,Q),M.vlambda.vadd(Q,M.vlambda),P.spatial.mult(q.invMassSolve*N,Q),q.vlambda.vadd(Q,q.vlambda),M.invInertiaWorldSolve&&(M.invInertiaWorldSolve.vmult(_.rotational,Q),Q.mult(N,Q),M.wlambda.vadd(Q,M.wlambda)),q.invInertiaWorldSolve&&(q.invInertiaWorldSolve.vmult(P.rotational,Q),Q.mult(N,Q),q.wlambda.vadd(Q,q.wlambda))},i.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,a,r){a.exports=u;var c=t("./Equation"),o=t("../math/Vec3"),i=t("../math/Mat3");function u(f,y,l){c.call(this,f,y,-l,l),this.ri=new o,this.rj=new o,this.t=new o}u.prototype=new c,u.prototype.constructor=u;var h=new o,m=new o;u.prototype.computeB=function(f){var y=this.a,l=this.b,d=this.bi,v=this.bj,p=this.ri,x=this.rj,b=h,O=m,N=this.t;p.cross(N,b),x.cross(N,O);var _=this.jacobianElementA,P=this.jacobianElementB;N.negate(_.spatial),b.negate(_.rotational),P.spatial.copy(N),P.rotational.copy(O);var M=this.computeGW(),q=this.computeGiMf(),Q=-M*l-f*q;return Q}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Mat3"),i=t("./Equation");function u(f,y,l){l=l||{};var d=typeof l.maxForce<"u"?l.maxForce:1e6;i.call(this,f,y,-d,d),this.axisA=l.axisA?l.axisA.clone():new c(1,0,0),this.axisB=l.axisB?l.axisB.clone():new c(0,1,0),this.maxAngle=Math.PI/2}u.prototype=new i,u.prototype.constructor=u;var h=new c,m=new c;u.prototype.computeB=function(f){var y=this.a,l=this.b,d=this.axisA,v=this.axisB,p=h,x=m,b=this.jacobianElementA,O=this.jacobianElementB;d.cross(v,p),v.cross(d,x),b.rotational.copy(x),O.rotational.copy(p);var N=Math.cos(this.maxAngle)-d.dot(v),_=this.computeGW(),P=this.computeGiMf(),M=-N*y-_*l-f*P;return M}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Mat3"),i=t("./Equation");function u(h,m,f){f=typeof f<"u"?f:1e6,i.call(this,h,m,-f,f),this.axisA=new c,this.axisB=new c,this.targetVelocity=0}u.prototype=new i,u.prototype.constructor=u,u.prototype.computeB=function(h){var m=this.a,f=this.b,y=this.bi,l=this.bj,d=this.axisA,v=this.axisB,p=this.jacobianElementA,x=this.jacobianElementB;p.rotational.copy(d),v.negate(x.rotational);var b=this.computeGW()-this.targetVelocity,O=this.computeGiMf(),N=-b*f-h*O;return N}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,a,r){var c=t("../utils/Utils");a.exports=o;function o(i,u,h){h=c.defaults(h,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=o.idCounter++,this.materials=[i,u],this.friction=h.friction,this.restitution=h.restitution,this.contactEquationStiffness=h.contactEquationStiffness,this.contactEquationRelaxation=h.contactEquationRelaxation,this.frictionEquationStiffness=h.frictionEquationStiffness,this.frictionEquationRelaxation=h.frictionEquationRelaxation}o.idCounter=0},{"../utils/Utils":53}],25:[function(t,a,r){a.exports=c;function c(o){var i="";o=o||{},typeof o=="string"?(i=o,o={}):typeof o=="object"&&(i=""),this.name=i,this.id=c.idCounter++,this.friction=typeof o.friction<"u"?o.friction:-1,this.restitution=typeof o.restitution<"u"?o.restitution:-1}c.idCounter=0},{}],26:[function(t,a,r){a.exports=o;var c=t("./Vec3");function o(){this.spatial=new c,this.rotational=new c}o.prototype.multiplyElement=function(i){return i.spatial.dot(this.spatial)+i.rotational.dot(this.rotational)},o.prototype.multiplyVectors=function(i,u){return i.dot(this.spatial)+u.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,a,r){a.exports=o;var c=t("./Vec3");function o(i){i?this.elements=i:this.elements=[0,0,0,0,0,0,0,0,0]}o.prototype.identity=function(){var i=this.elements;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1},o.prototype.setZero=function(){var i=this.elements;i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0},o.prototype.setTrace=function(i){var u=this.elements;u[0]=i.x,u[4]=i.y,u[8]=i.z},o.prototype.getTrace=function(u){var u=u||new c,h=this.elements;u.x=h[0],u.y=h[4],u.z=h[8]},o.prototype.vmult=function(i,u){u=u||new c;var h=this.elements,m=i.x,f=i.y,y=i.z;return u.x=h[0]*m+h[1]*f+h[2]*y,u.y=h[3]*m+h[4]*f+h[5]*y,u.z=h[6]*m+h[7]*f+h[8]*y,u},o.prototype.smult=function(i){for(var u=0;u<this.elements.length;u++)this.elements[u]*=i},o.prototype.mmult=function(i,u){for(var h=u||new o,m=0;m<3;m++)for(var f=0;f<3;f++){for(var y=0,l=0;l<3;l++)y+=i.elements[m+l*3]*this.elements[l+f*3];h.elements[m+f*3]=y}return h},o.prototype.scale=function(i,u){u=u||new o;for(var h=this.elements,m=u.elements,f=0;f!==3;f++)m[3*f+0]=i.x*h[3*f+0],m[3*f+1]=i.y*h[3*f+1],m[3*f+2]=i.z*h[3*f+2];return u},o.prototype.solve=function(i,u){u=u||new c;for(var h=3,m=4,f=[],y=0;y<h*m;y++)f.push(0);var y,l;for(y=0;y<3;y++)for(l=0;l<3;l++)f[y+m*l]=this.elements[y+3*l];f[3+4*0]=i.x,f[3+4*1]=i.y,f[3+4*2]=i.z;var d=3,v=d,p,x=4,b,O;do{if(y=v-d,f[y+m*y]===0){for(l=y+1;l<v;l++)if(f[y+m*l]!==0){p=x;do b=x-p,f[b+m*y]+=f[b+m*l];while(--p);break}}if(f[y+m*y]!==0)for(l=y+1;l<v;l++){var N=f[y+m*l]/f[y+m*y];p=x;do b=x-p,f[b+m*l]=b<=y?0:f[b+m*l]-f[b+m*y]*N;while(--p)}}while(--d);if(u.z=f[2*m+3]/f[2*m+2],u.y=(f[1*m+3]-f[1*m+2]*u.z)/f[1*m+1],u.x=(f[0*m+3]-f[0*m+2]*u.z-f[0*m+1]*u.y)/f[0*m+0],isNaN(u.x)||isNaN(u.y)||isNaN(u.z)||u.x===1/0||u.y===1/0||u.z===1/0)throw"Could not solve equation! Got x=["+u.toString()+"], b=["+i.toString()+"], A=["+this.toString()+"]";return u},o.prototype.e=function(i,u,h){if(h===void 0)return this.elements[u+3*i];this.elements[u+3*i]=h},o.prototype.copy=function(i){for(var u=0;u<i.elements.length;u++)this.elements[u]=i.elements[u];return this},o.prototype.toString=function(){for(var i="",u=",",h=0;h<9;h++)i+=this.elements[h]+u;return i},o.prototype.reverse=function(i){i=i||new o;for(var u=3,h=6,m=[],f=0;f<u*h;f++)m.push(0);var f,y;for(f=0;f<3;f++)for(y=0;y<3;y++)m[f+h*y]=this.elements[f+3*y];m[3+6*0]=1,m[3+6*1]=0,m[3+6*2]=0,m[4+6*0]=0,m[4+6*1]=1,m[4+6*2]=0,m[5+6*0]=0,m[5+6*1]=0,m[5+6*2]=1;var l=3,d=l,v,p=h,x;do{if(f=d-l,m[f+h*f]===0){for(y=f+1;y<d;y++)if(m[f+h*y]!==0){v=p;do x=p-v,m[x+h*f]+=m[x+h*y];while(--v);break}}if(m[f+h*f]!==0)for(y=f+1;y<d;y++){var b=m[f+h*y]/m[f+h*f];v=p;do x=p-v,m[x+h*y]=x<=f?0:m[x+h*y]-m[x+h*f]*b;while(--v)}}while(--l);f=2;do{y=f-1;do{var b=m[f+h*y]/m[f+h*f];v=h;do x=h-v,m[x+h*y]=m[x+h*y]-m[x+h*f]*b;while(--v)}while(y--)}while(--f);f=2;do{var b=1/m[f+h*f];v=h;do x=h-v,m[x+h*f]=m[x+h*f]*b;while(--v)}while(f--);f=2;do{y=2;do{if(x=m[u+y+h*f],isNaN(x)||x===1/0)throw"Could not reverse! A=["+this.toString()+"]";i.e(f,y,x)}while(y--)}while(f--);return i},o.prototype.setRotationFromQuaternion=function(i){var u=i.x,h=i.y,m=i.z,f=i.w,y=u+u,l=h+h,d=m+m,v=u*y,p=u*l,x=u*d,b=h*l,O=h*d,N=m*d,_=f*y,P=f*l,M=f*d,q=this.elements;return q[3*0+0]=1-(b+N),q[3*0+1]=p-M,q[3*0+2]=x+P,q[3*1+0]=p+M,q[3*1+1]=1-(v+N),q[3*1+2]=O-_,q[3*2+0]=x-P,q[3*2+1]=O+_,q[3*2+2]=1-(v+b),this},o.prototype.transpose=function(i){i=i||new o;for(var u=i.elements,h=this.elements,m=0;m!==3;m++)for(var f=0;f!==3;f++)u[3*m+f]=h[3*f+m];return i}},{"./Vec3":30}],28:[function(t,a,r){a.exports=o;var c=t("./Vec3");function o(y,l,d,v){this.x=y!==void 0?y:0,this.y=l!==void 0?l:0,this.z=d!==void 0?d:0,this.w=v!==void 0?v:1}o.prototype.set=function(y,l,d,v){this.x=y,this.y=l,this.z=d,this.w=v},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(y,l){var d=Math.sin(l*.5);this.x=y.x*d,this.y=y.y*d,this.z=y.z*d,this.w=Math.cos(l*.5)},o.prototype.toAxisAngle=function(y){y=y||new c,this.normalize();var l=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);return d<.001?(y.x=this.x,y.y=this.y,y.z=this.z):(y.x=this.x/d,y.y=this.y/d,y.z=this.z/d),[y,l]};var i=new c,u=new c;o.prototype.setFromVectors=function(y,l){if(y.isAntiparallelTo(l)){var d=i,v=u;y.tangents(d,v),this.setFromAxisAngle(d,Math.PI)}else{var p=y.cross(l);this.x=p.x,this.y=p.y,this.z=p.z,this.w=Math.sqrt(Math.pow(y.norm(),2)*Math.pow(l.norm(),2))+y.dot(l),this.normalize()}};var h=new c,m=new c,f=new c;o.prototype.mult=function(y,l){l=l||new o;var d=this.w,v=h,p=m,x=f;return v.set(this.x,this.y,this.z),p.set(y.x,y.y,y.z),l.w=d*y.w-v.dot(p),v.cross(p,x),l.x=d*p.x+y.w*v.x+x.x,l.y=d*p.y+y.w*v.y+x.y,l.z=d*p.z+y.w*v.z+x.z,l},o.prototype.inverse=function(y){var l=this.x,d=this.y,v=this.z,p=this.w;y=y||new o,this.conjugate(y);var x=1/(l*l+d*d+v*v+p*p);return y.x*=x,y.y*=x,y.z*=x,y.w*=x,y},o.prototype.conjugate=function(y){return y=y||new o,y.x=-this.x,y.y=-this.y,y.z=-this.z,y.w=this.w,y},o.prototype.normalize=function(){var y=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);y===0?(this.x=0,this.y=0,this.z=0,this.w=0):(y=1/y,this.x*=y,this.y*=y,this.z*=y,this.w*=y)},o.prototype.normalizeFast=function(){var y=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;y===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=y,this.y*=y,this.z*=y,this.w*=y)},o.prototype.vmult=function(y,l){l=l||new c;var d=y.x,v=y.y,p=y.z,x=this.x,b=this.y,O=this.z,N=this.w,_=N*d+b*p-O*v,P=N*v+O*d-x*p,M=N*p+x*v-b*d,q=-x*d-b*v-O*p;return l.x=_*N+q*-x+P*-O-M*-b,l.y=P*N+q*-b+M*-x-_*-O,l.z=M*N+q*-O+_*-b-P*-x,l},o.prototype.copy=function(y){return this.x=y.x,this.y=y.y,this.z=y.z,this.w=y.w,this},o.prototype.toEuler=function(y,l){l=l||"YZX";var d,v,p,x=this.x,b=this.y,O=this.z,N=this.w;switch(l){case"YZX":var _=x*b+O*N;if(_>.499&&(d=2*Math.atan2(x,N),v=Math.PI/2,p=0),_<-.499&&(d=-2*Math.atan2(x,N),v=-Math.PI/2,p=0),isNaN(d)){var P=x*x,M=b*b,q=O*O;d=Math.atan2(2*b*N-2*x*O,1-2*M-2*q),v=Math.asin(2*_),p=Math.atan2(2*x*N-2*b*O,1-2*P-2*q)}break;default:throw new Error("Euler order "+l+" not supported yet.")}y.y=d,y.z=v,y.x=p},o.prototype.setFromEuler=function(y,l,d,v){v=v||"XYZ";var p=Math.cos(y/2),x=Math.cos(l/2),b=Math.cos(d/2),O=Math.sin(y/2),N=Math.sin(l/2),_=Math.sin(d/2);return v==="XYZ"?(this.x=O*x*b+p*N*_,this.y=p*N*b-O*x*_,this.z=p*x*_+O*N*b,this.w=p*x*b-O*N*_):v==="YXZ"?(this.x=O*x*b+p*N*_,this.y=p*N*b-O*x*_,this.z=p*x*_-O*N*b,this.w=p*x*b+O*N*_):v==="ZXY"?(this.x=O*x*b-p*N*_,this.y=p*N*b+O*x*_,this.z=p*x*_+O*N*b,this.w=p*x*b-O*N*_):v==="ZYX"?(this.x=O*x*b-p*N*_,this.y=p*N*b+O*x*_,this.z=p*x*_-O*N*b,this.w=p*x*b+O*N*_):v==="YZX"?(this.x=O*x*b+p*N*_,this.y=p*N*b+O*x*_,this.z=p*x*_-O*N*b,this.w=p*x*b-O*N*_):v==="XZY"&&(this.x=O*x*b-p*N*_,this.y=p*N*b-O*x*_,this.z=p*x*_+O*N*b,this.w=p*x*b+O*N*_),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,a,r){var c=t("./Vec3"),o=t("./Quaternion");a.exports=i;function i(h){h=h||{},this.position=new c,h.position&&this.position.copy(h.position),this.quaternion=new o,h.quaternion&&this.quaternion.copy(h.quaternion)}var u=new o;i.pointToLocalFrame=function(h,m,f,l){var l=l||new c;return f.vsub(h,l),m.conjugate(u),u.vmult(l,l),l},i.prototype.pointToLocal=function(h,m){return i.pointToLocalFrame(this.position,this.quaternion,h,m)},i.pointToWorldFrame=function(h,m,f,l){var l=l||new c;return m.vmult(f,l),l.vadd(h,l),l},i.prototype.pointToWorld=function(h,m){return i.pointToWorldFrame(this.position,this.quaternion,h,m)},i.prototype.vectorToWorldFrame=function(h,f){var f=f||new c;return this.quaternion.vmult(h,f),f},i.vectorToWorldFrame=function(h,m,f){return h.vmult(m,f),f},i.vectorToLocalFrame=function(h,m,f,l){var l=l||new c;return m.w*=-1,m.vmult(f,l),m.w*=-1,l}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,a,r){a.exports=o;var c=t("./Mat3");function o(m,f,y){this.x=m||0,this.y=f||0,this.z=y||0}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1),o.prototype.cross=function(m,f){var y=m.x,l=m.y,d=m.z,v=this.x,p=this.y,x=this.z;return f=f||new o,f.x=p*d-x*l,f.y=x*y-v*d,f.z=v*l-p*y,f},o.prototype.set=function(m,f,y){return this.x=m,this.y=f,this.z=y,this},o.prototype.setZero=function(){this.x=this.y=this.z=0},o.prototype.vadd=function(m,f){if(f)f.x=m.x+this.x,f.y=m.y+this.y,f.z=m.z+this.z;else return new o(this.x+m.x,this.y+m.y,this.z+m.z)},o.prototype.vsub=function(m,f){if(f)f.x=this.x-m.x,f.y=this.y-m.y,f.z=this.z-m.z;else return new o(this.x-m.x,this.y-m.y,this.z-m.z)},o.prototype.crossmat=function(){return new c([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},o.prototype.normalize=function(){var m=this.x,f=this.y,y=this.z,l=Math.sqrt(m*m+f*f+y*y);if(l>0){var d=1/l;this.x*=d,this.y*=d,this.z*=d}else this.x=0,this.y=0,this.z=0;return l},o.prototype.unit=function(m){m=m||new o;var f=this.x,y=this.y,l=this.z,d=Math.sqrt(f*f+y*y+l*l);return d>0?(d=1/d,m.x=f*d,m.y=y*d,m.z=l*d):(m.x=1,m.y=0,m.z=0),m},o.prototype.norm=function(){var m=this.x,f=this.y,y=this.z;return Math.sqrt(m*m+f*f+y*y)},o.prototype.length=o.prototype.norm,o.prototype.norm2=function(){return this.dot(this)},o.prototype.lengthSquared=o.prototype.norm2,o.prototype.distanceTo=function(m){var f=this.x,y=this.y,l=this.z,d=m.x,v=m.y,p=m.z;return Math.sqrt((d-f)*(d-f)+(v-y)*(v-y)+(p-l)*(p-l))},o.prototype.distanceSquared=function(m){var f=this.x,y=this.y,l=this.z,d=m.x,v=m.y,p=m.z;return(d-f)*(d-f)+(v-y)*(v-y)+(p-l)*(p-l)},o.prototype.mult=function(m,f){f=f||new o;var y=this.x,l=this.y,d=this.z;return f.x=m*y,f.y=m*l,f.z=m*d,f},o.prototype.scale=o.prototype.mult,o.prototype.dot=function(m){return this.x*m.x+this.y*m.y+this.z*m.z},o.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},o.prototype.negate=function(m){return m=m||new o,m.x=-this.x,m.y=-this.y,m.z=-this.z,m};var i=new o,u=new o;o.prototype.tangents=function(m,f){var y=this.norm();if(y>0){var l=i,d=1/y;l.set(this.x*d,this.y*d,this.z*d);var v=u;Math.abs(l.x)<.9?(v.set(1,0,0),l.cross(v,m)):(v.set(0,1,0),l.cross(v,m)),l.cross(m,f)}else m.set(1,0,0),f.set(0,1,0)},o.prototype.toString=function(){return this.x+","+this.y+","+this.z},o.prototype.toArray=function(){return[this.x,this.y,this.z]},o.prototype.copy=function(m){return this.x=m.x,this.y=m.y,this.z=m.z,this},o.prototype.lerp=function(m,f,y){var l=this.x,d=this.y,v=this.z;y.x=l+(m.x-l)*f,y.y=d+(m.y-d)*f,y.z=v+(m.z-v)*f},o.prototype.almostEquals=function(m,f){return f===void 0&&(f=1e-6),!(Math.abs(this.x-m.x)>f||Math.abs(this.y-m.y)>f||Math.abs(this.z-m.z)>f)},o.prototype.almostZero=function(m){return m===void 0&&(m=1e-6),!(Math.abs(this.x)>m||Math.abs(this.y)>m||Math.abs(this.z)>m)};var h=new o;o.prototype.isAntiparallelTo=function(m,f){return this.negate(h),h.almostEquals(m,f)},o.prototype.clone=function(){return new o(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,a,r){a.exports=l;var c=t("../utils/EventTarget"),o=t("../shapes/Shape"),i=t("../math/Vec3"),u=t("../math/Mat3"),h=t("../math/Quaternion"),m=t("../material/Material"),f=t("../collision/AABB"),y=t("../shapes/Box");function l(H){H=H||{},c.apply(this),this.id=l.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup=typeof H.collisionFilterGroup=="number"?H.collisionFilterGroup:1,this.collisionFilterMask=typeof H.collisionFilterMask=="number"?H.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,H.position&&this.position.copy(H.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,H.velocity&&this.velocity.copy(H.velocity),this.initVelocity=new i,this.force=new i;var oe=typeof H.mass=="number"?H.mass:0;this.mass=oe,this.invMass=oe>0?1/oe:0,this.material=H.material||null,this.linearDamping=typeof H.linearDamping=="number"?H.linearDamping:.01,this.type=oe<=0?l.STATIC:l.DYNAMIC,typeof H.type==typeof l.STATIC&&(this.type=H.type),this.allowSleep=typeof H.allowSleep<"u"?H.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof H.sleepSpeedLimit<"u"?H.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof H.sleepTimeLimit<"u"?H.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new h,H.quaternion&&this.quaternion.copy(H.quaternion),this.initQuaternion=new h,this.angularVelocity=new i,H.angularVelocity&&this.angularVelocity.copy(H.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new h,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new u,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new u,this.fixedRotation=typeof H.fixedRotation<"u"?H.fixedRotation:!1,this.angularDamping=typeof H.angularDamping<"u"?H.angularDamping:.01,this.aabb=new f,this.aabbNeedsUpdate=!0,this.wlambda=new i,H.shape&&this.addShape(H.shape),this.updateMassProperties()}l.prototype=new c,l.prototype.constructor=l,l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2,l.idCounter=0,l.prototype.wakeUp=function(){var H=this.sleepState;this.sleepState=0,H===l.SLEEPING&&this.dispatchEvent({type:"wakeup"})},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.prototype.sleepTick=function(H){if(this.allowSleep){var oe=this.sleepState,ie=this.velocity.norm2()+this.angularVelocity.norm2(),ue=Math.pow(this.sleepSpeedLimit,2);oe===l.AWAKE&&ie<ue?(this.sleepState=l.SLEEPY,this.timeLastSleepy=H,this.dispatchEvent(l.sleepyEvent)):oe===l.SLEEPY&&ie>ue?this.wakeUp():oe===l.SLEEPY&&H-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(l.sleepEvent))}},l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},l.prototype.pointToLocalFrame=function(H,ie){var ie=ie||new i;return H.vsub(this.position,ie),this.quaternion.conjugate().vmult(ie,ie),ie},l.prototype.vectorToLocalFrame=function(H,ie){var ie=ie||new i;return this.quaternion.conjugate().vmult(H,ie),ie},l.prototype.pointToWorldFrame=function(H,ie){var ie=ie||new i;return this.quaternion.vmult(H,ie),ie.vadd(this.position,ie),ie},l.prototype.vectorToWorldFrame=function(H,ie){var ie=ie||new i;return this.quaternion.vmult(H,ie),ie};var d=new i,v=new h;l.prototype.addShape=function(H,oe,ie){var ue=new i,me=new h;return oe&&ue.copy(oe),ie&&me.copy(ie),this.shapes.push(H),this.shapeOffsets.push(ue),this.shapeOrientations.push(me),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},l.prototype.updateBoundingRadius=function(){for(var H=this.shapes,oe=this.shapeOffsets,ie=H.length,ue=0,me=0;me!==ie;me++){var Ae=H[me];Ae.updateBoundingSphereRadius();var Fe=oe[me].norm(),Me=Ae.boundingSphereRadius;Fe+Me>ue&&(ue=Fe+Me)}this.boundingRadius=ue};var p=new f;l.prototype.computeAABB=function(){for(var H=this.shapes,oe=this.shapeOffsets,ie=this.shapeOrientations,ue=H.length,me=d,Ae=v,Fe=this.quaternion,Me=this.aabb,je=p,Pe=0;Pe!==ue;Pe++){var D=H[Pe];ie[Pe].mult(Fe,Ae),Ae.vmult(oe[Pe],me),me.vadd(this.position,me),D.calculateWorldAABB(me,Ae,je.lowerBound,je.upperBound),Pe===0?Me.copy(je):Me.extend(je)}this.aabbNeedsUpdate=!1};var x=new u,b=new u,O=new u;l.prototype.updateInertiaWorld=function(H){var oe=this.invInertia;if(!(oe.x===oe.y&&oe.y===oe.z&&!H)){var ie=x,ue=b,me=O;ie.setRotationFromQuaternion(this.quaternion),ie.transpose(ue),ie.scale(oe,ie),ie.mmult(ue,this.invInertiaWorld)}};var N=new i,_=new i;l.prototype.applyForce=function(H,oe){if(this.type===l.DYNAMIC){var ie=N;oe.vsub(this.position,ie);var ue=_;ie.cross(H,ue),this.force.vadd(H,this.force),this.torque.vadd(ue,this.torque)}};var P=new i,M=new i;l.prototype.applyLocalForce=function(H,oe){if(this.type===l.DYNAMIC){var ie=P,ue=M;this.vectorToWorldFrame(H,ie),this.pointToWorldFrame(oe,ue),this.applyForce(ie,ue)}};var q=new i,Q=new i,w=new i;l.prototype.applyImpulse=function(H,oe){if(this.type===l.DYNAMIC){var ie=q;oe.vsub(this.position,ie);var ue=Q;ue.copy(H),ue.mult(this.invMass,ue),this.velocity.vadd(ue,this.velocity);var me=w;ie.cross(H,me),this.invInertiaWorld.vmult(me,me),this.angularVelocity.vadd(me,this.angularVelocity)}};var k=new i,V=new i;l.prototype.applyLocalImpulse=function(H,oe){if(this.type===l.DYNAMIC){var ie=k,ue=V;this.vectorToWorldFrame(H,ie),this.pointToWorldFrame(oe,ue),this.applyImpulse(ie,ue)}};var K=new i;l.prototype.updateMassProperties=function(){var H=K;this.invMass=this.mass>0?1/this.mass:0;var oe=this.inertia,ie=this.fixedRotation;this.computeAABB(),H.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),y.calculateInertia(H,this.mass,oe),this.invInertia.set(oe.x>0&&!ie?1/oe.x:0,oe.y>0&&!ie?1/oe.y:0,oe.z>0&&!ie?1/oe.z:0),this.updateInertiaWorld(!0)},l.prototype.getVelocityAtWorldPoint=function(H,oe){var ie=new i;return H.vsub(this.position,ie),this.angularVelocity.cross(ie,oe),this.velocity.vadd(oe,oe),oe}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,a,r){var c=t("./Body"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../collision/RaycastResult"),h=t("../collision/Ray"),m=t("../objects/WheelInfo");a.exports=f;function f(D){this.chassisBody=D.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof D.indexRightAxis<"u"?D.indexRightAxis:1,this.indexForwardAxis=typeof D.indexForwardAxis<"u"?D.indexForwardAxis:0,this.indexUpAxis=typeof D.indexUpAxis<"u"?D.indexUpAxis:2}var y=new o,l=new o,d=new o,v=new o,p=new o,x=new o,b=new h;f.prototype.addWheel=function(D){D=D||{};var A=new m(D),F=this.wheelInfos.length;return this.wheelInfos.push(A),F},f.prototype.setSteeringValue=function(D,A){var F=this.wheelInfos[A];F.steering=D};var O=new o;f.prototype.applyEngineForce=function(D,A){this.wheelInfos[A].engineForce=D},f.prototype.setBrake=function(D,A){this.wheelInfos[A].brake=D},f.prototype.addToWorld=function(D){var A=this.constraints;D.add(this.chassisBody);var F=this;this.preStepCallback=function(){F.updateVehicle(D.dt)},D.addEventListener("preStep",this.preStepCallback),this.world=D},f.prototype.getVehicleAxisWorld=function(D,A){A.set(D===0?1:0,D===1?1:0,D===2?1:0),this.chassisBody.vectorToWorldFrame(A,A)},f.prototype.updateVehicle=function(D){for(var A=this.wheelInfos,F=A.length,ee=this.chassisBody,S=0;S<F;S++)this.updateWheelTransform(S);this.currentVehicleSpeedKmHour=3.6*ee.velocity.norm();var L=new o;this.getVehicleAxisWorld(this.indexForwardAxis,L),L.dot(ee.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var S=0;S<F;S++)this.castRay(A[S]);this.updateSuspension(D);for(var ce=new o,xe=new o,S=0;S<F;S++){var X=A[S],C=X.suspensionForce;C>X.maxSuspensionForce&&(C=X.maxSuspensionForce),X.raycastResult.hitNormalWorld.scale(C*D,ce),X.raycastResult.hitPointWorld.vsub(ee.position,xe),ee.applyImpulse(ce,X.raycastResult.hitPointWorld)}this.updateFriction(D);var R=new o,W=new o,j=new o;for(S=0;S<F;S++){var X=A[S];ee.getVelocityAtWorldPoint(X.chassisConnectionPointWorld,j);var ne=1;switch(this.indexUpAxis){case 1:ne=-1;break}if(X.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,W);var re=W.dot(X.raycastResult.hitNormalWorld);X.raycastResult.hitNormalWorld.scale(re,R),W.vsub(R,W);var he=W.dot(j);X.deltaRotation=ne*he*D/X.radius}(X.sliding||!X.isInContact)&&X.engineForce!==0&&X.useCustomSlidingRotationalSpeed&&(X.deltaRotation=(X.engineForce>0?1:-1)*X.customSlidingRotationalSpeed*D),Math.abs(X.brake)>Math.abs(X.engineForce)&&(X.deltaRotation=0),X.rotation+=X.deltaRotation,X.deltaRotation*=.99}},f.prototype.updateSuspension=function(D){for(var A=this.chassisBody,F=A.mass,ee=this.wheelInfos,S=ee.length,L=0;L<S;L++){var ce=ee[L];if(ce.isInContact){var xe,X=ce.suspensionRestLength,C=ce.suspensionLength,R=X-C;xe=ce.suspensionStiffness*R*ce.clippedInvContactDotSuspension;var W=ce.suspensionRelativeVelocity,j;W<0?j=ce.dampingCompression:j=ce.dampingRelaxation,xe-=j*W,ce.suspensionForce=xe*F,ce.suspensionForce<0&&(ce.suspensionForce=0)}else ce.suspensionForce=0}},f.prototype.removeFromWorld=function(D){var A=this.constraints;D.remove(this.chassisBody),D.removeEventListener("preStep",this.preStepCallback),this.world=null};var N=new o,_=new o;f.prototype.castRay=function(D){var A=N,F=_;this.updateWheelTransformWorld(D);var ee=this.chassisBody,S=-1,L=D.suspensionRestLength+D.radius;D.directionWorld.scale(L,A);var ce=D.chassisConnectionPointWorld;ce.vadd(A,F);var xe=D.raycastResult,X=0;xe.reset();var C=ee.collisionResponse;ee.collisionResponse=!1,this.world.rayTest(ce,F,xe),ee.collisionResponse=C;var R=xe.body;if(D.raycastResult.groundObject=0,R){S=xe.distance,D.raycastResult.hitNormalWorld=xe.hitNormalWorld,D.isInContact=!0;var W=xe.distance;D.suspensionLength=W-D.radius;var j=D.suspensionRestLength-D.maxSuspensionTravel,ne=D.suspensionRestLength+D.maxSuspensionTravel;D.suspensionLength<j&&(D.suspensionLength=j),D.suspensionLength>ne&&(D.suspensionLength=ne,D.raycastResult.reset());var re=D.raycastResult.hitNormalWorld.dot(D.directionWorld),he=new o;ee.getVelocityAtWorldPoint(D.raycastResult.hitPointWorld,he);var Ee=D.raycastResult.hitNormalWorld.dot(he);if(re>=-.1)D.suspensionRelativeVelocity=0,D.clippedInvContactDotSuspension=1/.1;else{var Te=-1/re;D.suspensionRelativeVelocity=Ee*Te,D.clippedInvContactDotSuspension=Te}}else D.suspensionLength=D.suspensionRestLength+0*D.maxSuspensionTravel,D.suspensionRelativeVelocity=0,D.directionWorld.scale(-1,D.raycastResult.hitNormalWorld),D.clippedInvContactDotSuspension=1;return S},f.prototype.updateWheelTransformWorld=function(D){D.isInContact=!1;var A=this.chassisBody;A.pointToWorldFrame(D.chassisConnectionPointLocal,D.chassisConnectionPointWorld),A.vectorToWorldFrame(D.directionLocal,D.directionWorld),A.vectorToWorldFrame(D.axleLocal,D.axleWorld)},f.prototype.updateWheelTransform=function(D){var A=v,F=p,ee=x,S=this.wheelInfos[D];this.updateWheelTransformWorld(S),S.directionLocal.scale(-1,A),F.copy(S.axleLocal),A.cross(F,ee),ee.normalize(),F.normalize();var L=S.steering,ce=new i;ce.setFromAxisAngle(A,L);var xe=new i;xe.setFromAxisAngle(F,S.rotation);var X=S.worldTransform.quaternion;this.chassisBody.quaternion.mult(ce,X),X.mult(xe,X),X.normalize();var C=S.worldTransform.position;C.copy(S.directionWorld),C.scale(S.suspensionLength,C),C.vadd(S.chassisConnectionPointWorld,C)};var P=[new o(1,0,0),new o(0,1,0),new o(0,0,1)];f.prototype.getWheelTransformWorld=function(D){return this.wheelInfos[D].worldTransform};var M=new o,q=[],Q=[],w=1;f.prototype.updateFriction=function(D){for(var A=M,F=this.wheelInfos,ee=F.length,S=this.chassisBody,L=Q,ce=q,xe=0,X=0;X<ee;X++){var C=F[X],R=C.raycastResult.body;R&&xe++,C.sideImpulse=0,C.forwardImpulse=0,L[X]||(L[X]=new o),ce[X]||(ce[X]=new o)}for(var X=0;X<ee;X++){var C=F[X],R=C.raycastResult.body;if(R){var W=ce[X],j=this.getWheelTransformWorld(X);j.vectorToWorldFrame(P[this.indexRightAxis],W);var ne=C.raycastResult.hitNormalWorld,re=W.dot(ne);ne.scale(re,A),W.vsub(A,W),W.normalize(),ne.cross(W,L[X]),L[X].normalize(),C.sideImpulse=Pe(S,C.raycastResult.hitPointWorld,R,C.raycastResult.hitPointWorld,W),C.sideImpulse*=w}}var he=1,Ee=.5;this.sliding=!1;for(var X=0;X<ee;X++){var C=F[X],R=C.raycastResult.body,Te=0;if(C.slipInfo=1,R){var Ne=0,ke=C.brake?C.brake:Ne;Te=H(S,R,C.raycastResult.hitPointWorld,L[X],ke),Te+=C.engineForce*D;var _e=ke/Te;C.slipInfo*=_e}if(C.forwardImpulse=0,C.skidInfo=1,R){C.skidInfo=1;var $e=C.suspensionForce*D*C.frictionSlip,qe=$e,Ke=$e*qe;C.forwardImpulse=Te;var ot=C.forwardImpulse*Ee,vt=C.sideImpulse*he,St=ot*ot+vt*vt;if(C.sliding=!1,St>Ke){this.sliding=!0,C.sliding=!0;var _e=$e/Math.sqrt(St);C.skidInfo*=_e}}}if(this.sliding)for(var X=0;X<ee;X++){var C=F[X];C.sideImpulse!==0&&C.skidInfo<1&&(C.forwardImpulse*=C.skidInfo,C.sideImpulse*=C.skidInfo)}for(var X=0;X<ee;X++){var C=F[X],yt=new o;if(yt.copy(C.raycastResult.hitPointWorld),C.forwardImpulse!==0){var Ht=new o;L[X].scale(C.forwardImpulse,Ht),S.applyImpulse(Ht,yt)}if(C.sideImpulse!==0){var R=C.raycastResult.body,Oe=new o;Oe.copy(C.raycastResult.hitPointWorld);var De=new o;ce[X].scale(C.sideImpulse,De),S.pointToLocalFrame(yt,yt),yt["xyz"[this.indexUpAxis]]*=C.rollInfluence,S.pointToWorldFrame(yt,yt),S.applyImpulse(De,yt),De.scale(-1,De),R.applyImpulse(De,Oe)}}};var k=new o,V=new o,K=new o;function H(D,A,F,ee,S){var L=0,ce=F,xe=k,X=V,C=K;D.getVelocityAtWorldPoint(ce,xe),A.getVelocityAtWorldPoint(ce,X),xe.vsub(X,C);var R=ee.dot(C),W=Ae(D,F,ee),j=Ae(A,F,ee),ne=1,re=ne/(W+j);return L=-R*re,S<L&&(L=S),L<-S&&(L=-S),L}var oe=new o,ie=new o,ue=new o,me=new o;function Ae(D,A,F){var ee=oe,S=ie,L=ue,ce=me;return A.vsub(D.position,ee),ee.cross(F,S),D.invInertiaWorld.vmult(S,ce),ce.cross(ee,L),D.invMass+F.dot(L)}var Fe=new o,Me=new o,je=new o;function Pe(D,A,F,ee,S,ne){var ce=S.norm2();if(ce>1.1)return 0;var xe=Fe,X=Me,C=je;D.getVelocityAtWorldPoint(A,xe),F.getVelocityAtWorldPoint(ee,X),xe.vsub(X,C);var R=S.dot(C),W=.2,j=1/(D.invMass+F.invMass),ne=-W*R*j;return ne}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,a,r){var c=t("./Body"),o=t("../shapes/Sphere"),i=t("../shapes/Box"),u=t("../math/Vec3"),h=t("../constraints/HingeConstraint");a.exports=m;function m(l){if(this.wheelBodies=[],this.coordinateSystem=typeof l.coordinateSystem>"u"?new u(1,2,3):l.coordinateSystem.clone(),this.chassisBody=l.chassisBody,!this.chassisBody){var d=new i(new u(5,2,.5));this.chassisBody=new c(1,d)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}m.prototype.addWheel=function(l){l=l||{};var d=l.body;d||(d=new c(1,new o(1.2))),this.wheelBodies.push(d),this.wheelForces.push(0);var v=new u,p=typeof l.position<"u"?l.position.clone():new u,x=new u;this.chassisBody.pointToWorldFrame(p,x),d.position.set(x.x,x.y,x.z);var b=typeof l.axis<"u"?l.axis.clone():new u(0,1,0);this.wheelAxes.push(b);var O=new h(this.chassisBody,d,{pivotA:p,axisA:b,pivotB:u.ZERO,axisB:b,collideConnected:!1});return this.constraints.push(O),this.wheelBodies.length-1},m.prototype.setSteeringValue=function(l,d){var v=this.wheelAxes[d],p=Math.cos(l),x=Math.sin(l),b=v.x,O=v.y;this.constraints[d].axisA.set(p*b-x*O,x*b+p*O,0)},m.prototype.setMotorSpeed=function(l,d){var v=this.constraints[d];v.enableMotor(),v.motorTargetVelocity=l},m.prototype.disableMotor=function(l){var d=this.constraints[l];d.disableMotor()};var f=new u;m.prototype.setWheelForce=function(l,d){this.wheelForces[d]=l},m.prototype.applyWheelForce=function(l,d){var v=this.wheelAxes[d],p=this.wheelBodies[d],x=p.torque;v.scale(l,f),p.vectorToWorldFrame(f,f),x.vadd(f,x)},m.prototype.addToWorld=function(l){for(var d=this.constraints,v=this.wheelBodies.concat([this.chassisBody]),p=0;p<v.length;p++)l.add(v[p]);for(var p=0;p<d.length;p++)l.addConstraint(d[p]);l.addEventListener("preStep",this._update.bind(this))},m.prototype._update=function(){for(var l=this.wheelForces,d=0;d<l.length;d++)this.applyWheelForce(l[d],d)},m.prototype.removeFromWorld=function(l){for(var d=this.constraints,v=this.wheelBodies.concat([this.chassisBody]),p=0;p<v.length;p++)l.remove(v[p]);for(var p=0;p<d.length;p++)l.removeConstraint(d[p])};var y=new u;m.prototype.getWheelSpeed=function(l){var d=this.wheelAxes[l],v=this.wheelBodies[l],p=v.angularVelocity;return this.chassisBody.vectorToWorldFrame(d,y),p.dot(y)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,a,r){a.exports=f;var c=t("../shapes/Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../shapes/Particle"),h=t("../objects/Body"),m=t("../material/Material");function f(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}f.prototype.add=function(O){this.particles.push(O),this.neighbors.length<this.particles.length&&this.neighbors.push([])},f.prototype.remove=function(O){var N=this.particles.indexOf(O);N!==-1&&(this.particles.splice(N,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var y=new o;f.prototype.getNeighbors=function(O,N){for(var _=this.particles.length,P=O.id,M=this.smoothingRadius*this.smoothingRadius,q=y,Q=0;Q!==_;Q++){var w=this.particles[Q];w.position.vsub(O.position,q),P!==w.id&&q.norm2()<M&&N.push(w)}};var l=new o,d=new o,v=new o,p=new o,x=new o,b=new o;f.prototype.update=function(){for(var O=this.particles.length,N=l,_=this.speedOfSound,P=this.eps,M=0;M!==O;M++){var q=this.particles[M],Q=this.neighbors[M];Q.length=0,this.getNeighbors(q,Q),Q.push(this.particles[M]);for(var w=Q.length,k=0,V=0;V!==w;V++){q.position.vsub(Q[V].position,N);var K=N.norm(),H=this.w(K);k+=Q[V].mass*H}this.densities[M]=k,this.pressures[M]=_*_*(this.densities[M]-this.density)}for(var oe=d,ie=v,ue=p,me=x,Ae=b,M=0;M!==O;M++){var Fe=this.particles[M];oe.set(0,0,0),ie.set(0,0,0);for(var Me,je,Pe,Q=this.neighbors[M],w=Q.length,V=0;V!==w;V++){var D=Q[V];Fe.position.vsub(D.position,me);var A=me.norm();Me=-D.mass*(this.pressures[M]/(this.densities[M]*this.densities[M]+P)+this.pressures[V]/(this.densities[V]*this.densities[V]+P)),this.gradw(me,ue),ue.mult(Me,ue),oe.vadd(ue,oe),D.velocity.vsub(Fe.velocity,Ae),Ae.mult(1/(1e-4+this.densities[M]*this.densities[V])*this.viscosity*D.mass,Ae),je=this.nablaw(A),Ae.mult(je,Ae),ie.vadd(Ae,ie)}ie.mult(Fe.mass,ie),oe.mult(Fe.mass,oe),Fe.force.vadd(ie,Fe.force),Fe.force.vadd(oe,Fe.force)}},f.prototype.w=function(O){var N=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(N,9))*Math.pow(N*N-O*O,3)},f.prototype.gradw=function(O,N){var _=O.norm(),P=this.smoothingRadius;O.mult(945/(32*Math.PI*Math.pow(P,9))*Math.pow(P*P-_*_,2),N)},f.prototype.nablaw=function(O){var N=this.smoothingRadius,_=945/(32*Math.PI*Math.pow(N,9))*(N*N-O*O)*(7*O*O-3*N*N);return _}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,a,r){var c=t("../math/Vec3");a.exports=o;function o(b,O,N){N=N||{},this.restLength=typeof N.restLength=="number"?N.restLength:1,this.stiffness=N.stiffness||100,this.damping=N.damping||1,this.bodyA=b,this.bodyB=O,this.localAnchorA=new c,this.localAnchorB=new c,N.localAnchorA&&this.localAnchorA.copy(N.localAnchorA),N.localAnchorB&&this.localAnchorB.copy(N.localAnchorB),N.worldAnchorA&&this.setWorldAnchorA(N.worldAnchorA),N.worldAnchorB&&this.setWorldAnchorB(N.worldAnchorB)}o.prototype.setWorldAnchorA=function(b){this.bodyA.pointToLocalFrame(b,this.localAnchorA)},o.prototype.setWorldAnchorB=function(b){this.bodyB.pointToLocalFrame(b,this.localAnchorB)},o.prototype.getWorldAnchorA=function(b){this.bodyA.pointToWorldFrame(this.localAnchorA,b)},o.prototype.getWorldAnchorB=function(b){this.bodyB.pointToWorldFrame(this.localAnchorB,b)};var i=new c,u=new c,h=new c,m=new c,f=new c,y=new c,l=new c,d=new c,v=new c,p=new c,x=new c;o.prototype.applyForce=function(){var b=this.stiffness,O=this.damping,N=this.restLength,_=this.bodyA,P=this.bodyB,M=i,q=u,Q=h,w=m,k=x,V=f,K=y,H=l,oe=d,ie=v,ue=p;this.getWorldAnchorA(V),this.getWorldAnchorB(K),V.vsub(_.position,H),K.vsub(P.position,oe),K.vsub(V,M);var me=M.norm();q.copy(M),q.normalize(),P.velocity.vsub(_.velocity,Q),P.angularVelocity.cross(oe,k),Q.vadd(k,Q),_.angularVelocity.cross(H,k),Q.vsub(k,Q),q.mult(-b*(me-N)-O*Q.dot(q),w),_.force.vsub(w,_.force),P.force.vadd(w,P.force),H.cross(w,ie),oe.cross(w,ue),_.torque.vsub(ie,_.torque),P.torque.vadd(ue,P.torque)}},{"../math/Vec3":30}],36:[function(t,a,r){var c=t("../math/Vec3"),o=t("../math/Transform"),i=t("../collision/RaycastResult"),u=t("../utils/Utils");a.exports=h;function h(y){y=u.defaults(y,{chassisConnectionPointLocal:new c,chassisConnectionPointWorld:new c,directionLocal:new c,directionWorld:new c,axleLocal:new c,axleWorld:new c,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=y.maxSuspensionTravel,this.customSlidingRotationalSpeed=y.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=y.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=y.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=y.chassisConnectionPointWorld.clone(),this.directionLocal=y.directionLocal.clone(),this.directionWorld=y.directionWorld.clone(),this.axleLocal=y.axleLocal.clone(),this.axleWorld=y.axleWorld.clone(),this.suspensionRestLength=y.suspensionRestLength,this.suspensionMaxLength=y.suspensionMaxLength,this.radius=y.radius,this.suspensionStiffness=y.suspensionStiffness,this.dampingCompression=y.dampingCompression,this.dampingRelaxation=y.dampingRelaxation,this.frictionSlip=y.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=y.rollInfluence,this.maxSuspensionForce=y.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=y.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new i,this.worldTransform=new o,this.isInContact=!1}var f=new c,m=new c,f=new c;h.prototype.updateWheel=function(y){var l=this.raycastResult;if(this.isInContact){var d=l.hitNormalWorld.dot(l.directionWorld);l.hitPointWorld.vsub(y.position,m),y.getVelocityAtWorldPoint(m,f);var v=l.hitNormalWorld.dot(f);if(d>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var p=-1/d;this.suspensionRelativeVelocity=v*p,this.clippedInvContactDotSuspension=p}}else l.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,l.directionWorld.scale(-1,l.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,a,r){a.exports=u;var c=t("./Shape"),o=t("../math/Vec3"),i=t("./ConvexPolyhedron");function u(y){c.call(this),this.type=c.types.BOX,this.halfExtents=y,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}u.prototype=new c,u.prototype.constructor=u,u.prototype.updateConvexPolyhedronRepresentation=function(){var y=this.halfExtents.x,l=this.halfExtents.y,d=this.halfExtents.z,v=o,p=[new v(-y,-l,-d),new v(y,-l,-d),new v(y,l,-d),new v(-y,l,-d),new v(-y,-l,d),new v(y,-l,d),new v(y,l,d),new v(-y,l,d)],x=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],b=[new v(0,0,1),new v(0,1,0),new v(1,0,0)],O=new i(p,x);this.convexPolyhedronRepresentation=O,O.material=this.material},u.prototype.calculateLocalInertia=function(y,l){return l=l||new o,u.calculateInertia(this.halfExtents,y,l),l},u.calculateInertia=function(y,l,d){var v=y;d.x=1/12*l*(2*v.y*2*v.y+2*v.z*2*v.z),d.y=1/12*l*(2*v.x*2*v.x+2*v.z*2*v.z),d.z=1/12*l*(2*v.y*2*v.y+2*v.x*2*v.x)},u.prototype.getSideNormals=function(y,l){var d=y,v=this.halfExtents;if(d[0].set(v.x,0,0),d[1].set(0,v.y,0),d[2].set(0,0,v.z),d[3].set(-v.x,0,0),d[4].set(0,-v.y,0),d[5].set(0,0,-v.z),l!==void 0)for(var p=0;p!==d.length;p++)l.vmult(d[p],d[p]);return d},u.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},u.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var h=new o,m=new o;u.prototype.forEachWorldCorner=function(y,l,d){for(var v=this.halfExtents,p=[[v.x,v.y,v.z],[-v.x,v.y,v.z],[-v.x,-v.y,v.z],[-v.x,-v.y,-v.z],[v.x,-v.y,-v.z],[v.x,v.y,-v.z],[-v.x,v.y,-v.z],[v.x,-v.y,v.z]],x=0;x<p.length;x++)h.set(p[x][0],p[x][1],p[x][2]),l.vmult(h,h),y.vadd(h,h),d(h.x,h.y,h.z)};var f=[new o,new o,new o,new o,new o,new o,new o,new o];u.prototype.calculateWorldAABB=function(y,l,d,v){var p=this.halfExtents;f[0].set(p.x,p.y,p.z),f[1].set(-p.x,p.y,p.z),f[2].set(-p.x,-p.y,p.z),f[3].set(-p.x,-p.y,-p.z),f[4].set(p.x,-p.y,-p.z),f[5].set(p.x,p.y,-p.z),f[6].set(-p.x,p.y,-p.z),f[7].set(p.x,-p.y,p.z);var x=f[0];l.vmult(x,x),y.vadd(x,x),v.copy(x),d.copy(x);for(var b=1;b<8;b++){var x=f[b];l.vmult(x,x),y.vadd(x,x);var O=x.x,N=x.y,_=x.z;O>v.x&&(v.x=O),N>v.y&&(v.y=N),_>v.z&&(v.z=_),O<d.x&&(d.x=O),N<d.y&&(d.y=N),_<d.z&&(d.z=_)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,a,r){a.exports=h;var c=t("./Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../math/Transform");function h(D,A,F){var ee=this;c.call(this),this.type=c.types.CONVEXPOLYHEDRON,this.vertices=D||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=A||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=F?F.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}h.prototype=new c,h.prototype.constructor=h;var m=new o;h.prototype.computeEdges=function(){var D=this.faces,A=this.vertices,F=A.length,ee=this.uniqueEdges;ee.length=0;for(var S=m,L=0;L!==D.length;L++)for(var ce=D[L],xe=ce.length,X=0;X!==xe;X++){var C=(X+1)%xe;A[ce[X]].vsub(A[ce[C]],S),S.normalize();for(var R=!1,W=0;W!==ee.length;W++)if(ee[W].almostEquals(S)||ee[W].almostEquals(S)){R=!0;break}R||ee.push(S.clone())}},h.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var D=0;D<this.faces.length;D++){for(var A=0;A<this.faces[D].length;A++)if(!this.vertices[this.faces[D][A]])throw new Error("Vertex "+this.faces[D][A]+" not found!");var F=this.faceNormals[D]||new o;this.getFaceNormal(D,F),F.negate(F),this.faceNormals[D]=F;var ee=this.vertices[this.faces[D][0]];if(F.dot(ee)<0){console.error(".faceNormals["+D+"] = Vec3("+F.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var A=0;A<this.faces[D].length;A++)console.warn(".vertices["+this.faces[D][A]+"] = Vec3("+this.vertices[this.faces[D][A]].toString()+")")}}};var f=new o,y=new o;h.computeNormal=function(D,A,F,ee){A.vsub(D,y),F.vsub(A,f),f.cross(y,ee),ee.isZero()||ee.normalize()},h.prototype.getFaceNormal=function(D,A){var F=this.faces[D],ee=this.vertices[F[0]],S=this.vertices[F[1]],L=this.vertices[F[2]];return h.computeNormal(ee,S,L,A)};var l=new o;h.prototype.clipAgainstHull=function(D,A,F,ee,S,L,ce,xe,X){for(var C=l,R=this,W=xe,j=-1,ne=-Number.MAX_VALUE,re=0;re<F.faces.length;re++){C.copy(F.faceNormals[re]),S.vmult(C,C);var he=C.dot(L);he>ne&&(ne=he,j=re)}for(var Ee=[],Te=F.faces[j],Ne=Te.length,ke=0;ke<Ne;ke++){var _e=F.vertices[Te[ke]],$e=new o;$e.copy(_e),S.vmult($e,$e),ee.vadd($e,$e),Ee.push($e)}j>=0&&this.clipFaceAgainstHull(L,D,A,Ee,ce,xe,X)};var d=new o,v=new o,p=new o,x=new o,b=new o,O=new o;h.prototype.findSeparatingAxis=function(D,A,F,ee,S,L,ce,xe){var X=d,C=v,R=p,W=x,j=b,ne=O,re=Number.MAX_VALUE,he=this,Ee=0;if(he.uniqueAxes)for(var Ne=0;Ne!==he.uniqueAxes.length;Ne++){F.vmult(he.uniqueAxes[Ne],X);var _e=he.testSepAxis(X,D,A,F,ee,S);if(_e===!1)return!1;_e<re&&(re=_e,L.copy(X))}else for(var Te=ce?ce.length:he.faces.length,Ne=0;Ne<Te;Ne++){var ke=ce?ce[Ne]:Ne;X.copy(he.faceNormals[ke]),F.vmult(X,X);var _e=he.testSepAxis(X,D,A,F,ee,S);if(_e===!1)return!1;_e<re&&(re=_e,L.copy(X))}if(D.uniqueAxes)for(var Ne=0;Ne!==D.uniqueAxes.length;Ne++){S.vmult(D.uniqueAxes[Ne],C),Ee++;var _e=he.testSepAxis(C,D,A,F,ee,S);if(_e===!1)return!1;_e<re&&(re=_e,L.copy(C))}else for(var $e=xe?xe.length:D.faces.length,Ne=0;Ne<$e;Ne++){var ke=xe?xe[Ne]:Ne;C.copy(D.faceNormals[ke]),S.vmult(C,C),Ee++;var _e=he.testSepAxis(C,D,A,F,ee,S);if(_e===!1)return!1;_e<re&&(re=_e,L.copy(C))}for(var qe=0;qe!==he.uniqueEdges.length;qe++){F.vmult(he.uniqueEdges[qe],W);for(var Ke=0;Ke!==D.uniqueEdges.length;Ke++)if(S.vmult(D.uniqueEdges[Ke],j),W.cross(j,ne),!ne.almostZero()){ne.normalize();var ot=he.testSepAxis(ne,D,A,F,ee,S);if(ot===!1)return!1;ot<re&&(re=ot,L.copy(ne))}}return ee.vsub(A,R),R.dot(L)>0&&L.negate(L),!0};var N=[],_=[];h.prototype.testSepAxis=function(D,A,F,ee,S,L){var ce=this;h.project(ce,D,F,ee,N),h.project(A,D,S,L,_);var xe=N[0],X=N[1],C=_[0],R=_[1];if(xe<R||C<X)return!1;var W=xe-R,j=C-X,ne=W<j?W:j;return ne};var P=new o,M=new o;h.prototype.calculateLocalInertia=function(D,A){this.computeLocalAABB(P,M);var F=M.x-P.x,ee=M.y-P.y,S=M.z-P.z;A.x=1/12*D*(2*ee*2*ee+2*S*2*S),A.y=1/12*D*(2*F*2*F+2*S*2*S),A.z=1/12*D*(2*ee*2*ee+2*F*2*F)},h.prototype.getPlaneConstantOfFace=function(D){var A=this.faces[D],F=this.faceNormals[D],ee=this.vertices[A[0]],S=-F.dot(ee);return S};var q=new o,Q=new o,w=new o,k=new o,V=new o,K=new o,H=new o,oe=new o;h.prototype.clipFaceAgainstHull=function(D,A,F,ee,S,L,ce){for(var xe=q,X=Q,C=w,R=k,W=V,j=K,ne=H,re=oe,he=this,Ee=[],Te=ee,Ne=Ee,ke=-1,_e=Number.MAX_VALUE,$e=0;$e<he.faces.length;$e++){xe.copy(he.faceNormals[$e]),F.vmult(xe,xe);var qe=xe.dot(D);qe<_e&&(_e=qe,ke=$e)}if(!(ke<0)){var Ke=he.faces[ke];Ke.connectedFaces=[];for(var ot=0;ot<he.faces.length;ot++)for(var vt=0;vt<he.faces[ot].length;vt++)Ke.indexOf(he.faces[ot][vt])!==-1&&ot!==ke&&Ke.connectedFaces.indexOf(ot)===-1&&Ke.connectedFaces.push(ot);for(var St=Te.length,yt=Ke.length,Ht=[],Oe=0;Oe<yt;Oe++){var De=he.vertices[Ke[Oe]],Ut=he.vertices[Ke[(Oe+1)%yt]];De.vsub(Ut,X),C.copy(X),F.vmult(C,C),A.vadd(C,C),R.copy(this.faceNormals[ke]),F.vmult(R,R),A.vadd(R,R),C.cross(R,W),W.negate(W),j.copy(De),F.vmult(j,j),A.vadd(j,j);var tn=-j.dot(W),B,Yt=Ke.connectedFaces[Oe];ne.copy(this.faceNormals[Yt]);var rt=this.getPlaneConstantOfFace(Yt);re.copy(ne),F.vmult(re,re);var B=rt-re.dot(A);for(this.clipFaceAgainstPlane(Te,Ne,re,B);Te.length;)Te.shift();for(;Ne.length;)Te.push(Ne.shift())}ne.copy(this.faceNormals[ke]);var rt=this.getPlaneConstantOfFace(ke);re.copy(ne),F.vmult(re,re);for(var B=rt-re.dot(A),ot=0;ot<Te.length;ot++){var Y=re.dot(Te[ot])+B;if(Y<=S&&(console.log("clamped: depth="+Y+" to minDist="+(S+"")),Y=S),Y<=L){var te=Te[ot];if(Y<=0){var we={point:te,normal:re,depth:Y};ce.push(we)}}}}},h.prototype.clipFaceAgainstPlane=function(D,A,F,ee){var S,L,ce=D.length;if(ce<2)return A;var xe=D[D.length-1],X=D[0];S=F.dot(xe)+ee;for(var C=0;C<ce;C++){if(X=D[C],L=F.dot(X)+ee,S<0)if(L<0){var R=new o;R.copy(X),A.push(R)}else{var R=new o;xe.lerp(X,S/(S-L),R),A.push(R)}else if(L<0){var R=new o;xe.lerp(X,S/(S-L),R),A.push(R),A.push(X)}xe=X,S=L}return A},h.prototype.computeWorldVertices=function(D,A){for(var F=this.vertices.length;this.worldVertices.length<F;)this.worldVertices.push(new o);for(var ee=this.vertices,S=this.worldVertices,L=0;L!==F;L++)A.vmult(ee[L],S[L]),D.vadd(S[L],S[L]);this.worldVerticesNeedsUpdate=!1};var ie=new o;h.prototype.computeLocalAABB=function(D,A){var F=this.vertices.length,ee=this.vertices,S=ie;D.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var L=0;L<F;L++){var ce=ee[L];ce.x<D.x?D.x=ce.x:ce.x>A.x&&(A.x=ce.x),ce.y<D.y?D.y=ce.y:ce.y>A.y&&(A.y=ce.y),ce.z<D.z?D.z=ce.z:ce.z>A.z&&(A.z=ce.z)}},h.prototype.computeWorldFaceNormals=function(D){for(var A=this.faceNormals.length;this.worldFaceNormals.length<A;)this.worldFaceNormals.push(new o);for(var F=this.faceNormals,ee=this.worldFaceNormals,S=0;S!==A;S++)D.vmult(F[S],ee[S]);this.worldFaceNormalsNeedsUpdate=!1},h.prototype.updateBoundingSphereRadius=function(){for(var D=0,A=this.vertices,F=0,ee=A.length;F!==ee;F++){var S=A[F].norm2();S>D&&(D=S)}this.boundingSphereRadius=Math.sqrt(D)};var ue=new o;h.prototype.calculateWorldAABB=function(D,A,F,ee){for(var S=this.vertices.length,L=this.vertices,ce,xe,X,C,R,W,j=0;j<S;j++){ue.copy(L[j]),A.vmult(ue,ue),D.vadd(ue,ue);var ne=ue;ne.x<ce||ce===void 0?ce=ne.x:(ne.x>C||C===void 0)&&(C=ne.x),ne.y<xe||xe===void 0?xe=ne.y:(ne.y>R||R===void 0)&&(R=ne.y),ne.z<X||X===void 0?X=ne.z:(ne.z>W||W===void 0)&&(W=ne.z)}F.set(ce,xe,X),ee.set(C,R,W)},h.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},h.prototype.getAveragePointLocal=function(D){D=D||new o;for(var A=this.vertices.length,F=this.vertices,ee=0;ee<A;ee++)D.vadd(F[ee],D);return D.mult(1/A,D),D},h.prototype.transformAllPoints=function(D,A){var F=this.vertices.length,ee=this.vertices;if(A){for(var S=0;S<F;S++){var L=ee[S];A.vmult(L,L)}for(var S=0;S<this.faceNormals.length;S++){var L=this.faceNormals[S];A.vmult(L,L)}}if(D)for(var S=0;S<F;S++){var L=ee[S];L.vadd(D,L)}};var me=new o,Ae=new o,Fe=new o;h.prototype.pointIsInside=function(D){var A=this.vertices.length,F=this.vertices,ee=this.faces,S=this.faceNormals,L=null,ce=this.faces.length,xe=me;this.getAveragePointLocal(xe);for(var X=0;X<ce;X++){var C=this.faces[X].length,A=S[X],R=F[ee[X][0]],W=Ae;D.vsub(R,W);var j=A.dot(W),ne=Fe;xe.vsub(R,ne);var re=A.dot(ne);if(j<0&&re>0||j>0&&re<0)return!1}return L?1:-1};var Me=new o,je=new o,Pe=new o;h.project=function(D,A,F,ee,S){var L=D.vertices.length,ce=Me,xe=je,X=0,C=0,R=Pe,W=D.vertices;R.setZero(),u.vectorToLocalFrame(F,ee,A,xe),u.pointToLocalFrame(F,ee,R,R);var j=R.dot(xe);C=X=W[0].dot(xe);for(var ne=1;ne<L;ne++){var re=W[ne].dot(xe);re>X&&(X=re),re<C&&(C=re)}if(C-=j,X-=j,C>X){var he=C;C=X,X=he}S[0]=X,S[1]=C}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,a,r){a.exports=h;var c=t("./Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("./ConvexPolyhedron");function h(m,f,y,l){var d=l,v=[],p=[],x=[],b=[],O=[],N=Math.cos,_=Math.sin;v.push(new o(f*N(0),f*_(0),-y*.5)),b.push(0),v.push(new o(m*N(0),m*_(0),y*.5)),O.push(1);for(var P=0;P<d;P++){var M=2*Math.PI/d*(P+1),q=2*Math.PI/d*(P+.5);P<d-1?(v.push(new o(f*N(M),f*_(M),-y*.5)),b.push(2*P+2),v.push(new o(m*N(M),m*_(M),y*.5)),O.push(2*P+3),x.push([2*P+2,2*P+3,2*P+1,2*P])):x.push([0,1,2*P+1,2*P]),(d%2===1||P<d/2)&&p.push(new o(N(q),_(q),0))}x.push(O),p.push(new o(0,0,1));for(var Q=[],P=0;P<b.length;P++)Q.push(b[b.length-P-1]);x.push(Q),this.type=c.types.CONVEXPOLYHEDRON,u.call(this,v,x,p)}h.prototype=new u},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,a,r){var c=t("./Shape"),o=t("./ConvexPolyhedron"),i=t("../math/Vec3"),u=t("../utils/Utils");a.exports=h;function h(m,f){f=u.defaults(f,{maxValue:null,minValue:null,elementSize:1}),this.data=m,this.maxValue=f.maxValue,this.minValue=f.minValue,this.elementSize=f.elementSize,f.minValue===null&&this.updateMinValue(),f.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,c.call(this),this.pillarConvex=new o,this.pillarOffset=new i,this.type=c.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}h.prototype=new c,h.prototype.update=function(){this._cachedPillars={}},h.prototype.updateMinValue=function(){for(var m=this.data,f=m[0][0],y=0;y!==m.length;y++)for(var l=0;l!==m[y].length;l++){var d=m[y][l];d<f&&(f=d)}this.minValue=f},h.prototype.updateMaxValue=function(){for(var m=this.data,f=m[0][0],y=0;y!==m.length;y++)for(var l=0;l!==m[y].length;l++){var d=m[y][l];d>f&&(f=d)}this.maxValue=f},h.prototype.setHeightValueAtIndex=function(m,f,y){var l=this.data;l[m][f]=y,this.clearCachedConvexTrianglePillar(m,f,!1),m>0&&(this.clearCachedConvexTrianglePillar(m-1,f,!0),this.clearCachedConvexTrianglePillar(m-1,f,!1)),f>0&&(this.clearCachedConvexTrianglePillar(m,f-1,!0),this.clearCachedConvexTrianglePillar(m,f-1,!1)),f>0&&m>0&&this.clearCachedConvexTrianglePillar(m-1,f-1,!0)},h.prototype.getRectMinMax=function(m,f,y,l,d){d=d||[];for(var v=this.data,p=this.minValue,x=m;x<=y;x++)for(var b=f;b<=l;b++){var O=v[x][b];O>p&&(p=O)}d[0]=this.minValue,d[1]=p},h.prototype.getIndexOfPosition=function(m,f,y,l){var d=this.elementSize,v=this.data,p=Math.floor(m/d),x=Math.floor(f/d);return y[0]=p,y[1]=x,l&&(p<0&&(p=0),x<0&&(x=0),p>=v.length-1&&(p=v.length-1),x>=v[0].length-1&&(x=v[0].length-1)),!(p<0||x<0||p>=v.length-1||x>=v[0].length-1)},h.prototype.getHeightAt=function(m,f,y){var l=[];this.getIndexOfPosition(m,f,l,y);var d=[];return this.getRectMinMax(l[0],l[1]+1,l[0],l[1]+1,d),(d[0]+d[1])/2},h.prototype.getCacheConvexTrianglePillarKey=function(m,f,y){return m+"_"+f+"_"+(y?1:0)},h.prototype.getCachedConvexTrianglePillar=function(m,f,y){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(m,f,y)]},h.prototype.setCachedConvexTrianglePillar=function(m,f,y,l,d){this._cachedPillars[this.getCacheConvexTrianglePillarKey(m,f,y)]={convex:l,offset:d}},h.prototype.clearCachedConvexTrianglePillar=function(m,f,y){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(m,f,y)]},h.prototype.getConvexTrianglePillar=function(m,f,y){var l=this.pillarConvex,d=this.pillarOffset;if(this.cacheEnabled){var v=this.getCachedConvexTrianglePillar(m,f,y);if(v){this.pillarConvex=v.convex,this.pillarOffset=v.offset;return}l=new o,d=new i,this.pillarConvex=l,this.pillarOffset=d}var v=this.data,p=this.elementSize,x=l.faces;l.vertices.length=6;for(var b=0;b<6;b++)l.vertices[b]||(l.vertices[b]=new i);x.length=5;for(var b=0;b<5;b++)x[b]||(x[b]=[]);var O=l.vertices,N=(Math.min(v[m][f],v[m+1][f],v[m][f+1],v[m+1][f+1])-this.minValue)/2+this.minValue;y?(d.set((m+.75)*p,(f+.75)*p,N),O[0].set(.25*p,.25*p,v[m+1][f+1]-N),O[1].set(-.75*p,.25*p,v[m][f+1]-N),O[2].set(.25*p,-.75*p,v[m+1][f]-N),O[3].set(.25*p,.25*p,-N-1),O[4].set(-.75*p,.25*p,-N-1),O[5].set(.25*p,-.75*p,-N-1),x[0][0]=0,x[0][1]=1,x[0][2]=2,x[1][0]=5,x[1][1]=4,x[1][2]=3,x[2][0]=2,x[2][1]=5,x[2][2]=3,x[2][3]=0,x[3][0]=3,x[3][1]=4,x[3][2]=1,x[3][3]=0,x[4][0]=1,x[4][1]=4,x[4][2]=5,x[4][3]=2):(d.set((m+.25)*p,(f+.25)*p,N),O[0].set(-.25*p,-.25*p,v[m][f]-N),O[1].set(.75*p,-.25*p,v[m+1][f]-N),O[2].set(-.25*p,.75*p,v[m][f+1]-N),O[3].set(-.25*p,-.25*p,-N-1),O[4].set(.75*p,-.25*p,-N-1),O[5].set(-.25*p,.75*p,-N-1),x[0][0]=0,x[0][1]=1,x[0][2]=2,x[1][0]=5,x[1][1]=4,x[1][2]=3,x[2][0]=0,x[2][1]=2,x[2][2]=5,x[2][3]=3,x[3][0]=1,x[3][1]=0,x[3][2]=3,x[3][3]=4,x[4][0]=4,x[4][1]=5,x[4][2]=2,x[4][3]=1),l.computeNormals(),l.computeEdges(),l.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(m,f,y,l,d)},h.prototype.calculateLocalInertia=function(m,f){return f=f||new i,f.set(0,0,0),f},h.prototype.volume=function(){return Number.MAX_VALUE},h.prototype.calculateWorldAABB=function(m,f,y,l){y.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},h.prototype.updateBoundingSphereRadius=function(){var m=this.data,f=this.elementSize;this.boundingSphereRadius=new i(m.length*f,m[0].length*f,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,a,r){a.exports=i;var c=t("./Shape"),o=t("../math/Vec3");function i(){c.call(this),this.type=c.types.PARTICLE}i.prototype=new c,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(u,h){return h=h||new o,h.set(0,0,0),h},i.prototype.volume=function(){return 0},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},i.prototype.calculateWorldAABB=function(u,h,m,f){m.copy(u),f.copy(u)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,a,r){a.exports=i;var c=t("./Shape"),o=t("../math/Vec3");function i(){c.call(this),this.type=c.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}i.prototype=new c,i.prototype.constructor=i,i.prototype.computeWorldNormal=function(h){var m=this.worldNormal;m.set(0,0,1),h.vmult(m,m),this.worldNormalNeedsUpdate=!1},i.prototype.calculateLocalInertia=function(h,m){return m=m||new o,m},i.prototype.volume=function(){return Number.MAX_VALUE};var u=new o;i.prototype.calculateWorldAABB=function(h,m,f,y){u.set(0,0,1),m.vmult(u,u);var l=Number.MAX_VALUE;f.set(-l,-l,-l),y.set(l,l,l),u.x===1&&(y.x=h.x),u.y===1&&(y.y=h.y),u.z===1&&(y.z=h.z),u.x===-1&&(f.x=h.x),u.y===-1&&(f.y=h.y),u.z===-1&&(f.z=h.z)},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,a,r){a.exports=u;var u=t("./Shape"),c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("../material/Material");function u(){this.id=u.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}u.prototype.constructor=u,u.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},u.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},u.prototype.calculateLocalInertia=function(h,m){throw"calculateLocalInertia() not implemented for shape type "+this.type},u.idCounter=0,u.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,a,r){a.exports=i;var c=t("./Shape"),o=t("../math/Vec3");function i(u){if(c.call(this),this.radius=u!==void 0?Number(u):1,this.type=c.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}i.prototype=new c,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(u,h){h=h||new o;var m=2*u*this.radius*this.radius/5;return h.x=m,h.y=m,h.z=m,h},i.prototype.volume=function(){return 4*Math.PI*this.radius/3},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},i.prototype.calculateWorldAABB=function(u,h,m,f){for(var y=this.radius,l=["x","y","z"],d=0;d<l.length;d++){var v=l[d];m[v]=u[v]-y,f[v]=u[v]+y}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,a,r){a.exports=f;var c=t("./Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../math/Transform"),h=t("../collision/AABB"),m=t("../utils/Octree");function f(w,k){c.call(this),this.type=c.types.TRIMESH,this.vertices=new Float32Array(w),this.indices=new Int16Array(k),this.normals=new Float32Array(k.length),this.aabb=new h,this.edges=null,this.scale=new o(1,1,1),this.tree=new m,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}f.prototype=new c,f.prototype.constructor=f;var y=new o;f.prototype.updateTree=function(){var w=this.tree;w.reset(),w.aabb.copy(this.aabb);var k=this.scale;w.aabb.lowerBound.x*=1/k.x,w.aabb.lowerBound.y*=1/k.y,w.aabb.lowerBound.z*=1/k.z,w.aabb.upperBound.x*=1/k.x,w.aabb.upperBound.y*=1/k.y,w.aabb.upperBound.z*=1/k.z;for(var V=new h,K=new o,H=new o,oe=new o,ie=[K,H,oe],ue=0;ue<this.indices.length/3;ue++){var me=ue*3;this._getUnscaledVertex(this.indices[me],K),this._getUnscaledVertex(this.indices[me+1],H),this._getUnscaledVertex(this.indices[me+2],oe),V.setFromPoints(ie),w.insert(V,ue)}w.removeEmptyNodes()};var l=new h;f.prototype.getTrianglesInAABB=function(w,k){l.copy(w);var V=this.scale,K=V.x,H=V.y,oe=V.z,ie=l.lowerBound,ue=l.upperBound;return ie.x/=K,ie.y/=H,ie.z/=oe,ue.x/=K,ue.y/=H,ue.z/=oe,this.tree.aabbQuery(l,k)},f.prototype.setScale=function(w){var k=this.scale.x===this.scale.y===this.scale.z,V=w.x===w.y===w.z;k&&V||this.updateNormals(),this.scale.copy(w),this.updateAABB(),this.updateBoundingSphereRadius()},f.prototype.updateNormals=function(){for(var w=y,k=this.normals,V=0;V<this.indices.length/3;V++){var K=V*3,H=this.indices[K],oe=this.indices[K+1],ie=this.indices[K+2];this.getVertex(H,b),this.getVertex(oe,O),this.getVertex(ie,N),f.computeNormal(O,b,N,w),k[K]=w.x,k[K+1]=w.y,k[K+2]=w.z}},f.prototype.updateEdges=function(){for(var w={},k=function(Ae,Fe){var Me=H<oe?H+"_"+oe:oe+"_"+H;w[Me]=!0},V=0;V<this.indices.length/3;V++){var K=V*3,H=this.indices[K],oe=this.indices[K+1],ie=this.indices[K+2];k(H,oe),k(oe,ie),k(ie,H)}var ue=Object.keys(w);this.edges=new Int16Array(ue.length*2);for(var V=0;V<ue.length;V++){var me=ue[V].split("_");this.edges[2*V]=parseInt(me[0],10),this.edges[2*V+1]=parseInt(me[1],10)}},f.prototype.getEdgeVertex=function(w,k,V){var K=this.edges[w*2+(k?1:0)];this.getVertex(K,V)};var d=new o,v=new o;f.prototype.getEdgeVector=function(w,k){var V=d,K=v;this.getEdgeVertex(w,0,V),this.getEdgeVertex(w,1,K),K.vsub(V,k)};var p=new o,x=new o;f.computeNormal=function(w,k,V,K){k.vsub(w,x),V.vsub(k,p),p.cross(x,K),K.isZero()||K.normalize()};var b=new o,O=new o,N=new o;f.prototype.getVertex=function(w,k){var V=this.scale;return this._getUnscaledVertex(w,k),k.x*=V.x,k.y*=V.y,k.z*=V.z,k},f.prototype._getUnscaledVertex=function(w,k){var V=w*3,K=this.vertices;return k.set(K[V],K[V+1],K[V+2])},f.prototype.getWorldVertex=function(w,k,V,K){return this.getVertex(w,K),u.pointToWorldFrame(k,V,K,K),K},f.prototype.getTriangleVertices=function(w,k,V,K){var H=w*3;this.getVertex(this.indices[H],k),this.getVertex(this.indices[H+1],V),this.getVertex(this.indices[H+2],K)},f.prototype.getNormal=function(w,k){var V=w*3;return k.set(this.normals[V],this.normals[V+1],this.normals[V+2])};var _=new h;f.prototype.calculateLocalInertia=function(w,k){this.computeLocalAABB(_);var V=_.upperBound.x-_.lowerBound.x,K=_.upperBound.y-_.lowerBound.y,H=_.upperBound.z-_.lowerBound.z;return k.set(1/12*w*(2*K*2*K+2*H*2*H),1/12*w*(2*V*2*V+2*H*2*H),1/12*w*(2*K*2*K+2*V*2*V))};var P=new o;f.prototype.computeLocalAABB=function(w){var k=w.lowerBound,V=w.upperBound,K=this.vertices.length,H=this.vertices,oe=P;this.getVertex(0,oe),k.copy(oe),V.copy(oe);for(var ie=0;ie!==K;ie++)this.getVertex(ie,oe),oe.x<k.x?k.x=oe.x:oe.x>V.x&&(V.x=oe.x),oe.y<k.y?k.y=oe.y:oe.y>V.y&&(V.y=oe.y),oe.z<k.z?k.z=oe.z:oe.z>V.z&&(V.z=oe.z)},f.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},f.prototype.updateBoundingSphereRadius=function(){for(var w=0,k=this.vertices,V=new o,K=0,H=k.length/3;K!==H;K++){this.getVertex(K,V);var oe=V.norm2();oe>w&&(w=oe)}this.boundingSphereRadius=Math.sqrt(w)};var M=new o,q=new u,Q=new h;f.prototype.calculateWorldAABB=function(w,k,V,K){var H=q,oe=Q;H.position=w,H.quaternion=k,this.aabb.toWorldFrame(H,oe),V.copy(oe.lowerBound),K.copy(oe.upperBound)},f.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},f.createTorus=function(w,k,V,K,H){w=w||1,k=k||.5,V=V||8,K=K||6,H=H||Math.PI*2;for(var oe=[],ie=[],ue=0;ue<=V;ue++)for(var me=0;me<=K;me++){var Ae=me/K*H,Fe=ue/V*Math.PI*2,Me=(w+k*Math.cos(Fe))*Math.cos(Ae),je=(w+k*Math.cos(Fe))*Math.sin(Ae),Pe=k*Math.sin(Fe);oe.push(Me,je,Pe)}for(var ue=1;ue<=V;ue++)for(var me=1;me<=K;me++){var D=(K+1)*ue+me-1,A=(K+1)*(ue-1)+me-1,F=(K+1)*(ue-1)+me,ee=(K+1)*ue+me;ie.push(D,A,ee),ie.push(A,F,ee)}return new f(oe,ie)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,a,r){a.exports=u;var c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("./Solver");function u(){i.call(this),this.iterations=10,this.tolerance=1e-7}u.prototype=new i;var h=[],m=[],f=[];u.prototype.solve=function(y,l){var d=0,v=this.iterations,p=this.tolerance*this.tolerance,x=this.equations,b=x.length,O=l.bodies,N=O.length,_=y,P,M,q,Q,w,k,V;if(b!==0)for(var K=0;K!==N;K++)O[K].updateSolveMassProperties();var H=m,oe=f,ie=h;H.length=b,oe.length=b,ie.length=b;for(var K=0;K!==b;K++){var ue=x[K];ie[K]=0,oe[K]=ue.computeB(_),H[K]=1/ue.computeC()}if(b!==0){for(var K=0;K!==N;K++){var me=O[K],Ae=me.vlambda,Fe=me.wlambda;Ae.set(0,0,0),Fe&&Fe.set(0,0,0)}for(d=0;d!==v;d++){w=0;for(var Me=0;Me!==b;Me++){var ue=x[Me];M=oe[Me],q=H[Me],V=ie[Me],k=ue.computeGWlambda(),Q=q*(M-k-ue.eps*V),V+Q<ue.minForce?Q=ue.minForce-V:V+Q>ue.maxForce&&(Q=ue.maxForce-V),ie[Me]+=Q,w+=Q>0?Q:-Q,ue.addToWlambda(Q)}if(w*w<p)break}for(var K=0;K!==N;K++){var me=O[K],je=me.velocity,Pe=me.angularVelocity;je.vadd(me.vlambda,je),Pe&&Pe.vadd(me.wlambda,Pe)}}return d}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,a,r){a.exports=c;function c(){this.equations=[]}c.prototype.solve=function(o,i){return 0},c.prototype.addEquation=function(o){o.enabled&&this.equations.push(o)},c.prototype.removeEquation=function(o){var i=this.equations,u=i.indexOf(o);u!==-1&&i.splice(u,1)},c.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,a,r){a.exports=h;var c=t("../math/Vec3"),o=t("../math/Quaternion"),i=t("./Solver"),u=t("../objects/Body");function h(_){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=_,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}h.prototype=new i;var m=[],f=[],y=[],l=[],d={bodies:[]},v=u.STATIC;function p(_){for(var P=_.length,M=0;M!==P;M++){var q=_[M];if(!q.visited&&!(q.body.type&v))return q}return!1}var x=[];function b(_,P,M,q){for(x.push(_),_.visited=!0,P(_,M,q);x.length;)for(var Q=x.pop(),w;w=p(Q.children);)w.visited=!0,P(w,M,q),x.push(w)}function O(_,P,M){P.push(_.body);for(var q=_.eqs.length,Q=0;Q!==q;Q++){var w=_.eqs[Q];M.indexOf(w)===-1&&M.push(w)}}h.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},h.prototype.solve=function(_,P){for(var M=m,q=this.nodePool,Q=P.bodies,w=this.equations,k=w.length,V=Q.length,K=this.subsolver;q.length<V;)q.push(this.createNode());M.length=V;for(var H=0;H<V;H++)M[H]=q[H];for(var H=0;H!==V;H++){var oe=M[H];oe.body=Q[H],oe.children.length=0,oe.eqs.length=0,oe.visited=!1}for(var ie=0;ie!==k;ie++){var ue=w[ie],H=Q.indexOf(ue.bi),me=Q.indexOf(ue.bj),Ae=M[H],Fe=M[me];Ae.children.push(Fe),Ae.eqs.push(ue),Fe.children.push(Ae),Fe.eqs.push(ue)}var Me,je=0,Pe=y;K.tolerance=this.tolerance,K.iterations=this.iterations;for(var D=d;Me=p(M);){Pe.length=0,D.bodies.length=0,b(Me,O,D.bodies,Pe);var A=Pe.length;Pe=Pe.sort(N);for(var H=0;H!==A;H++)K.addEquation(Pe[H]);var F=K.solve(_,D);K.removeAllEquations(),je++}return je};function N(_,P){return P.id-_.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,a,r){var c=function(){};a.exports=c,c.prototype={constructor:c,addEventListener:function(o,i){this._listeners===void 0&&(this._listeners={});var u=this._listeners;return u[o]===void 0&&(u[o]=[]),u[o].indexOf(i)===-1&&u[o].push(i),this},hasEventListener:function(o,i){if(this._listeners===void 0)return!1;var u=this._listeners;return u[o]!==void 0&&u[o].indexOf(i)!==-1},removeEventListener:function(o,i){if(this._listeners===void 0)return this;var u=this._listeners;if(u[o]===void 0)return this;var h=u[o].indexOf(i);return h!==-1&&u[o].splice(h,1),this},dispatchEvent:function(o){if(this._listeners===void 0)return this;var i=this._listeners,u=i[o.type];if(u!==void 0){o.target=this;for(var h=0,m=u.length;h<m;h++)u[h].call(this,o)}return this}}},{}],50:[function(t,a,r){var c=t("../collision/AABB"),o=t("../math/Vec3");a.exports=u;function i(f){f=f||{},this.root=f.root||null,this.aabb=f.aabb?f.aabb.clone():new c,this.data=[],this.children=[]}function u(f,y){y=y||{},y.root=null,y.aabb=f,i.call(this,y),this.maxDepth=typeof y.maxDepth<"u"?y.maxDepth:8}u.prototype=new i,i.prototype.reset=function(f,y){this.children.length=this.data.length=0},i.prototype.insert=function(f,y,l){var d=this.data;if(l=l||0,!this.aabb.contains(f))return!1;var v=this.children;if(l<(this.maxDepth||this.root.maxDepth)){var p=!1;v.length||(this.subdivide(),p=!0);for(var x=0;x!==8;x++)if(v[x].insert(f,y,l+1))return!0;p&&(v.length=0)}return d.push(y),!0};var h=new o;i.prototype.subdivide=function(){var f=this.aabb,y=f.lowerBound,l=f.upperBound,d=this.children;d.push(new i({aabb:new c({lowerBound:new o(0,0,0)})}),new i({aabb:new c({lowerBound:new o(1,0,0)})}),new i({aabb:new c({lowerBound:new o(1,1,0)})}),new i({aabb:new c({lowerBound:new o(1,1,1)})}),new i({aabb:new c({lowerBound:new o(0,1,1)})}),new i({aabb:new c({lowerBound:new o(0,0,1)})}),new i({aabb:new c({lowerBound:new o(1,0,1)})}),new i({aabb:new c({lowerBound:new o(0,1,0)})})),l.vsub(y,h),h.scale(.5,h);for(var v=this.root||this,p=0;p!==8;p++){var x=d[p];x.root=v;var b=x.aabb.lowerBound;b.x*=h.x,b.y*=h.y,b.z*=h.z,b.vadd(y,b),b.vadd(h,x.aabb.upperBound)}},i.prototype.aabbQuery=function(f,y){for(var l=this.data,d=this.children,v=[this];v.length;){var p=v.pop();p.aabb.overlaps(f)&&Array.prototype.push.apply(y,p.data),Array.prototype.push.apply(v,p.children)}return y};var m=new c;i.prototype.rayQuery=function(f,y,l){return f.getAABB(m),m.toLocalFrame(y,m),this.aabbQuery(m,l),l},i.prototype.removeEmptyNodes=function(){for(var f=[this];f.length;){for(var y=f.pop(),l=y.children.length-1;l>=0;l--)y.children[l].data.length||y.children.splice(l,1);Array.prototype.push.apply(f,y.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,a,r){a.exports=c;function c(){this.objects=[],this.type=Object}c.prototype.release=function(){for(var o=arguments.length,i=0;i!==o;i++)this.objects.push(arguments[i])},c.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},c.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,a,r){a.exports=c;function c(){this.data={keys:[]}}c.prototype.get=function(o,i){if(o>i){var u=i;i=o,o=u}return this.data[o+"-"+i]},c.prototype.set=function(o,i,u){if(o>i){var h=i;i=o,o=h}var m=o+"-"+i;this.get(o,i)||this.data.keys.push(m),this.data[m]=u},c.prototype.reset=function(){for(var o=this.data,i=o.keys;i.length>0;){var u=i.pop();delete o[u]}}},{}],53:[function(t,a,r){function c(){}a.exports=c,c.defaults=function(o,i){o=o||{};for(var u in i)u in o||(o[u]=i[u]);return o}},{}],54:[function(t,a,r){a.exports=i;var c=t("../math/Vec3"),o=t("./Pool");function i(){o.call(this),this.type=c}i.prototype=new o,i.prototype.constructObject=function(){return new c}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,a,r){a.exports=p;var c=t("../collision/AABB"),o=t("../shapes/Shape"),i=t("../collision/Ray"),u=t("../math/Vec3"),h=t("../math/Transform"),m=t("../shapes/ConvexPolyhedron"),f=t("../math/Quaternion"),y=t("../solver/Solver"),l=t("../utils/Vec3Pool"),d=t("../equations/ContactEquation"),v=t("../equations/FrictionEquation");function p(se){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=se,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(se,E,g,T,I,z){var $;this.contactPointPool.length?($=this.contactPointPool.pop(),$.bi=se,$.bj=E):$=new d(se,E),$.enabled=se.collisionResponse&&E.collisionResponse&&g.collisionResponse&&T.collisionResponse;var G=this.currentContactMaterial;$.restitution=G.restitution,$.setSpookParams(G.contactEquationStiffness,G.contactEquationRelaxation,this.world.dt);var U=g.material||se.material,ae=T.material||E.material;return U&&ae&&U.restitution>=0&&ae.restitution>=0&&($.restitution=U.restitution*ae.restitution),$.si=I||g,$.sj=z||T,$},p.prototype.createFrictionEquationsFromContact=function(se,E){var g=se.bi,T=se.bj,I=se.si,z=se.sj,$=this.world,G=this.currentContactMaterial,U=G.friction,ae=I.material||g.material,pe=z.material||T.material;if(ae&&pe&&ae.friction>=0&&pe.friction>=0&&(U=ae.friction*pe.friction),U>0){var ye=U*$.gravity.length(),ve=g.invMass+T.invMass;ve>0&&(ve=1/ve);var le=this.frictionEquationPool,de=le.length?le.pop():new v(g,T,ye*ve),Re=le.length?le.pop():new v(g,T,ye*ve);return de.bi=Re.bi=g,de.bj=Re.bj=T,de.minForce=Re.minForce=-ye*ve,de.maxForce=Re.maxForce=ye*ve,de.ri.copy(se.ri),de.rj.copy(se.rj),Re.ri.copy(se.ri),Re.rj.copy(se.rj),se.ni.tangents(de.t,Re.t),de.setSpookParams(G.frictionEquationStiffness,G.frictionEquationRelaxation,$.dt),Re.setSpookParams(G.frictionEquationStiffness,G.frictionEquationRelaxation,$.dt),de.enabled=Re.enabled=se.enabled,E.push(de,Re),!0}return!1};var x=new u,b=new u,O=new u;p.prototype.createFrictionFromAverage=function(se){var E=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(E,this.frictionResult)||se===1)){var g=this.frictionResult[this.frictionResult.length-2],T=this.frictionResult[this.frictionResult.length-1];x.setZero(),b.setZero(),O.setZero();for(var I=E.bi,z=E.bj,$=0;$!==se;$++)E=this.result[this.result.length-1-$],E.bodyA!==I?(x.vadd(E.ni,x),b.vadd(E.ri,b),O.vadd(E.rj,O)):(x.vsub(E.ni,x),b.vadd(E.rj,b),O.vadd(E.ri,O));var G=1/se;b.scale(G,g.ri),O.scale(G,g.rj),T.ri.copy(g.ri),T.rj.copy(g.rj),x.normalize(),x.tangents(g.t,T.t)}};var N=new u,_=new u,P=new f,M=new f;p.prototype.getContacts=function(se,E,g,T,I,z,$){this.contactPointPool=I,this.frictionEquationPool=$,this.result=T,this.frictionResult=z;for(var G=P,U=M,ae=N,pe=_,ye=0,ve=se.length;ye!==ve;ye++){var le=se[ye],de=E[ye],Re=null;le.material&&de.material&&(Re=g.getContactMaterial(le.material,de.material)||null);for(var Ue=0;Ue<le.shapes.length;Ue++){le.quaternion.mult(le.shapeOrientations[Ue],G),le.quaternion.vmult(le.shapeOffsets[Ue],ae),ae.vadd(le.position,ae);for(var Be=le.shapes[Ue],fe=0;fe<de.shapes.length;fe++){de.quaternion.mult(de.shapeOrientations[fe],U),de.quaternion.vmult(de.shapeOffsets[fe],pe),pe.vadd(de.position,pe);var Ve=de.shapes[fe];if(!(ae.distanceTo(pe)>Be.boundingSphereRadius+Ve.boundingSphereRadius)){var tt=null;Be.material&&Ve.material&&(tt=g.getContactMaterial(Be.material,Ve.material)||null),this.currentContactMaterial=tt||Re||g.defaultContactMaterial;var Ge=this[Be.type|Ve.type];Ge&&(Be.type<Ve.type?Ge.call(this,Be,Ve,ae,pe,G,U,le,de,Be,Ve):Ge.call(this,Ve,Be,pe,ae,U,G,de,le,Be,Ve))}}}}};var q=0,Q=10;function w(se){q>Q||(q++,console.warn(se))}p.prototype[o.types.BOX|o.types.BOX]=p.prototype.boxBox=function(se,E,g,T,I,z,$,G){se.convexPolyhedronRepresentation.material=se.material,E.convexPolyhedronRepresentation.material=E.material,se.convexPolyhedronRepresentation.collisionResponse=se.collisionResponse,E.convexPolyhedronRepresentation.collisionResponse=E.collisionResponse,this.convexConvex(se.convexPolyhedronRepresentation,E.convexPolyhedronRepresentation,g,T,I,z,$,G,se,E)},p.prototype[o.types.BOX|o.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(se,E,g,T,I,z,$,G){se.convexPolyhedronRepresentation.material=se.material,se.convexPolyhedronRepresentation.collisionResponse=se.collisionResponse,this.convexConvex(se.convexPolyhedronRepresentation,E,g,T,I,z,$,G,se,E)},p.prototype[o.types.BOX|o.types.PARTICLE]=p.prototype.boxParticle=function(se,E,g,T,I,z,$,G){se.convexPolyhedronRepresentation.material=se.material,se.convexPolyhedronRepresentation.collisionResponse=se.collisionResponse,this.convexParticle(se.convexPolyhedronRepresentation,E,g,T,I,z,$,G,se,E)},p.prototype[o.types.SPHERE]=p.prototype.sphereSphere=function(se,E,g,T,I,z,$,G){var U=this.createContactEquation($,G,se,E);T.vsub(g,U.ni),U.ni.normalize(),U.ri.copy(U.ni),U.rj.copy(U.ni),U.ri.mult(se.radius,U.ri),U.rj.mult(-E.radius,U.rj),U.ri.vadd(g,U.ri),U.ri.vsub($.position,U.ri),U.rj.vadd(T,U.rj),U.rj.vsub(G.position,U.rj),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)};var k=new u,V=new u,K=new u;p.prototype[o.types.PLANE|o.types.TRIMESH]=p.prototype.planeTrimesh=function(se,E,g,T,I,z,$,G){var U=new u,ae=k;ae.set(0,0,1),I.vmult(ae,ae);for(var pe=0;pe<E.vertices.length/3;pe++){E.getVertex(pe,U);var ye=new u;ye.copy(U),h.pointToWorldFrame(T,z,ye,U);var ve=V;U.vsub(g,ve);var le=ae.dot(ve);if(le<=0){var de=this.createContactEquation($,G,se,E);de.ni.copy(ae);var Re=K;ae.scale(ve.dot(ae),Re),U.vsub(Re,Re),de.ri.copy(Re),de.ri.vsub($.position,de.ri),de.rj.copy(U),de.rj.vsub(G.position,de.rj),this.result.push(de),this.createFrictionEquationsFromContact(de,this.frictionResult)}}};var H=new u,oe=new u,ie=new u,ue=new u,me=new u,Ae=new u,Fe=new u,Me=new u,je=new u,Pe=new u,D=new u,A=new u,F=new u,ee=new u,S=new c,L=[];p.prototype[o.types.SPHERE|o.types.TRIMESH]=p.prototype.sphereTrimesh=function(se,E,g,T,I,z,$,G){var U=Ae,ae=Fe,pe=Me,ye=je,ve=Pe,le=D,de=S,Re=me,Ue=oe,Be=L;h.pointToLocalFrame(T,z,g,ve);var fe=se.radius;de.lowerBound.set(ve.x-fe,ve.y-fe,ve.z-fe),de.upperBound.set(ve.x+fe,ve.y+fe,ve.z+fe),E.getTrianglesInAABB(de,Be);for(var Ve=ue,tt=se.radius*se.radius,Ge=0;Ge<Be.length;Ge++)for(var Qe=0;Qe<3;Qe++)if(E.getVertex(E.indices[Be[Ge]*3+Qe],Ve),Ve.vsub(ve,Ue),Ue.norm2()<=tt){Re.copy(Ve),h.pointToWorldFrame(T,z,Re,Ve),Ve.vsub(g,Ue);var ze=this.createContactEquation($,G,se,E);ze.ni.copy(Ue),ze.ni.normalize(),ze.ri.copy(ze.ni),ze.ri.scale(se.radius,ze.ri),ze.ri.vadd(g,ze.ri),ze.ri.vsub($.position,ze.ri),ze.rj.copy(Ve),ze.rj.vsub(G.position,ze.rj),this.result.push(ze),this.createFrictionEquationsFromContact(ze,this.frictionResult)}for(var Ge=0;Ge<Be.length;Ge++)for(var Qe=0;Qe<3;Qe++){E.getVertex(E.indices[Be[Ge]*3+Qe],U),E.getVertex(E.indices[Be[Ge]*3+(Qe+1)%3],ae),ae.vsub(U,pe),ve.vsub(ae,le);var bt=le.dot(pe);ve.vsub(U,le);var Ct=le.dot(pe);if(Ct>0&&bt<0){ve.vsub(U,le),ye.copy(pe),ye.normalize(),Ct=le.dot(ye),ye.scale(Ct,le),le.vadd(U,le);var It=le.distanceTo(ve);if(It<se.radius){var ze=this.createContactEquation($,G,se,E);le.vsub(ve,ze.ni),ze.ni.normalize(),ze.ni.scale(se.radius,ze.ri),h.pointToWorldFrame(T,z,le,le),le.vsub(G.position,ze.rj),h.vectorToWorldFrame(z,ze.ni,ze.ni),h.vectorToWorldFrame(z,ze.ri,ze.ri),this.result.push(ze),this.createFrictionEquationsFromContact(ze,this.frictionResult)}}}for(var Mt=A,Xt=F,Pt=ee,it=H,Ge=0,mt=Be.length;Ge!==mt;Ge++){E.getTriangleVertices(Be[Ge],Mt,Xt,Pt),E.getNormal(Be[Ge],it),ve.vsub(Mt,le);var It=le.dot(it);if(it.scale(It,le),ve.vsub(le,le),It=le.distanceTo(ve),i.pointInTriangle(le,Mt,Xt,Pt)&&It<se.radius){var ze=this.createContactEquation($,G,se,E);le.vsub(ve,ze.ni),ze.ni.normalize(),ze.ni.scale(se.radius,ze.ri),h.pointToWorldFrame(T,z,le,le),le.vsub(G.position,ze.rj),h.vectorToWorldFrame(z,ze.ni,ze.ni),h.vectorToWorldFrame(z,ze.ri,ze.ri),this.result.push(ze),this.createFrictionEquationsFromContact(ze,this.frictionResult)}}Be.length=0};var ce=new u,xe=new u;p.prototype[o.types.SPHERE|o.types.PLANE]=p.prototype.spherePlane=function(se,E,g,T,I,z,$,G){var U=this.createContactEquation($,G,se,E);if(U.ni.set(0,0,1),z.vmult(U.ni,U.ni),U.ni.negate(U.ni),U.ni.normalize(),U.ni.mult(se.radius,U.ri),g.vsub(T,ce),U.ni.mult(U.ni.dot(ce),xe),ce.vsub(xe,U.rj),-ce.dot(U.ni)<=se.radius){var ae=U.ri,pe=U.rj;ae.vadd(g,ae),ae.vsub($.position,ae),pe.vadd(T,pe),pe.vsub(G.position,pe),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)}};var X=new u,C=new u,R=new u;function W(se,E,g){for(var T=null,I=se.length,z=0;z!==I;z++){var $=se[z],G=X;se[(z+1)%I].vsub($,G);var U=C;G.cross(E,U);var ae=R;g.vsub($,ae);var pe=U.dot(ae);if(T===null||pe>0&&T===!0||pe<=0&&T===!1){T===null&&(T=pe>0);continue}else return!1}return!0}var j=new u,ne=new u,re=new u,he=new u,Ee=[new u,new u,new u,new u,new u,new u],Te=new u,Ne=new u,ke=new u,_e=new u;p.prototype[o.types.SPHERE|o.types.BOX]=p.prototype.sphereBox=function(se,E,g,T,I,z,$,G){var U=this.v3pool,ae=Ee;g.vsub(T,j),E.getSideNormals(ae,z);for(var pe=se.radius,ye=[],ve=!1,le=Ne,de=ke,Re=_e,Ue=null,Be=0,fe=0,Ve=0,tt=null,Ge=0,Qe=ae.length;Ge!==Qe&&ve===!1;Ge++){var ze=ne;ze.copy(ae[Ge]);var bt=ze.norm();ze.normalize();var Ct=j.dot(ze);if(Ct<bt+pe&&Ct>0){var It=re,Mt=he;It.copy(ae[(Ge+1)%3]),Mt.copy(ae[(Ge+2)%3]);var Xt=It.norm(),Pt=Mt.norm();It.normalize(),Mt.normalize();var it=j.dot(It),mt=j.dot(Mt);if(it<Xt&&it>-Xt&&mt<Pt&&mt>-Pt){var Dt=Math.abs(Ct-bt-pe);(tt===null||Dt<tt)&&(tt=Dt,fe=it,Ve=mt,Ue=bt,le.copy(ze),de.copy(It),Re.copy(Mt),Be++)}}}if(Be){ve=!0;var Xe=this.createContactEquation($,G,se,E);le.mult(-pe,Xe.ri),Xe.ni.copy(le),Xe.ni.negate(Xe.ni),le.mult(Ue,le),de.mult(fe,de),le.vadd(de,le),Re.mult(Ve,Re),le.vadd(Re,Xe.rj),Xe.ri.vadd(g,Xe.ri),Xe.ri.vsub($.position,Xe.ri),Xe.rj.vadd(T,Xe.rj),Xe.rj.vsub(G.position,Xe.rj),this.result.push(Xe),this.createFrictionEquationsFromContact(Xe,this.frictionResult)}for(var dt=U.get(),Jt=Te,zt=0;zt!==2&&!ve;zt++)for(var Bt=0;Bt!==2&&!ve;Bt++)for(var _t=0;_t!==2&&!ve;_t++)if(dt.set(0,0,0),zt?dt.vadd(ae[0],dt):dt.vsub(ae[0],dt),Bt?dt.vadd(ae[1],dt):dt.vsub(ae[1],dt),_t?dt.vadd(ae[2],dt):dt.vsub(ae[2],dt),T.vadd(dt,Jt),Jt.vsub(g,Jt),Jt.norm2()<pe*pe){ve=!0;var Xe=this.createContactEquation($,G,se,E);Xe.ri.copy(Jt),Xe.ri.normalize(),Xe.ni.copy(Xe.ri),Xe.ri.mult(pe,Xe.ri),Xe.rj.copy(dt),Xe.ri.vadd(g,Xe.ri),Xe.ri.vsub($.position,Xe.ri),Xe.rj.vadd(T,Xe.rj),Xe.rj.vsub(G.position,Xe.rj),this.result.push(Xe),this.createFrictionEquationsFromContact(Xe,this.frictionResult)}U.release(dt),dt=null;for(var Gt=U.get(),Kt=U.get(),Xe=U.get(),on=U.get(),Dt=U.get(),Dn=ae.length,zt=0;zt!==Dn&&!ve;zt++)for(var Bt=0;Bt!==Dn&&!ve;Bt++)if(zt%3!==Bt%3){ae[Bt].cross(ae[zt],Gt),Gt.normalize(),ae[zt].vadd(ae[Bt],Kt),Xe.copy(g),Xe.vsub(Kt,Xe),Xe.vsub(T,Xe);var Vn=Xe.dot(Gt);Gt.mult(Vn,on);for(var _t=0;_t===zt%3||_t===Bt%3;)_t++;Dt.copy(g),Dt.vsub(on,Dt),Dt.vsub(Kt,Dt),Dt.vsub(T,Dt);var Ka=Math.abs(Vn),es=Dt.norm();if(Ka<ae[_t].norm()&&es<pe){ve=!0;var gt=this.createContactEquation($,G,se,E);Kt.vadd(on,gt.rj),gt.rj.copy(gt.rj),Dt.negate(gt.ni),gt.ni.normalize(),gt.ri.copy(gt.rj),gt.ri.vadd(T,gt.ri),gt.ri.vsub(g,gt.ri),gt.ri.normalize(),gt.ri.mult(pe,gt.ri),gt.ri.vadd(g,gt.ri),gt.ri.vsub($.position,gt.ri),gt.rj.vadd(T,gt.rj),gt.rj.vsub(G.position,gt.rj),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult)}}U.release(Gt,Kt,Xe,on,Dt)};var $e=new u,qe=new u,Ke=new u,ot=new u,vt=new u,St=new u,yt=new u,Ht=new u,Oe=new u,De=new u;p.prototype[o.types.SPHERE|o.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(se,E,g,T,I,z,$,G){var U=this.v3pool;g.vsub(T,$e);for(var ae=E.faceNormals,pe=E.faces,ye=E.vertices,ve=se.radius,le=[],de=0;de!==ye.length;de++){var Re=ye[de],Ue=vt;z.vmult(Re,Ue),T.vadd(Ue,Ue);var Be=ot;if(Ue.vsub(g,Be),Be.norm2()<ve*ve){Ve=!0;var fe=this.createContactEquation($,G,se,E);fe.ri.copy(Be),fe.ri.normalize(),fe.ni.copy(fe.ri),fe.ri.mult(ve,fe.ri),Ue.vsub(T,fe.rj),fe.ri.vadd(g,fe.ri),fe.ri.vsub($.position,fe.ri),fe.rj.vadd(T,fe.rj),fe.rj.vsub(G.position,fe.rj),this.result.push(fe),this.createFrictionEquationsFromContact(fe,this.frictionResult);return}}for(var Ve=!1,de=0,tt=pe.length;de!==tt&&Ve===!1;de++){var Ge=ae[de],Qe=pe[de],ze=St;z.vmult(Ge,ze);var bt=yt;z.vmult(ye[Qe[0]],bt),bt.vadd(T,bt);var Ct=Ht;ze.mult(-ve,Ct),g.vadd(Ct,Ct);var It=Oe;Ct.vsub(bt,It);var Mt=It.dot(ze),Xt=De;if(g.vsub(bt,Xt),Mt<0&&Xt.dot(ze)>0){for(var Pt=[],it=0,mt=Qe.length;it!==mt;it++){var dt=U.get();z.vmult(ye[Qe[it]],dt),T.vadd(dt,dt),Pt.push(dt)}if(W(Pt,ze,g)){Ve=!0;var fe=this.createContactEquation($,G,se,E);ze.mult(-ve,fe.ri),ze.negate(fe.ni);var Jt=U.get();ze.mult(-Mt,Jt);var zt=U.get();ze.mult(-ve,zt),g.vsub(T,fe.rj),fe.rj.vadd(zt,fe.rj),fe.rj.vadd(Jt,fe.rj),fe.rj.vadd(T,fe.rj),fe.rj.vsub(G.position,fe.rj),fe.ri.vadd(g,fe.ri),fe.ri.vsub($.position,fe.ri),U.release(Jt),U.release(zt),this.result.push(fe),this.createFrictionEquationsFromContact(fe,this.frictionResult);for(var it=0,Bt=Pt.length;it!==Bt;it++)U.release(Pt[it]);return}else for(var it=0;it!==Qe.length;it++){var _t=U.get(),Gt=U.get();z.vmult(ye[Qe[(it+1)%Qe.length]],_t),z.vmult(ye[Qe[(it+2)%Qe.length]],Gt),T.vadd(_t,_t),T.vadd(Gt,Gt);var Kt=qe;Gt.vsub(_t,Kt);var Xe=Ke;Kt.unit(Xe);var on=U.get(),Dt=U.get();g.vsub(_t,Dt);var Dn=Dt.dot(Xe);Xe.mult(Dn,on),on.vadd(_t,on);var Vn=U.get();if(on.vsub(g,Vn),Dn>0&&Dn*Dn<Kt.norm2()&&Vn.norm2()<ve*ve){var fe=this.createContactEquation($,G,se,E);on.vsub(T,fe.rj),on.vsub(g,fe.ni),fe.ni.normalize(),fe.ni.mult(ve,fe.ri),fe.rj.vadd(T,fe.rj),fe.rj.vsub(G.position,fe.rj),fe.ri.vadd(g,fe.ri),fe.ri.vsub($.position,fe.ri),this.result.push(fe),this.createFrictionEquationsFromContact(fe,this.frictionResult);for(var it=0,Bt=Pt.length;it!==Bt;it++)U.release(Pt[it]);U.release(_t),U.release(Gt),U.release(on),U.release(Vn),U.release(Dt);return}U.release(_t),U.release(Gt),U.release(on),U.release(Vn),U.release(Dt)}for(var it=0,Bt=Pt.length;it!==Bt;it++)U.release(Pt[it])}}};var Ut=new u,tn=new u;p.prototype[o.types.PLANE|o.types.BOX]=p.prototype.planeBox=function(se,E,g,T,I,z,$,G){E.convexPolyhedronRepresentation.material=E.material,E.convexPolyhedronRepresentation.collisionResponse=E.collisionResponse,this.planeConvex(se,E.convexPolyhedronRepresentation,g,T,I,z,$,G)};var Yt=new u,rt=new u,B=new u,Y=new u;p.prototype[o.types.PLANE|o.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(se,E,g,T,I,z,$,G){var U=Yt,ae=rt;ae.set(0,0,1),I.vmult(ae,ae);for(var pe=0,ye=B,ve=0;ve!==E.vertices.length;ve++){U.copy(E.vertices[ve]),z.vmult(U,U),T.vadd(U,U),U.vsub(g,ye);var le=ae.dot(ye);if(le<=0){var de=this.createContactEquation($,G,se,E),Re=Y;ae.mult(ae.dot(ye),Re),U.vsub(Re,Re),Re.vsub(g,de.ri),de.ni.copy(ae),U.vsub(T,de.rj),de.ri.vadd(g,de.ri),de.ri.vsub($.position,de.ri),de.rj.vadd(T,de.rj),de.rj.vsub(G.position,de.rj),this.result.push(de),pe++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(de,this.frictionResult)}}this.enableFrictionReduction&&pe&&this.createFrictionFromAverage(pe)};var te=new u,we=new u;p.prototype[o.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(se,E,g,T,I,z,$,G,U,ae,pe,ye){var ve=te;if(!(g.distanceTo(T)>se.boundingSphereRadius+E.boundingSphereRadius)&&se.findSeparatingAxis(E,g,I,T,z,ve,pe,ye)){var le=[],de=we;se.clipAgainstHull(g,I,E,T,z,ve,-100,100,le);for(var Re=0,Ue=0;Ue!==le.length;Ue++){var Be=this.createContactEquation($,G,se,E,U,ae),fe=Be.ri,Ve=Be.rj;ve.negate(Be.ni),le[Ue].normal.negate(de),de.mult(le[Ue].depth,de),le[Ue].point.vadd(de,fe),Ve.copy(le[Ue].point),fe.vsub(g,fe),Ve.vsub(T,Ve),fe.vadd(g,fe),fe.vsub($.position,fe),Ve.vadd(T,Ve),Ve.vsub(G.position,Ve),this.result.push(Be),Re++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Be,this.frictionResult)}this.enableFrictionReduction&&Re&&this.createFrictionFromAverage(Re)}};var be=new u,Ce=new u,Ie=new u;p.prototype[o.types.PLANE|o.types.PARTICLE]=p.prototype.planeParticle=function(se,E,g,T,I,z,$,G){var U=be;U.set(0,0,1),$.quaternion.vmult(U,U);var ae=Ce;T.vsub($.position,ae);var pe=U.dot(ae);if(pe<=0){var ye=this.createContactEquation(G,$,E,se);ye.ni.copy(U),ye.ni.negate(ye.ni),ye.ri.set(0,0,0);var ve=Ie;U.mult(U.dot(T),ve),T.vsub(ve,ve),ye.rj.copy(ve),this.result.push(ye),this.createFrictionEquationsFromContact(ye,this.frictionResult)}};var lt=new u;p.prototype[o.types.PARTICLE|o.types.SPHERE]=p.prototype.sphereParticle=function(se,E,g,T,I,z,$,G){var U=lt;U.set(0,0,1),T.vsub(g,U);var ae=U.norm2();if(ae<=se.radius*se.radius){var pe=this.createContactEquation(G,$,E,se);U.normalize(),pe.rj.copy(U),pe.rj.mult(se.radius,pe.rj),pe.ni.copy(U),pe.ni.negate(pe.ni),pe.ri.set(0,0,0),this.result.push(pe),this.createFrictionEquationsFromContact(pe,this.frictionResult)}};var Nt=new f,ft=new u,nn=new u,ln=new u,En=new u,Bn=new u;p.prototype[o.types.PARTICLE|o.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(se,E,g,T,I,z,$,G){var U=-1,ae=ln,pe=Bn,ye=null,ve=0,le=ft;if(le.copy(T),le.vsub(g,le),I.conjugate(Nt),Nt.vmult(le,le),se.pointIsInside(le)){se.worldVerticesNeedsUpdate&&se.computeWorldVertices(g,I),se.worldFaceNormalsNeedsUpdate&&se.computeWorldFaceNormals(I);for(var de=0,Re=se.faces.length;de!==Re;de++){var Ue=[se.worldVertices[se.faces[de][0]]],Be=se.worldFaceNormals[de];T.vsub(Ue[0],En);var fe=-Be.dot(En);(ye===null||Math.abs(fe)<Math.abs(ye))&&(ye=fe,U=de,ae.copy(Be),ve++)}if(U!==-1){var Ve=this.createContactEquation(G,$,E,se);ae.mult(ye,pe),pe.vadd(T,pe),pe.vsub(g,pe),Ve.rj.copy(pe),ae.negate(Ve.ni),Ve.ri.set(0,0,0);var tt=Ve.ri,Ge=Ve.rj;tt.vadd(T,tt),tt.vsub(G.position,tt),Ge.vadd(g,Ge),Ge.vsub($.position,Ge),this.result.push(Ve),this.createFrictionEquationsFromContact(Ve,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},p.prototype[o.types.BOX|o.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(se,E,g,T,I,z,$,G){se.convexPolyhedronRepresentation.material=se.material,se.convexPolyhedronRepresentation.collisionResponse=se.collisionResponse,this.convexHeightfield(se.convexPolyhedronRepresentation,E,g,T,I,z,$,G)};var Wr=new u,bo=new u,zo=[0];p.prototype[o.types.CONVEXPOLYHEDRON|o.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(se,E,g,T,I,z,$,G){var U=E.data,ae=E.elementSize,pe=se.boundingSphereRadius,ye=bo,ve=zo,le=Wr;h.pointToLocalFrame(T,z,g,le);var de=Math.floor((le.x-pe)/ae)-1,Re=Math.ceil((le.x+pe)/ae)+1,Ue=Math.floor((le.y-pe)/ae)-1,Be=Math.ceil((le.y+pe)/ae)+1;if(!(Re<0||Be<0||de>U.length||Ue>U[0].length)){de<0&&(de=0),Re<0&&(Re=0),Ue<0&&(Ue=0),Be<0&&(Be=0),de>=U.length&&(de=U.length-1),Re>=U.length&&(Re=U.length-1),Be>=U[0].length&&(Be=U[0].length-1),Ue>=U[0].length&&(Ue=U[0].length-1);var fe=[];E.getRectMinMax(de,Ue,Re,Be,fe);var Ve=fe[0],tt=fe[1];if(!(le.z-pe>tt||le.z+pe<Ve))for(var Ge=de;Ge<Re;Ge++)for(var Qe=Ue;Qe<Be;Qe++)E.getConvexTrianglePillar(Ge,Qe,!1),h.pointToWorldFrame(T,z,E.pillarOffset,ye),g.distanceTo(ye)<E.pillarConvex.boundingSphereRadius+se.boundingSphereRadius&&this.convexConvex(se,E.pillarConvex,g,ye,I,z,$,G,null,null,ve,null),E.getConvexTrianglePillar(Ge,Qe,!0),h.pointToWorldFrame(T,z,E.pillarOffset,ye),g.distanceTo(ye)<E.pillarConvex.boundingSphereRadius+se.boundingSphereRadius&&this.convexConvex(se,E.pillarConvex,g,ye,I,z,$,G,null,null,ve,null)}};var qr=new u,Fo=new u;p.prototype[o.types.SPHERE|o.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(se,E,g,T,I,z,$,G){var U=E.data,ae=se.radius,pe=E.elementSize,ye=Fo,ve=qr;h.pointToLocalFrame(T,z,g,ve);var le=Math.floor((ve.x-ae)/pe)-1,de=Math.ceil((ve.x+ae)/pe)+1,Re=Math.floor((ve.y-ae)/pe)-1,Ue=Math.ceil((ve.y+ae)/pe)+1;if(!(de<0||Ue<0||le>U.length||Ue>U[0].length)){le<0&&(le=0),de<0&&(de=0),Re<0&&(Re=0),Ue<0&&(Ue=0),le>=U.length&&(le=U.length-1),de>=U.length&&(de=U.length-1),Ue>=U[0].length&&(Ue=U[0].length-1),Re>=U[0].length&&(Re=U[0].length-1);var Be=[];E.getRectMinMax(le,Re,de,Ue,Be);var fe=Be[0],Ve=Be[1];if(!(ve.z-ae>Ve||ve.z+ae<fe))for(var tt=this.result,Ge=le;Ge<de;Ge++)for(var Qe=Re;Qe<Ue;Qe++){var ze=tt.length;E.getConvexTrianglePillar(Ge,Qe,!1),h.pointToWorldFrame(T,z,E.pillarOffset,ye),g.distanceTo(ye)<E.pillarConvex.boundingSphereRadius+se.boundingSphereRadius&&this.sphereConvex(se,E.pillarConvex,g,ye,I,z,$,G),E.getConvexTrianglePillar(Ge,Qe,!0),h.pointToWorldFrame(T,z,E.pillarOffset,ye),g.distanceTo(ye)<E.pillarConvex.boundingSphereRadius+se.boundingSphereRadius&&this.sphereConvex(se,E.pillarConvex,g,ye,I,z,$,G);var bt=tt.length-ze;if(bt>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,a,r){a.exports=M;var c=t("../shapes/Shape"),o=t("../math/Vec3"),i=t("../math/Quaternion"),u=t("../solver/GSSolver"),h=t("../utils/Vec3Pool"),m=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation"),y=t("./Narrowphase"),l=t("../utils/EventTarget"),d=t("../collision/ArrayCollisionMatrix"),v=t("../material/Material"),p=t("../material/ContactMaterial"),x=t("../objects/Body"),b=t("../utils/TupleDictionary"),O=t("../collision/RaycastResult"),N=t("../collision/AABB"),_=t("../collision/Ray"),P=t("../collision/NaiveBroadphase");function M(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new P,this.bodies=[],this.solver=new u,this.constraints=[],this.narrowphase=new y(this),this.collisionMatrix=new d,this.collisionMatrixPrevious=new d,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new b,this.defaultMaterial=new v("default"),this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}M.prototype=new l;var q=new N,Q=[],w=new _;if(M.prototype.getContactMaterial=function(C,R){return this.contactMaterialTable.get(C.id,R.id)},M.prototype.numObjects=function(){return this.bodies.length},M.prototype.collisionMatrixTick=function(){var C=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=C,this.collisionMatrix.reset()},M.prototype.add=M.prototype.addBody=function(C){this.bodies.indexOf(C)===-1&&(C.index=this.bodies.length,this.bodies.push(C),C.world=this,C.initPosition.copy(C.position),C.initVelocity.copy(C.velocity),C.timeLastSleepy=this.time,C instanceof x&&(C.initAngularVelocity.copy(C.angularVelocity),C.initQuaternion.copy(C.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=C,this.dispatchEvent(this.addBodyEvent))},M.prototype.addConstraint=function(C){this.constraints.push(C)},M.prototype.removeConstraint=function(C){var R=this.constraints.indexOf(C);R!==-1&&this.constraints.splice(R,1)},M.prototype.rayTest=function(C,R,W){W instanceof O?this.raycastClosest(C,R,{skipBackfaces:!0},W):this.raycastAll(C,R,{skipBackfaces:!0},W)},M.prototype.raycastAll=function(C,R,W,j){return W.mode=_.ALL,W.from=C,W.to=R,W.callback=j,w.intersectWorld(this,W)},M.prototype.raycastAny=function(C,R,W,j){return W.mode=_.ANY,W.from=C,W.to=R,W.result=j,w.intersectWorld(this,W)},M.prototype.raycastClosest=function(C,R,W,j){return W.mode=_.CLOSEST,W.from=C,W.to=R,W.result=j,w.intersectWorld(this,W)},M.prototype.remove=function(C){C.world=null;var R=this.bodies.length-1,W=this.bodies,j=W.indexOf(C);if(j!==-1){W.splice(j,1);for(var ne=0;ne!==W.length;ne++)W[ne].index=ne;this.collisionMatrix.setNumObjects(R),this.removeBodyEvent.body=C,this.dispatchEvent(this.removeBodyEvent)}},M.prototype.removeBody=M.prototype.remove,M.prototype.addMaterial=function(C){this.materials.push(C)},M.prototype.addContactMaterial=function(C){this.contactmaterials.push(C),this.contactMaterialTable.set(C.materials[0].id,C.materials[1].id,C)},typeof performance>"u"&&(performance={}),!performance.now){var k=Date.now();performance.timing&&performance.timing.navigationStart&&(k=performance.timing.navigationStart),performance.now=function(){return Date.now()-k}}var V=new o;M.prototype.step=function(C,R,W){if(W=W||10,R=R||0,R===0)this.internalStep(C),this.time+=C;else{var j=Math.floor((this.time+R)/C)-Math.floor(this.time/C);j=Math.min(j,W);for(var ne=performance.now(),re=0;re!==j&&(this.internalStep(C),!(performance.now()-ne>C*1e3));re++);this.time+=R;for(var he=this.time%C,Ee=he/C,Te=V,Ne=this.bodies,ke=0;ke!==Ne.length;ke++){var _e=Ne[ke];_e.type!==x.STATIC&&_e.sleepState!==x.SLEEPING?(_e.position.vsub(_e.previousPosition,Te),Te.scale(Ee,Te),_e.position.vadd(Te,_e.interpolatedPosition)):(_e.interpolatedPosition.copy(_e.position),_e.interpolatedQuaternion.copy(_e.quaternion))}}};var K={type:"postStep"},H={type:"preStep"},oe={type:"collide",body:null,contact:null},ie=[],ue=[],me=[],Ae=[],Fe=new o,Me=new o,je=new o,Pe=new o,D=new o,A=new o,F=new o,ee=new o,S=new o,L=new i,ce=new i,xe=new i,X=new o;M.prototype.internalStep=function(C){this.dt=C;var R=this,W=this,j=this.contacts,ne=me,re=Ae,he=this.numObjects(),Ee=this.bodies,Te=this.solver,Ne=this.gravity,ke=this.doProfiling,_e=this.profile,$e=x.DYNAMIC,qe,Ke=this.constraints,ot=ue,vt=Ne.norm(),St=Ne.x,yt=Ne.y,Ht=Ne.z,Oe=0;for(ke&&(qe=performance.now()),Oe=0;Oe!==he;Oe++){var De=Ee[Oe];if(De.type&$e){var Ut=De.force,tn=De.mass;Ut.x+=tn*St,Ut.y+=tn*yt,Ut.z+=tn*Ht}}for(var Oe=0,Yt=this.subsystems.length;Oe!==Yt;Oe++)this.subsystems[Oe].update();ke&&(qe=performance.now()),ne.length=0,re.length=0,this.broadphase.collisionPairs(this,ne,re),ke&&(_e.broadphase=performance.now()-qe);var bo=Ke.length;for(Oe=0;Oe!==bo;Oe++){var rt=Ke[Oe];if(!rt.collideConnected)for(var B=ne.length-1;B>=0;B-=1)(rt.bodyA===ne[B]&&rt.bodyB===re[B]||rt.bodyB===ne[B]&&rt.bodyA===re[B])&&(ne.splice(B,1),re.splice(B,1))}this.collisionMatrixTick(),ke&&(qe=performance.now());var Y=ie,te=j.length;for(Oe=0;Oe!==te;Oe++)Y.push(j[Oe]);j.length=0;var we=this.frictionEquations.length;for(Oe=0;Oe!==we;Oe++)ot.push(this.frictionEquations[Oe]);this.frictionEquations.length=0,this.narrowphase.getContacts(ne,re,this,j,Y,this.frictionEquations,ot),ke&&(_e.narrowphase=performance.now()-qe),ke&&(qe=performance.now());for(var Oe=0;Oe<this.frictionEquations.length;Oe++)Te.addEquation(this.frictionEquations[Oe]);for(var be=j.length,Ce=0;Ce!==be;Ce++){var rt=j[Ce],De=rt.bi,Ie=rt.bj,lt=rt.si,Nt=rt.sj,ft;De.material&&Ie.material?ft=this.getContactMaterial(De.material,Ie.material)||this.defaultContactMaterial:ft=this.defaultContactMaterial;var nn=ft.friction;if(De.material&&Ie.material&&(De.material.friction>=0&&Ie.material.friction>=0&&(nn=De.material.friction*Ie.material.friction),De.material.restitution>=0&&Ie.material.restitution>=0&&(rt.restitution=De.material.restitution*Ie.material.restitution)),Te.addEquation(rt),De.allowSleep&&De.type===x.DYNAMIC&&De.sleepState===x.SLEEPING&&Ie.sleepState===x.AWAKE&&Ie.type!==x.STATIC){var ln=Ie.velocity.norm2()+Ie.angularVelocity.norm2(),En=Math.pow(Ie.sleepSpeedLimit,2);ln>=En*2&&(De._wakeUpAfterNarrowphase=!0)}if(Ie.allowSleep&&Ie.type===x.DYNAMIC&&Ie.sleepState===x.SLEEPING&&De.sleepState===x.AWAKE&&De.type!==x.STATIC){var Bn=De.velocity.norm2()+De.angularVelocity.norm2(),Wr=Math.pow(De.sleepSpeedLimit,2);Bn>=Wr*2&&(Ie._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(De,Ie,!0),this.collisionMatrixPrevious.get(De,Ie)||(oe.body=Ie,oe.contact=rt,De.dispatchEvent(oe),oe.body=De,Ie.dispatchEvent(oe))}for(ke&&(_e.makeContactConstraints=performance.now()-qe,qe=performance.now()),Oe=0;Oe!==he;Oe++){var De=Ee[Oe];De._wakeUpAfterNarrowphase&&(De.wakeUp(),De._wakeUpAfterNarrowphase=!1)}var bo=Ke.length;for(Oe=0;Oe!==bo;Oe++){var rt=Ke[Oe];rt.update();for(var B=0,zo=rt.equations.length;B!==zo;B++){var qr=rt.equations[B];Te.addEquation(qr)}}Te.solve(C,this),ke&&(_e.solve=performance.now()-qe),Te.removeAllEquations();var Fo=Math.pow;for(Oe=0;Oe!==he;Oe++){var De=Ee[Oe];if(De.type&$e){var se=Fo(1-De.linearDamping,C),E=De.velocity;E.mult(se,E);var g=De.angularVelocity;if(g){var T=Fo(1-De.angularDamping,C);g.mult(T,g)}}}for(this.dispatchEvent(H),Oe=0;Oe!==he;Oe++){var De=Ee[Oe];De.preStep&&De.preStep.call(De)}ke&&(qe=performance.now());var I=L,z=ce,$=xe,G=this.stepnumber,U=x.DYNAMIC|x.KINEMATIC,ae=G%(this.quatNormalizeSkip+1)===0,pe=this.quatNormalizeFast,ye=C*.5,ve=c.types.PLANE,le=c.types.CONVEXPOLYHEDRON;for(Oe=0;Oe!==he;Oe++){var de=Ee[Oe],Re=de.force,Ue=de.torque;if(de.type&U&&de.sleepState!==x.SLEEPING){var Be=de.velocity,fe=de.angularVelocity,Ve=de.position,tt=de.quaternion,Ge=de.invMass,Qe=de.invInertiaWorld;Be.x+=Re.x*Ge*C,Be.y+=Re.y*Ge*C,Be.z+=Re.z*Ge*C,de.angularVelocity&&(Qe.vmult(Ue,X),X.mult(C,X),X.vadd(fe,fe)),Ve.x+=Be.x*C,Ve.y+=Be.y*C,Ve.z+=Be.z*C,de.angularVelocity&&(z.set(fe.x,fe.y,fe.z,0),z.mult(tt,$),tt.x+=ye*$.x,tt.y+=ye*$.y,tt.z+=ye*$.z,tt.w+=ye*$.w,ae&&(pe?tt.normalizeFast():tt.normalize())),de.aabb&&(de.aabbNeedsUpdate=!0),de.updateInertiaWorld&&de.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,ke&&(_e.integrate=performance.now()-qe),this.time+=C,this.stepnumber+=1,this.dispatchEvent(K),Oe=0;Oe!==he;Oe++){var De=Ee[Oe],ze=De.postStep;ze&&ze.call(De)}if(this.allowSleep)for(Oe=0;Oe!==he;Oe++)Ee[Oe].sleepTick(this.time)},M.prototype.clearForces=function(){for(var C=this.bodies,R=C.length,W=0;W!==R;W++){var j=C[W],ne=j.force,re=j.torque;j.force.set(0,0,0),j.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})});var Km={};Hd(Km,{main:()=>Za,onStart:()=>Jm,onUpdate:()=>Qm,rendererTransport:()=>Ja});module.exports=Gd(Km);var wo=Ze(Je());function tp(){return{states:[]}}var Uo;(function(e){function n(t,a=wo.default.Writer.create()){for(let r of t.states)_i.encode(r,a.uint32(10).fork()).ldelim();return a}e.encode=n;function s(t,a){let r=t instanceof wo.default.Reader?t:wo.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=tp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.states.push(_i.decode(r,r.uint32()));continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Uo||(Uo={}));function np(){return{clip:"",playing:void 0,weight:void 0,speed:void 0,loop:void 0,shouldReset:void 0}}var _i;(function(e){function n(t,a=wo.default.Writer.create()){return t.clip!==""&&a.uint32(18).string(t.clip),t.playing!==void 0&&a.uint32(24).bool(t.playing),t.weight!==void 0&&a.uint32(37).float(t.weight),t.speed!==void 0&&a.uint32(45).float(t.speed),t.loop!==void 0&&a.uint32(48).bool(t.loop),t.shouldReset!==void 0&&a.uint32(56).bool(t.shouldReset),a}e.encode=n;function s(t,a){let r=t instanceof wo.default.Reader?t:wo.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=np();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 2:if(i!==18)break;o.clip=r.string();continue;case 3:if(i!==24)break;o.playing=r.bool();continue;case 4:if(i!==37)break;o.weight=r.float();continue;case 5:if(i!==45)break;o.speed=r.float();continue;case 6:if(i!==48)break;o.loop=r.bool();continue;case 7:if(i!==56)break;o.shouldReset=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(_i||(_i={}));var pu={COMPONENT_ID:1042,serialize(e,n){let s=Uo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Uo.decode(e.buffer(),e.remainingBytes())},create(){return Uo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAnimator"}};var Ai=Ze(Je());function op(){return{playing:void 0,volume:void 0,loop:void 0,pitch:void 0,audioClipUrl:""}}var Do;(function(e){function n(t,a=Ai.default.Writer.create()){return t.playing!==void 0&&a.uint32(8).bool(t.playing),t.volume!==void 0&&a.uint32(21).float(t.volume),t.loop!==void 0&&a.uint32(24).bool(t.loop),t.pitch!==void 0&&a.uint32(37).float(t.pitch),t.audioClipUrl!==""&&a.uint32(42).string(t.audioClipUrl),a}e.encode=n;function s(t,a){let r=t instanceof Ai.default.Reader?t:Ai.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=op();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.playing=r.bool();continue;case 2:if(i!==21)break;o.volume=r.float();continue;case 3:if(i!==24)break;o.loop=r.bool();continue;case 4:if(i!==37)break;o.pitch=r.float();continue;case 5:if(i!==42)break;o.audioClipUrl=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Do||(Do={}));var hu={COMPONENT_ID:1020,serialize(e,n){let s=Do.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Do.decode(e.buffer(),e.remainingBytes())},create(){return Do.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAudioSource"}};var Ri=Ze(Je());function rp(){return{playing:void 0,volume:void 0,url:""}}var Vo;(function(e){function n(t,a=Ri.default.Writer.create()){return t.playing!==void 0&&a.uint32(8).bool(t.playing),t.volume!==void 0&&a.uint32(21).float(t.volume),t.url!==""&&a.uint32(26).string(t.url),a}e.encode=n;function s(t,a){let r=t instanceof Ri.default.Reader?t:Ri.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=rp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.playing=r.bool();continue;case 2:if(i!==21)break;o.volume=r.float();continue;case 3:if(i!==26)break;o.url=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Vo||(Vo={}));var mu={COMPONENT_ID:1021,serialize(e,n){let s=Vo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Vo.decode(e.buffer(),e.remainingBytes())},create(){return Vo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAudioStream"}};var Ni=Ze(Je());var yu;(function(e){e[e.AAPT_POSITION=0]="AAPT_POSITION",e[e.AAPT_NAME_TAG=1]="AAPT_NAME_TAG",e[e.AAPT_LEFT_HAND=2]="AAPT_LEFT_HAND",e[e.AAPT_RIGHT_HAND=3]="AAPT_RIGHT_HAND"})(yu||(yu={}));function ip(){return{avatarId:void 0,anchorPointId:0}}var Wo;(function(e){function n(t,a=Ni.default.Writer.create()){return t.avatarId!==void 0&&a.uint32(10).string(t.avatarId),t.anchorPointId!==0&&a.uint32(16).int32(t.anchorPointId),a}e.encode=n;function s(t,a){let r=t instanceof Ni.default.Reader?t:Ni.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ip();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.avatarId=r.string();continue;case 2:if(i!==16)break;o.anchorPointId=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Wo||(Wo={}));var vu={COMPONENT_ID:1073,serialize(e,n){let s=Wo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Wo.decode(e.buffer(),e.remainingBytes())},create(){return Wo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAvatarAttach"}};var Ci=Ze(Je());var bn=Ze(Je());function ap(){return{x:0,y:0,z:0}}var xu;(function(e){function n(t,a=bn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.z!==0&&a.uint32(29).float(t.z),a}e.encode=n;function s(t,a){let r=t instanceof bn.default.Reader?t:bn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ap();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.z=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(xu||(xu={}));function sp(){return{x:0,y:0,z:0}}var nt;(function(e){function n(t,a=bn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.z!==0&&a.uint32(29).float(t.z),a}e.encode=n;function s(t,a){let r=t instanceof bn.default.Reader?t:bn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=sp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.z=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(nt||(nt={}));function cp(){return{x:0,y:0}}var Eu;(function(e){function n(t,a=bn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),a}e.encode=n;function s(t,a){let r=t instanceof bn.default.Reader?t:bn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=cp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Eu||(Eu={}));function up(){return{x:0,y:0,z:0,w:0}}var So;(function(e){function n(t,a=bn.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.z!==0&&a.uint32(29).float(t.z),t.w!==0&&a.uint32(37).float(t.w),a}e.encode=n;function s(t,a){let r=t instanceof bn.default.Reader?t:bn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=up();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.z=r.float();continue;case 4:if(i!==37)break;o.w=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(So||(So={}));var bu;(function(e){e[e.AMT_HIDE_AVATARS=0]="AMT_HIDE_AVATARS",e[e.AMT_DISABLE_PASSPORTS=1]="AMT_DISABLE_PASSPORTS"})(bu||(bu={}));function fp(){return{area:void 0,excludeIds:[],modifiers:[]}}var qo;(function(e){function n(t,a=Ci.default.Writer.create()){t.area!==void 0&&nt.encode(t.area,a.uint32(10).fork()).ldelim();for(let r of t.excludeIds)a.uint32(18).string(r);a.uint32(26).fork();for(let r of t.modifiers)a.int32(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Ci.default.Reader?t:Ci.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=fp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.area=nt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.excludeIds.push(r.string());continue;case 3:if(i===24){o.modifiers.push(r.int32());continue}if(i===26){let u=r.uint32()+r.pos;for(;r.pos<u;)o.modifiers.push(r.int32());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(qo||(qo={}));var gu={COMPONENT_ID:1070,serialize(e,n){let s=qo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return qo.decode(e.buffer(),e.remainingBytes())},create(){return qo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAvatarModifierArea"}};var Rn=null;try{Rn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Tt(e,n,s){this.low=e|0,this.high=n|0,this.unsigned=!!s}Tt.prototype.__isLong__;Object.defineProperty(Tt.prototype,"__isLong__",{value:!0});function rn(e){return(e&&e.__isLong__)===!0}function Tu(e){var n=Math.clz32(e&-e);return e?31-n:n}Tt.isLong=rn;var wu={},Su={};function _o(e,n){var s,t,a;return n?(e>>>=0,(a=0<=e&&e<256)&&(t=Su[e],t)?t:(s=ct(e,0,!0),a&&(Su[e]=s),s)):(e|=0,(a=-128<=e&&e<128)&&(t=wu[e],t)?t:(s=ct(e,e<0?-1:0,!1),a&&(wu[e]=s),s))}Tt.fromInt=_o;function Nn(e,n){if(isNaN(e))return n?jn:Pn;if(n){if(e<0)return jn;if(e>=Nu)return Bu}else{if(e<=-Au)return pn;if(e+1>=Au)return Iu}return e<0?Nn(-e,n).neg():ct(e%Go|0,e/Go|0,n)}Tt.fromNumber=Nn;function ct(e,n,s){return new Tt(e,n,s)}Tt.fromBits=ct;var Ii=Math.pow;function ms(e,n,s){if(e.length===0)throw Error("empty string");if(typeof n=="number"?(s=n,n=!1):n=!!n,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return n?jn:Pn;if(s=s||10,s<2||36<s)throw RangeError("radix");var t;if((t=e.indexOf("-"))>0)throw Error("interior hyphen");if(t===0)return ms(e.substring(1),n,s).neg();for(var a=Nn(Ii(s,8)),r=Pn,c=0;c<e.length;c+=8){var o=Math.min(8,e.length-c),i=parseInt(e.substring(c,c+o),s);if(o<8){var u=Nn(Ii(s,o));r=r.mul(u).add(Nn(i))}else r=r.mul(a),r=r.add(Nn(i))}return r.unsigned=n,r}Tt.fromString=ms;function zn(e,n){return typeof e=="number"?Nn(e,n):typeof e=="string"?ms(e,n):ct(e.low,e.high,typeof n=="boolean"?n:e.unsigned)}Tt.fromValue=zn;var _u=65536,lp=1<<24,Go=_u*_u,Nu=Go*Go,Au=Nu/2,Ru=_o(lp),Pn=_o(0);Tt.ZERO=Pn;var jn=_o(0,!0);Tt.UZERO=jn;var Ho=_o(1);Tt.ONE=Ho;var Cu=_o(1,!0);Tt.UONE=Cu;var hs=_o(-1);Tt.NEG_ONE=hs;var Iu=ct(-1,2147483647,!1);Tt.MAX_VALUE=Iu;var Bu=ct(-1,-1,!0);Tt.MAX_UNSIGNED_VALUE=Bu;var pn=ct(0,-2147483648,!1);Tt.MIN_VALUE=pn;var ge=Tt.prototype;ge.toInt=function(){return this.unsigned?this.low>>>0:this.low};ge.toNumber=function(){return this.unsigned?(this.high>>>0)*Go+(this.low>>>0):this.high*Go+(this.low>>>0)};ge.toString=function(n){if(n=n||10,n<2||36<n)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(pn)){var s=Nn(n),t=this.div(s),a=t.mul(s).sub(this);return t.toString(n)+a.toInt().toString(n)}else return"-"+this.neg().toString(n);for(var r=Nn(Ii(n,6),this.unsigned),c=this,o="";;){var i=c.div(r),u=c.sub(i.mul(r)).toInt()>>>0,h=u.toString(n);if(c=i,c.isZero())return h+o;for(;h.length<6;)h="0"+h;o=""+h+o}};ge.getHighBits=function(){return this.high};ge.getHighBitsUnsigned=function(){return this.high>>>0};ge.getLowBits=function(){return this.low};ge.getLowBitsUnsigned=function(){return this.low>>>0};ge.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pn)?64:this.neg().getNumBitsAbs();for(var n=this.high!=0?this.high:this.low,s=31;s>0&&!(n&1<<s);s--);return this.high!=0?s+33:s+1};ge.isZero=function(){return this.high===0&&this.low===0};ge.eqz=ge.isZero;ge.isNegative=function(){return!this.unsigned&&this.high<0};ge.isPositive=function(){return this.unsigned||this.high>=0};ge.isOdd=function(){return(this.low&1)===1};ge.isEven=function(){return(this.low&1)===0};ge.equals=function(n){return rn(n)||(n=zn(n)),this.unsigned!==n.unsigned&&this.high>>>31===1&&n.high>>>31===1?!1:this.high===n.high&&this.low===n.low};ge.eq=ge.equals;ge.notEquals=function(n){return!this.eq(n)};ge.neq=ge.notEquals;ge.ne=ge.notEquals;ge.lessThan=function(n){return this.comp(n)<0};ge.lt=ge.lessThan;ge.lessThanOrEqual=function(n){return this.comp(n)<=0};ge.lte=ge.lessThanOrEqual;ge.le=ge.lessThanOrEqual;ge.greaterThan=function(n){return this.comp(n)>0};ge.gt=ge.greaterThan;ge.greaterThanOrEqual=function(n){return this.comp(n)>=0};ge.gte=ge.greaterThanOrEqual;ge.ge=ge.greaterThanOrEqual;ge.compare=function(n){if(rn(n)||(n=zn(n)),this.eq(n))return 0;var s=this.isNegative(),t=n.isNegative();return s&&!t?-1:!s&&t?1:this.unsigned?n.high>>>0>this.high>>>0||n.high===this.high&&n.low>>>0>this.low>>>0?-1:1:this.sub(n).isNegative()?-1:1};ge.comp=ge.compare;ge.negate=function(){return!this.unsigned&&this.eq(pn)?pn:this.not().add(Ho)};ge.neg=ge.negate;ge.add=function(n){rn(n)||(n=zn(n));var s=this.high>>>16,t=this.high&65535,a=this.low>>>16,r=this.low&65535,c=n.high>>>16,o=n.high&65535,i=n.low>>>16,u=n.low&65535,h=0,m=0,f=0,y=0;return y+=r+u,f+=y>>>16,y&=65535,f+=a+i,m+=f>>>16,f&=65535,m+=t+o,h+=m>>>16,m&=65535,h+=s+c,h&=65535,ct(f<<16|y,h<<16|m,this.unsigned)};ge.subtract=function(n){return rn(n)||(n=zn(n)),this.add(n.neg())};ge.sub=ge.subtract;ge.multiply=function(n){if(this.isZero())return this;if(rn(n)||(n=zn(n)),Rn){var s=Rn.mul(this.low,this.high,n.low,n.high);return ct(s,Rn.get_high(),this.unsigned)}if(n.isZero())return this.unsigned?jn:Pn;if(this.eq(pn))return n.isOdd()?pn:Pn;if(n.eq(pn))return this.isOdd()?pn:Pn;if(this.isNegative())return n.isNegative()?this.neg().mul(n.neg()):this.neg().mul(n).neg();if(n.isNegative())return this.mul(n.neg()).neg();if(this.lt(Ru)&&n.lt(Ru))return Nn(this.toNumber()*n.toNumber(),this.unsigned);var t=this.high>>>16,a=this.high&65535,r=this.low>>>16,c=this.low&65535,o=n.high>>>16,i=n.high&65535,u=n.low>>>16,h=n.low&65535,m=0,f=0,y=0,l=0;return l+=c*h,y+=l>>>16,l&=65535,y+=r*h,f+=y>>>16,y&=65535,y+=c*u,f+=y>>>16,y&=65535,f+=a*h,m+=f>>>16,f&=65535,f+=r*u,m+=f>>>16,f&=65535,f+=c*i,m+=f>>>16,f&=65535,m+=t*h+a*u+r*i+c*o,m&=65535,ct(y<<16|l,m<<16|f,this.unsigned)};ge.mul=ge.multiply;ge.divide=function(n){if(rn(n)||(n=zn(n)),n.isZero())throw Error("division by zero");if(Rn){if(!this.unsigned&&this.high===-2147483648&&n.low===-1&&n.high===-1)return this;var s=(this.unsigned?Rn.div_u:Rn.div_s)(this.low,this.high,n.low,n.high);return ct(s,Rn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?jn:Pn;var t,a,r;if(this.unsigned){if(n.unsigned||(n=n.toUnsigned()),n.gt(this))return jn;if(n.gt(this.shru(1)))return Cu;r=jn}else{if(this.eq(pn)){if(n.eq(Ho)||n.eq(hs))return pn;if(n.eq(pn))return Ho;var c=this.shr(1);return t=c.div(n).shl(1),t.eq(Pn)?n.isNegative()?Ho:hs:(a=this.sub(n.mul(t)),r=t.add(a.div(n)),r)}else if(n.eq(pn))return this.unsigned?jn:Pn;if(this.isNegative())return n.isNegative()?this.neg().div(n.neg()):this.neg().div(n).neg();if(n.isNegative())return this.div(n.neg()).neg();r=Pn}for(a=this;a.gte(n);){t=Math.max(1,Math.floor(a.toNumber()/n.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),i=o<=48?1:Ii(2,o-48),u=Nn(t),h=u.mul(n);h.isNegative()||h.gt(a);)t-=i,u=Nn(t,this.unsigned),h=u.mul(n);u.isZero()&&(u=Ho),r=r.add(u),a=a.sub(h)}return r};ge.div=ge.divide;ge.modulo=function(n){if(rn(n)||(n=zn(n)),Rn){var s=(this.unsigned?Rn.rem_u:Rn.rem_s)(this.low,this.high,n.low,n.high);return ct(s,Rn.get_high(),this.unsigned)}return this.sub(this.div(n).mul(n))};ge.mod=ge.modulo;ge.rem=ge.modulo;ge.not=function(){return ct(~this.low,~this.high,this.unsigned)};ge.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};ge.clz=ge.countLeadingZeros;ge.countTrailingZeros=function(){return this.low?Tu(this.low):Tu(this.high)+32};ge.ctz=ge.countTrailingZeros;ge.and=function(n){return rn(n)||(n=zn(n)),ct(this.low&n.low,this.high&n.high,this.unsigned)};ge.or=function(n){return rn(n)||(n=zn(n)),ct(this.low|n.low,this.high|n.high,this.unsigned)};ge.xor=function(n){return rn(n)||(n=zn(n)),ct(this.low^n.low,this.high^n.high,this.unsigned)};ge.shiftLeft=function(n){return rn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?ct(this.low<<n,this.high<<n|this.low>>>32-n,this.unsigned):ct(0,this.low<<n-32,this.unsigned)};ge.shl=ge.shiftLeft;ge.shiftRight=function(n){return rn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?ct(this.low>>>n|this.high<<32-n,this.high>>n,this.unsigned):ct(this.high>>n-32,this.high>=0?0:-1,this.unsigned)};ge.shr=ge.shiftRight;ge.shiftRightUnsigned=function(n){return rn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?ct(this.low>>>n|this.high<<32-n,this.high>>>n,this.unsigned):n===32?ct(this.high,0,this.unsigned):ct(this.high>>>n-32,0,this.unsigned)};ge.shru=ge.shiftRightUnsigned;ge.shr_u=ge.shiftRightUnsigned;ge.rotateLeft=function(n){var s;return rn(n)&&(n=n.toInt()),(n&=63)===0?this:n===32?ct(this.high,this.low,this.unsigned):n<32?(s=32-n,ct(this.low<<n|this.high>>>s,this.high<<n|this.low>>>s,this.unsigned)):(n-=32,s=32-n,ct(this.high<<n|this.low>>>s,this.low<<n|this.high>>>s,this.unsigned))};ge.rotl=ge.rotateLeft;ge.rotateRight=function(n){var s;return rn(n)&&(n=n.toInt()),(n&=63)===0?this:n===32?ct(this.high,this.low,this.unsigned):n<32?(s=32-n,ct(this.high<<s|this.low>>>n,this.low<<s|this.high>>>n,this.unsigned)):(n-=32,s=32-n,ct(this.low<<s|this.high>>>n,this.high<<s|this.low>>>n,this.unsigned))};ge.rotr=ge.rotateRight;ge.toSigned=function(){return this.unsigned?ct(this.low,this.high,!1):this};ge.toUnsigned=function(){return this.unsigned?this:ct(this.low,this.high,!0)};ge.toBytes=function(n){return n?this.toBytesLE():this.toBytesBE()};ge.toBytesLE=function(){var n=this.high,s=this.low;return[s&255,s>>>8&255,s>>>16&255,s>>>24,n&255,n>>>8&255,n>>>16&255,n>>>24]};ge.toBytesBE=function(){var n=this.high,s=this.low;return[n>>>24,n>>>16&255,n>>>8&255,n&255,s>>>24,s>>>16&255,s>>>8&255,s&255]};Tt.fromBytes=function(n,s,t){return t?Tt.fromBytesLE(n,s):Tt.fromBytesBE(n,s)};Tt.fromBytesLE=function(n,s){return new Tt(n[0]|n[1]<<8|n[2]<<16|n[3]<<24,n[4]|n[5]<<8|n[6]<<16|n[7]<<24,s)};Tt.fromBytesBE=function(n,s){return new Tt(n[4]<<24|n[5]<<16|n[6]<<8|n[7],n[0]<<24|n[1]<<16|n[2]<<8|n[3],s)};var ys=Tt;var Ro=Ze(Je());var Ao=Ze(Je());function dp(){return{r:0,g:0,b:0}}var Ft;(function(e){function n(t,a=Ao.default.Writer.create()){return t.r!==0&&a.uint32(13).float(t.r),t.g!==0&&a.uint32(21).float(t.g),t.b!==0&&a.uint32(29).float(t.b),a}e.encode=n;function s(t,a){let r=t instanceof Ao.default.Reader?t:Ao.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=dp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.r=r.float();continue;case 2:if(i!==21)break;o.g=r.float();continue;case 3:if(i!==29)break;o.b=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ft||(Ft={}));function pp(){return{r:0,g:0,b:0,a:0}}var Ot;(function(e){function n(t,a=Ao.default.Writer.create()){return t.r!==0&&a.uint32(13).float(t.r),t.g!==0&&a.uint32(21).float(t.g),t.b!==0&&a.uint32(29).float(t.b),t.a!==0&&a.uint32(37).float(t.a),a}e.encode=n;function s(t,a){let r=t instanceof Ao.default.Reader?t:Ao.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=pp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.r=r.float();continue;case 2:if(i!==21)break;o.g=r.float();continue;case 3:if(i!==29)break;o.b=r.float();continue;case 4:if(i!==37)break;o.a=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ot||(Ot={}));function hp(){return{id:"",name:void 0,bodyShape:void 0,skinColor:void 0,hairColor:void 0,eyeColor:void 0,expressionTriggerId:void 0,expressionTriggerTimestamp:void 0,talking:void 0,wearables:[],emotes:[]}}var Yo;(function(e){function n(t,a=Ro.default.Writer.create()){t.id!==""&&a.uint32(10).string(t.id),t.name!==void 0&&a.uint32(18).string(t.name),t.bodyShape!==void 0&&a.uint32(26).string(t.bodyShape),t.skinColor!==void 0&&Ft.encode(t.skinColor,a.uint32(34).fork()).ldelim(),t.hairColor!==void 0&&Ft.encode(t.hairColor,a.uint32(42).fork()).ldelim(),t.eyeColor!==void 0&&Ft.encode(t.eyeColor,a.uint32(50).fork()).ldelim(),t.expressionTriggerId!==void 0&&a.uint32(58).string(t.expressionTriggerId),t.expressionTriggerTimestamp!==void 0&&a.uint32(64).int64(t.expressionTriggerTimestamp),t.talking!==void 0&&a.uint32(72).bool(t.talking);for(let r of t.wearables)a.uint32(82).string(r);for(let r of t.emotes)a.uint32(90).string(r);return a}e.encode=n;function s(t,a){let r=t instanceof Ro.default.Reader?t:Ro.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=hp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.id=r.string();continue;case 2:if(i!==18)break;o.name=r.string();continue;case 3:if(i!==26)break;o.bodyShape=r.string();continue;case 4:if(i!==34)break;o.skinColor=Ft.decode(r,r.uint32());continue;case 5:if(i!==42)break;o.hairColor=Ft.decode(r,r.uint32());continue;case 6:if(i!==50)break;o.eyeColor=Ft.decode(r,r.uint32());continue;case 7:if(i!==58)break;o.expressionTriggerId=r.string();continue;case 8:if(i!==64)break;o.expressionTriggerTimestamp=yp(r.int64());continue;case 9:if(i!==72)break;o.talking=r.bool();continue;case 10:if(i!==82)break;o.wearables.push(r.string());continue;case 11:if(i!==90)break;o.emotes.push(r.string());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Yo||(Yo={}));var mp=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global;throw"Unable to locate global object"})();function yp(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new mp.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}Ro.default.util.Long!==ys&&(Ro.default.util.Long=ys,Ro.default.configure());var Ou={COMPONENT_ID:1080,serialize(e,n){let s=Yo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Yo.decode(e.buffer(),e.remainingBytes())},create(){return Yo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBAvatarShape"}};var Bi=Ze(Je());var ku;(function(e){e[e.BM_NONE=0]="BM_NONE",e[e.BM_X=1]="BM_X",e[e.BM_Y=2]="BM_Y",e[e.BM_Z=4]="BM_Z",e[e.BM_ALL=7]="BM_ALL"})(ku||(ku={}));function vp(){return{billboardMode:void 0}}var jo;(function(e){function n(t,a=Bi.default.Writer.create()){return t.billboardMode!==void 0&&a.uint32(8).int32(t.billboardMode),a}e.encode=n;function s(t,a){let r=t instanceof Bi.default.Reader?t:Bi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=vp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.billboardMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(jo||(jo={}));var Mu={COMPONENT_ID:1090,serialize(e,n){let s=jo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return jo.decode(e.buffer(),e.remainingBytes())},create(){return jo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBBillboard"}};var Oi=Ze(Je());function xp(){return{mode:0}}var $o;(function(e){function n(t,a=Oi.default.Writer.create()){return t.mode!==0&&a.uint32(8).int32(t.mode),a}e.encode=n;function s(t,a){let r=t instanceof Oi.default.Reader?t:Oi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=xp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.mode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})($o||($o={}));var Pu={COMPONENT_ID:1072,serialize(e,n){let s=$o.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return $o.decode(e.buffer(),e.remainingBytes())},create(){return $o.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBCameraMode"}};var ki=Ze(Je());function Ep(){return{area:void 0,mode:0}}var Xo;(function(e){function n(t,a=ki.default.Writer.create()){return t.area!==void 0&&nt.encode(t.area,a.uint32(10).fork()).ldelim(),t.mode!==0&&a.uint32(16).int32(t.mode),a}e.encode=n;function s(t,a){let r=t instanceof ki.default.Reader?t:ki.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ep();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.area=nt.decode(r,r.uint32());continue;case 2:if(i!==16)break;o.mode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Xo||(Xo={}));var zu={COMPONENT_ID:1071,serialize(e,n){let s=Xo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Xo.decode(e.buffer(),e.remainingBytes())},create(){return Xo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBCameraModeArea"}};var Mi=Ze(Je());function bp(){return{frameNumber:0,totalRuntime:0,tickNumber:0}}var Zo;(function(e){function n(t,a=Mi.default.Writer.create()){return t.frameNumber!==0&&a.uint32(8).uint32(t.frameNumber),t.totalRuntime!==0&&a.uint32(21).float(t.totalRuntime),t.tickNumber!==0&&a.uint32(24).uint32(t.tickNumber),a}e.encode=n;function s(t,a){let r=t instanceof Mi.default.Reader?t:Mi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=bp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.frameNumber=r.uint32();continue;case 2:if(i!==21)break;o.totalRuntime=r.float();continue;case 3:if(i!==24)break;o.tickNumber=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Zo||(Zo={}));var Fu={COMPONENT_ID:1048,serialize(e,n){let s=Zo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Zo.decode(e.buffer(),e.remainingBytes())},create(){return Zo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBEngineInfo"}};var Pi=Ze(Je());function gp(){return{src:"",visibleMeshesCollisionMask:void 0,invisibleMeshesCollisionMask:void 0}}var Qo;(function(e){function n(t,a=Pi.default.Writer.create()){return t.src!==""&&a.uint32(10).string(t.src),t.visibleMeshesCollisionMask!==void 0&&a.uint32(32).uint32(t.visibleMeshesCollisionMask),t.invisibleMeshesCollisionMask!==void 0&&a.uint32(40).uint32(t.invisibleMeshesCollisionMask),a}e.encode=n;function s(t,a){let r=t instanceof Pi.default.Reader?t:Pi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=gp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.src=r.string();continue;case 4:if(i!==32)break;o.visibleMeshesCollisionMask=r.uint32();continue;case 5:if(i!==40)break;o.invisibleMeshesCollisionMask=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Qo||(Qo={}));var Lu={COMPONENT_ID:1041,serialize(e,n){let s=Qo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Qo.decode(e.buffer(),e.remainingBytes())},create(){return Qo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBGltfContainer"}};var zi=Ze(Je());function Tp(){return{currentState:0}}var Jo;(function(e){function n(t,a=zi.default.Writer.create()){return t.currentState!==0&&a.uint32(8).int32(t.currentState),a}e.encode=n;function s(t,a){let r=t instanceof zi.default.Reader?t:zi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Tp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.currentState=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Jo||(Jo={}));var Uu={COMPONENT_ID:1049,serialize(e,n){let s=Jo.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Jo.decode(e.buffer(),e.remainingBytes())},create(){return Jo.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBGltfContainerLoadingState"}};var qn=Ze(Je());var gn=Ze(Je());var Du;(function(e){e[e.TWM_REPEAT=0]="TWM_REPEAT",e[e.TWM_CLAMP=1]="TWM_CLAMP",e[e.TWM_MIRROR=2]="TWM_MIRROR"})(Du||(Du={}));var Vu;(function(e){e[e.TFM_POINT=0]="TFM_POINT",e[e.TFM_BILINEAR=1]="TFM_BILINEAR",e[e.TFM_TRILINEAR=2]="TFM_TRILINEAR"})(Vu||(Vu={}));function wp(){return{src:"",wrapMode:void 0,filterMode:void 0}}var Fi;(function(e){function n(t,a=gn.default.Writer.create()){return t.src!==""&&a.uint32(10).string(t.src),t.wrapMode!==void 0&&a.uint32(16).int32(t.wrapMode),t.filterMode!==void 0&&a.uint32(24).int32(t.filterMode),a}e.encode=n;function s(t,a){let r=t instanceof gn.default.Reader?t:gn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=wp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.src=r.string();continue;case 2:if(i!==16)break;o.wrapMode=r.int32();continue;case 3:if(i!==24)break;o.filterMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Fi||(Fi={}));function Sp(){return{userId:"",wrapMode:void 0,filterMode:void 0}}var Li;(function(e){function n(t,a=gn.default.Writer.create()){return t.userId!==""&&a.uint32(10).string(t.userId),t.wrapMode!==void 0&&a.uint32(16).int32(t.wrapMode),t.filterMode!==void 0&&a.uint32(24).int32(t.filterMode),a}e.encode=n;function s(t,a){let r=t instanceof gn.default.Reader?t:gn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Sp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.userId=r.string();continue;case 2:if(i!==16)break;o.wrapMode=r.int32();continue;case 3:if(i!==24)break;o.filterMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Li||(Li={}));function _p(){return{videoPlayerEntity:0,wrapMode:void 0,filterMode:void 0}}var Ui;(function(e){function n(t,a=gn.default.Writer.create()){return t.videoPlayerEntity!==0&&a.uint32(8).uint32(t.videoPlayerEntity),t.wrapMode!==void 0&&a.uint32(16).int32(t.wrapMode),t.filterMode!==void 0&&a.uint32(24).int32(t.filterMode),a}e.encode=n;function s(t,a){let r=t instanceof gn.default.Reader?t:gn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=_p();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.videoPlayerEntity=r.uint32();continue;case 2:if(i!==16)break;o.wrapMode=r.int32();continue;case 3:if(i!==24)break;o.filterMode=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ui||(Ui={}));function Ap(){return{tex:void 0}}var an;(function(e){function n(t,a=gn.default.Writer.create()){switch(t.tex?.$case){case"texture":Fi.encode(t.tex.texture,a.uint32(10).fork()).ldelim();break;case"avatarTexture":Li.encode(t.tex.avatarTexture,a.uint32(18).fork()).ldelim();break;case"videoTexture":Ui.encode(t.tex.videoTexture,a.uint32(26).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof gn.default.Reader?t:gn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ap();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.tex={$case:"texture",texture:Fi.decode(r,r.uint32())};continue;case 2:if(i!==18)break;o.tex={$case:"avatarTexture",avatarTexture:Li.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.tex={$case:"videoTexture",videoTexture:Ui.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(an||(an={}));var Wu;(function(e){e[e.MTM_OPAQUE=0]="MTM_OPAQUE",e[e.MTM_ALPHA_TEST=1]="MTM_ALPHA_TEST",e[e.MTM_ALPHA_BLEND=2]="MTM_ALPHA_BLEND",e[e.MTM_ALPHA_TEST_AND_ALPHA_BLEND=3]="MTM_ALPHA_TEST_AND_ALPHA_BLEND",e[e.MTM_AUTO=4]="MTM_AUTO"})(Wu||(Wu={}));function Rp(){return{material:void 0}}var Ko;(function(e){function n(t,a=qn.default.Writer.create()){switch(t.material?.$case){case"unlit":Di.encode(t.material.unlit,a.uint32(10).fork()).ldelim();break;case"pbr":Vi.encode(t.material.pbr,a.uint32(18).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof qn.default.Reader?t:qn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Rp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.material={$case:"unlit",unlit:Di.decode(r,r.uint32())};continue;case 2:if(i!==18)break;o.material={$case:"pbr",pbr:Vi.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ko||(Ko={}));function Np(){return{texture:void 0,alphaTest:void 0,castShadows:void 0,diffuseColor:void 0}}var Di;(function(e){function n(t,a=qn.default.Writer.create()){return t.texture!==void 0&&an.encode(t.texture,a.uint32(10).fork()).ldelim(),t.alphaTest!==void 0&&a.uint32(21).float(t.alphaTest),t.castShadows!==void 0&&a.uint32(24).bool(t.castShadows),t.diffuseColor!==void 0&&Ot.encode(t.diffuseColor,a.uint32(34).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof qn.default.Reader?t:qn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Np();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.texture=an.decode(r,r.uint32());continue;case 2:if(i!==21)break;o.alphaTest=r.float();continue;case 3:if(i!==24)break;o.castShadows=r.bool();continue;case 4:if(i!==34)break;o.diffuseColor=Ot.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Di||(Di={}));function Cp(){return{texture:void 0,alphaTest:void 0,castShadows:void 0,alphaTexture:void 0,emissiveTexture:void 0,bumpTexture:void 0,albedoColor:void 0,emissiveColor:void 0,reflectivityColor:void 0,transparencyMode:void 0,metallic:void 0,roughness:void 0,specularIntensity:void 0,emissiveIntensity:void 0,directIntensity:void 0}}var Vi;(function(e){function n(t,a=qn.default.Writer.create()){return t.texture!==void 0&&an.encode(t.texture,a.uint32(10).fork()).ldelim(),t.alphaTest!==void 0&&a.uint32(21).float(t.alphaTest),t.castShadows!==void 0&&a.uint32(24).bool(t.castShadows),t.alphaTexture!==void 0&&an.encode(t.alphaTexture,a.uint32(34).fork()).ldelim(),t.emissiveTexture!==void 0&&an.encode(t.emissiveTexture,a.uint32(42).fork()).ldelim(),t.bumpTexture!==void 0&&an.encode(t.bumpTexture,a.uint32(50).fork()).ldelim(),t.albedoColor!==void 0&&Ot.encode(t.albedoColor,a.uint32(58).fork()).ldelim(),t.emissiveColor!==void 0&&Ft.encode(t.emissiveColor,a.uint32(66).fork()).ldelim(),t.reflectivityColor!==void 0&&Ft.encode(t.reflectivityColor,a.uint32(74).fork()).ldelim(),t.transparencyMode!==void 0&&a.uint32(80).int32(t.transparencyMode),t.metallic!==void 0&&a.uint32(93).float(t.metallic),t.roughness!==void 0&&a.uint32(101).float(t.roughness),t.specularIntensity!==void 0&&a.uint32(117).float(t.specularIntensity),t.emissiveIntensity!==void 0&&a.uint32(125).float(t.emissiveIntensity),t.directIntensity!==void 0&&a.uint32(133).float(t.directIntensity),a}e.encode=n;function s(t,a){let r=t instanceof qn.default.Reader?t:qn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Cp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.texture=an.decode(r,r.uint32());continue;case 2:if(i!==21)break;o.alphaTest=r.float();continue;case 3:if(i!==24)break;o.castShadows=r.bool();continue;case 4:if(i!==34)break;o.alphaTexture=an.decode(r,r.uint32());continue;case 5:if(i!==42)break;o.emissiveTexture=an.decode(r,r.uint32());continue;case 6:if(i!==50)break;o.bumpTexture=an.decode(r,r.uint32());continue;case 7:if(i!==58)break;o.albedoColor=Ot.decode(r,r.uint32());continue;case 8:if(i!==66)break;o.emissiveColor=Ft.decode(r,r.uint32());continue;case 9:if(i!==74)break;o.reflectivityColor=Ft.decode(r,r.uint32());continue;case 10:if(i!==80)break;o.transparencyMode=r.int32();continue;case 11:if(i!==93)break;o.metallic=r.float();continue;case 12:if(i!==101)break;o.roughness=r.float();continue;case 14:if(i!==117)break;o.specularIntensity=r.float();continue;case 15:if(i!==125)break;o.emissiveIntensity=r.float();continue;case 16:if(i!==133)break;o.directIntensity=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Vi||(Vi={}));var qu={COMPONENT_ID:1017,serialize(e,n){let s=Ko.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Ko.decode(e.buffer(),e.remainingBytes())},create(){return Ko.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMaterial"}};var sn=Ze(Je());var Hu;(function(e){e[e.CL_NONE=0]="CL_NONE",e[e.CL_POINTER=1]="CL_POINTER",e[e.CL_PHYSICS=2]="CL_PHYSICS",e[e.CL_RESERVED1=4]="CL_RESERVED1",e[e.CL_RESERVED2=8]="CL_RESERVED2",e[e.CL_RESERVED3=16]="CL_RESERVED3",e[e.CL_RESERVED4=32]="CL_RESERVED4",e[e.CL_RESERVED5=64]="CL_RESERVED5",e[e.CL_RESERVED6=128]="CL_RESERVED6",e[e.CL_CUSTOM1=256]="CL_CUSTOM1",e[e.CL_CUSTOM2=512]="CL_CUSTOM2",e[e.CL_CUSTOM3=1024]="CL_CUSTOM3",e[e.CL_CUSTOM4=2048]="CL_CUSTOM4",e[e.CL_CUSTOM5=4096]="CL_CUSTOM5",e[e.CL_CUSTOM6=8192]="CL_CUSTOM6",e[e.CL_CUSTOM7=16384]="CL_CUSTOM7",e[e.CL_CUSTOM8=32768]="CL_CUSTOM8"})(Hu||(Hu={}));function Ip(){return{collisionMask:void 0,mesh:void 0}}var er;(function(e){function n(t,a=sn.default.Writer.create()){switch(t.collisionMask!==void 0&&a.uint32(8).uint32(t.collisionMask),t.mesh?.$case){case"box":Wi.encode(t.mesh.box,a.uint32(18).fork()).ldelim();break;case"sphere":Gi.encode(t.mesh.sphere,a.uint32(26).fork()).ldelim();break;case"cylinder":qi.encode(t.mesh.cylinder,a.uint32(34).fork()).ldelim();break;case"plane":Hi.encode(t.mesh.plane,a.uint32(42).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof sn.default.Reader?t:sn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Ip();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.collisionMask=r.uint32();continue;case 2:if(i!==18)break;o.mesh={$case:"box",box:Wi.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.mesh={$case:"sphere",sphere:Gi.decode(r,r.uint32())};continue;case 4:if(i!==34)break;o.mesh={$case:"cylinder",cylinder:qi.decode(r,r.uint32())};continue;case 5:if(i!==42)break;o.mesh={$case:"plane",plane:Hi.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(er||(er={}));function Bp(){return{}}var Wi;(function(e){function n(t,a=sn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof sn.default.Reader?t:sn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Bp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Wi||(Wi={}));function Op(){return{radiusTop:void 0,radiusBottom:void 0}}var qi;(function(e){function n(t,a=sn.default.Writer.create()){return t.radiusTop!==void 0&&a.uint32(13).float(t.radiusTop),t.radiusBottom!==void 0&&a.uint32(21).float(t.radiusBottom),a}e.encode=n;function s(t,a){let r=t instanceof sn.default.Reader?t:sn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Op();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.radiusTop=r.float();continue;case 2:if(i!==21)break;o.radiusBottom=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(qi||(qi={}));function kp(){return{}}var Hi;(function(e){function n(t,a=sn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof sn.default.Reader?t:sn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=kp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Hi||(Hi={}));function Mp(){return{}}var Gi;(function(e){function n(t,a=sn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof sn.default.Reader?t:sn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Mp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Gi||(Gi={}));var Gu={COMPONENT_ID:1019,serialize(e,n){let s=er.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return er.decode(e.buffer(),e.remainingBytes())},create(){return er.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMeshCollider"}};var cn=Ze(Je());function Pp(){return{mesh:void 0}}var tr;(function(e){function n(t,a=cn.default.Writer.create()){switch(t.mesh?.$case){case"box":Yi.encode(t.mesh.box,a.uint32(10).fork()).ldelim();break;case"sphere":Xi.encode(t.mesh.sphere,a.uint32(18).fork()).ldelim();break;case"cylinder":ji.encode(t.mesh.cylinder,a.uint32(26).fork()).ldelim();break;case"plane":$i.encode(t.mesh.plane,a.uint32(34).fork()).ldelim();break}return a}e.encode=n;function s(t,a){let r=t instanceof cn.default.Reader?t:cn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Pp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.mesh={$case:"box",box:Yi.decode(r,r.uint32())};continue;case 2:if(i!==18)break;o.mesh={$case:"sphere",sphere:Xi.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.mesh={$case:"cylinder",cylinder:ji.decode(r,r.uint32())};continue;case 4:if(i!==34)break;o.mesh={$case:"plane",plane:$i.decode(r,r.uint32())};continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(tr||(tr={}));function zp(){return{uvs:[]}}var Yi;(function(e){function n(t,a=cn.default.Writer.create()){a.uint32(10).fork();for(let r of t.uvs)a.float(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof cn.default.Reader?t:cn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=zp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i===13){o.uvs.push(r.float());continue}if(i===10){let u=r.uint32()+r.pos;for(;r.pos<u;)o.uvs.push(r.float());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Yi||(Yi={}));function Fp(){return{radiusTop:void 0,radiusBottom:void 0}}var ji;(function(e){function n(t,a=cn.default.Writer.create()){return t.radiusTop!==void 0&&a.uint32(13).float(t.radiusTop),t.radiusBottom!==void 0&&a.uint32(21).float(t.radiusBottom),a}e.encode=n;function s(t,a){let r=t instanceof cn.default.Reader?t:cn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Fp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.radiusTop=r.float();continue;case 2:if(i!==21)break;o.radiusBottom=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ji||(ji={}));function Lp(){return{uvs:[]}}var $i;(function(e){function n(t,a=cn.default.Writer.create()){a.uint32(10).fork();for(let r of t.uvs)a.float(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof cn.default.Reader?t:cn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Lp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i===13){o.uvs.push(r.float());continue}if(i===10){let u=r.uint32()+r.pos;for(;r.pos<u;)o.uvs.push(r.float());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})($i||($i={}));function Up(){return{}}var Xi;(function(e){function n(t,a=cn.default.Writer.create()){return a}e.encode=n;function s(t,a){let r=t instanceof cn.default.Reader?t:cn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Up();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Xi||(Xi={}));var Yu={COMPONENT_ID:1018,serialize(e,n){let s=tr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return tr.decode(e.buffer(),e.remainingBytes())},create(){return tr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMeshRenderer"}};var Zi=Ze(Je());var ju;(function(e){e[e.NFT_CLASSIC=0]="NFT_CLASSIC",e[e.NFT_BAROQUE_ORNAMENT=1]="NFT_BAROQUE_ORNAMENT",e[e.NFT_DIAMOND_ORNAMENT=2]="NFT_DIAMOND_ORNAMENT",e[e.NFT_MINIMAL_WIDE=3]="NFT_MINIMAL_WIDE",e[e.NFT_MINIMAL_GREY=4]="NFT_MINIMAL_GREY",e[e.NFT_BLOCKY=5]="NFT_BLOCKY",e[e.NFT_GOLD_EDGES=6]="NFT_GOLD_EDGES",e[e.NFT_GOLD_CARVED=7]="NFT_GOLD_CARVED",e[e.NFT_GOLD_WIDE=8]="NFT_GOLD_WIDE",e[e.NFT_GOLD_ROUNDED=9]="NFT_GOLD_ROUNDED",e[e.NFT_METAL_MEDIUM=10]="NFT_METAL_MEDIUM",e[e.NFT_METAL_WIDE=11]="NFT_METAL_WIDE",e[e.NFT_METAL_SLIM=12]="NFT_METAL_SLIM",e[e.NFT_METAL_ROUNDED=13]="NFT_METAL_ROUNDED",e[e.NFT_PINS=14]="NFT_PINS",e[e.NFT_MINIMAL_BLACK=15]="NFT_MINIMAL_BLACK",e[e.NFT_MINIMAL_WHITE=16]="NFT_MINIMAL_WHITE",e[e.NFT_TAPE=17]="NFT_TAPE",e[e.NFT_WOOD_SLIM=18]="NFT_WOOD_SLIM",e[e.NFT_WOOD_WIDE=19]="NFT_WOOD_WIDE",e[e.NFT_WOOD_TWIGS=20]="NFT_WOOD_TWIGS",e[e.NFT_CANVAS=21]="NFT_CANVAS",e[e.NFT_NONE=22]="NFT_NONE"})(ju||(ju={}));function Dp(){return{urn:"",style:void 0,color:void 0}}var nr;(function(e){function n(t,a=Zi.default.Writer.create()){return t.urn!==""&&a.uint32(10).string(t.urn),t.style!==void 0&&a.uint32(16).int32(t.style),t.color!==void 0&&Ft.encode(t.color,a.uint32(26).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Zi.default.Reader?t:Zi.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Dp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.urn=r.string();continue;case 2:if(i!==16)break;o.style=r.int32();continue;case 3:if(i!==26)break;o.color=Ft.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(nr||(nr={}));var $u={COMPONENT_ID:1040,serialize(e,n){let s=nr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return nr.decode(e.buffer(),e.remainingBytes())},create(){return nr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBNftShape"}};var Hn=Ze(Je());function Vp(){return{pointerEvents:[]}}var or;(function(e){function n(t,a=Hn.default.Writer.create()){for(let r of t.pointerEvents)Ji.encode(r,a.uint32(10).fork()).ldelim();return a}e.encode=n;function s(t,a){let r=t instanceof Hn.default.Reader?t:Hn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Vp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.pointerEvents.push(Ji.decode(r,r.uint32()));continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(or||(or={}));function Wp(){return{button:void 0,hoverText:void 0,maxDistance:void 0,showFeedback:void 0}}var Qi;(function(e){function n(t,a=Hn.default.Writer.create()){return t.button!==void 0&&a.uint32(8).int32(t.button),t.hoverText!==void 0&&a.uint32(18).string(t.hoverText),t.maxDistance!==void 0&&a.uint32(29).float(t.maxDistance),t.showFeedback!==void 0&&a.uint32(32).bool(t.showFeedback),a}e.encode=n;function s(t,a){let r=t instanceof Hn.default.Reader?t:Hn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Wp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.button=r.int32();continue;case 2:if(i!==18)break;o.hoverText=r.string();continue;case 3:if(i!==29)break;o.maxDistance=r.float();continue;case 4:if(i!==32)break;o.showFeedback=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Qi||(Qi={}));function qp(){return{eventType:0,eventInfo:void 0}}var Ji;(function(e){function n(t,a=Hn.default.Writer.create()){return t.eventType!==0&&a.uint32(8).int32(t.eventType),t.eventInfo!==void 0&&Qi.encode(t.eventInfo,a.uint32(18).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Hn.default.Reader?t:Hn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=qp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.eventType=r.int32();continue;case 2:if(i!==18)break;o.eventInfo=Qi.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Ji||(Ji={}));var Xu={COMPONENT_ID:1062,serialize(e,n){let s=or.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return or.decode(e.buffer(),e.remainingBytes())},create(){return or.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBPointerEvents"}};var ea=Ze(Je());var Ki=Ze(Je());function Hp(){return{position:void 0,globalOrigin:void 0,direction:void 0,normalHit:void 0,length:0,meshName:void 0,entityId:void 0}}var so;(function(e){function n(t,a=Ki.default.Writer.create()){return t.position!==void 0&&nt.encode(t.position,a.uint32(10).fork()).ldelim(),t.globalOrigin!==void 0&&nt.encode(t.globalOrigin,a.uint32(18).fork()).ldelim(),t.direction!==void 0&&nt.encode(t.direction,a.uint32(26).fork()).ldelim(),t.normalHit!==void 0&&nt.encode(t.normalHit,a.uint32(34).fork()).ldelim(),t.length!==0&&a.uint32(45).float(t.length),t.meshName!==void 0&&a.uint32(50).string(t.meshName),t.entityId!==void 0&&a.uint32(56).uint32(t.entityId),a}e.encode=n;function s(t,a){let r=t instanceof Ki.default.Reader?t:Ki.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Hp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.position=nt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.globalOrigin=nt.decode(r,r.uint32());continue;case 3:if(i!==26)break;o.direction=nt.decode(r,r.uint32());continue;case 4:if(i!==34)break;o.normalHit=nt.decode(r,r.uint32());continue;case 5:if(i!==45)break;o.length=r.float();continue;case 6:if(i!==50)break;o.meshName=r.string();continue;case 7:if(i!==56)break;o.entityId=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(so||(so={}));function Gp(){return{button:0,hit:void 0,state:0,timestamp:0,analog:void 0,tickNumber:0}}var rr;(function(e){function n(t,a=ea.default.Writer.create()){return t.button!==0&&a.uint32(8).int32(t.button),t.hit!==void 0&&so.encode(t.hit,a.uint32(18).fork()).ldelim(),t.state!==0&&a.uint32(32).int32(t.state),t.timestamp!==0&&a.uint32(40).uint32(t.timestamp),t.analog!==void 0&&a.uint32(53).float(t.analog),t.tickNumber!==0&&a.uint32(56).uint32(t.tickNumber),a}e.encode=n;function s(t,a){let r=t instanceof ea.default.Reader?t:ea.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Gp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.button=r.int32();continue;case 2:if(i!==18)break;o.hit=so.decode(r,r.uint32());continue;case 4:if(i!==32)break;o.state=r.int32();continue;case 5:if(i!==40)break;o.timestamp=r.uint32();continue;case 6:if(i!==53)break;o.analog=r.float();continue;case 7:if(i!==56)break;o.tickNumber=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(rr||(rr={}));var Zu={COMPONENT_ID:1063,serialize(e,n){let s=rr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return rr.decode(e.buffer(),e.remainingBytes())},create(){return rr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBPointerEventsResult"}};var ta=Ze(Je());function Yp(){return{isPointerLocked:!1}}var ir;(function(e){function n(t,a=ta.default.Writer.create()){return t.isPointerLocked===!0&&a.uint32(8).bool(t.isPointerLocked),a}e.encode=n;function s(t,a){let r=t instanceof ta.default.Reader?t:ta.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Yp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.isPointerLocked=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ir||(ir={}));var Qu={COMPONENT_ID:1074,serialize(e,n){let s=ir.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return ir.decode(e.buffer(),e.remainingBytes())},create(){return ir.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBPointerLock"}};var na=Ze(Je());var Ju;(function(e){e[e.RQT_HIT_FIRST=0]="RQT_HIT_FIRST",e[e.RQT_QUERY_ALL=1]="RQT_QUERY_ALL",e[e.RQT_NONE=2]="RQT_NONE"})(Ju||(Ju={}));function jp(){return{timestamp:void 0,originOffset:void 0,direction:void 0,maxDistance:0,queryType:0,continuous:void 0,collisionMask:void 0}}var ar;(function(e){function n(t,a=na.default.Writer.create()){switch(t.timestamp!==void 0&&a.uint32(8).uint32(t.timestamp),t.originOffset!==void 0&&nt.encode(t.originOffset,a.uint32(18).fork()).ldelim(),t.direction?.$case){case"localDirection":nt.encode(t.direction.localDirection,a.uint32(50).fork()).ldelim();break;case"globalDirection":nt.encode(t.direction.globalDirection,a.uint32(26).fork()).ldelim();break;case"globalTarget":nt.encode(t.direction.globalTarget,a.uint32(58).fork()).ldelim();break;case"targetEntity":a.uint32(80).uint32(t.direction.targetEntity);break}return t.maxDistance!==0&&a.uint32(37).float(t.maxDistance),t.queryType!==0&&a.uint32(40).int32(t.queryType),t.continuous!==void 0&&a.uint32(64).bool(t.continuous),t.collisionMask!==void 0&&a.uint32(72).uint32(t.collisionMask),a}e.encode=n;function s(t,a){let r=t instanceof na.default.Reader?t:na.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=jp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.timestamp=r.uint32();continue;case 2:if(i!==18)break;o.originOffset=nt.decode(r,r.uint32());continue;case 6:if(i!==50)break;o.direction={$case:"localDirection",localDirection:nt.decode(r,r.uint32())};continue;case 3:if(i!==26)break;o.direction={$case:"globalDirection",globalDirection:nt.decode(r,r.uint32())};continue;case 7:if(i!==58)break;o.direction={$case:"globalTarget",globalTarget:nt.decode(r,r.uint32())};continue;case 10:if(i!==80)break;o.direction={$case:"targetEntity",targetEntity:r.uint32()};continue;case 4:if(i!==37)break;o.maxDistance=r.float();continue;case 5:if(i!==40)break;o.queryType=r.int32();continue;case 8:if(i!==64)break;o.continuous=r.bool();continue;case 9:if(i!==72)break;o.collisionMask=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ar||(ar={}));var Ku={COMPONENT_ID:1067,serialize(e,n){let s=ar.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return ar.decode(e.buffer(),e.remainingBytes())},create(){return ar.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBRaycast"}};var oa=Ze(Je());function $p(){return{timestamp:void 0,globalOrigin:void 0,direction:void 0,hits:[],tickNumber:0}}var sr;(function(e){function n(t,a=oa.default.Writer.create()){t.timestamp!==void 0&&a.uint32(8).uint32(t.timestamp),t.globalOrigin!==void 0&&nt.encode(t.globalOrigin,a.uint32(18).fork()).ldelim(),t.direction!==void 0&&nt.encode(t.direction,a.uint32(26).fork()).ldelim();for(let r of t.hits)so.encode(r,a.uint32(34).fork()).ldelim();return t.tickNumber!==0&&a.uint32(40).uint32(t.tickNumber),a}e.encode=n;function s(t,a){let r=t instanceof oa.default.Reader?t:oa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=$p();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.timestamp=r.uint32();continue;case 2:if(i!==18)break;o.globalOrigin=nt.decode(r,r.uint32());continue;case 3:if(i!==26)break;o.direction=nt.decode(r,r.uint32());continue;case 4:if(i!==34)break;o.hits.push(so.decode(r,r.uint32()));continue;case 5:if(i!==40)break;o.tickNumber=r.uint32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(sr||(sr={}));var ef={COMPONENT_ID:1068,serialize(e,n){let s=sr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return sr.decode(e.buffer(),e.remainingBytes())},create(){return sr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBRaycastResult"}};var ra=Ze(Je());function Xp(){return{text:"",font:void 0,fontSize:void 0,fontAutoSize:void 0,textAlign:void 0,width:void 0,height:void 0,paddingTop:void 0,paddingRight:void 0,paddingBottom:void 0,paddingLeft:void 0,lineSpacing:void 0,lineCount:void 0,textWrapping:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,outlineWidth:void 0,shadowColor:void 0,outlineColor:void 0,textColor:void 0}}var cr;(function(e){function n(t,a=ra.default.Writer.create()){return t.text!==""&&a.uint32(10).string(t.text),t.font!==void 0&&a.uint32(16).int32(t.font),t.fontSize!==void 0&&a.uint32(29).float(t.fontSize),t.fontAutoSize!==void 0&&a.uint32(32).bool(t.fontAutoSize),t.textAlign!==void 0&&a.uint32(40).int32(t.textAlign),t.width!==void 0&&a.uint32(53).float(t.width),t.height!==void 0&&a.uint32(61).float(t.height),t.paddingTop!==void 0&&a.uint32(69).float(t.paddingTop),t.paddingRight!==void 0&&a.uint32(77).float(t.paddingRight),t.paddingBottom!==void 0&&a.uint32(85).float(t.paddingBottom),t.paddingLeft!==void 0&&a.uint32(93).float(t.paddingLeft),t.lineSpacing!==void 0&&a.uint32(101).float(t.lineSpacing),t.lineCount!==void 0&&a.uint32(104).int32(t.lineCount),t.textWrapping!==void 0&&a.uint32(112).bool(t.textWrapping),t.shadowBlur!==void 0&&a.uint32(125).float(t.shadowBlur),t.shadowOffsetX!==void 0&&a.uint32(133).float(t.shadowOffsetX),t.shadowOffsetY!==void 0&&a.uint32(141).float(t.shadowOffsetY),t.outlineWidth!==void 0&&a.uint32(149).float(t.outlineWidth),t.shadowColor!==void 0&&Ft.encode(t.shadowColor,a.uint32(154).fork()).ldelim(),t.outlineColor!==void 0&&Ft.encode(t.outlineColor,a.uint32(162).fork()).ldelim(),t.textColor!==void 0&&Ot.encode(t.textColor,a.uint32(170).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof ra.default.Reader?t:ra.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Xp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.text=r.string();continue;case 2:if(i!==16)break;o.font=r.int32();continue;case 3:if(i!==29)break;o.fontSize=r.float();continue;case 4:if(i!==32)break;o.fontAutoSize=r.bool();continue;case 5:if(i!==40)break;o.textAlign=r.int32();continue;case 6:if(i!==53)break;o.width=r.float();continue;case 7:if(i!==61)break;o.height=r.float();continue;case 8:if(i!==69)break;o.paddingTop=r.float();continue;case 9:if(i!==77)break;o.paddingRight=r.float();continue;case 10:if(i!==85)break;o.paddingBottom=r.float();continue;case 11:if(i!==93)break;o.paddingLeft=r.float();continue;case 12:if(i!==101)break;o.lineSpacing=r.float();continue;case 13:if(i!==104)break;o.lineCount=r.int32();continue;case 14:if(i!==112)break;o.textWrapping=r.bool();continue;case 15:if(i!==125)break;o.shadowBlur=r.float();continue;case 16:if(i!==133)break;o.shadowOffsetX=r.float();continue;case 17:if(i!==141)break;o.shadowOffsetY=r.float();continue;case 18:if(i!==149)break;o.outlineWidth=r.float();continue;case 19:if(i!==154)break;o.shadowColor=Ft.decode(r,r.uint32());continue;case 20:if(i!==162)break;o.outlineColor=Ft.decode(r,r.uint32());continue;case 21:if(i!==170)break;o.textColor=Ot.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(cr||(cr={}));var tf={COMPONENT_ID:1030,serialize(e,n){let s=cr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return cr.decode(e.buffer(),e.remainingBytes())},create(){return cr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTextShape"}};var Tn=Ze(Je());var nf;(function(e){e[e.EF_LINEAR=0]="EF_LINEAR",e[e.EF_EASEINQUAD=1]="EF_EASEINQUAD",e[e.EF_EASEOUTQUAD=2]="EF_EASEOUTQUAD",e[e.EF_EASEQUAD=3]="EF_EASEQUAD",e[e.EF_EASEINSINE=4]="EF_EASEINSINE",e[e.EF_EASEOUTSINE=5]="EF_EASEOUTSINE",e[e.EF_EASESINE=6]="EF_EASESINE",e[e.EF_EASEINEXPO=7]="EF_EASEINEXPO",e[e.EF_EASEOUTEXPO=8]="EF_EASEOUTEXPO",e[e.EF_EASEEXPO=9]="EF_EASEEXPO",e[e.EF_EASEINELASTIC=10]="EF_EASEINELASTIC",e[e.EF_EASEOUTELASTIC=11]="EF_EASEOUTELASTIC",e[e.EF_EASEELASTIC=12]="EF_EASEELASTIC",e[e.EF_EASEINBOUNCE=13]="EF_EASEINBOUNCE",e[e.EF_EASEOUTBOUNCE=14]="EF_EASEOUTBOUNCE",e[e.EF_EASEBOUNCE=15]="EF_EASEBOUNCE",e[e.EF_EASEINCUBIC=16]="EF_EASEINCUBIC",e[e.EF_EASEOUTCUBIC=17]="EF_EASEOUTCUBIC",e[e.EF_EASECUBIC=18]="EF_EASECUBIC",e[e.EF_EASEINQUART=19]="EF_EASEINQUART",e[e.EF_EASEOUTQUART=20]="EF_EASEOUTQUART",e[e.EF_EASEQUART=21]="EF_EASEQUART",e[e.EF_EASEINQUINT=22]="EF_EASEINQUINT",e[e.EF_EASEOUTQUINT=23]="EF_EASEOUTQUINT",e[e.EF_EASEQUINT=24]="EF_EASEQUINT",e[e.EF_EASEINCIRC=25]="EF_EASEINCIRC",e[e.EF_EASEOUTCIRC=26]="EF_EASEOUTCIRC",e[e.EF_EASECIRC=27]="EF_EASECIRC",e[e.EF_EASEINBACK=28]="EF_EASEINBACK",e[e.EF_EASEOUTBACK=29]="EF_EASEOUTBACK",e[e.EF_EASEBACK=30]="EF_EASEBACK"})(nf||(nf={}));function Zp(){return{duration:0,easingFunction:0,mode:void 0,playing:void 0,currentTime:void 0}}var $n;(function(e){function n(t,a=Tn.default.Writer.create()){switch(t.duration!==0&&a.uint32(13).float(t.duration),t.easingFunction!==0&&a.uint32(16).int32(t.easingFunction),t.mode?.$case){case"move":ia.encode(t.mode.move,a.uint32(26).fork()).ldelim();break;case"rotate":aa.encode(t.mode.rotate,a.uint32(34).fork()).ldelim();break;case"scale":sa.encode(t.mode.scale,a.uint32(42).fork()).ldelim();break}return t.playing!==void 0&&a.uint32(48).bool(t.playing),t.currentTime!==void 0&&a.uint32(61).float(t.currentTime),a}e.encode=n;function s(t,a){let r=t instanceof Tn.default.Reader?t:Tn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Zp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.duration=r.float();continue;case 2:if(i!==16)break;o.easingFunction=r.int32();continue;case 3:if(i!==26)break;o.mode={$case:"move",move:ia.decode(r,r.uint32())};continue;case 4:if(i!==34)break;o.mode={$case:"rotate",rotate:aa.decode(r,r.uint32())};continue;case 5:if(i!==42)break;o.mode={$case:"scale",scale:sa.decode(r,r.uint32())};continue;case 6:if(i!==48)break;o.playing=r.bool();continue;case 7:if(i!==61)break;o.currentTime=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})($n||($n={}));function Qp(){return{start:void 0,end:void 0,faceDirection:void 0}}var ia;(function(e){function n(t,a=Tn.default.Writer.create()){return t.start!==void 0&&nt.encode(t.start,a.uint32(10).fork()).ldelim(),t.end!==void 0&&nt.encode(t.end,a.uint32(18).fork()).ldelim(),t.faceDirection!==void 0&&a.uint32(24).bool(t.faceDirection),a}e.encode=n;function s(t,a){let r=t instanceof Tn.default.Reader?t:Tn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Qp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.start=nt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.end=nt.decode(r,r.uint32());continue;case 3:if(i!==24)break;o.faceDirection=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ia||(ia={}));function Jp(){return{start:void 0,end:void 0}}var aa;(function(e){function n(t,a=Tn.default.Writer.create()){return t.start!==void 0&&So.encode(t.start,a.uint32(10).fork()).ldelim(),t.end!==void 0&&So.encode(t.end,a.uint32(18).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Tn.default.Reader?t:Tn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Jp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.start=So.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.end=So.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(aa||(aa={}));function Kp(){return{start:void 0,end:void 0}}var sa;(function(e){function n(t,a=Tn.default.Writer.create()){return t.start!==void 0&&nt.encode(t.start,a.uint32(10).fork()).ldelim(),t.end!==void 0&&nt.encode(t.end,a.uint32(18).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof Tn.default.Reader?t:Tn.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=Kp();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.start=nt.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.end=nt.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(sa||(sa={}));var of={COMPONENT_ID:1102,serialize(e,n){let s=$n.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return $n.decode(e.buffer(),e.remainingBytes())},create(){return $n.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTween"}};var ca=Ze(Je());var rf;(function(e){e[e.TL_RESTART=0]="TL_RESTART",e[e.TL_YOYO=1]="TL_YOYO"})(rf||(rf={}));function eh(){return{sequence:[],loop:void 0}}var ur;(function(e){function n(t,a=ca.default.Writer.create()){for(let r of t.sequence)$n.encode(r,a.uint32(10).fork()).ldelim();return t.loop!==void 0&&a.uint32(16).int32(t.loop),a}e.encode=n;function s(t,a){let r=t instanceof ca.default.Reader?t:ca.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=eh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.sequence.push($n.decode(r,r.uint32()));continue;case 2:if(i!==16)break;o.loop=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(ur||(ur={}));var af={COMPONENT_ID:1104,serialize(e,n){let s=ur.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return ur.decode(e.buffer(),e.remainingBytes())},create(){return ur.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTweenSequence"}};var ua=Ze(Je());var sf;(function(e){e[e.TS_ACTIVE=0]="TS_ACTIVE",e[e.TS_COMPLETED=1]="TS_COMPLETED",e[e.TS_PAUSED=2]="TS_PAUSED"})(sf||(sf={}));function th(){return{state:0,currentTime:0}}var fr;(function(e){function n(t,a=ua.default.Writer.create()){return t.state!==0&&a.uint32(8).int32(t.state),t.currentTime!==0&&a.uint32(21).float(t.currentTime),a}e.encode=n;function s(t,a){let r=t instanceof ua.default.Reader?t:ua.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=th();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.state=r.int32();continue;case 2:if(i!==21)break;o.currentTime=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(fr||(fr={}));var cf={COMPONENT_ID:1103,serialize(e,n){let s=fr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return fr.decode(e.buffer(),e.remainingBytes())},create(){return fr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBTweenState"}};var fa=Ze(Je());var No=Ze(Je());function nh(){return{top:0,left:0,right:0,bottom:0}}var co;(function(e){function n(t,a=No.default.Writer.create()){return t.top!==0&&a.uint32(13).float(t.top),t.left!==0&&a.uint32(21).float(t.left),t.right!==0&&a.uint32(29).float(t.right),t.bottom!==0&&a.uint32(37).float(t.bottom),a}e.encode=n;function s(t,a){let r=t instanceof No.default.Reader?t:No.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=nh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.top=r.float();continue;case 2:if(i!==21)break;o.left=r.float();continue;case 3:if(i!==29)break;o.right=r.float();continue;case 4:if(i!==37)break;o.bottom=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(co||(co={}));function oh(){return{x:0,y:0,width:0,height:0}}var uf;(function(e){function n(t,a=No.default.Writer.create()){return t.x!==0&&a.uint32(13).float(t.x),t.y!==0&&a.uint32(21).float(t.y),t.width!==0&&a.uint32(29).float(t.width),t.height!==0&&a.uint32(37).float(t.height),a}e.encode=n;function s(t,a){let r=t instanceof No.default.Reader?t:No.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=oh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.x=r.float();continue;case 2:if(i!==21)break;o.y=r.float();continue;case 3:if(i!==29)break;o.width=r.float();continue;case 4:if(i!==37)break;o.height=r.float();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(uf||(uf={}));var ff;(function(e){e[e.NINE_SLICES=0]="NINE_SLICES",e[e.CENTER=1]="CENTER",e[e.STRETCH=2]="STRETCH"})(ff||(ff={}));function rh(){return{color:void 0,texture:void 0,textureMode:0,textureSlices:void 0,uvs:[]}}var lr;(function(e){function n(t,a=fa.default.Writer.create()){t.color!==void 0&&Ot.encode(t.color,a.uint32(10).fork()).ldelim(),t.texture!==void 0&&an.encode(t.texture,a.uint32(18).fork()).ldelim(),t.textureMode!==0&&a.uint32(24).int32(t.textureMode),t.textureSlices!==void 0&&co.encode(t.textureSlices,a.uint32(34).fork()).ldelim(),a.uint32(42).fork();for(let r of t.uvs)a.float(r);return a.ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof fa.default.Reader?t:fa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=rh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.color=Ot.decode(r,r.uint32());continue;case 2:if(i!==18)break;o.texture=an.decode(r,r.uint32());continue;case 3:if(i!==24)break;o.textureMode=r.int32();continue;case 4:if(i!==34)break;o.textureSlices=co.decode(r,r.uint32());continue;case 5:if(i===45){o.uvs.push(r.float());continue}if(i===42){let u=r.uint32()+r.pos;for(;r.pos<u;)o.uvs.push(r.float());continue}break}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(lr||(lr={}));var lf={COMPONENT_ID:1053,serialize(e,n){let s=lr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return lr.decode(e.buffer(),e.remainingBytes())},create(){return lr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiBackground"}};var la=Ze(Je());function ih(){return{devicePixelRatio:0,width:0,height:0,interactableArea:void 0}}var dr;(function(e){function n(t,a=la.default.Writer.create()){return t.devicePixelRatio!==0&&a.uint32(13).float(t.devicePixelRatio),t.width!==0&&a.uint32(16).int32(t.width),t.height!==0&&a.uint32(24).int32(t.height),t.interactableArea!==void 0&&co.encode(t.interactableArea,a.uint32(34).fork()).ldelim(),a}e.encode=n;function s(t,a){let r=t instanceof la.default.Reader?t:la.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ih();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==13)break;o.devicePixelRatio=r.float();continue;case 2:if(i!==16)break;o.width=r.int32();continue;case 3:if(i!==24)break;o.height=r.int32();continue;case 4:if(i!==34)break;o.interactableArea=co.decode(r,r.uint32());continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(dr||(dr={}));var df={COMPONENT_ID:1054,serialize(e,n){let s=dr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return dr.decode(e.buffer(),e.remainingBytes())},create(){return dr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiCanvasInformation"}};var da=Ze(Je());function ah(){return{acceptEmpty:!1,emptyLabel:void 0,options:[],selectedIndex:void 0,disabled:!1,color:void 0,textAlign:void 0,font:void 0,fontSize:void 0}}var pr;(function(e){function n(t,a=da.default.Writer.create()){t.acceptEmpty===!0&&a.uint32(8).bool(t.acceptEmpty),t.emptyLabel!==void 0&&a.uint32(18).string(t.emptyLabel);for(let r of t.options)a.uint32(26).string(r);return t.selectedIndex!==void 0&&a.uint32(32).int32(t.selectedIndex),t.disabled===!0&&a.uint32(40).bool(t.disabled),t.color!==void 0&&Ot.encode(t.color,a.uint32(50).fork()).ldelim(),t.textAlign!==void 0&&a.uint32(80).int32(t.textAlign),t.font!==void 0&&a.uint32(88).int32(t.font),t.fontSize!==void 0&&a.uint32(96).int32(t.fontSize),a}e.encode=n;function s(t,a){let r=t instanceof da.default.Reader?t:da.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ah();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.acceptEmpty=r.bool();continue;case 2:if(i!==18)break;o.emptyLabel=r.string();continue;case 3:if(i!==26)break;o.options.push(r.string());continue;case 4:if(i!==32)break;o.selectedIndex=r.int32();continue;case 5:if(i!==40)break;o.disabled=r.bool();continue;case 6:if(i!==50)break;o.color=Ot.decode(r,r.uint32());continue;case 10:if(i!==80)break;o.textAlign=r.int32();continue;case 11:if(i!==88)break;o.font=r.int32();continue;case 12:if(i!==96)break;o.fontSize=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(pr||(pr={}));var pf={COMPONENT_ID:1094,serialize(e,n){let s=pr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return pr.decode(e.buffer(),e.remainingBytes())},create(){return pr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiDropdown"}};var pa=Ze(Je());function sh(){return{value:0}}var hr;(function(e){function n(t,a=pa.default.Writer.create()){return t.value!==0&&a.uint32(8).int32(t.value),a}e.encode=n;function s(t,a){let r=t instanceof pa.default.Reader?t:pa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=sh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.value=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(hr||(hr={}));var hf={COMPONENT_ID:1096,serialize(e,n){let s=hr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return hr.decode(e.buffer(),e.remainingBytes())},create(){return hr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiDropdownResult"}};var ha=Ze(Je());function ch(){return{placeholder:"",color:void 0,placeholderColor:void 0,disabled:!1,textAlign:void 0,font:void 0,fontSize:void 0,value:void 0}}var mr;(function(e){function n(t,a=ha.default.Writer.create()){return t.placeholder!==""&&a.uint32(10).string(t.placeholder),t.color!==void 0&&Ot.encode(t.color,a.uint32(18).fork()).ldelim(),t.placeholderColor!==void 0&&Ot.encode(t.placeholderColor,a.uint32(26).fork()).ldelim(),t.disabled===!0&&a.uint32(32).bool(t.disabled),t.textAlign!==void 0&&a.uint32(80).int32(t.textAlign),t.font!==void 0&&a.uint32(88).int32(t.font),t.fontSize!==void 0&&a.uint32(96).int32(t.fontSize),t.value!==void 0&&a.uint32(106).string(t.value),a}e.encode=n;function s(t,a){let r=t instanceof ha.default.Reader?t:ha.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ch();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.placeholder=r.string();continue;case 2:if(i!==18)break;o.color=Ot.decode(r,r.uint32());continue;case 3:if(i!==26)break;o.placeholderColor=Ot.decode(r,r.uint32());continue;case 4:if(i!==32)break;o.disabled=r.bool();continue;case 10:if(i!==80)break;o.textAlign=r.int32();continue;case 11:if(i!==88)break;o.font=r.int32();continue;case 12:if(i!==96)break;o.fontSize=r.int32();continue;case 13:if(i!==106)break;o.value=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(mr||(mr={}));var mf={COMPONENT_ID:1093,serialize(e,n){let s=mr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return mr.decode(e.buffer(),e.remainingBytes())},create(){return mr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiInput"}};var ma=Ze(Je());function uh(){return{value:"",isSubmit:void 0}}var yr;(function(e){function n(t,a=ma.default.Writer.create()){return t.value!==""&&a.uint32(10).string(t.value),t.isSubmit!==void 0&&a.uint32(16).bool(t.isSubmit),a}e.encode=n;function s(t,a){let r=t instanceof ma.default.Reader?t:ma.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=uh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.value=r.string();continue;case 2:if(i!==16)break;o.isSubmit=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(yr||(yr={}));var yf={COMPONENT_ID:1095,serialize(e,n){let s=yr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return yr.decode(e.buffer(),e.remainingBytes())},create(){return yr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiInputResult"}};var ya=Ze(Je());function fh(){return{value:"",color:void 0,textAlign:void 0,font:void 0,fontSize:void 0}}var vr;(function(e){function n(t,a=ya.default.Writer.create()){return t.value!==""&&a.uint32(10).string(t.value),t.color!==void 0&&Ot.encode(t.color,a.uint32(18).fork()).ldelim(),t.textAlign!==void 0&&a.uint32(24).int32(t.textAlign),t.font!==void 0&&a.uint32(32).int32(t.font),t.fontSize!==void 0&&a.uint32(40).int32(t.fontSize),a}e.encode=n;function s(t,a){let r=t instanceof ya.default.Reader?t:ya.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=fh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.value=r.string();continue;case 2:if(i!==18)break;o.color=Ot.decode(r,r.uint32());continue;case 3:if(i!==24)break;o.textAlign=r.int32();continue;case 4:if(i!==32)break;o.font=r.int32();continue;case 5:if(i!==40)break;o.fontSize=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(vr||(vr={}));var vf={COMPONENT_ID:1052,serialize(e,n){let s=vr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return vr.decode(e.buffer(),e.remainingBytes())},create(){return vr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiText"}};var va=Ze(Je());var xf;(function(e){e[e.YGPT_RELATIVE=0]="YGPT_RELATIVE",e[e.YGPT_ABSOLUTE=1]="YGPT_ABSOLUTE"})(xf||(xf={}));var Ef;(function(e){e[e.YGA_AUTO=0]="YGA_AUTO",e[e.YGA_FLEX_START=1]="YGA_FLEX_START",e[e.YGA_CENTER=2]="YGA_CENTER",e[e.YGA_FLEX_END=3]="YGA_FLEX_END",e[e.YGA_STRETCH=4]="YGA_STRETCH",e[e.YGA_BASELINE=5]="YGA_BASELINE",e[e.YGA_SPACE_BETWEEN=6]="YGA_SPACE_BETWEEN",e[e.YGA_SPACE_AROUND=7]="YGA_SPACE_AROUND"})(Ef||(Ef={}));var bf;(function(e){e[e.YGU_UNDEFINED=0]="YGU_UNDEFINED",e[e.YGU_POINT=1]="YGU_POINT",e[e.YGU_PERCENT=2]="YGU_PERCENT",e[e.YGU_AUTO=3]="YGU_AUTO"})(bf||(bf={}));var gf;(function(e){e[e.YGFD_ROW=0]="YGFD_ROW",e[e.YGFD_COLUMN=1]="YGFD_COLUMN",e[e.YGFD_COLUMN_REVERSE=2]="YGFD_COLUMN_REVERSE",e[e.YGFD_ROW_REVERSE=3]="YGFD_ROW_REVERSE"})(gf||(gf={}));var Tf;(function(e){e[e.YGW_NO_WRAP=0]="YGW_NO_WRAP",e[e.YGW_WRAP=1]="YGW_WRAP",e[e.YGW_WRAP_REVERSE=2]="YGW_WRAP_REVERSE"})(Tf||(Tf={}));var wf;(function(e){e[e.YGJ_FLEX_START=0]="YGJ_FLEX_START",e[e.YGJ_CENTER=1]="YGJ_CENTER",e[e.YGJ_FLEX_END=2]="YGJ_FLEX_END",e[e.YGJ_SPACE_BETWEEN=3]="YGJ_SPACE_BETWEEN",e[e.YGJ_SPACE_AROUND=4]="YGJ_SPACE_AROUND",e[e.YGJ_SPACE_EVENLY=5]="YGJ_SPACE_EVENLY"})(wf||(wf={}));var Sf;(function(e){e[e.YGO_VISIBLE=0]="YGO_VISIBLE",e[e.YGO_HIDDEN=1]="YGO_HIDDEN",e[e.YGO_SCROLL=2]="YGO_SCROLL"})(Sf||(Sf={}));var _f;(function(e){e[e.YGD_FLEX=0]="YGD_FLEX",e[e.YGD_NONE=1]="YGD_NONE"})(_f||(_f={}));var Af;(function(e){e[e.YGE_LEFT=0]="YGE_LEFT",e[e.YGE_TOP=1]="YGE_TOP",e[e.YGE_RIGHT=2]="YGE_RIGHT",e[e.YGE_BOTTOM=3]="YGE_BOTTOM",e[e.YGE_START=4]="YGE_START",e[e.YGE_END=5]="YGE_END",e[e.YGE_HORIZONTAL=6]="YGE_HORIZONTAL",e[e.YGE_VERTICAL=7]="YGE_VERTICAL",e[e.YGE_ALL=8]="YGE_ALL"})(Af||(Af={}));var Rf;(function(e){e[e.PFM_NONE=0]="PFM_NONE",e[e.PFM_BLOCK=1]="PFM_BLOCK"})(Rf||(Rf={}));function lh(){return{parent:0,rightOf:0,alignContent:void 0,alignItems:void 0,flexWrap:void 0,flexShrink:void 0,positionType:0,alignSelf:0,flexDirection:0,justifyContent:0,overflow:0,display:0,flexBasisUnit:0,flexBasis:0,flexGrow:0,widthUnit:0,width:0,heightUnit:0,height:0,minWidthUnit:0,minWidth:0,minHeightUnit:0,minHeight:0,maxWidthUnit:0,maxWidth:0,maxHeightUnit:0,maxHeight:0,positionLeftUnit:0,positionLeft:0,positionTopUnit:0,positionTop:0,positionRightUnit:0,positionRight:0,positionBottomUnit:0,positionBottom:0,marginLeftUnit:0,marginLeft:0,marginTopUnit:0,marginTop:0,marginRightUnit:0,marginRight:0,marginBottomUnit:0,marginBottom:0,paddingLeftUnit:0,paddingLeft:0,paddingTopUnit:0,paddingTop:0,paddingRightUnit:0,paddingRight:0,paddingBottomUnit:0,paddingBottom:0,pointerFilter:void 0}}var xr;(function(e){function n(t,a=va.default.Writer.create()){return t.parent!==0&&a.uint32(8).int32(t.parent),t.rightOf!==0&&a.uint32(16).int32(t.rightOf),t.alignContent!==void 0&&a.uint32(24).int32(t.alignContent),t.alignItems!==void 0&&a.uint32(32).int32(t.alignItems),t.flexWrap!==void 0&&a.uint32(40).int32(t.flexWrap),t.flexShrink!==void 0&&a.uint32(53).float(t.flexShrink),t.positionType!==0&&a.uint32(56).int32(t.positionType),t.alignSelf!==0&&a.uint32(64).int32(t.alignSelf),t.flexDirection!==0&&a.uint32(72).int32(t.flexDirection),t.justifyContent!==0&&a.uint32(80).int32(t.justifyContent),t.overflow!==0&&a.uint32(88).int32(t.overflow),t.display!==0&&a.uint32(96).int32(t.display),t.flexBasisUnit!==0&&a.uint32(104).int32(t.flexBasisUnit),t.flexBasis!==0&&a.uint32(117).float(t.flexBasis),t.flexGrow!==0&&a.uint32(125).float(t.flexGrow),t.widthUnit!==0&&a.uint32(128).int32(t.widthUnit),t.width!==0&&a.uint32(141).float(t.width),t.heightUnit!==0&&a.uint32(144).int32(t.heightUnit),t.height!==0&&a.uint32(157).float(t.height),t.minWidthUnit!==0&&a.uint32(160).int32(t.minWidthUnit),t.minWidth!==0&&a.uint32(173).float(t.minWidth),t.minHeightUnit!==0&&a.uint32(176).int32(t.minHeightUnit),t.minHeight!==0&&a.uint32(189).float(t.minHeight),t.maxWidthUnit!==0&&a.uint32(192).int32(t.maxWidthUnit),t.maxWidth!==0&&a.uint32(205).float(t.maxWidth),t.maxHeightUnit!==0&&a.uint32(208).int32(t.maxHeightUnit),t.maxHeight!==0&&a.uint32(221).float(t.maxHeight),t.positionLeftUnit!==0&&a.uint32(224).int32(t.positionLeftUnit),t.positionLeft!==0&&a.uint32(237).float(t.positionLeft),t.positionTopUnit!==0&&a.uint32(240).int32(t.positionTopUnit),t.positionTop!==0&&a.uint32(253).float(t.positionTop),t.positionRightUnit!==0&&a.uint32(256).int32(t.positionRightUnit),t.positionRight!==0&&a.uint32(269).float(t.positionRight),t.positionBottomUnit!==0&&a.uint32(272).int32(t.positionBottomUnit),t.positionBottom!==0&&a.uint32(285).float(t.positionBottom),t.marginLeftUnit!==0&&a.uint32(288).int32(t.marginLeftUnit),t.marginLeft!==0&&a.uint32(301).float(t.marginLeft),t.marginTopUnit!==0&&a.uint32(304).int32(t.marginTopUnit),t.marginTop!==0&&a.uint32(317).float(t.marginTop),t.marginRightUnit!==0&&a.uint32(320).int32(t.marginRightUnit),t.marginRight!==0&&a.uint32(333).float(t.marginRight),t.marginBottomUnit!==0&&a.uint32(336).int32(t.marginBottomUnit),t.marginBottom!==0&&a.uint32(349).float(t.marginBottom),t.paddingLeftUnit!==0&&a.uint32(352).int32(t.paddingLeftUnit),t.paddingLeft!==0&&a.uint32(365).float(t.paddingLeft),t.paddingTopUnit!==0&&a.uint32(368).int32(t.paddingTopUnit),t.paddingTop!==0&&a.uint32(381).float(t.paddingTop),t.paddingRightUnit!==0&&a.uint32(384).int32(t.paddingRightUnit),t.paddingRight!==0&&a.uint32(397).float(t.paddingRight),t.paddingBottomUnit!==0&&a.uint32(400).int32(t.paddingBottomUnit),t.paddingBottom!==0&&a.uint32(413).float(t.paddingBottom),t.pointerFilter!==void 0&&a.uint32(416).int32(t.pointerFilter),a}e.encode=n;function s(t,a){let r=t instanceof va.default.Reader?t:va.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=lh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.parent=r.int32();continue;case 2:if(i!==16)break;o.rightOf=r.int32();continue;case 3:if(i!==24)break;o.alignContent=r.int32();continue;case 4:if(i!==32)break;o.alignItems=r.int32();continue;case 5:if(i!==40)break;o.flexWrap=r.int32();continue;case 6:if(i!==53)break;o.flexShrink=r.float();continue;case 7:if(i!==56)break;o.positionType=r.int32();continue;case 8:if(i!==64)break;o.alignSelf=r.int32();continue;case 9:if(i!==72)break;o.flexDirection=r.int32();continue;case 10:if(i!==80)break;o.justifyContent=r.int32();continue;case 11:if(i!==88)break;o.overflow=r.int32();continue;case 12:if(i!==96)break;o.display=r.int32();continue;case 13:if(i!==104)break;o.flexBasisUnit=r.int32();continue;case 14:if(i!==117)break;o.flexBasis=r.float();continue;case 15:if(i!==125)break;o.flexGrow=r.float();continue;case 16:if(i!==128)break;o.widthUnit=r.int32();continue;case 17:if(i!==141)break;o.width=r.float();continue;case 18:if(i!==144)break;o.heightUnit=r.int32();continue;case 19:if(i!==157)break;o.height=r.float();continue;case 20:if(i!==160)break;o.minWidthUnit=r.int32();continue;case 21:if(i!==173)break;o.minWidth=r.float();continue;case 22:if(i!==176)break;o.minHeightUnit=r.int32();continue;case 23:if(i!==189)break;o.minHeight=r.float();continue;case 24:if(i!==192)break;o.maxWidthUnit=r.int32();continue;case 25:if(i!==205)break;o.maxWidth=r.float();continue;case 26:if(i!==208)break;o.maxHeightUnit=r.int32();continue;case 27:if(i!==221)break;o.maxHeight=r.float();continue;case 28:if(i!==224)break;o.positionLeftUnit=r.int32();continue;case 29:if(i!==237)break;o.positionLeft=r.float();continue;case 30:if(i!==240)break;o.positionTopUnit=r.int32();continue;case 31:if(i!==253)break;o.positionTop=r.float();continue;case 32:if(i!==256)break;o.positionRightUnit=r.int32();continue;case 33:if(i!==269)break;o.positionRight=r.float();continue;case 34:if(i!==272)break;o.positionBottomUnit=r.int32();continue;case 35:if(i!==285)break;o.positionBottom=r.float();continue;case 36:if(i!==288)break;o.marginLeftUnit=r.int32();continue;case 37:if(i!==301)break;o.marginLeft=r.float();continue;case 38:if(i!==304)break;o.marginTopUnit=r.int32();continue;case 39:if(i!==317)break;o.marginTop=r.float();continue;case 40:if(i!==320)break;o.marginRightUnit=r.int32();continue;case 41:if(i!==333)break;o.marginRight=r.float();continue;case 42:if(i!==336)break;o.marginBottomUnit=r.int32();continue;case 43:if(i!==349)break;o.marginBottom=r.float();continue;case 44:if(i!==352)break;o.paddingLeftUnit=r.int32();continue;case 45:if(i!==365)break;o.paddingLeft=r.float();continue;case 46:if(i!==368)break;o.paddingTopUnit=r.int32();continue;case 47:if(i!==381)break;o.paddingTop=r.float();continue;case 48:if(i!==384)break;o.paddingRightUnit=r.int32();continue;case 49:if(i!==397)break;o.paddingRight=r.float();continue;case 50:if(i!==400)break;o.paddingBottomUnit=r.int32();continue;case 51:if(i!==413)break;o.paddingBottom=r.float();continue;case 52:if(i!==416)break;o.pointerFilter=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(xr||(xr={}));var Nf={COMPONENT_ID:1050,serialize(e,n){let s=xr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return xr.decode(e.buffer(),e.remainingBytes())},create(){return xr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBUiTransform"}};var xa=Ze(Je());var Cf;(function(e){e[e.VS_NONE=0]="VS_NONE",e[e.VS_ERROR=1]="VS_ERROR",e[e.VS_LOADING=2]="VS_LOADING",e[e.VS_READY=3]="VS_READY",e[e.VS_PLAYING=4]="VS_PLAYING",e[e.VS_BUFFERING=5]="VS_BUFFERING",e[e.VS_SEEKING=6]="VS_SEEKING",e[e.VS_PAUSED=7]="VS_PAUSED"})(Cf||(Cf={}));function dh(){return{timestamp:0,tickNumber:0,currentOffset:0,videoLength:0,state:0}}var Er;(function(e){function n(t,a=xa.default.Writer.create()){return t.timestamp!==0&&a.uint32(8).uint32(t.timestamp),t.tickNumber!==0&&a.uint32(16).uint32(t.tickNumber),t.currentOffset!==0&&a.uint32(29).float(t.currentOffset),t.videoLength!==0&&a.uint32(37).float(t.videoLength),t.state!==0&&a.uint32(40).int32(t.state),a}e.encode=n;function s(t,a){let r=t instanceof xa.default.Reader?t:xa.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=dh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.timestamp=r.uint32();continue;case 2:if(i!==16)break;o.tickNumber=r.uint32();continue;case 3:if(i!==29)break;o.currentOffset=r.float();continue;case 4:if(i!==37)break;o.videoLength=r.float();continue;case 5:if(i!==40)break;o.state=r.int32();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(Er||(Er={}));var If={COMPONENT_ID:1044,serialize(e,n){let s=Er.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return Er.decode(e.buffer(),e.remainingBytes())},create(){return Er.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBVideoEvent"}};var Ea=Ze(Je());function ph(){return{src:"",playing:void 0,position:void 0,volume:void 0,playbackRate:void 0,loop:void 0}}var br;(function(e){function n(t,a=Ea.default.Writer.create()){return t.src!==""&&a.uint32(10).string(t.src),t.playing!==void 0&&a.uint32(16).bool(t.playing),t.position!==void 0&&a.uint32(29).float(t.position),t.volume!==void 0&&a.uint32(37).float(t.volume),t.playbackRate!==void 0&&a.uint32(45).float(t.playbackRate),t.loop!==void 0&&a.uint32(48).bool(t.loop),a}e.encode=n;function s(t,a){let r=t instanceof Ea.default.Reader?t:Ea.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=ph();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;o.src=r.string();continue;case 2:if(i!==16)break;o.playing=r.bool();continue;case 3:if(i!==29)break;o.position=r.float();continue;case 4:if(i!==37)break;o.volume=r.float();continue;case 5:if(i!==45)break;o.playbackRate=r.float();continue;case 6:if(i!==48)break;o.loop=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(br||(br={}));var Bf={COMPONENT_ID:1043,serialize(e,n){let s=br.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return br.decode(e.buffer(),e.remainingBytes())},create(){return br.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBVideoPlayer"}};var ba=Ze(Je());function hh(){return{visible:void 0}}var gr;(function(e){function n(t,a=ba.default.Writer.create()){return t.visible!==void 0&&a.uint32(8).bool(t.visible),a}e.encode=n;function s(t,a){let r=t instanceof ba.default.Reader?t:ba.default.Reader.create(t),c=a===void 0?r.len:r.pos+a,o=hh();for(;r.pos<c;){let i=r.uint32();switch(i>>>3){case 1:if(i!==8)break;o.visible=r.bool();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return o}e.decode=s})(gr||(gr={}));var Of={COMPONENT_ID:1081,serialize(e,n){let s=gr.encode(e),t=new Uint8Array(s.finish(),0,s.len);n.writeBuffer(t,!1)},deserialize(e){return gr.decode(e.buffer(),e.remainingBytes())},create(){return gr.decode(new Uint8Array)},jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBVisibilityComponent"}};var vs=e=>e.defineComponentFromSchema("core::Animator",pu),xs=e=>e.defineComponentFromSchema("core::AudioSource",hu),Es=e=>e.defineComponentFromSchema("core::AudioStream",mu),bs=e=>e.defineComponentFromSchema("core::AvatarAttach",vu),kf=e=>e.defineComponentFromSchema("core::AvatarModifierArea",gu),Mf=e=>e.defineComponentFromSchema("core::AvatarShape",Ou),Pf=e=>e.defineComponentFromSchema("core::Billboard",Mu),zf=e=>e.defineComponentFromSchema("core::CameraMode",Pu),Ff=e=>e.defineComponentFromSchema("core::CameraModeArea",zu),Lf=e=>e.defineComponentFromSchema("core::EngineInfo",Fu),gs=e=>e.defineComponentFromSchema("core::GltfContainer",Lu),Uf=e=>e.defineComponentFromSchema("core::GltfContainerLoadingState",Uu),Ts=e=>e.defineComponentFromSchema("core::Material",qu),Df=e=>e.defineComponentFromSchema("core::MeshCollider",Gu),ws=e=>e.defineComponentFromSchema("core::MeshRenderer",Yu),Ss=e=>e.defineComponentFromSchema("core::NftShape",$u),jr=e=>e.defineComponentFromSchema("core::PointerEvents",Xu),ga=e=>e.defineValueSetComponentFromSchema("core::PointerEventsResult",Zu,{timestampFunction:n=>n.timestamp,maxElements:100}),Vf=e=>e.defineComponentFromSchema("core::PointerLock",Qu),_s=e=>e.defineComponentFromSchema("core::Raycast",Ku),As=e=>e.defineComponentFromSchema("core::RaycastResult",ef),Wf=e=>e.defineComponentFromSchema("core::TextShape",tf),Rs=e=>e.defineComponentFromSchema("core::Tween",of),Ta=e=>e.defineComponentFromSchema("core::TweenSequence",af),wa=e=>e.defineComponentFromSchema("core::TweenState",cf),Ns=e=>e.defineComponentFromSchema("core::UiBackground",lf),qf=e=>e.defineComponentFromSchema("core::UiCanvasInformation",df),Hf=e=>e.defineComponentFromSchema("core::UiDropdown",pf),Gf=e=>e.defineComponentFromSchema("core::UiDropdownResult",hf),Yf=e=>e.defineComponentFromSchema("core::UiInput",mf),jf=e=>e.defineComponentFromSchema("core::UiInputResult",yf),Cs=e=>e.defineComponentFromSchema("core::UiText",vf),Is=e=>e.defineComponentFromSchema("core::UiTransform",Nf),Bs=e=>e.defineValueSetComponentFromSchema("core::VideoEvent",If,{timestampFunction:n=>n.timestamp,maxElements:100}),Sa=e=>e.defineComponentFromSchema("core::VideoPlayer",Bf),Os=e=>e.defineComponentFromSchema("core::VisibilityComponent",Of),ks={"core::Animator":vs,"core::AudioSource":xs,"core::AudioStream":Es,"core::AvatarAttach":bs,"core::AvatarModifierArea":kf,"core::AvatarShape":Mf,"core::Billboard":Pf,"core::CameraMode":zf,"core::CameraModeArea":Ff,"core::EngineInfo":Lf,"core::GltfContainer":gs,"core::GltfContainerLoadingState":Uf,"core::Material":Ts,"core::MeshCollider":Df,"core::MeshRenderer":ws,"core::NftShape":Ss,"core::PointerEvents":jr,"core::PointerEventsResult":ga,"core::PointerLock":Vf,"core::Raycast":_s,"core::RaycastResult":As,"core::TextShape":Wf,"core::Tween":Rs,"core::TweenSequence":Ta,"core::TweenState":wa,"core::UiBackground":Ns,"core::UiCanvasInformation":qf,"core::UiDropdown":Hf,"core::UiDropdownResult":Gf,"core::UiInput":Yf,"core::UiInputResult":jf,"core::UiText":Cs,"core::UiTransform":Is,"core::VideoEvent":Bs,"core::VideoPlayer":Sa,"core::VisibilityComponent":Os};function $f(e){let n=vs(e);function s(t,a){let r=n.getMutableOrNull(t);if(!r)return[null,null];let c=r.states.find(o=>o.clip===a);return c?[r,c]:[r,null]}return{...n,getClipOrNull(t,a){let[r,c]=s(t,a);return c},getClip(t,a){let[r,c]=s(t,a);if(!r)throw new Error(`There is no Animator found in the entity ${t}`);if(!c)throw new Error(`The Animator component of ${t} has no the state ${a}`);return c},playSingleAnimation(t,a,r=!0){let[c,o]=s(t,a);if(!c||!o)return!1;for(let i of c.states)i.playing=!1,i.shouldReset=!0;return o.playing=!0,o.shouldReset=r,!0},stopAllAnimations(t,a=!0){let r=n.getMutableOrNull(t);if(!r)return!1;for(let c of r.states)c.playing=!1,c.shouldReset=a;return!0}}}var yh={Common(e){return{tex:{$case:"texture",texture:e}}},Avatar(e){return{tex:{$case:"avatarTexture",avatarTexture:e}}},Video(e){return{tex:{$case:"videoTexture",videoTexture:e}}}};function Xf(e){let n=Ts(e);return{...n,Texture:yh,setBasicMaterial(s,t){n.createOrReplace(s,{material:{$case:"unlit",unlit:t}})},setPbrMaterial(s,t){n.createOrReplace(s,{material:{$case:"pbr",pbr:t}})}}}function Zf(e){let n=ws(e);return{...n,setBox(s,t){n.createOrReplace(s,{mesh:{$case:"box",box:{uvs:t||[]}}})},setPlane(s,t){n.createOrReplace(s,{mesh:{$case:"plane",plane:{uvs:t||[]}}})},setCylinder(s,t,a){n.createOrReplace(s,{mesh:{$case:"cylinder",cylinder:{radiusBottom:t,radiusTop:a}}})},setSphere(s){n.createOrReplace(s,{mesh:{$case:"sphere",sphere:{}}})}}}var vh={Move(e){return{$case:"move",move:e}},Rotate(e){return{$case:"rotate",rotate:e}},Scale(e){return{$case:"scale",scale:e}}};function Qf(e){return{...Rs(e),Mode:vh}}var _a=e=>({serialize(n,s){s.writeUint32(n.length);for(let t of n)e.serialize(t,s)},deserialize(n){let s=[],t=n.readUint32();for(let a=0;a<t;a++)s.push(e.deserialize(n));return s},create(){return[]},jsonSchema:{type:"array",items:e.jsonSchema,serializationType:"array"}});var $r={serialize(e,n){n.writeInt8(e?1:0)},deserialize(e){return e.readInt8()===1},create(){return!1},jsonSchema:{type:"boolean",serializationType:"boolean"}};var Xr={serialize(e,n){n.writeInt64(BigInt(e))},deserialize(e){return Number(e.readInt64())},create(){return 0},jsonSchema:{type:"integer",serializationType:"int64"}},uo={serialize(e,n){n.writeInt32(e)},deserialize(e){return e.readInt32()},create(){return 0},jsonSchema:{type:"integer",serializationType:"int32"}},Zr={serialize(e,n){n.writeInt16(e)},deserialize(e){return e.readInt16()},create(){return 0},jsonSchema:{type:"integer",serializationType:"int16"}},Qr={serialize(e,n){n.writeInt8(e)},deserialize(e){return e.readInt8()},create(){return 0},jsonSchema:{type:"integer",serializationType:"int8"}};var Aa={serialize(e,n){n.writeUtf8String(e)},deserialize(e){return e.readUtf8String()},create(){return""},jsonSchema:{type:"string",serializationType:"utf8-string"}},Jr=Aa;function xh(e){let t=0,a=0;for(let r in e){if(typeof e[r]=="number"){if(e[r]>2147483647||e[r]<-2147483648)throw new Error("Enum member values must be numbers within the range of -2147483648 to 2147483647.");t++}a++}if(a!==t*2)throw new Error("All enum member values must be of numeric type.")}function Eh(e){for(let n in e)if(typeof e[n]!="string")throw new Error("All enum member values must be of string type.")}var bh="enum-int",Ra=(e,n)=>(xh(e),{serialize(s,t){uo.serialize(s,t)},deserialize(s){return uo.deserialize(s)},create(){return n},jsonSchema:{type:"integer",enum:Object.values(e).filter(s=>Number.isInteger(s)),default:n,serializationType:bh,enumObject:e}}),gh="enum-string",Na=(e,n)=>(Eh(e),{serialize(s,t){Aa.serialize(s,t)},deserialize(s){return Aa.deserialize(s)},create(){return n},jsonSchema:{type:"string",enum:Object.values(e),default:n,serializationType:gh,enumObject:e}});var Tr={serialize(e,n){n.writeFloat32(e)},deserialize(e){return e.readFloat32()},create(){return 0},jsonSchema:{type:"number",serializationType:"float32"}},Kr={serialize(e,n){n.writeFloat64(e)},deserialize(e){return e.readFloat64()},create(){return 0},jsonSchema:{type:"number",serializationType:"float64"}};var ei={serialize(e,n){n.writeFloat32(e.r),n.writeFloat32(e.g),n.writeFloat32(e.b)},deserialize(e){return{r:e.readFloat32(),g:e.readFloat32(),b:e.readFloat32()}},create(){return{r:0,g:0,b:0}},jsonSchema:{type:"object",properties:{r:{type:"number"},g:{type:"number"},b:{type:"number"}},serializationType:"color3"}};var ti={serialize(e,n){n.writeFloat32(e.r),n.writeFloat32(e.g),n.writeFloat32(e.b),n.writeFloat32(e.a)},deserialize(e){return{r:e.readFloat32(),g:e.readFloat32(),b:e.readFloat32(),a:e.readFloat32()}},create(){return{r:0,g:0,b:0,a:0}},jsonSchema:{type:"object",properties:{r:{type:"number"},g:{type:"number"},b:{type:"number"},a:{type:"number"}},serializationType:"color4"}};var ni={serialize(e,n){n.writeInt32(e)},deserialize(e){return e.readInt32()},create(){return 0},jsonSchema:{type:"integer",serializationType:"entity"}};var oi={serialize(e,n){n.writeFloat32(e.x),n.writeFloat32(e.y),n.writeFloat32(e.z),n.writeFloat32(e.w)},deserialize(e){return{x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32(),w:e.readFloat32()}},create(){return{x:0,y:0,z:0,w:0}},jsonSchema:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}},serializationType:"quaternion"}};var ri={serialize(e,n){n.writeFloat32(e.x),n.writeFloat32(e.y),n.writeFloat32(e.z)},deserialize(e){return{x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32()}},create(){return{x:0,y:0,z:0}},jsonSchema:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}},serializationType:"vector3"}};var Ca=(e,n)=>{let s=Object.keys(e).reduce((t,a)=>(t[a]=e[a].jsonSchema,t),{});return{serialize(t,a){for(let r in e)e[r].serialize(t[r],a)},deserialize(t){let a={};for(let r in e)a[r]=e[r].deserialize(t);return a},create(){let t={};for(let a in e)t[a]=e[a].create();return{...t,...n}},extend:t=>{let a={};for(let r in e)a[r]=e[r].create();return{...a,...n,...t}},jsonSchema:{type:"object",properties:s,serializationType:"map"}}};var Ia=e=>({serialize(n,s){n?(s.writeInt8(1),e.serialize(n,s)):s.writeInt8(0)},deserialize(n){if(n.readInt8())return e.deserialize(n)},create(){},jsonSchema:{type:e.jsonSchema.type,serializationType:"optional",optionalJsonSchema:e.jsonSchema}});var Ba=e=>{let n=Object.keys(e),s=n.reduce((a,r,c)=>(a[r]=c,a),{}),t=n.reduce((a,r)=>(a[r]=e[r].jsonSchema,a),{});return{serialize({$case:a,value:r},c){let o=s[a.toString()]+1;c.writeUint8(o),e[a].serialize(r,c)},deserialize(a){let r=n[a.readInt8()-1],c=e[r].deserialize(a);return{$case:r,value:c}},create(){return{}},jsonSchema:{type:"object",properties:t,serializationType:"one-of"}}};var Jf=(e,n)=>n.includes(e.serializationType),Th=e=>Jf(e,["one-of"]),wh=()=>({type:{type:"object",serializationType:"unknown"},value:void 0}),Oa=e=>Jf(e,["array","map"]),Ms=(e,n,s)=>{let t=e[s],a=n[s];if(Th(t)){let r=a;if(!r.$case)return wh();let c=t.properties[r.$case];return Oa(c)&&(n[s]={[r.$case]:r.value}),{type:c,value:r.value}}return{type:t,value:a}};var Kf={[$r.jsonSchema.serializationType]:$r,[Jr.jsonSchema.serializationType]:Jr,[Tr.jsonSchema.serializationType]:Tr,[Kr.jsonSchema.serializationType]:Kr,[Qr.jsonSchema.serializationType]:Qr,[Zr.jsonSchema.serializationType]:Zr,[uo.jsonSchema.serializationType]:uo,[Xr.jsonSchema.serializationType]:Xr,[ri.jsonSchema.serializationType]:ri,[oi.jsonSchema.serializationType]:oi,[ei.jsonSchema.serializationType]:ei,[ti.jsonSchema.serializationType]:ti,[ni.jsonSchema.serializationType]:ni};function wr(e){if(Kf[e.serializationType])return Kf[e.serializationType];if(e.serializationType==="map"){let n=e,s={};for(let t in n.properties)s[t]=wr(n.properties[t]);return Ca(s)}if(e.serializationType==="optional")return Ia(wr(e.optionalJsonSchema));if(e.serializationType==="array")return _a(wr(e.items));if(e.serializationType==="enum-int"){let n=e;return Ra(n.enumObject,n.default)}if(e.serializationType==="enum-string"){let n=e;return Na(n.enumObject,n.default)}if(e.serializationType==="one-of"){let n=e,s={};for(let t in n.properties)s[t]=wr(n.properties[t]);return Ba(s)}throw new Error(`${e.serializationType} is not supported as reverse schema generation.`)}function ka(e,n,s){if(e.serializationType==="map"){let{properties:t}=e,a=n;for(let r in t){let{type:c,value:o}=Ms(t,a,r);if(c.serializationType!=="unknown")if(Oa(c))ka(c,o,s);else{let i=s(o,c);i.changed&&(a[r]=i.value)}}}else if(e.serializationType==="array"){let{items:t}=e,a=n;for(let r=0,c=a.length;r<c;r++){let{type:o,value:i}=Ms({items:t},{items:a[r]},"items");if(Oa(o))ka(o,i,s);else{let u=s(i,o);u.changed&&(a[r]=u.value)}}}}var Z;(function(e){e.Boolean=$r,e.String=Jr,e.Float=Tr,e.Double=Kr,e.Byte=Qr,e.Short=Zr,e.Int=uo,e.Int64=Xr,e.Number=Tr,e.Vector3=ri,e.Quaternion=oi,e.Color3=ei,e.Color4=ti,e.Entity=ni,e.EnumNumber=Ra,e.EnumString=Na,e.Array=_a,e.Map=Ca,e.Optional=Ia,e.OneOf=Ba,e.fromJson=wr,e.mutateNestedValues=ka})(Z||(Z={}));function Sh(e){return e.defineComponent("core-schema::Name",{value:Z.String})}var el=Sh;var Ps={serialize(e,n){let s=n.incrementWriteOffset(44);n.setFloat32(s,e.position.x),n.setFloat32(s+4,e.position.y),n.setFloat32(s+8,e.position.z),n.setFloat32(s+12,e.rotation.x),n.setFloat32(s+16,e.rotation.y),n.setFloat32(s+20,e.rotation.z),n.setFloat32(s+24,e.rotation.w),n.setFloat32(s+28,e.scale.x),n.setFloat32(s+32,e.scale.y),n.setFloat32(s+36,e.scale.z),n.setUint32(s+40,e.parent||0)},deserialize(e){let n=e.incrementReadOffset(44);return{position:{x:e.getFloat32(n),y:e.getFloat32(n+4),z:e.getFloat32(n+8)},rotation:{x:e.getFloat32(n+12),y:e.getFloat32(n+16),z:e.getFloat32(n+20),w:e.getFloat32(n+24)},scale:{x:e.getFloat32(n+28),y:e.getFloat32(n+32),z:e.getFloat32(n+36)},parent:e.getUint32(n+40)}},create(){return{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1},parent:0}},extend(e){return{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1},parent:0,...e}},jsonSchema:{type:"object",properties:{position:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},scale:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},rotation:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}}},parent:{type:"integer"}},serializationType:"transform"}};function tl(e){let n=e.defineComponentFromSchema("core::Transform",Ps);return{...n,create(s,t){return n.create(s,Ps.extend(t))},createOrReplace(s,t){return n.createOrReplace(s,Ps.extend(t))}}}var Co=e=>tl(e),nl=e=>Xf(e),ol=e=>$f(e),rl=e=>Zf(e);var zs=e=>Qf(e),Ma=e=>el(e);var Fs={"core::Transform":1,"core::Animator":1042,"core::AudioSource":1020,"core::AudioStream":1021,"core::AvatarAttach":1073,"core::AvatarBase":1087,"core::AvatarEmoteCommand":1088,"core::AvatarEquippedData":1091,"core::AvatarModifierArea":1070,"core::AvatarShape":1080,"core::Billboard":1090,"core::CameraMode":1072,"core::CameraModeArea":1071,"core::EngineInfo":1048,"core::GltfContainer":1041,"core::GltfContainerLoadingState":1049,"core::Material":1017,"core::MeshCollider":1019,"core::MeshRenderer":1018,"core::NftShape":1040,"core::PlayerIdentityData":1089,"core::PointerEvents":1062,"core::PointerEventsResult":1063,"core::PointerLock":1074,"core::Raycast":1067,"core::RaycastResult":1068,"core::TextShape":1030,"core::Tween":1102,"core::TweenSequence":1104,"core::TweenState":1103,"core::UiBackground":1053,"core::UiCanvasInformation":1054,"core::UiDropdown":1094,"core::UiDropdownResult":1096,"core::UiInput":1093,"core::UiInputResult":1095,"core::UiText":1052,"core::UiTransform":1050,"core::VideoEvent":1044,"core::VideoPlayer":1043,"core::VisibilityComponent":1081};var al=Ze(Ti());var _h=new Int32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function Ah(e,n){let s=~~n^-1;for(let t=0;t<e.length;t++)s=_h[(s^e[t])&255]^s>>>8;return s^-1}function il(e,n=0){return Ah(e,n)>>>0}var Ls=2048;function Gn(e){if(Fs[e])return Fs[e];let n=new Uint8Array(128);return al.write(e,n,0),(il(n)+Ls&4294967295)>>>0}var Us=typeof process=="object"&&!1||!1;function ii(e,n){if(Us&&e&&typeof e=="object"&&typeof e.then=="function")throw new Error(n);return e}function sl(){let e=new Map;return{addTo(n,s){if(s<0)return!1;let t=e.get(n);return t!==void 0&&t>=s||e.set(n,s),!0},has(n,s){let t=e.get(n);return t!==void 0&&t>=s},getMap(){return e}}}var Io=65535,Rh=4294901760,Ux=Io+1,Ds=Io,Pa=512,Nh=Ds,Fn;(function(e){function n(t){return[(t&Io)>>>0,((t&Rh)>>16&Io)>>>0]}e.fromEntityId=n;function s(t,a){return(t&Io|(a&Io)<<16)>>>0}e.toEntityId=s})(Fn||(Fn={}));var Wt;(function(e){e[e.Unknown=0]="Unknown",e[e.UsedEntity=1]="UsedEntity",e[e.Removed=2]="Removed",e[e.Reserved=3]="Reserved"})(Wt||(Wt={}));function cl(){let e=Pa,n,s,t=new Set,a=[],r=sl(),c=Nh;function o(d,v){c=d,s=v,n=v[0]}function i(d){if(e>Ds-1)throw new Error(`It fails trying to generate an entity out of range ${Ds}.`);if(d&&n>s[1])throw new Error(`Max amount of network entities reached ${s[1]} `);if(!d&&e>=c)throw new Error(`Max amount of local entities reached ${c}`);let v=d?n++:e++,p=r.getMap().has(v)?r.getMap().get(v)+1:0,x=Fn.toEntityId(v,p);return t.has(x)?i():(t.add(x),x)}function u(d){if(d&&!s)throw new Error("Network entities ranged not initialized. Connect to a CRDT Server");let v=(s&&[...t.values()].filter(x=>{let[b]=Fn.fromEntityId(x);return b>=s[0]&&b<=s[1]}).length)??0,p=t.size-v;if(!d&&p+Pa>=e||d&&v+s[0]>=n)return i(d);for(let[x,b]of r.getMap())if(b<Io){if(d&&(x<s[0]||x>s[1])||!d&&x>=c)continue;let O=Fn.toEntityId(x,b+1);if(!t.has(O)&&!a.includes(O))return t.add(O),O}return i(d)}function h(d){return d<Pa?!1:(t.has(d)?(t.delete(d),a.push(d)):f(d),!0)}function m(){let d=a;if(d.length){a=[];for(let v of d){let[p,x]=Fn.fromEntityId(v);r.addTo(p,x)}}return d}function f(d){let[v,p]=Fn.fromEntityId(d);r.addTo(v,p);for(let x=0;x<=p;x++)t.delete(Fn.toEntityId(v,x));return!0}function y(d){let[v,p]=Fn.fromEntityId(d);if(r.has(v,p))return!1;if(p>0){for(let x=0;x<=p-1;x++)t.delete(Fn.toEntityId(v,x));r.addTo(v,p-1)}return t.add(d),!0}function l(d){let[v,p]=Fn.fromEntityId(d);if(v<Pa)return Wt.Reserved;if(t.has(d))return Wt.UsedEntity;let x=r.getMap().get(v);return x!==void 0&&x>=p?Wt.Removed:Wt.Unknown}return{setNetworkEntitiesRange:o,generateEntity:u,removeEntity:h,getExistingEntities(){return new Set(t)},getEntityState:l,releaseRemovedEntities:m,updateRemovedEntity:f,updateUsedEntity:y}}var Sr=Ze(Ti()),pt=function(e,n,s,t){if(s==="a"&&!t)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?e!==n||!t:!n.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?t:s==="a"?t.call(e):t?t.value:n.get(e)},ut,hn,Qt;function Ch(e,n){let s=Math.max(e,n)+1024;return Math.ceil(s/1024)*1024}var Ih=10240,Lt=class{constructor(n,s,t){ut.add(this),this._buffer=n||new Uint8Array(Ih),this.view=new DataView(this._buffer.buffer,this._buffer.byteOffset),this.woffset=t??(n?this._buffer.length:null)??0,this.roffset=s??0}buffer(){return this._buffer}bufferLength(){return this._buffer.length}resetBuffer(){this.roffset=0,this.woffset=0}currentReadOffset(){return this.roffset}currentWriteOffset(){return this.woffset}incrementReadOffset(n){return pt(this,ut,"m",Qt).call(this,n)}remainingBytes(){return this.woffset-this.roffset}readFloat32(){return this.view.getFloat32(pt(this,ut,"m",Qt).call(this,4),!0)}readFloat64(){return this.view.getFloat64(pt(this,ut,"m",Qt).call(this,8),!0)}readInt8(){return this.view.getInt8(pt(this,ut,"m",Qt).call(this,1))}readInt16(){return this.view.getInt16(pt(this,ut,"m",Qt).call(this,2),!0)}readInt32(){return this.view.getInt32(pt(this,ut,"m",Qt).call(this,4),!0)}readInt64(){return this.view.getBigInt64(pt(this,ut,"m",Qt).call(this,8),!0)}readUint8(){return this.view.getUint8(pt(this,ut,"m",Qt).call(this,1))}readUint16(){return this.view.getUint16(pt(this,ut,"m",Qt).call(this,2),!0)}readUint32(){return this.view.getUint32(pt(this,ut,"m",Qt).call(this,4),!0)}readUint64(){return this.view.getBigUint64(pt(this,ut,"m",Qt).call(this,8),!0)}readBuffer(){let n=this.view.getUint32(pt(this,ut,"m",Qt).call(this,4),!0);return this._buffer.subarray(pt(this,ut,"m",Qt).call(this,n),pt(this,ut,"m",Qt).call(this,0))}readUtf8String(){let n=this.view.getUint32(pt(this,ut,"m",Qt).call(this,4),!0);return Sr.read(this._buffer,pt(this,ut,"m",Qt).call(this,n),pt(this,ut,"m",Qt).call(this,0))}incrementWriteOffset(n){return pt(this,ut,"m",hn).call(this,n)}toBinary(){return this._buffer.subarray(0,this.woffset)}toCopiedBinary(){return new Uint8Array(this.toBinary())}writeBuffer(n,s=!0){s&&this.writeUint32(n.byteLength);let t=pt(this,ut,"m",hn).call(this,n.byteLength);this._buffer.set(n,t)}writeUtf8String(n,s=!0){let t=Sr.length(n);s&&this.writeUint32(t);let a=pt(this,ut,"m",hn).call(this,t);Sr.write(n,this._buffer,a)}writeFloat32(n){let s=pt(this,ut,"m",hn).call(this,4);this.view.setFloat32(s,n,!0)}writeFloat64(n){let s=pt(this,ut,"m",hn).call(this,8);this.view.setFloat64(s,n,!0)}writeInt8(n){let s=pt(this,ut,"m",hn).call(this,1);this.view.setInt8(s,n)}writeInt16(n){let s=pt(this,ut,"m",hn).call(this,2);this.view.setInt16(s,n,!0)}writeInt32(n){let s=pt(this,ut,"m",hn).call(this,4);this.view.setInt32(s,n,!0)}writeInt64(n){let s=pt(this,ut,"m",hn).call(this,8);this.view.setBigInt64(s,n,!0)}writeUint8(n){let s=pt(this,ut,"m",hn).call(this,1);this.view.setUint8(s,n)}writeUint16(n){let s=pt(this,ut,"m",hn).call(this,2);this.view.setUint16(s,n,!0)}writeUint32(n){let s=pt(this,ut,"m",hn).call(this,4);this.view.setUint32(s,n,!0)}writeUint64(n){let s=pt(this,ut,"m",hn).call(this,8);this.view.setBigUint64(s,n,!0)}getFloat32(n){return this.view.getFloat32(n,!0)}getFloat64(n){return this.view.getFloat64(n,!0)}getInt8(n){return this.view.getInt8(n)}getInt16(n){return this.view.getInt16(n,!0)}getInt32(n){return this.view.getInt32(n,!0)}getInt64(n){return this.view.getBigInt64(n,!0)}getUint8(n){return this.view.getUint8(n)}getUint16(n){return this.view.getUint16(n,!0)}getUint32(n){return this.view.getUint32(n,!0)}getUint64(n){return this.view.getBigUint64(n,!0)}setFloat32(n,s){this.view.setFloat32(n,s,!0)}setFloat64(n,s){this.view.setFloat64(n,s,!0)}setInt8(n,s){this.view.setInt8(n,s)}setInt16(n,s){this.view.setInt16(n,s,!0)}setInt32(n,s){this.view.setInt32(n,s,!0)}setInt64(n,s){this.view.setBigInt64(n,s,!0)}setUint8(n,s){this.view.setUint8(n,s)}setUint16(n,s){this.view.setUint16(n,s,!0)}setUint32(n,s){this.view.setUint32(n,s,!0)}setUint64(n,s){this.view.setBigUint64(n,s,!0)}};ut=new WeakSet,hn=function(n){if(this.woffset+n>this._buffer.byteLength){let s=Ch(this._buffer.byteLength,this.woffset+n),t=new Uint8Array(s);t.set(this._buffer);let a=this._buffer.byteOffset;this._buffer=t,this.view=new DataView(this._buffer.buffer,a)}return this.woffset+=n,this.woffset-n},Qt=function(n){if(this.roffset+n>this.woffset)throw new Error("Outside of the bounds of writen data.");return this.roffset+=n,this.roffset-n};var et;(function(e){e[e.RESERVED=0]="RESERVED",e[e.PUT_COMPONENT=1]="PUT_COMPONENT",e[e.DELETE_COMPONENT=2]="DELETE_COMPONENT",e[e.DELETE_ENTITY=3]="DELETE_ENTITY",e[e.APPEND_VALUE=4]="APPEND_VALUE",e[e.MAX_MESSAGE_TYPE=5]="MAX_MESSAGE_TYPE"})(et||(et={}));var Cn=8,wn;(function(e){e[e.StateUpdatedTimestamp=1]="StateUpdatedTimestamp",e[e.StateOutdatedTimestamp=2]="StateOutdatedTimestamp",e[e.NoChanges=3]="NoChanges",e[e.StateOutdatedData=4]="StateOutdatedData",e[e.StateUpdatedData=5]="StateUpdatedData",e[e.EntityWasDeleted=6]="EntityWasDeleted",e[e.EntityDeleted=7]="EntityDeleted"})(wn||(wn={}));var In;(function(e){function n(r){let c=r.remainingBytes();if(c<Cn)return!1;let o=r.getUint32(r.currentReadOffset());return!(c<o)}e.validate=n;function s(r){return n(r)?{length:r.readUint32(),type:r.readUint32()}:null}e.readHeader=s;function t(r){if(!n(r))return null;let c=r.currentReadOffset();return{length:r.getUint32(c),type:r.getUint32(c+4)}}e.getHeader=t;function a(r){let c=t(r);return c?(r.incrementReadOffset(c.length),!0):!1}e.consumeMessage=a})(In||(In={}));var fo;(function(e){e.MESSAGE_HEADER_LENGTH=12;function n(t,a,r,c){let o=Cn+e.MESSAGE_HEADER_LENGTH,i=c.incrementWriteOffset(o);c.setUint32(i,o),c.setUint32(i+4,et.DELETE_COMPONENT),c.setUint32(i+8,t),c.setUint32(i+12,a),c.setUint32(i+16,r)}e.write=n;function s(t){let a=In.readHeader(t);if(!a)return null;if(a.type!==et.DELETE_COMPONENT)throw new Error("DeleteComponentOperation tried to read another message type.");return{...a,entityId:t.readUint32(),componentId:t.readUint32(),timestamp:t.readUint32()}}e.read=s})(fo||(fo={}));var Bo;(function(e){e.MESSAGE_HEADER_LENGTH=16;function n(t,a,r,c,o){let i=o.incrementWriteOffset(Cn+e.MESSAGE_HEADER_LENGTH);o.writeBuffer(c,!1);let u=o.currentWriteOffset()-i;o.setUint32(i,u),o.setUint32(i+4,et.APPEND_VALUE),o.setUint32(i+8,t),o.setUint32(i+12,r),o.setUint32(i+16,a);let h=u-e.MESSAGE_HEADER_LENGTH-Cn;o.setUint32(i+20,h)}e.write=n;function s(t){let a=In.readHeader(t);if(!a)return null;if(a.type!==et.APPEND_VALUE)throw new Error("AppendValueOperation tried to read another message type.");return{...a,entityId:t.readUint32(),componentId:t.readUint32(),timestamp:t.readUint32(),data:t.readBuffer()}}e.read=s})(Bo||(Bo={}));var ai;(function(e){e.MESSAGE_HEADER_LENGTH=4;function n(t,a){a.writeUint32(Cn+4),a.writeUint32(et.DELETE_ENTITY),a.writeUint32(t)}e.write=n;function s(t){let a=In.readHeader(t);if(!a)return null;if(a.type!==et.DELETE_ENTITY)throw new Error("DeleteEntity tried to read another message type.");return{...a,entityId:t.readUint32()}}e.read=s})(ai||(ai={}));var lo;(function(e){e.MESSAGE_HEADER_LENGTH=16;function n(t,a,r,c,o){let i=o.incrementWriteOffset(Cn+e.MESSAGE_HEADER_LENGTH);o.writeBuffer(c,!1);let u=o.currentWriteOffset()-i;o.setUint32(i,u),o.setUint32(i+4,et.PUT_COMPONENT),o.setUint32(i+8,t),o.setUint32(i+12,r),o.setUint32(i+16,a);let h=u-e.MESSAGE_HEADER_LENGTH-Cn;o.setUint32(i+20,h)}e.write=n;function s(t){let a=In.readHeader(t);if(!a)return null;if(a.type!==et.PUT_COMPONENT)throw new Error("PutComponentOperation tried to read another message type.");return{...a,entityId:t.readUint32(),componentId:t.readUint32(),timestamp:t.readUint32(),data:t.readBuffer()}}e.read=s})(lo||(lo={}));function ul(e,n){let s=[],t=[],a=[],r=[];function c(m){return function(y){let l=new Lt(y),d;for(;d=In.getHeader(l);){let v=l.currentReadOffset();if(d.type===et.DELETE_COMPONENT){let p=fo.read(l);t.push({...p,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else if(d.type===et.PUT_COMPONENT){let p=lo.read(l);t.push({...p,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else if(d.type===et.DELETE_ENTITY){let p=ai.read(l);t.push({...p,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else if(d.type===et.APPEND_VALUE){let p=Bo.read(l);t.push({...p,transportId:m,messageBuffer:l.buffer().subarray(v,l.currentReadOffset())})}else l.incrementReadOffset(d.length)}}}function o(m){return m.splice(0,m.length)}async function i(){let m=o(t),f=new Lt,y=[];for(let l of m)if(l.type===et.DELETE_ENTITY)y.push(l.entityId),a.push(l);else{let d=e.entityContainer.getEntityState(l.entityId);if(d===Wt.Removed)continue;d===Wt.Unknown&&e.entityContainer.updateUsedEntity(l.entityId);let v=e.getComponentOrNull(l.componentId);if(v){let[p,x]=v.updateFromCrdt(l);if(p){let b=f.currentWriteOffset();p.type===et.PUT_COMPONENT?lo.write(l.entityId,p.timestamp,p.componentId,p.data,f):p.type===et.DELETE_COMPONENT&&fo.write(l.entityId,v.componentId,p.timestamp,f),r.push({...l,messageBuffer:f.buffer().subarray(b,f.currentWriteOffset())})}else a.push(l),n&&n(l.entityId,l.type,v,x)}else a.push(l)}for(let l of y){for(let d=r.length-1;d>=0;d--)r[d].entityId===l&&r[d].type!==et.DELETE_ENTITY&&r.splice(d,1);for(let d of e.componentsIter())d.entityDeleted(l,!0);e.entityContainer.updateRemovedEntity(l),n&&n(l,et.DELETE_ENTITY)}}async function u(m){let f=o(a),y=o(r),l=new Lt;for(let v of e.componentsIter())for(let p of v.getCrdtUpdates()){let x=l.currentWriteOffset();if(s.some(b=>b.filter(p))&&(p.type===et.PUT_COMPONENT?lo.write(p.entityId,p.timestamp,p.componentId,p.data,l):p.type===et.DELETE_COMPONENT?fo.write(p.entityId,v.componentId,p.timestamp,l):p.type===et.APPEND_VALUE&&Bo.write(p.entityId,p.timestamp,p.componentId,p.data,l),f.push({...p,messageBuffer:l.buffer().subarray(x,l.currentWriteOffset())}),n)){let b=p.type===et.PUT_COMPONENT||p.type===et.APPEND_VALUE?v.get(p.entityId):void 0;n(p.entityId,p.type,v,b)}}for(let v of m){let p=l.currentWriteOffset();ai.write(v,l),f.push({type:et.DELETE_ENTITY,entityId:v,messageBuffer:l.buffer().subarray(p,l.currentWriteOffset())}),n&&n(v,et.DELETE_ENTITY)}let d=new Lt;for(let v in s){let p=Number(v),x=s[p];d.resetBuffer();for(let O of y)O.transportId===p&&!f.find(N=>N.entityId===O.entityId&&N.componentId&&N.componentId===O.componentId)&&d.writeBuffer(O.messageBuffer,!1);for(let O of f)O.transportId!==p&&x.filter(O)&&d.writeBuffer(O.messageBuffer,!1);let b=d.currentWriteOffset()?d.toBinary():new Uint8Array([]);await x.send(b)}}function h(m){let f=s.push(m)-1;m.onmessage=c(f)}return{sendMessages:u,receiveMessages:i,addTransport:h}}var fl;(function(e){let n;(function(s){s[s.NETWORKED=0]="NETWORKED",s[s.RENDERER=1]="RENDERER"})(n=e.SynchronizedEntityType||(e.SynchronizedEntityType={}))})(fl||(fl={}));function si(e,n){if(e===n)return 0;if(e===null&&n!==null)return-1;if(e!==null&&n===null)return 1;if(e instanceof Uint8Array&&n instanceof Uint8Array){let s=e.byteLength-n.byteLength;if(s!==0)return s>0?1:-1;let t;for(let a=0,r=e.byteLength;a<r;a++)if(t=e[a]-n[a],t!==0)return t>0?1:-1;return 0}if(typeof e=="string"){let s=e.length-n.length;return s!==0?s>0?1:-1:e.localeCompare(n)}return e>n?1:-1}function Vs(e){return Object.freeze({...e})}function Bh(e,n){let s=(n.get(e)||0)+1;return n.set(e,s),s}function Oh(e,n,s,t){return function(r,c){for(let[o,i]of n)if(!(c&&!c(o)))if(t.has(o)){let u=t.get(o),h=new Lt;s.serialize(u,h),lo.write(o,i,e,h.toBinary(),r)}else fo.write(o,e,i,r)}}function kh(e,n,s,t){function a(r){let{entityId:c,timestamp:o}=r,i=n.get(c);if(i===void 0||i<o)return wn.StateUpdatedTimestamp;if(i>o)return wn.StateOutdatedTimestamp;if(r.type===et.DELETE_COMPONENT&&!t.has(c))return wn.NoChanges;let u=0;if(t.has(c)){let h=new Lt;s.serialize(t.get(c),h),u=si(h.toBinary(),r.data||null)}else u=si(null,r.data);return u===0?wn.NoChanges:u>0?wn.StateOutdatedData:wn.StateUpdatedData}return r=>{if(r.type!==et.PUT_COMPONENT&&r.type!==et.DELETE_COMPONENT)return[null,t.get(r.entityId)];let c=a(r),o=r.entityId;switch(c){case wn.StateUpdatedData:case wn.StateUpdatedTimestamp:{if(n.set(o,r.timestamp),r.type===et.PUT_COMPONENT){let i=new Lt(r.data);t.set(o,s.deserialize(i))}else t.delete(o);return[null,t.get(o)]}case wn.StateOutdatedTimestamp:case wn.StateOutdatedData:if(t.has(o)){let i=new Lt;return s.serialize(t.get(o),i),[{type:et.PUT_COMPONENT,componentId:e,data:i.toBinary(),entityId:o,timestamp:n.get(o)},t.get(o)]}else return[{type:et.DELETE_COMPONENT,componentId:e,entityId:o,timestamp:n.get(o)},void 0]}return[null,t.get(o)]}}function Mh(e,n,s,t,a){return function*(){for(let r of s){let c=Bh(r,n);if(a.has(r)){let o=new Lt;t.serialize(a.get(r),o),yield{type:et.PUT_COMPONENT,componentId:e,entityId:r,data:o.toBinary(),timestamp:c}}else yield{type:et.DELETE_COMPONENT,componentId:e,entityId:r,timestamp:c}}s.clear()}}function Ws(e,n,s){let t=new Map,a=new Set,r=new Map;return{get componentId(){return n},get componentName(){return e},get componentType(){return 0},schema:s,has(c){return t.has(c)},deleteFrom(c,o=!0){let i=t.get(c);return t.delete(c)&&o&&a.add(c),i||null},entityDeleted(c,o){t.delete(c)&&o&&a.add(c)},getOrNull(c){let o=t.get(c);return o?Vs(o):null},get(c){let o=t.get(c);if(!o)throw new Error(`[getFrom] Component ${e} for entity #${c} not found`);return Vs(o)},create(c,o){if(t.get(c))throw new Error(`[create] Component ${e} for ${c} already exists`);let u=o===void 0?s.create():s.extend?s.extend(o):o;return t.set(c,u),a.add(c),u},createOrReplace(c,o){let i=o===void 0?s.create():s.extend?s.extend(o):o;return t.set(c,i),a.add(c),i},getMutableOrNull(c){let o=t.get(c);return o?(a.add(c),o):null},getOrCreateMutable(c,o){let i=t.get(c);return i?(a.add(c),i):this.create(c,o)},getMutable(c){let o=this.getMutableOrNull(c);if(o===null)throw new Error(`[mutable] Component ${e} for ${c} not found`);return o},*iterator(){for(let[c,o]of t)yield[c,o]},*dirtyIterator(){for(let c of a)yield c},getCrdtUpdates:Mh(n,r,a,s,t),updateFromCrdt:kh(n,r,s,t),dumpCrdtStateToBuffer:Oh(n,r,s,t)}}function ll(){let e=[];function n(){e.sort((a,r)=>r.priority-a.priority)}function s(a,r,c){let o=c??a.name;if(e.find(i=>i.fn===a))throw new Error(`System ${JSON.stringify(o)} already added to the engine`);e.push({fn:a,priority:r,name:o}),n()}function t(a){let r=-1;return typeof a=="string"?r=e.findIndex(c=>c.name===a):r=e.findIndex(c=>c.fn===a),r===-1?!1:(e.splice(r,1),n(),!0)}return{add:s,remove:t,getSystems(){return e}}}var qs=pl(new Set);function dl(){throw new Error("The set is frozen")}function pl(e){return e.add=dl,e.clear=dl,e}function Ph(e,n){return e.timestamp>n.timestamp?1:-1}function hl(e,n,s,t){let a=new Map,r=new Set,c=[];function o(m){let f=m.raw.length;return f>1&&m.raw[f-1].timestamp<=m.raw[f-2].timestamp}function i(m){let f=a.get(m);if(f){for(o(f)&&f.raw.sort(Ph);f.raw.length>t.maxElements;)f.raw.shift();let y=pl(new Set(f?.raw.map(l=>l.value)));return f.frozenSet=y,y}else return qs}function u(m,f){let y=a.get(m);y||(y={raw:[],frozenSet:qs},a.set(m,y));let l=s.extend?s.extend(f):f,d=t.timestampFunction(l);return Us&&Object.freeze(l),y.raw.push({value:l,timestamp:d}),{set:i(m),value:l}}return{get componentId(){return n},get componentName(){return e},get componentType(){return 1},schema:s,has(m){return a.has(m)},entityDeleted(m){a.delete(m)},get(m){let f=a.get(m);return f?f.frozenSet:qs},addValue(m,f){let{set:y,value:l}=u(m,f);r.add(m);let d=new Lt;return s.serialize(l,d),c.push({componentId:n,data:d.toBinary(),entityId:m,timestamp:0,type:et.APPEND_VALUE}),y},*iterator(){for(let[m,f]of a)yield[m,f.frozenSet]},*dirtyIterator(){for(let m of r)yield m},getCrdtUpdates(){return r.clear(),c.splice(0,c.length)},updateFromCrdt(m){if(m.type===et.APPEND_VALUE){let f=new Lt(m.data);u(m.entityId,s.deserialize(f))}return[null,void 0]},dumpCrdtStateToBuffer:function(m,f){for(let[y,{raw:l}]of a)if(!(f&&!f(y)))for(let d of l){let v=new Lt;s.serialize(d.value,v),Bo.write(y,0,n,v.toBinary(),m)}}}}function*ml(e,n){if(n.has(e)){n.delete(e);for(let[s,t]of n)t.parent===e&&(yield*ml(s,n));yield e}}function zh(e,n,s){let t=new Map(e.getEntitiesWith(s));return ml(n,t)}function yl(e,n){let s=Co(e);for(let t of zh(e,n,s))e.removeEntity(t)}var vl=[0,1,2,4,5,6,7,8,9,10,11,12,13],Fh=1<<20;function xl(e){let n=ga(e),s={previousFrameMaxTimestamp:0,currentFrameMaxTimestamp:0,buttonState:new Map,thisFrameCommands:[]};function t(d,v,p){let x=n.get(p);for(let b of Array.from(x).reverse())if(b.button===v&&b.state===d)return b}function*a(d,v){let p=n.get(v);for(let x of Array.from(p).reverse())x.button===d&&(yield x)}function r(){let d=s.currentFrameMaxTimestamp;s.previousFrameMaxTimestamp=d,s.thisFrameCommands.length&&(s.thisFrameCommands=[]);for(let[,v]of e.getEntitiesWith(n)){let p=Array.from(v);for(let x=p.length-1;x>=0;x--){let b=p[x];if(b.timestamp>d&&(d=b.timestamp),b.timestamp>s.previousFrameMaxTimestamp&&s.thisFrameCommands.push(b),b.state===0||b.state===1){let O=s.buttonState.get(b.button);if(!O||b.timestamp>O.timestamp)s.buttonState.set(b.button,b);else break}}}s.currentFrameMaxTimestamp=d}e.addSystem(r,Fh,"@dcl/ecs#inputSystem");function c(d){return d>s.previousFrameMaxTimestamp&&d<=s.currentFrameMaxTimestamp}function o(d,v){if(d!==3)return i(d,v);for(let p of vl){let x=i(p,v);if(x)return x}return null}function i(d,v){let p=null,x=null;for(let b of a(d,v))if(x){if(!p&&b.state===1){p=b;break}}else if(b.state===0){x=b;continue}return!x||!p?null:p.timestamp<x.timestamp&&c(x.timestamp)?{up:x,down:p}:null}function u(d,v,p){if(d!==3)return m(d,v,p);for(let x of vl){let b=m(x,v,p);if(b)return b}return null}function h(d,v,p){if(p)return u(d,v,p);for(let x of s.thisFrameCommands)if((x.button===d||d===3)&&x.state===v)return x;return null}function m(d,v,p){let x=t(v,d,p);return x&&c(x.timestamp)?x:null}function f(d,v){return o(d,v)!==null}function y(d,v,p){if(p){let x=t(v,d,p);return x&&c(x.timestamp)||!1}else{for(let x of s.thisFrameCommands)if((x.button===d||d===3)&&x.state===v)return!0;return!1}}function l(d){return s.buttonState.get(d)?.state===1}return{isPressed:l,getClick:o,getInputCommand:h,isClicked:f,isTriggered:y}}var El;(function(e){e[e.LastWriteWinElementSet=0]="LastWriteWinElementSet",e[e.GrowOnlyValueSet=1]="GrowOnlyValueSet"})(El||(El={}));function Uh(){let e=cl(),n=new Map,s=ll(),t,a=!1;function r(q,Q=1e5,w){s.add(q,Q,w)}function c(q){return s.remove(q)}function o(){if(!t)throw new Error("Network manager not initialized. Start CRDT Server");return t}function i(q,Q){return e.setNetworkEntitiesRange(q,Q),t={addEntity:()=>e.generateEntity(!0)},t}function u(){return e.generateEntity()}function h(q){for(let[,Q]of n)Q.entityDeleted(q,!0);return e.removeEntity(q)}function m(q){return yl({removeEntity:h,defineComponentFromSchema:y,getEntitiesWith:x},q)}function f(q,Q){if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let w=Gn(q);if(n.get(w))throw new Error(`Component number ${w} was already registered.`);if(Q.componentName!==q)throw new Error(`Component name doesn't match componentDefinition.componentName ${q} != ${Q.componentName}`);if(Q.componentId!==w)throw new Error(`Component number doesn't match componentDefinition.componentId ${w} != ${Q.componentId}`);return n.set(w,Q),Q}function y(q,Q){let w=Gn(q),k=n.get(w);if(k)return k;if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let V=Ws(q,w,Q);return n.set(w,V),V}function l(q,Q,w){let k=Gn(q),V=n.get(k);if(V)return V;if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let K=hl(q,k,Q,w);return n.set(k,K),K}function d(q,Q,w){let k=Gn(q),V=n.get(k);if(V)return V;if(a)throw new Error("Engine is already sealed. No components can be added at this stage");let K=Z.Map(Q,w),H=Ws(q,k,K),oe={...H,create(ie,ue){return H.create(ie,ue)},createOrReplace(ie,ue){return H.createOrReplace(ie,ue)}};return n.set(k,oe),oe}function v(q){let Q=typeof q=="number"?q:Gn(q),w=n.get(Q);if(!w)throw new Error(`Component ${Q} not found. You need to declare the components at the beginnig of the engine declaration`);return w}function p(q){let Q=typeof q=="number"?q:Gn(q);return n.get(Q)??null}function*x(...q){for(let[Q,...w]of O(...q))yield[Q,...w.map(k=>k.get(Q))]}function b(q){let Q=Ma({defineComponent:d});for(let[w,k]of x(Q))if(k.value===q)return w;return null}function*O(...q){let[Q,...w]=q;for(let[k]of Q.iterator()){let V=!0;for(let K of w)if(!K.has(k)){V=!1;break}V&&(yield[k,...q])}}function N(){return s.getSystems()}function _(){return n.values()}function P(q){if(a)throw new Error("Engine is already sealed. No components can be removed at this stage");let Q=typeof q=="number"?q:Gn(q);n.delete(Q)}Co({defineComponentFromSchema:y});function M(){a||(a=!0)}return{addEntity:u,removeEntity:h,removeEntityWithChildren:m,addSystem:r,getSystems:N,removeSystem:c,defineComponent:d,defineComponentFromSchema:y,defineValueSetComponentFromSchema:l,getEntitiesWith:x,getComponent:v,getComponentOrNull:p,getEntityOrNullByName:b,removeComponentDefinition:P,registerComponentDefinition:f,entityContainer:e,componentsIter:_,seal:M,addNetworkManager:i,getNetworkManager:o}}function bl(e){let n=Uh(),s=ul(n,e?.onChangeFunction||null);async function t(a){await s.receiveMessages();for(let c of n.getSystems()){let o=c.fn(a);ii(o,`A system (${c.name||"anonymous"}) returned a thenable. Systems cannot be async functions. Documentation: https://dcl.gg/sdk/sync-systems`)}let r=n.entityContainer.releaseRemovedEntities();await s.sendMessages(r)}return{addEntity:n.addEntity,removeEntity:n.removeEntity,removeEntityWithChildren:n.removeEntityWithChildren,addSystem:n.addSystem,removeSystem:n.removeSystem,defineComponent:n.defineComponent,defineComponentFromSchema:n.defineComponentFromSchema,defineValueSetComponentFromSchema:n.defineValueSetComponentFromSchema,registerComponentDefinition:n.registerComponentDefinition,getEntitiesWith:n.getEntitiesWith,getComponent:n.getComponent,getComponentOrNull:n.getComponentOrNull,removeComponentDefinition:n.removeComponentDefinition,componentsIter:n.componentsIter,seal:n.seal,getEntityOrNullByName:n.getEntityOrNullByName,update:t,RootEntity:0,PlayerEntity:1,CameraEntity:2,getEntityState:n.entityContainer.getEntityState,addTransport:s.addTransport,entityContainer:n.entityContainer,addNetworkManager:n.addNetworkManager,getNetworkManager:n.getNetworkManager}}function gl(e,n){let s=jr(e),t;(function(y){y[y.Click=0]="Click",y[y.Down=1]="Down",y[y.Up=2]="Up"})(t||(t={}));let a=(y={})=>({button:3,...y}),r=new Map;function c(y){return r.get(y)||r.set(y,new Map).get(y)}function o(y,l,d){(d.hoverText||d.showFeedback)&&(s.getMutableOrNull(y)||s.create(y)).pointerEvents.push({eventType:l,eventInfo:{button:d.button,showFeedback:d.showFeedback,hoverText:d.hoverText,maxDistance:d.maxDistance}})}function i(y,l,d){let v=s.getMutableOrNull(y);v&&(v.pointerEvents=v.pointerEvents.filter(p=>!(p.eventInfo?.button===d&&p.eventType===l)))}function u(y){return y===t.Up?0:1}function h(y,l){let d=c(y),v=d.get(l);v?.opts.hoverText&&i(y,u(l),v.opts.button),d.delete(l)}e.addSystem(function(){for(let[l,d]of r){if(e.getEntityState(l)===Wt.Removed){r.delete(l);continue}for(let[v,{cb:p,opts:x}]of d){if(v===t.Click){let b=n.getClick(x.button,l);b&&ii(p(b.up),"Click event returned a thenable. Only synchronous functions are allowed")}if(v===t.Down||v===t.Up){let b=n.getInputCommand(x.button,u(v),l);b&&ii(p(b),"Event handler returned a thenable. Only synchronous functions are allowed")}}}});let m=(...y)=>{let[l,d,v]=y;if(typeof l=="number")return m({entity:l,opts:v??{}},d);let{entity:p,opts:x}=l,b=a(x);h(p,t.Down),c(p).set(t.Down,{cb:d,opts:b}),o(p,1,b)},f=(...y)=>{let[l,d,v]=y;if(typeof l=="number")return f({entity:l,opts:v??{}},d);let{entity:p,opts:x}=l,b=a(x);h(p,t.Up),c(p).set(t.Up,{cb:d,opts:b}),o(p,0,b)};return{removeOnClick(y){h(y,t.Click)},removeOnPointerDown(y){h(y,t.Down)},removeOnPointerUp(y){h(y,t.Up)},onClick(y,l){let{entity:d}=y,v=a(y.opts);h(d,t.Click),c(d).set(t.Click,{cb:l,opts:v}),o(d,1,v)},onPointerDown:m,onPointerUp:f}}function Tl(e){let n=zs(e),s=wa(e),t=Ta(e),a=new Map;function r(u){let h=s.getOrNull(u),m=n.getOrNull(u),f=a.get(u);return!h||!m?!1:!!((c(u)||h.state===1)&&!f?.completed&&(f?.frames??0)>2)}function c(u){let h=n.getOrNull(u),m=a.get(u)?.tween;if(h&&!m||!h&&m)return!0;let f=new Lt;return n.schema.serialize(h,f),si(f.toBinary(),m)}let o=[];e.addSystem(()=>{for(let u of o)u();o.length=0;for(let[u,h]of e.getEntitiesWith(n)){if(c(u)){let f=new Lt;n.schema.serialize(h,f),a.set(u,{tween:f.toBinary(),frames:0,completed:!1,changed:!0});continue}let m=a.get(u);if(m.frames+=1,m.changed=!1,r(u)){m.frames=0,m.completed=!0;let f=t.getOrNull(u);if(!f)continue;let{sequence:y}=f;if(y&&y.length){let[l,...d]=y;n.createOrReplace(u,l);let v=t.getMutable(u);v.sequence=d,f.loop===0&&v.sequence.push(h)}else f.loop===1?n.createOrReplace(u,i(h)):f.loop===0&&(n.deleteFrom(u),a.delete(u),o.push(()=>{n.createOrReplace(u,h)}))}}},Number.NEGATIVE_INFINITY);function i(u){if(u.mode?.$case==="move"&&u.mode.move)return{...u,mode:{...u.mode,move:{start:u.mode.move.end,end:u.mode.move.start}}};if(u.mode?.$case==="rotate"&&u.mode.rotate)return{...u,mode:{...u.mode,rotate:{start:u.mode.rotate.end,end:u.mode.rotate.start}}};if(u.mode?.$case==="scale"&&u.mode.scale)return{...u,mode:{...u.mode,scale:{start:u.mode.scale.end,end:u.mode.scale.start}}};throw new Error("Invalid tween")}return{tweenCompleted:r}}var Se=bl(),_r=xl(Se),ci=gl(Se,_r);var mb=Tl(Se);var Hs=xs(Se),Gs=Es(Se),wl=bs(Se);var Ar=gs(Se);var xt=Ss(Se),Sl=jr(Se);var _l=Ns(Se);var Rr=Cs(Se),Ys=Is(Se);var Nr=Sa(Se),za=Os(Se);var Al;(function(e){e[e.CT_FIRST_PERSON=0]="CT_FIRST_PERSON",e[e.CT_THIRD_PERSON=1]="CT_THIRD_PERSON",e[e.CT_CINEMATIC=2]="CT_CINEMATIC"})(Al||(Al={}));var Zn;(function(e){e[e.IA_POINTER=0]="IA_POINTER",e[e.IA_PRIMARY=1]="IA_PRIMARY",e[e.IA_SECONDARY=2]="IA_SECONDARY",e[e.IA_ANY=3]="IA_ANY",e[e.IA_FORWARD=4]="IA_FORWARD",e[e.IA_BACKWARD=5]="IA_BACKWARD",e[e.IA_RIGHT=6]="IA_RIGHT",e[e.IA_LEFT=7]="IA_LEFT",e[e.IA_JUMP=8]="IA_JUMP",e[e.IA_WALK=9]="IA_WALK",e[e.IA_ACTION_3=10]="IA_ACTION_3",e[e.IA_ACTION_4=11]="IA_ACTION_4",e[e.IA_ACTION_5=12]="IA_ACTION_5",e[e.IA_ACTION_6=13]="IA_ACTION_6"})(Zn||(Zn={}));var Qn;(function(e){e[e.PET_UP=0]="PET_UP",e[e.PET_DOWN=1]="PET_DOWN",e[e.PET_HOVER_ENTER=2]="PET_HOVER_ENTER",e[e.PET_HOVER_LEAVE=3]="PET_HOVER_LEAVE"})(Qn||(Qn={}));var Rl;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.LOADING=1]="LOADING",e[e.NOT_FOUND=2]="NOT_FOUND",e[e.FINISHED_WITH_ERROR=3]="FINISHED_WITH_ERROR",e[e.FINISHED=4]="FINISHED"})(Rl||(Rl={}));var Nl;(function(e){e[e.TAM_TOP_LEFT=0]="TAM_TOP_LEFT",e[e.TAM_TOP_CENTER=1]="TAM_TOP_CENTER",e[e.TAM_TOP_RIGHT=2]="TAM_TOP_RIGHT",e[e.TAM_MIDDLE_LEFT=3]="TAM_MIDDLE_LEFT",e[e.TAM_MIDDLE_CENTER=4]="TAM_MIDDLE_CENTER",e[e.TAM_MIDDLE_RIGHT=5]="TAM_MIDDLE_RIGHT",e[e.TAM_BOTTOM_LEFT=6]="TAM_BOTTOM_LEFT",e[e.TAM_BOTTOM_CENTER=7]="TAM_BOTTOM_CENTER",e[e.TAM_BOTTOM_RIGHT=8]="TAM_BOTTOM_RIGHT"})(Nl||(Nl={}));var Cl;(function(e){e[e.F_SANS_SERIF=0]="F_SANS_SERIF",e[e.F_SERIF=1]="F_SERIF",e[e.F_MONOSPACE=2]="F_MONOSPACE"})(Cl||(Cl={}));function js(e){let n=e.getComponentOrNull("composite::root");return n||e.defineComponent("composite::root",{src:Z.String,entities:Z.Array(Z.Map({src:Z.Entity,dest:Z.Entity}))})}var Dh="/";function Vh(e,n=!1){let s="",t=0,a=-1,r=0,c;for(let o=0;o<=e.length;++o){if(o<e.length)c=e.charCodeAt(o);else{if(c===47)break;c=47}if(c===47){if(!(a===o-1||r===1))if(a!==o-1&&r===2){if(s.length<2||t!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){let i=s.lastIndexOf("/");if(i!==s.length-1){i===-1?(s="",t=0):(s=s.slice(0,i),t=s.length-1-s.lastIndexOf("/")),a=o,r=0;continue}}else if(s.length===2||s.length===1){s="",t=0,a=o,r=0;continue}}n&&(s.length>0?s+="/..":s="..",t=2)}else s.length>0?s+="/"+e.slice(a+1,o):s=e.slice(a+1,o),t=o-a-1;a=o,r=0}else c===46&&r!==-1?++r:r=-1}return s}function Fa(...e){let n="",s=!1,t;for(let a=e.length-1;a>=-1&&!s;a--){let r;a>=0?r=e[a]:(t===void 0&&(t=Dh),r=t),r.length!==0&&(n=r+"/"+n,s=r.charCodeAt(0)===47)}return n=Vh(n,!s),s?n.length>0?"/"+n:"/":n.length>0?n:"."}function Il(e){if(e.length===0)return".";let n=e.charCodeAt(0),s=n===47,t=-1,a=!0;for(let r=e.length-1;r>=1;--r)if(n=e.charCodeAt(r),n===47){if(!a){t=r;break}}else a=!1;return t===-1?s?"/":".":s&&t===1?"//":e.slice(0,t)}function La(e,n){return(e.startsWith(".")?Fa(n,e):Fa(e)).substring(1)}var Cr;(function(e){e[e.EMM_NONE=0]="EMM_NONE",e[e.EMM_NEXT_AVAILABLE=1]="EMM_NEXT_AVAILABLE",e[e.EMM_DIRECT_MAPPING=2]="EMM_DIRECT_MAPPING"})(Cr||(Cr={}));function Bl(e,n){return n.data?.$case==="json"?n.data.json:e.schema.deserialize(new Lt(n.data?.binary))}function qh(e,n){let s=e.getComponentOrNull(n.name);if(s)return s;if(n.name.startsWith("core::")){if(n.name in ks)return ks[n.name](e);throw new Error(`The core component ${n.name} was not found.`)}else{if(n.jsonSchema)return e.defineComponentFromSchema(n.name,Z.fromJson(n.jsonSchema));throw new Error(`${n.name} is not defined and there is no schema to define it.`)}}function Hh(e,n,s,{entityMapping:t}){let a=s.get(n);if(a)return a;if(t?.type===Cr.EMM_DIRECT_MAPPING){let c=t.getCompositeEntity(n);return s.set(n,c),c}let r=t?.type===Cr.EMM_NEXT_AVAILABLE?t.getNextAvailableEntity():e.addEntity();if(r===null)throw new Error("There is no more entities to allocate");return s.set(n,r),r}function $s(e,n,s,t){let{rootEntity:a,alreadyRequestedSrc:r,entityMapping:c}=t,o=r||new Set,i=Il(Fa(n.src)),u=Gn("core::Transform"),h=js(e),m=new Map,f=v=>Hh(e,v,m,t),y=a??f(0);a&&m.set(0,a);let l=n.composite.components.find(v=>v.name===h.componentName);if(l)for(let[v,p]of l.data){let x=Bl(h,p),b=La(x.src,i),O=s.getCompositeOrNull(b),N=f(v);if(O){if(o.has(O.src)||O.src===n.src)throw new Error(`Composite ${n.src} has a recursive instanciation while try to instance ${O.src}. Previous instances: ${o.toString()}`);$s(e,O,s,{rootEntity:N,alreadyRequestedSrc:new Set(o).add(O.src),entityMapping:c?.type===Cr.EMM_NEXT_AVAILABLE?c:void 0})}}for(let v of n.composite.components){if(v.name===h.componentName)continue;let p=qh(e,v);for(let[x,b]of v.data){let O=Bl(p,b),N=f(x),_=p.create(N,O);if(p.componentId===u){let P=_;P.parent?P.parent=f(P.parent):P.parent=f(0)}else Z.mutateNestedValues(p.schema.jsonSchema,_,(P,M)=>M.serializationType==="entity"?{changed:!0,value:f(P)}:{changed:!1})}}let d=h.getMutableOrNull(y)||h.create(y);for(let[v,p]of m)d.entities.push({src:v,dest:p});return d.src=n.src,y}var _n=Ze(Je());var Sn=Ze(Je());var Ol;(function(e){e[e.NULL_VALUE=0]="NULL_VALUE"})(Ol||(Ol={}));function Gh(e){switch(e){case 0:case"NULL_VALUE":return 0;default:throw new zl.Error("Unrecognized enum value "+e+" for enum NullValue")}}function Yh(e){switch(e){case 0:return"NULL_VALUE";default:throw new zl.Error("Unrecognized enum value "+e+" for enum NullValue")}}function kl(){return{fields:new Map}}var Ir;(function(e){function n(o,i=Sn.default.Writer.create()){return o.fields.forEach((u,h)=>{u!==void 0&&Ua.encode({key:h,value:u},i.uint32(10).fork()).ldelim()}),i}e.encode=n;function s(o,i){let u=o instanceof Sn.default.Reader?o:Sn.default.Reader.create(o),h=i===void 0?u.len:u.pos+i,m=kl();for(;u.pos<h;){let f=u.uint32();switch(f>>>3){case 1:if(f!==10)break;let y=Ua.decode(u,u.uint32());y.value!==void 0&&m.fields.set(y.key,y.value);continue}if((f&7)===4||f===0)break;u.skipType(f&7)}return m}e.decode=s;function t(o){return{fields:$h(o.fields)?Object.entries(o.fields).reduce((i,[u,h])=>(i.set(u,h),i),new Map):new Map}}e.fromJSON=t;function a(o){let i={};return i.fields={},o.fields&&o.fields.forEach((u,h)=>{i.fields[h]=u}),i}e.toJSON=a;function r(o){let i=kl();return o!==void 0&&Object.keys(o).forEach(u=>{i.fields.set(u,o[u])}),i}e.wrap=r;function c(o){let i={};return[...o.fields.keys()].forEach(u=>{i[u]=o.fields.get(u)}),i}e.unwrap=c})(Ir||(Ir={}));function jh(){return{key:"",value:void 0}}var Ua;(function(e){function n(r,c=Sn.default.Writer.create()){return r.key!==""&&c.uint32(10).string(r.key),r.value!==void 0&&$t.encode($t.wrap(r.value),c.uint32(18).fork()).ldelim(),c}e.encode=n;function s(r,c){let o=r instanceof Sn.default.Reader?r:Sn.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=jh();for(;o.pos<i;){let h=o.uint32();switch(h>>>3){case 1:if(h!==10)break;u.key=o.string();continue;case 2:if(h!==18)break;u.value=$t.unwrap($t.decode(o,o.uint32()));continue}if((h&7)===4||h===0)break;o.skipType(h&7)}return u}e.decode=s;function t(r){return{key:po(r.key)?String(r.key):"",value:po(r?.value)?r.value:void 0}}e.fromJSON=t;function a(r){let c={};return r.key!==void 0&&(c.key=r.key),r.value!==void 0&&(c.value=r.value),c}e.toJSON=a})(Ua||(Ua={}));function Ml(){return{kind:void 0}}var $t;(function(e){function n(o,i=Sn.default.Writer.create()){switch(o.kind?.$case){case"nullValue":i.uint32(8).int32(o.kind.nullValue);break;case"numberValue":i.uint32(17).double(o.kind.numberValue);break;case"stringValue":i.uint32(26).string(o.kind.stringValue);break;case"boolValue":i.uint32(32).bool(o.kind.boolValue);break;case"structValue":Ir.encode(Ir.wrap(o.kind.structValue),i.uint32(42).fork()).ldelim();break;case"listValue":Br.encode(Br.wrap(o.kind.listValue),i.uint32(50).fork()).ldelim();break}return i}e.encode=n;function s(o,i){let u=o instanceof Sn.default.Reader?o:Sn.default.Reader.create(o),h=i===void 0?u.len:u.pos+i,m=Ml();for(;u.pos<h;){let f=u.uint32();switch(f>>>3){case 1:if(f!==8)break;m.kind={$case:"nullValue",nullValue:u.int32()};continue;case 2:if(f!==17)break;m.kind={$case:"numberValue",numberValue:u.double()};continue;case 3:if(f!==26)break;m.kind={$case:"stringValue",stringValue:u.string()};continue;case 4:if(f!==32)break;m.kind={$case:"boolValue",boolValue:u.bool()};continue;case 5:if(f!==42)break;m.kind={$case:"structValue",structValue:Ir.unwrap(Ir.decode(u,u.uint32()))};continue;case 6:if(f!==50)break;m.kind={$case:"listValue",listValue:Br.unwrap(Br.decode(u,u.uint32()))};continue}if((f&7)===4||f===0)break;u.skipType(f&7)}return m}e.decode=s;function t(o){return{kind:po(o.nullValue)?{$case:"nullValue",nullValue:Gh(o.nullValue)}:po(o.numberValue)?{$case:"numberValue",numberValue:Number(o.numberValue)}:po(o.stringValue)?{$case:"stringValue",stringValue:String(o.stringValue)}:po(o.boolValue)?{$case:"boolValue",boolValue:!!o.boolValue}:po(o.structValue)?{$case:"structValue",structValue:o.structValue}:po(o.listValue)?{$case:"listValue",listValue:[...o.listValue]}:void 0}}e.fromJSON=t;function a(o){let i={};return o.kind?.$case==="nullValue"&&(i.nullValue=o.kind?.nullValue!==void 0?Yh(o.kind?.nullValue):void 0),o.kind?.$case==="numberValue"&&(i.numberValue=o.kind?.numberValue),o.kind?.$case==="stringValue"&&(i.stringValue=o.kind?.stringValue),o.kind?.$case==="boolValue"&&(i.boolValue=o.kind?.boolValue),o.kind?.$case==="structValue"&&(i.structValue=o.kind?.structValue),o.kind?.$case==="listValue"&&(i.listValue=o.kind?.listValue),i}e.toJSON=a;function r(o){let i=Ml();if(o===null)i.kind={$case:"nullValue",nullValue:0};else if(typeof o=="boolean")i.kind={$case:"boolValue",boolValue:o};else if(typeof o=="number")i.kind={$case:"numberValue",numberValue:o};else if(typeof o=="string")i.kind={$case:"stringValue",stringValue:o};else if(Array.isArray(o))i.kind={$case:"listValue",listValue:o};else if(typeof o=="object")i.kind={$case:"structValue",structValue:o};else if(typeof o<"u")throw new Error("Unsupported any value type: "+typeof o);return i}e.wrap=r;function c(o){return o.kind?.$case==="nullValue"?null:o.kind?.$case==="numberValue"?o.kind?.numberValue:o.kind?.$case==="stringValue"?o.kind?.stringValue:o.kind?.$case==="boolValue"?o.kind?.boolValue:o.kind?.$case==="structValue"?o.kind?.structValue:o.kind?.$case==="listValue"?o.kind?.listValue:void 0}e.unwrap=c})($t||($t={}));function Pl(){return{values:[]}}var Br;(function(e){function n(o,i=Sn.default.Writer.create()){for(let u of o.values)$t.encode($t.wrap(u),i.uint32(10).fork()).ldelim();return i}e.encode=n;function s(o,i){let u=o instanceof Sn.default.Reader?o:Sn.default.Reader.create(o),h=i===void 0?u.len:u.pos+i,m=Pl();for(;u.pos<h;){let f=u.uint32();switch(f>>>3){case 1:if(f!==10)break;m.values.push($t.unwrap($t.decode(u,u.uint32())));continue}if((f&7)===4||f===0)break;u.skipType(f&7)}return m}e.decode=s;function t(o){return{values:Array.isArray(o?.values)?[...o.values]:[]}}e.fromJSON=t;function a(o){let i={};return o.values?i.values=o.values.map(u=>u):i.values=[],i}e.toJSON=a;function r(o){let i=Pl();return i.values=o??[],i}e.wrap=r;function c(o){return o?.hasOwnProperty("values")&&Array.isArray(o.values)?o.values:o}e.unwrap=c})(Br||(Br={}));var zl=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global;throw"Unable to locate global object"})();function $h(e){return typeof e=="object"&&e!==null}function po(e){return e!=null}function Xh(){return{data:void 0}}var ho;(function(e){function n(r,c=_n.default.Writer.create()){switch(r.data?.$case){case"json":$t.encode($t.wrap(r.data.json),c.uint32(10).fork()).ldelim();break;case"binary":c.uint32(18).bytes(r.data.binary);break}return c}e.encode=n;function s(r,c){let o=r instanceof _n.default.Reader?r:_n.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=Xh();for(;o.pos<i;){let h=o.uint32();switch(h>>>3){case 1:if(h!==10)break;u.data={$case:"json",json:$t.unwrap($t.decode(o,o.uint32()))};continue;case 2:if(h!==18)break;u.data={$case:"binary",binary:o.bytes()};continue}if((h&7)===4||h===0)break;o.skipType(h&7)}return u}e.decode=s;function t(r){return{data:ko(r.json)?{$case:"json",json:r.json}:ko(r.binary)?{$case:"binary",binary:Kh(r.binary)}:void 0}}e.fromJSON=t;function a(r){let c={};return r.data?.$case==="json"&&(c.json=r.data?.json),r.data?.$case==="binary"&&(c.binary=r.data?.binary!==void 0?em(r.data?.binary):void 0),c}e.toJSON=a})(ho||(ho={}));function Zh(){return{name:"",jsonSchema:void 0,data:new Map}}var Or;(function(e){function n(r,c=_n.default.Writer.create()){return r.name!==""&&c.uint32(10).string(r.name),r.jsonSchema!==void 0&&$t.encode($t.wrap(r.jsonSchema),c.uint32(18).fork()).ldelim(),r.data.forEach((o,i)=>{Da.encode({key:i,value:o},c.uint32(26).fork()).ldelim()}),c}e.encode=n;function s(r,c){let o=r instanceof _n.default.Reader?r:_n.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=Zh();for(;o.pos<i;){let h=o.uint32();switch(h>>>3){case 1:if(h!==10)break;u.name=o.string();continue;case 2:if(h!==18)break;u.jsonSchema=$t.unwrap($t.decode(o,o.uint32()));continue;case 3:if(h!==26)break;let m=Da.decode(o,o.uint32());m.value!==void 0&&u.data.set(m.key,m.value);continue}if((h&7)===4||h===0)break;o.skipType(h&7)}return u}e.decode=s;function t(r){return{name:ko(r.name)?String(r.name):"",jsonSchema:ko(r?.jsonSchema)?r.jsonSchema:void 0,data:tm(r.data)?Object.entries(r.data).reduce((c,[o,i])=>(c.set(Number(o),ho.fromJSON(i)),c),new Map):new Map}}e.fromJSON=t;function a(r){let c={};return r.name!==void 0&&(c.name=r.name),r.jsonSchema!==void 0&&(c.jsonSchema=r.jsonSchema),c.data={},r.data&&r.data.forEach((o,i)=>{c.data[i]=ho.toJSON(o)}),c}e.toJSON=a})(Or||(Or={}));function Qh(){return{key:0,value:void 0}}var Da;(function(e){function n(r,c=_n.default.Writer.create()){return r.key!==0&&c.uint32(8).int32(r.key),r.value!==void 0&&ho.encode(r.value,c.uint32(18).fork()).ldelim(),c}e.encode=n;function s(r,c){let o=r instanceof _n.default.Reader?r:_n.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=Qh();for(;o.pos<i;){let h=o.uint32();switch(h>>>3){case 1:if(h!==8)break;u.key=o.int32();continue;case 2:if(h!==18)break;u.value=ho.decode(o,o.uint32());continue}if((h&7)===4||h===0)break;o.skipType(h&7)}return u}e.decode=s;function t(r){return{key:ko(r.key)?Number(r.key):0,value:ko(r.value)?ho.fromJSON(r.value):void 0}}e.fromJSON=t;function a(r){let c={};return r.key!==void 0&&(c.key=Math.round(r.key)),r.value!==void 0&&(c.value=r.value?ho.toJSON(r.value):void 0),c}e.toJSON=a})(Da||(Da={}));function Jh(){return{version:0,components:[]}}var Oo;(function(e){function n(r,c=_n.default.Writer.create()){r.version!==0&&c.uint32(8).int32(r.version);for(let o of r.components)Or.encode(o,c.uint32(18).fork()).ldelim();return c}e.encode=n;function s(r,c){let o=r instanceof _n.default.Reader?r:_n.default.Reader.create(r),i=c===void 0?o.len:o.pos+c,u=Jh();for(;o.pos<i;){let h=o.uint32();switch(h>>>3){case 1:if(h!==8)break;u.version=o.int32();continue;case 2:if(h!==18)break;u.components.push(Or.decode(o,o.uint32()));continue}if((h&7)===4||h===0)break;o.skipType(h&7)}return u}e.decode=s;function t(r){return{version:ko(r.version)?Number(r.version):0,components:Array.isArray(r?.components)?r.components.map(c=>Or.fromJSON(c)):[]}}e.fromJSON=t;function a(r){let c={};return r.version!==void 0&&(c.version=Math.round(r.version)),r.components?c.components=r.components.map(o=>o?Or.toJSON(o):void 0):c.components=[],c}e.toJSON=a})(Oo||(Oo={}));var kr=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global;throw"Unable to locate global object"})();function Kh(e){if(kr.Buffer)return Uint8Array.from(kr.Buffer.from(e,"base64"));{let n=kr.atob(e),s=new Uint8Array(n.length);for(let t=0;t<n.length;++t)s[t]=n.charCodeAt(t);return s}}function em(e){if(kr.Buffer)return kr.Buffer.from(e).toString("base64");{let n=[];return e.forEach(s=>{n.push(String.fromCharCode(s))}),kr.btoa(n.join(""))}}function tm(e){return typeof e=="object"&&e!==null}function ko(e){return e!=null}var mo;(function(e){function n(o){return Oo.fromJSON(o)}e.fromJson=n;function s(o){return Oo.decode(o)}e.fromBinary=s;function t(o){return Oo.toJSON(o)}e.toJson=t;function a(o){return Oo.encode(o).finish()}e.toBinary=a;function r(o,i,u,h={}){$s(o,i,u,h)}e.instance=r;function c(o,i="/"){return La(o,i)}e.resolveAndNormalizePath=c})(mo||(mo={}));var We=Co(Se),Fl=ol(Se),mn=nl(Se),Yn=rl(Se);var ag=Ma(Se);var yo=.45454545454545453,vo=2.2,Ll=1e-6,ui=Math.PI/180,fi=360/(Math.PI*2);var ht;(function(e){e.TwoPi=Math.PI*2;function n(_,P,M=1401298e-51){let q=_-P;return-M<=q&&q<=M}e.withinEpsilon=n;function s(_){let P=_.toString(16);return _<=15?("0"+P).toUpperCase():P.toUpperCase()}e.toHex=s;function t(_){let P=+_;return P===0||isNaN(P)?P:P>0?1:-1}e.sign=t;function a(_,P=0,M=1){return Math.min(M,Math.max(P,_))}e.clamp=a;function r(_){return Math.log(_)*Math.LOG2E}e.log2=r;function c(_,P){return _-Math.floor(_/P)*P}e.repeat=c;function o(_,P,M){return(_-P)/(M-P)}e.normalize=o;function i(_,P,M){return _*(M-P)+P}e.denormalize=i;function u(_,P){let M=c(P-_,360);return M>180&&(M-=360),M}e.deltaAngle=u;function h(_,P){let M=c(_,P*2);return P-Math.abs(M-P)}e.pingPong=h;function m(_,P,M){let q=a(M);return q=-2*q*q*q+3*q*q,P*q+_*(1-q)}e.smoothStep=m;function f(_,P,M){let q=0;return Math.abs(P-_)<=M?q=P:q=_+t(P-_)*M,q}e.moveTowards=f;function y(_,P,M){let q=u(_,P),Q=0;return-M<q&&q<M?Q=P:Q=f(_,_+q,M),Q}e.moveTowardsAngle=y;function l(_,P,M){return _+(P-_)*M}e.lerp=l;function d(_,P,M){let q=c(P-_,360);return q>180&&(q-=360),_+q*a(M)}e.lerpAngle=d;function v(_,P,M){let q=0;return _!==P?q=a((M-_)/(P-_)):q=0,q}e.inverseLerp=v;function p(_,P,M,q,Q){let w=Q*Q,k=Q*w,V=2*k-3*w+1,K=-2*k+3*w,H=k-2*w+Q,oe=k-w;return _*V+M*K+P*H+q*oe}e.hermite=p;function x(_,P){return _===P?_:Math.random()*(P-_)+_}e.randomRange=x;function b(_,P,M){return(_-P)/(M-P)}e.rangeToPercent=b;function O(_,P,M){return(M-P)*_+P}e.percentToRange=O;function N(_){return _-e.TwoPi*Math.floor((_+Math.PI)/e.TwoPi)}e.normalizeRadians=N})(ht||(ht={}));var J;(function(e){function n(B){let Y=Math.abs(B.x),te=Math.abs(B.y);if(Y!==te)return!0;let we=Math.abs(B.z);return Y!==we}e.isNonUniform=n;function s(B=0,Y=0,te=0){return{x:B,y:Y,z:te}}e.create=s;function t(B,Y){return{x:B.x+Y.x,y:B.y+Y.y,z:B.z+Y.z}}e.add=t;function a(B,Y,te){te.x=B.x+Y.x,te.y=B.y+Y.y,te.z=B.z+Y.z}e.addToRef=a;function r(B,Y){return{x:B.x-Y.x,y:B.y-Y.y,z:B.z-Y.z}}e.subtract=r;function c(B,Y,te){te.x=B.x-Y.x,te.y=B.y-Y.y,te.z=B.z-Y.z}e.subtractToRef=c;function o(B,Y,te,we,be){be.x=B.x-Y,be.y=B.y-te,be.z=B.z-we}e.subtractFromFloatsToRef=o;function i(B){return{x:-B.x,y:-B.y,z:-B.z}}e.negate=i;function u(B,Y){Y.x=B.x,Y.y=B.y,Y.z=B.z}e.copyFrom=u;function h(B,Y,te,we){we.x=B,we.y=Y,we.z=te}e.copyFromFloats=h;function m(B){return s(B.x,B.y,B.z)}e.clone=m;function f(B,Y,te,we){let be=Q(B,te)-we,Ce=Q(Y,te)-we;return be/(be-Ce)}e.getClipFactor=f;function y(B,Y,te){let we=M(B),be=M(Y),Ce=Q(we,be),Ie=s();return ue(we,be,Ie),Q(Ie,te)>0?Math.acos(Ce):-Math.acos(Ce)}e.getAngleBetweenVectors=y;function l(B,Y=0){return s(B[Y],B[Y+1],B[Y+2])}e.fromArray=l;function d(B,Y){return l(B,Y)}e.fromFloatArray=d;function v(B,Y,te){te.x=B[Y],te.y=B[Y+1],te.z=B[Y+2]}e.fromArrayToRef=v;function p(B,Y,te){return v(B,Y,te)}e.fromFloatArrayToRef=p;function x(B){return Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z)}e.length=x;function b(B){return B.x*B.x+B.y*B.y+B.z*B.z}e.lengthSquared=b;function O(B,Y,te){te.x=B.x*Y,te.y=B.y*Y,te.z=B.z*Y}e.scaleToRef=O;function N(B,Y){return s(B.x*Y,B.y*Y,B.z*Y)}e.scale=N;function _(B,Y){let te=s(0,0,0);return P(B,Y,te),te}e.normalizeFromLength=_;function P(B,Y,te){if(Y===0||Y===1){u(B,te);return}O(B,1/Y,te)}e.normalizeFromLengthToRef=P;function M(B){return _(B,x(B))}e.normalize=M;function q(B,Y){P(B,x(B),Y)}e.normalizeToRef=q;function Q(B,Y){return B.x*Y.x+B.y*Y.y+B.z*Y.z}e.dot=Q;function w(B,Y){let te=m(B);return k(B,Y,te),te}e.applyMatrix4=w;function k(B,Y,te){let{x:we,y:be,z:Ce}=B,Ie=Y._m,lt=1/(Ie[3]*we+Ie[7]*be+Ie[11]*Ce+Ie[15]);te.x=(Ie[0]*we+Ie[4]*be+Ie[8]*Ce+Ie[12])*lt,te.y=(Ie[1]*we+Ie[5]*be+Ie[9]*Ce+Ie[13])*lt,te.z=(Ie[2]*we+Ie[6]*be+Ie[10]*Ce+Ie[14])*lt}e.applyMatrix4ToRef=k;function V(B,Y){let te=s();return K(B,Y,te),te}e.rotate=V;function K(B,Y,te){let{x:we,y:be,z:Ce}=B,{x:Ie,y:lt,z:Nt,w:ft}=Y,nn=ft*we+lt*Ce-Nt*be,ln=ft*be+Nt*we-Ie*Ce,En=ft*Ce+Ie*be-lt*we,Bn=-Ie*we-lt*be-Nt*Ce;te.x=nn*ft+Bn*-Ie+ln*-Nt-En*-lt,te.y=ln*ft+Bn*-lt+En*-Ie-nn*-Nt,te.z=En*ft+Bn*-Nt+nn*-lt-ln*-Ie}e.rotateToRef=K;function H(B,Y,te){let we=s(0,0,0);return oe(B,Y,te,we),we}e.lerp=H;function oe(B,Y,te,we){we.x=B.x+(Y.x-B.x)*te,we.y=B.y+(Y.y-B.y)*te,we.z=B.z+(Y.z-B.z)*te}e.lerpToRef=oe;function ie(B,Y){let te=St();return ue(B,Y,te),te}e.cross=ie;function ue(B,Y,te){te.x=B.y*Y.z-B.z*Y.y,te.y=B.z*Y.x-B.x*Y.z,te.z=B.x*Y.y-B.y*Y.x}e.crossToRef=ue;function me(B,Y){let te=St();return Ae(B,Y,te),te}e.transformCoordinates=me;function Ae(B,Y,te){return Fe(B.x,B.y,B.z,Y,te)}e.transformCoordinatesToRef=Ae;function Fe(B,Y,te,we,be){let Ce=we._m,Ie=B*Ce[0]+Y*Ce[4]+te*Ce[8]+Ce[12],lt=B*Ce[1]+Y*Ce[5]+te*Ce[9]+Ce[13],Nt=B*Ce[2]+Y*Ce[6]+te*Ce[10]+Ce[14],ft=1/(B*Ce[3]+Y*Ce[7]+te*Ce[11]+Ce[15]);be.x=Ie*ft,be.y=lt*ft,be.z=Nt*ft}e.transformCoordinatesFromFloatsToRef=Fe;function Me(B,Y){let te=St();return je(B,Y,te),te}e.transformNormal=Me;function je(B,Y,te){Pe(B.x,B.y,B.z,Y,te)}e.transformNormalToRef=je;function Pe(B,Y,te,we,be){let Ce=we._m;be.x=B*Ce[0]+Y*Ce[4]+te*Ce[8],be.y=B*Ce[1]+Y*Ce[5]+te*Ce[9],be.z=B*Ce[2]+Y*Ce[6]+te*Ce[10]}e.transformNormalFromFloatsToRef=Pe;function D(B,Y,te,we,be){let Ce=be*be,Ie=be*Ce,lt=.5*(2*Y.x+(-B.x+te.x)*be+(2*B.x-5*Y.x+4*te.x-we.x)*Ce+(-B.x+3*Y.x-3*te.x+we.x)*Ie),Nt=.5*(2*Y.y+(-B.y+te.y)*be+(2*B.y-5*Y.y+4*te.y-we.y)*Ce+(-B.y+3*Y.y-3*te.y+we.y)*Ie),ft=.5*(2*Y.z+(-B.z+te.z)*be+(2*B.z-5*Y.z+4*te.z-we.z)*Ce+(-B.z+3*Y.z-3*te.z+we.z)*Ie);return s(lt,Nt,ft)}e.catmullRom=D;function A(B,Y,te){let we=s();return F(B,Y,te,we),we}e.clamp=A;function F(B,Y,te,we){let be=B.x;be=be>te.x?te.x:be,be=be<Y.x?Y.x:be;let Ce=B.y;Ce=Ce>te.y?te.y:Ce,Ce=Ce<Y.y?Y.y:Ce;let Ie=B.z;Ie=Ie>te.z?te.z:Ie,Ie=Ie<Y.z?Y.z:Ie,h(be,Ce,Ie,we)}e.clampToRef=F;function ee(B,Y,te,we,be){let Ce=be*be,Ie=be*Ce,lt=2*Ie-3*Ce+1,Nt=-2*Ie+3*Ce,ft=Ie-2*Ce+be,nn=Ie-Ce,ln=B.x*lt+te.x*Nt+Y.x*ft+we.x*nn,En=B.y*lt+te.y*Nt+Y.y*ft+we.y*nn,Bn=B.z*lt+te.z*Nt+Y.z*ft+we.z*nn;return s(ln,En,Bn)}e.hermite=ee;function S(B,Y){let te=s();return Ke(Y,B.x,B.y,B.z,te),te}e.minimize=S;function L(B,Y){let te=s();return qe(B,Y.x,Y.y,Y.z,te),te}e.maximize=L;function ce(B,Y){return Math.sqrt(xe(B,Y))}e.distance=ce;function xe(B,Y){let te=B.x-Y.x,we=B.y-Y.y,be=B.z-Y.z;return te*te+we*we+be*be}e.distanceSquared=xe;function X(B,Y){let te=t(B,Y);return O(te,.5,te),te}e.center=X;function C(B,Y,te){let we=St();return R(B,Y,te,we),we}e.rotationFromAxis=C;function R(B,Y,te,we){let be=He.create();He.fromAxisToRotationQuaternionToRef(B,Y,te,be),u(He.toEulerAngles(be),we)}e.rotationFromAxisToRef=R;function W(B){return`(${B.x}, ${B.y}, ${B.z})`}e.toString=W;function j(B){let Y=B.x||0;return Y=Y*397^(B.y||0),Y=Y*397^(B.z||0),Y}e.getHashCode=j;function ne(B,Y){return B.x===Y.x&&B.y===Y.y&&B.z===Y.z}e.equals=ne;function re(B,Y,te=Ll){return ht.withinEpsilon(B.x,Y.x,te)&&ht.withinEpsilon(B.y,Y.y,te)&&ht.withinEpsilon(B.z,Y.z,te)}e.equalsWithEpsilon=re;function he(B,Y,te,we){return B.x===Y&&B.y===te&&B.z===we}e.equalsToFloats=he;function Ee(B,Y){let te=s();return Te(B,Y,te),te}e.multiply=Ee;function Te(B,Y,te){te.x=B.x*Y.x,te.y=B.y*Y.y,te.z=B.z*Y.z}e.multiplyToRef=Te;function Ne(B,Y,te,we,be){be.x=B.x*Y,be.y=B.y*te,be.z=B.z*we}e.multiplyByFloatsToRef=Ne;function ke(B,Y,te,we){let be=s();return Ne(B,Y,te,we,be),be}e.multiplyByFloats=ke;function _e(B,Y){return{x:B.x/Y.x,y:B.y/Y.y,z:B.z/Y.z}}e.divide=_e;function $e(B,Y,te){te.x=B.x/Y.x,te.y=B.y/Y.y,te.z=B.z/Y.z}e.divideToRef=$e;function qe(B,Y,te,we,be){Y>B.x?be.x=Y:be.x=B.x,te>B.y?be.y=te:be.y=B.y,we>B.z?be.z=we:be.z=B.z}e.maximizeInPlaceFromFloatsToRef=qe;function Ke(B,Y,te,we,be){Y<B.x?be.x=Y:be.x=B.x,te<B.y?be.y=te:be.y=B.y,we<B.z?be.z=we:be.z=B.z}e.minimizeInPlaceFromFloatsToRef=Ke;function ot(B){return s(Math.floor(B.x),Math.floor(B.y),Math.floor(B.z))}e.floor=ot;function vt(B){return s(B.x-Math.floor(B.x),B.y-Math.floor(B.y),B.z-Math.floor(B.z))}e.fract=vt;function St(){return s(0,0,0)}e.Zero=St;function yt(){return s(1,1,1)}e.One=yt;function Ht(){return s(0,1,0)}e.Up=Ht;function Oe(){return s(0,-1,0)}e.Down=Oe;function De(){return s(0,0,1)}e.Forward=De;function Ut(){return s(0,0,-1)}e.Backward=Ut;function tn(){return s(1,0,0)}e.Right=tn;function Yt(){return s(-1,0,0)}e.Left=Yt;function rt(){return s(Math.random(),Math.random(),Math.random())}e.Random=rt})(J||(J={}));var Va;(function(e){function n(d,v,p,x){return{normal:J.create(d,v,p),d:x}}e.create=n;function s(d){return n(d[0],d[1],d[2],d[3])}e.fromArray=s;function t(d,v,p){return n(0,0,0,0)}e.fromPoints=t;function a(d,v){let p=n(0,0,0,0);return p.normal=J.normalize(v),p.d=-(v.x*d.x+v.y*d.y+v.z*d.z),p}e.romPositionAndNormal=a;function r(d,v,p){let x=-(v.x*d.x+v.y*d.y+v.z*d.z);return J.dot(p,v)+x}e.signedDistanceToPlaneFromPositionAndNormal=r;function c(d){return[d.normal.x,d.normal.y,d.normal.z,d.d]}e.asArray=c;function o(d){return n(d.normal.x,d.normal.y,d.normal.z,d.d)}e.clone=o;function i(d){return 0}e.getHashCode=i;function u(d){let v=n(0,0,0,0),p=Math.sqrt(d.normal.x*d.normal.x+d.normal.y*d.normal.y+d.normal.z*d.normal.z),x=0;return p!==0&&(x=1/p),v.normal.x=d.normal.x*x,v.normal.y=d.normal.y*x,v.normal.z=d.normal.z*x,v.d*=x,d}e.normalize=u;function h(d,v){let p=Ln.create();Ln.transposeToRef(v,p);let x=p._m,b=d.normal.x,O=d.normal.y,N=d.normal.z,_=d.d,P=b*x[0]+O*x[1]+N*x[2]+_*x[3],M=b*x[4]+O*x[5]+N*x[6]+_*x[7],q=b*x[8]+O*x[9]+N*x[10]+_*x[11],Q=b*x[12]+O*x[13]+N*x[14]+_*x[15];return n(P,M,q,Q)}e.transform=h;function m(d,v){return d.normal.x*v.x+d.normal.y*v.y+d.normal.z*v.z+d.d}e.dotCoordinate=m;function f(d,v,p){let x=v.x-d.x,b=v.y-d.y,O=v.z-d.z,N=p.x-d.x,_=p.y-d.y,P=p.z-d.z,M=b*P-O*_,q=O*N-x*P,Q=x*_-b*N,w=Math.sqrt(M*M+q*q+Q*Q),k;w!==0?k=1/w:k=0;let V=J.create(M*k,q*k,Q*k);return{normal:V,d:-(V.x*d.x+V.y*d.y+V.z*d.z)}}e.copyFromPoints=f;function y(d,v,p){return J.dot(d.normal,v)<=p}e.isFrontFacingTo=y;function l(d,v){return J.dot(v,d.normal)+d.d}e.signedDistanceTo=l})(Va||(Va={}));var Ln;(function(e){function n(E){return E._m}e.m=n;let s=0,t={};function a(){return t}e.IdentityReadonly=a;function r(){let E={updateFlag:0,isIdentity:!1,isIdentity3x2:!0,_isIdentityDirty:!0,_isIdentity3x2Dirty:!0,_m:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};return se(E,!1),E}e.create=r;function c(E,g=0){let T=r();return o(E,g,T),T}e.fromArray=c;function o(E,g,T){for(let I=0;I<16;I++)T._m[I]=E[I+g];Te(T)}e.fromArrayToRef=o;function i(E,g,T,I){for(let z=0;z<16;z++)I._m[z]=E[z+g]*T;Te(I)}e.fromFloatArrayToRefScaled=i;function u(E,g,T,I,z,$,G,U,ae,pe,ye,ve,le,de,Re,Ue,Be){let fe=Be._m;fe[0]=E,fe[1]=g,fe[2]=T,fe[3]=I,fe[4]=z,fe[5]=$,fe[6]=G,fe[7]=U,fe[8]=ae,fe[9]=pe,fe[10]=ye,fe[11]=ve,fe[12]=le,fe[13]=de,fe[14]=Re,fe[15]=Ue,Te(Be)}e.fromValuesToRef=u;function h(E,g,T,I,z,$,G,U,ae,pe,ye,ve,le,de,Re,Ue){let Be=r(),fe=Be._m;return fe[0]=E,fe[1]=g,fe[2]=T,fe[3]=I,fe[4]=z,fe[5]=$,fe[6]=G,fe[7]=U,fe[8]=ae,fe[9]=pe,fe[10]=ye,fe[11]=ve,fe[12]=le,fe[13]=de,fe[14]=Re,fe[15]=Ue,Te(Be),Be}e.fromValues=h;function m(E,g,T){let I=r();return f(E,g,T,I),I}e.compose=m;function f(E,g,T,I){let z=[r(),r(),r()];w(E.x,E.y,E.z,z[1]),Ee(g,z[0]),be(z[1],z[0],I),tn(I,T)}e.composeToRef=f;function y(){let E=h(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return se(E,!0),E}e.Identity=y;function l(E){u(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,E),se(E,!0)}e.IdentityToRef=l;function d(){let E=h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return se(E,!1),E}e.Zero=d;function v(E){let g=r();return p(E,g),g}e.RotationX=v;function p(E,g){let T=Math.sin(E),I=Math.cos(E);u(1,0,0,0,0,I,T,0,0,-T,I,0,0,0,0,1,g),se(g,I===1&&T===0)}e.rotationXToRef=p;function x(E){let g=r();return b(E,g),g}e.rotationY=x;function b(E,g){let T=Math.sin(E),I=Math.cos(E);u(I,0,-T,0,0,1,0,0,T,0,I,0,0,0,0,1,g),se(g,I===1&&T===0)}e.rotationYToRef=b;function O(E){let g=r();return N(E,g),g}e.rotationZ=O;function N(E,g){let T=Math.sin(E),I=Math.cos(E);u(I,T,0,0,-T,I,0,0,0,0,1,0,0,0,0,1,g),se(g,I===1&&T===0)}e.rotationZToRef=N;function _(E,g){let T=r();return P(E,g,T),T}e.rotationAxis=_;function P(E,g,T){let I=Math.sin(-g),z=Math.cos(-g),$=1-z,G=J.normalize(E),U=T._m;U[0]=G.x*G.x*$+z,U[1]=G.x*G.y*$-G.z*I,U[2]=G.x*G.z*$+G.y*I,U[3]=0,U[4]=G.y*G.x*$+G.z*I,U[5]=G.y*G.y*$+z,U[6]=G.y*G.z*$-G.x*I,U[7]=0,U[8]=G.z*G.x*$-G.y*I,U[9]=G.z*G.y*$+G.x*I,U[10]=G.z*G.z*$+z,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,Te(T)}e.rotationAxisToRef=P;function M(E,g,T){let I=r();return q(E,g,T,I),I}e.rotationYawPitchRoll=M;function q(E,g,T,I){let z=He.Zero();He.fromRotationYawPitchRollToRef(E,g,T,z),Ee(z,I)}e.rotationYawPitchRollToRef=q;function Q(E,g,T){let I=r();return w(E,g,T,I),I}e.scaling=Q;function w(E,g,T,I){u(E,0,0,0,0,g,0,0,0,0,T,0,0,0,0,1,I),se(I,E===1&&g===1&&T===1)}e.scalingToRef=w;function k(E,g,T){let I=r();return V(E,g,T,I),I}e.translation=k;function V(E,g,T,I){u(1,0,0,0,0,1,0,0,0,0,1,0,E,g,T,1,I),se(I,E===0&&g===0&&T===0)}e.translationToRef=V;function K(E,g,T){let I=r();return H(E,g,T,I),I}e.lerp=K;function H(E,g,T,I){for(let z=0;z<16;z++)I._m[z]=E._m[z]*(1-T)+g._m[z]*T;Te(I)}e.lerpToRef=H;function oe(E,g,T){let I=r();return ie(E,g,T,I),I}e.decomposeLerp=oe;function ie(E,g,T,I){let z=J.Zero(),$=He.Zero(),G=J.Zero();ft(E,z,$,G);let U=J.Zero(),ae=He.Zero(),pe=J.Zero();ft(g,U,ae,pe);let ye=J.Zero();J.lerpToRef(z,U,T,ye);let ve=He.Zero();He.slerpToRef($,ae,T,ve);let le=J.Zero();J.lerpToRef(G,pe,T,le),f(ye,ve,le,I)}e.decomposeLerpToRef=ie;function ue(E,g,T){let I=r();return me(E,g,T,I),I}e.LookAtLH=ue;function me(E,g,T,I){let z=J.Zero(),$=J.Zero(),G=J.Zero();J.subtractToRef(g,E,G),J.normalizeToRef(G,G),J.crossToRef(T,G,z);let U=J.lengthSquared(z);U===0?z.x=1:J.normalizeFromLengthToRef(z,Math.sqrt(U),z),J.crossToRef(G,z,$),J.normalizeToRef($,$);let ae=-J.dot(z,E),pe=-J.dot($,E),ye=-J.dot(G,E);u(z.x,$.x,G.x,0,z.y,$.y,G.y,0,z.z,$.z,G.z,0,ae,pe,ye,1,I)}e.lookAtLHToRef=me;function Ae(E,g,T){let I=r();return Fe(E,g,T,I),I}e.lookAtRH=Ae;function Fe(E,g,T,I){let z=J.Zero(),$=J.Zero(),G=J.Zero();J.subtractToRef(E,g,G),J.normalizeToRef(G,G),J.crossToRef(T,G,z);let U=J.lengthSquared(z);U===0?z.x=1:J.normalizeFromLengthToRef(z,Math.sqrt(U),z),J.crossToRef(G,z,$),J.normalizeToRef($,$);let ae=-J.dot(z,E),pe=-J.dot($,E),ye=-J.dot(G,E);u(z.x,$.x,G.x,0,z.y,$.y,G.y,0,z.z,$.z,G.z,0,ae,pe,ye,1,I)}e.lookAtRHToRef=Fe;function Me(E,g,T,I){let z=r();return je(E,g,T,I,z),z}e.orthoLH=Me;function je(E,g,T,I,z){let $=T,G=I,U=2/E,ae=2/g,pe=2/(G-$),ye=-(G+$)/(G-$);u(U,0,0,0,0,ae,0,0,0,0,pe,0,0,0,ye,1,z),se(z,U===1&&ae===1&&pe===1&&ye===0)}e.orthoLHToRef=je;function Pe(E,g,T,I,z,$){let G=r();return D(E,g,T,I,z,$,G),G}e.OrthoOffCenterLH=Pe;function D(E,g,T,I,z,$,G){let U=z,ae=$,pe=2/(g-E),ye=2/(I-T),ve=2/(ae-U),le=-(ae+U)/(ae-U),de=(E+g)/(E-g),Re=(I+T)/(T-I);u(pe,0,0,0,0,ye,0,0,0,0,ve,0,de,Re,le,1,G),Te(G)}e.orthoOffCenterLHToRef=D;function A(E,g,T,I,z,$){let G=r();return F(E,g,T,I,z,$,G),G}e.orthoOffCenterRH=A;function F(E,g,T,I,z,$,G){D(E,g,T,I,z,$,G),G._m[10]*=-1}e.orthoOffCenterRHToRef=F;function ee(E,g,T,I){let z=r(),$=T,G=I,U=2*$/E,ae=2*$/g,pe=(G+$)/(G-$),ye=-2*G*$/(G-$);return u(U,0,0,0,0,ae,0,0,0,0,pe,1,0,0,ye,0,z),se(z,!1),z}e.perspectiveLH=ee;function S(E,g,T,I){let z=r();return L(E,g,T,I,z),z}e.perspectiveFovLH=S;function L(E,g,T,I,z,$=!0){let G=T,U=I,ae=1/Math.tan(E*.5),pe=$?ae/g:ae,ye=$?ae:ae*g,ve=(U+G)/(U-G),le=-2*U*G/(U-G);u(pe,0,0,0,0,ye,0,0,0,0,ve,1,0,0,le,0,z),se(z,!1)}e.perspectiveFovLHToRef=L;function ce(E,g,T,I){let z=r();return xe(E,g,T,I,z),z}e.PerspectiveFovRH=ce;function xe(E,g,T,I,z,$=!0){let G=T,U=I,ae=1/Math.tan(E*.5),pe=$?ae/g:ae,ye=$?ae:ae*g,ve=-(U+G)/(U-G),le=-2*U*G/(U-G);u(pe,0,0,0,0,ye,0,0,0,0,ve,-1,0,0,le,0,z),se(z,!1)}e.perspectiveFovRHToRef=xe;function X(E,g,T,I,z=!1){let $=z?-1:1,G=Math.tan(E.upDegrees*Math.PI/180),U=Math.tan(E.downDegrees*Math.PI/180),ae=Math.tan(E.leftDegrees*Math.PI/180),pe=Math.tan(E.rightDegrees*Math.PI/180),ye=2/(ae+pe),ve=2/(G+U),le=I._m;le[0]=ye,le[1]=le[2]=le[3]=le[4]=0,le[5]=ve,le[6]=le[7]=0,le[8]=(ae-pe)*ye*.5,le[9]=-((G-U)*ve*.5),le[10]=-T/(g-T),le[11]=1*$,le[12]=le[13]=le[15]=0,le[14]=-(2*T*g)/(T-g),Te(I)}e.perspectiveFovWebVRToRef=X;function C(E){return[E._m[0],E._m[1],E._m[4],E._m[5]]}e.GetAsMatrix2x2=C;function R(E){return[E._m[0],E._m[1],E._m[2],E._m[4],E._m[5],E._m[6],E._m[8],E._m[9],E._m[10]]}e.GetAsMatrix3x3=R;function W(E){let g=r();return j(E,g),g}e.transpose=W;function j(E,g){let T=g._m,I=E._m;T[0]=I[0],T[1]=I[4],T[2]=I[8],T[3]=I[12],T[4]=I[1],T[5]=I[5],T[6]=I[9],T[7]=I[13],T[8]=I[2],T[9]=I[6],T[10]=I[10],T[11]=I[14],T[12]=I[3],T[13]=I[7],T[14]=I[11],T[15]=I[15],se(g,E.isIdentity,E._isIdentityDirty)}e.transposeToRef=j;function ne(E){let g=r();return re(E,g),g}e.reflection=ne;function re(E,g){let T=Va.normalize(E),I=T.normal.x,z=T.normal.y,$=T.normal.z,G=-2*I,U=-2*z,ae=-2*$;u(G*I+1,U*I,ae*I,0,G*z,U*z+1,ae*z,0,G*$,U*$,ae*$+1,0,G*T.d,U*T.d,ae*T.d,1,g)}e.reflectionToRef=re;function he(E,g,T,I){u(E.x,E.y,E.z,0,g.x,g.y,g.z,0,T.x,T.y,T.z,0,0,0,0,1,I)}e.fromXYZAxesToRef=he;function Ee(E,g){let T=E.x*E.x,I=E.y*E.y,z=E.z*E.z,$=E.x*E.y,G=E.z*E.w,U=E.z*E.x,ae=E.y*E.w,pe=E.y*E.z,ye=E.x*E.w;g._m[0]=1-2*(I+z),g._m[1]=2*($+G),g._m[2]=2*(U-ae),g._m[3]=0,g._m[4]=2*($-G),g._m[5]=1-2*(z+T),g._m[6]=2*(pe+ye),g._m[7]=0,g._m[8]=2*(U+ae),g._m[9]=2*(pe-ye),g._m[10]=1-2*(I+T),g._m[11]=0,g._m[12]=0,g._m[13]=0,g._m[14]=0,g._m[15]=1,Te(g)}e.fromQuaternionToRef=Ee;function Te(E){E.updateFlag=s++,E.isIdentity=!1,E.isIdentity3x2=!1,E._isIdentityDirty=!0,E._isIdentity3x2Dirty=!0}function Ne(E){if(E._isIdentityDirty){E._isIdentityDirty=!1;let g=E._m;E.isIdentity=g[0]===1&&g[1]===0&&g[2]===0&&g[3]===0&&g[4]===0&&g[5]===1&&g[6]===0&&g[7]===0&&g[8]===0&&g[9]===0&&g[10]===1&&g[11]===0&&g[12]===0&&g[13]===0&&g[14]===0&&g[15]===1}return E.isIdentity}e.isIdentityUpdate=Ne;function ke(E){return E._isIdentity3x2Dirty&&(E._isIdentity3x2Dirty=!1,E._m[0]!==1||E._m[5]!==1||E._m[15]!==1||E._m[1]!==0||E._m[2]!==0||E._m[3]!==0||E._m[4]!==0||E._m[6]!==0||E._m[7]!==0||E._m[8]!==0||E._m[9]!==0||E._m[10]!==0||E._m[11]!==0||E._m[12]!==0||E._m[13]!==0||E._m[14]!==0?E.isIdentity3x2=!1:E.isIdentity3x2=!0),E.isIdentity3x2}e.isIdentityAs3x2Update=ke;function _e(E){if(E.isIdentity===!0)return 1;let g=E._m,T=g[0],I=g[1],z=g[2],$=g[3],G=g[4],U=g[5],ae=g[6],pe=g[7],ye=g[8],ve=g[9],le=g[10],de=g[11],Re=g[12],Ue=g[13],Be=g[14],fe=g[15],Ve=le*fe-Be*de,tt=ve*fe-Ue*de,Ge=ve*Be-Ue*le,Qe=ye*fe-Re*de,ze=ye*Be-le*Re,bt=ye*Ue-Re*ve,Ct=+(U*Ve-ae*tt+pe*Ge),It=-(G*Ve-ae*Qe+pe*ze),Mt=+(G*tt-U*Qe+pe*bt),Xt=-(G*Ge-U*ze+ae*bt);return T*Ct+I*It+z*Mt+$*Xt}e.determinant=_e;function $e(E){return E._m}e.toArray=$e;function qe(E){return E._m}e.asArray=qe;function Ke(E){u(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,E),se(E,!1)}e.reset=Ke;function ot(E,g){let T=r();return vt(E,g,T),T}e.add=ot;function vt(E,g,T){for(let I=0;I<16;I++)T._m[I]=E._m[I]+g._m[I];Te(T)}e.addToRef=vt;function St(E,g){for(let T=0;T<16;T++)E._m[T]+=g._m[T];Te(E)}e.addToSelf=St;function yt(E){let g=r();return Ht(E,g),g}e.invert=yt;function Ht(E,g){if(E.isIdentity===!0){te(E,g);return}let T=E._m,I=T[0],z=T[1],$=T[2],G=T[3],U=T[4],ae=T[5],pe=T[6],ye=T[7],ve=T[8],le=T[9],de=T[10],Re=T[11],Ue=T[12],Be=T[13],fe=T[14],Ve=T[15],tt=de*Ve-fe*Re,Ge=le*Ve-Be*Re,Qe=le*fe-Be*de,ze=ve*Ve-Ue*Re,bt=ve*fe-de*Ue,Ct=ve*Be-Ue*le,It=+(ae*tt-pe*Ge+ye*Qe),Mt=-(U*tt-pe*ze+ye*bt),Xt=+(U*Ge-ae*ze+ye*Ct),Pt=-(U*Qe-ae*bt+pe*Ct),it=I*It+z*Mt+$*Xt+G*Pt;if(it===0){te(E,g);return}let mt=1/it,dt=pe*Ve-fe*ye,Jt=ae*Ve-Be*ye,zt=ae*fe-Be*pe,Bt=U*Ve-Ue*ye,_t=U*fe-Ue*pe,Gt=U*Be-Ue*ae,Kt=pe*Re-de*ye,Xe=ae*Re-le*ye,on=ae*de-le*pe,Dt=U*Re-ve*ye,Dn=U*de-ve*pe,Vn=U*le-ve*ae,Ka=-(z*tt-$*Ge+G*Qe),es=+(I*tt-$*ze+G*bt),gt=-(I*Ge-z*ze+G*Ct),Id=+(I*Qe-z*bt+$*Ct),Bd=+(z*dt-$*Jt+G*zt),Od=-(I*dt-$*Bt+G*_t),kd=+(I*Jt-z*Bt+G*Gt),Md=-(I*zt-z*_t+$*Gt),Pd=-(z*Kt-$*Xe+G*on),zd=+(I*Kt-$*Dt+G*Dn),Fd=-(I*Xe-z*Dt+G*Vn),Ld=+(I*on-z*Dn+$*Vn);u(It*mt,Ka*mt,Bd*mt,Pd*mt,Mt*mt,es*mt,Od*mt,zd*mt,Xt*mt,gt*mt,kd*mt,Fd*mt,Pt*mt,Id*mt,Md*mt,Ld*mt,g)}e.invertToRef=Ht;function Oe(E,g,T){E._m[g]+=T,Te(E)}e.addAtIndex=Oe;function De(E,g,T){return E._m[g]*=T,Te(E),E}e.multiplyAtIndex=De;function Ut(E,g,T,I){E._m[12]=g,E._m[13]=T,E._m[14]=I,Te(E)}e.setTranslationFromFloats=Ut;function tn(E,g){Ut(E,g.x,g.y,g.z)}e.setTranslation=tn;function Yt(E){return J.create(E._m[12],E._m[13],E._m[14])}e.getTranslation=Yt;function rt(E,g){g.x=E._m[12],g.y=E._m[13],g.z=E._m[14]}e.getTranslationToRef=rt;function B(E){let g=E._m;return u(1,0,0,0,0,1,0,0,0,0,1,0,g[12],g[13],g[14],g[15],E),se(E,g[12]===0&&g[13]===0&&g[14]===0&&g[15]===1),E}e.removeRotationAndScaling=B;function Y(E,g){let T=r();return be(E,g,T),T}e.multiply=Y;function te(E,g){we(E,g._m),se(g,E.isIdentity,E._isIdentityDirty,E.isIdentity3x2,E._isIdentity3x2Dirty)}e.copy=te;function we(E,g,T=0){for(let I=0;I<16;I++)g[T+I]=E._m[I]}e.copyToArray=we;function be(E,g,T){if(E.isIdentity){te(g,T);return}if(g.isIdentity){te(E,T);return}Ce(E,g,T._m,0),Te(T)}e.multiplyToRef=be;function Ce(E,g,T,I){let z=E._m,$=g._m,G=z[0],U=z[1],ae=z[2],pe=z[3],ye=z[4],ve=z[5],le=z[6],de=z[7],Re=z[8],Ue=z[9],Be=z[10],fe=z[11],Ve=z[12],tt=z[13],Ge=z[14],Qe=z[15],ze=$[0],bt=$[1],Ct=$[2],It=$[3],Mt=$[4],Xt=$[5],Pt=$[6],it=$[7],mt=$[8],dt=$[9],Jt=$[10],zt=$[11],Bt=$[12],_t=$[13],Gt=$[14],Kt=$[15];T[I]=G*ze+U*Mt+ae*mt+pe*Bt,T[I+1]=G*bt+U*Xt+ae*dt+pe*_t,T[I+2]=G*Ct+U*Pt+ae*Jt+pe*Gt,T[I+3]=G*It+U*it+ae*zt+pe*Kt,T[I+4]=ye*ze+ve*Mt+le*mt+de*Bt,T[I+5]=ye*bt+ve*Xt+le*dt+de*_t,T[I+6]=ye*Ct+ve*Pt+le*Jt+de*Gt,T[I+7]=ye*It+ve*it+le*zt+de*Kt,T[I+8]=Re*ze+Ue*Mt+Be*mt+fe*Bt,T[I+9]=Re*bt+Ue*Xt+Be*dt+fe*_t,T[I+10]=Re*Ct+Ue*Pt+Be*Jt+fe*Gt,T[I+11]=Re*It+Ue*it+Be*zt+fe*Kt,T[I+12]=Ve*ze+tt*Mt+Ge*mt+Qe*Bt,T[I+13]=Ve*bt+tt*Xt+Ge*dt+Qe*_t,T[I+14]=Ve*Ct+tt*Pt+Ge*Jt+Qe*Gt,T[I+15]=Ve*It+tt*it+Ge*zt+Qe*Kt}e.multiplyToArray=Ce;function Ie(E,g){let T=g;if(!T)return!1;if((E.isIdentity||T.isIdentity)&&!E._isIdentityDirty&&!T._isIdentityDirty)return E.isIdentity&&T.isIdentity;let I=E._m,z=T._m;return I[0]===z[0]&&I[1]===z[1]&&I[2]===z[2]&&I[3]===z[3]&&I[4]===z[4]&&I[5]===z[5]&&I[6]===z[6]&&I[7]===z[7]&&I[8]===z[8]&&I[9]===z[9]&&I[10]===z[10]&&I[11]===z[11]&&I[12]===z[12]&&I[13]===z[13]&&I[14]===z[14]&&I[15]===z[15]}e.equals=Ie;function lt(E){let g=r();return te(E,g),g}e.clone=lt;function Nt(E){let g=E._m[0]||0;for(let T=1;T<16;T++)g=g*397^(E._m[T]||0);return g}e.getHashCode=Nt;function ft(E,g,T,I){if(E.isIdentity)return I&&(I.x=0,I.y=0,I.z=0),g&&(g.x=1,g.y=1,g.z=1),T&&(T.w=1,T.x=0,T.y=0,T.z=0),!0;let z=E._m;I&&(I.x=z[12],I.y=z[13],I.z=z[14]);let $=g||J.Zero();if($.x=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),$.y=Math.sqrt(z[4]*z[4]+z[5]*z[5]+z[6]*z[6]),$.z=Math.sqrt(z[8]*z[8]+z[9]*z[9]+z[10]*z[10]),_e(E)<=0&&($.y*=-1),$.x===0||$.y===0||$.z===0)return T&&(T.w=1,T.x=0,T.y=0,T.z=0),!1;if(T){let G=1/$.x,U=1/$.y,ae=1/$.z,pe=r();u(z[0]*G,z[1]*G,z[2]*G,0,z[4]*U,z[5]*U,z[6]*U,0,z[8]*ae,z[9]*ae,z[10]*ae,0,0,0,0,1,pe),He.fromRotationMatrixToRef(pe,T)}return!0}e.decompose=ft;function nn(E,g,T,I,z,$){if(g<0||g>3)return;let G=g*4;E._m[G+0]=T,E._m[G+1]=I,E._m[G+2]=z,E._m[G+3]=$,Te(E)}e.setRowFromFloats=nn;function ln(E,g){let T=r();return En(E,g,T),T}e.scale=ln;function En(E,g,T){for(let I=0;I<16;I++)T._m[I]=E._m[I]*g;Te(T)}e.scaleToRef=En;function Bn(E,g,T){for(let I=0;I<16;I++)T._m[I]+=E._m[I]*g;Te(T)}e.scaleAndAddToRef=Bn;function Wr(E,g){let T=r();Ht(E,T),j(T,g);let I=g._m;u(I[0],I[1],I[2],0,I[4],I[5],I[6],0,I[8],I[9],I[10],0,0,0,0,1,g)}e.normalMatrixToRef=Wr;function bo(E){let g=r();return zo(E,g),g}e.getRotationMatrix=bo;function zo(E,g){let T=J.Zero();if(!ft(E,T)){g=y();return}let I=E._m,z=1/T.x,$=1/T.y,G=1/T.z;u(I[0]*z,I[1]*z,I[2]*z,0,I[4]*$,I[5]*$,I[6]*$,0,I[8]*G,I[9]*G,I[10]*G,0,0,0,0,1,g)}e.getRotationMatrixToRef=zo;function qr(E){E._m[2]*=-1,E._m[6]*=-1,E._m[8]*=-1,E._m[9]*=-1,E._m[14]*=-1,Te(E)}e.toggleModelMatrixHandInPlace=qr;function Fo(E){E._m[8]*=-1,E._m[9]*=-1,E._m[10]*=-1,E._m[11]*=-1,Te(E)}e.toggleProjectionMatrixHandInPlace=Fo;function se(E,g,T=!1,I=!1,z=!0){E.updateFlag=s++,E.isIdentity=g,E.isIdentity3x2=g||I,E._isIdentityDirty=E.isIdentity?!1:T,E._isIdentity3x2Dirty=E.isIdentity3x2?!1:z}})(Ln||(Ln={}));var He;(function(e){function n(w=0,k=0,V=0,K=1){return{x:w,y:k,z:V,w:K}}e.create=n;function s(w,k){return{x:w.x+k.x,y:w.y+k.y,z:w.z+k.z,w:w.w+k.w}}e.add=s;function t(w,k,V){let K=k*.5,H=w*.5,oe=V*.5,ie=Math.cos(K),ue=Math.cos(H),me=Math.cos(oe),Ae=Math.sin(K),Fe=Math.sin(H),Me=Math.sin(oe);return n(ue*Ae*me+Fe*ie*Me,Fe*ie*me-ue*Ae*Me,ue*ie*Me-Fe*Ae*me,ue*ie*me+Fe*Ae*Me)}e.fromRotationYawPitchRoll=t;function a(w,k,V){return t(k*ui,w*ui,V*ui)}e.fromEulerDegrees=a;function r(w){return Math.sqrt(c(w))}e.length=r;function c(w){return w.x*w.x+w.y*w.y+w.z*w.z+w.w*w.w}e.lengthSquared=c;function o(w,k){return w.x*k.x+w.y*k.y+w.z*k.z+w.w*k.w}e.dot=o;function i(w,k){let V=o(w,k);return Math.acos(Math.min(Math.abs(V),1))*2*fi}e.angle=i;function u(w,k,V){let K=i(w,k);if(K===0)return k;let H=Math.min(1,V/K);return p(w,k,H)}e.rotateTowards=u;function h(w,k={x:0,y:1,z:0}){let V=J.normalize(w),K=J.normalize(J.cross(k,V)),H=J.cross(V,K),oe=K.x,ie=K.y,ue=K.z,me=H.x,Ae=H.y,Fe=H.z,Me=V.x,je=V.y,Pe=V.z,D=oe+Ae+Pe,A=n();if(D>0){let S=Math.sqrt(D+1);return A.w=S*.5,S=.5/S,A.x=(Fe-je)*S,A.y=(Me-ue)*S,A.z=(ie-me)*S,A}if(oe>=Ae&&oe>=Pe){let S=Math.sqrt(1+oe-Ae-Pe),L=.5/S;return A.x=.5*S,A.y=(ie+me)*L,A.z=(ue+Me)*L,A.w=(Fe-je)*L,A}if(Ae>Pe){let S=Math.sqrt(1+Ae-oe-Pe),L=.5/S;return A.x=(me+ie)*L,A.y=.5*S,A.z=(je+Fe)*L,A.w=(Me-ue)*L,A}let F=Math.sqrt(1+Pe-oe-Ae),ee=.5/F;return A.x=(Me+ue)*ee,A.y=(je+Fe)*ee,A.z=.5*F,A.w=(ie-me)*ee,A}e.lookRotation=h;function m(w){let k=1/r(w);return n(w.x*k,w.y*k,w.z*k,w.w*k)}e.normalize=m;function f(w,k,V=J.Up()){let K=J.normalize(w),H=J.normalize(k),oe=J.cross(K,H),ie=Math.sqrt(J.lengthSquared(K)*J.lengthSquared(H))+J.dot(K,H);return J.lengthSquared(oe)<1e-4?Math.abs(ie)<1e-4?m(n(V.x,V.y,V.z,0)):y():m(n(oe.x,oe.y,oe.z,ie))}e.fromToRotation=f;function y(){return n(0,0,0,1)}e.Identity=y;function l(w){let k=J.create(),V=w.x*w.x+w.y*w.y+w.z*w.z+w.w*w.w,K=w.x*w.w-w.y*w.z;return K>.4995*V?(k.x=Math.PI/2,k.y=2*Math.atan2(w.y,w.x),k.z=0):K<-.4995*V?(k.x=-Math.PI/2,k.y=-2*Math.atan2(w.y,w.x),k.z=0):(k.x=Math.asin(2*(w.w*w.x-w.y*w.z)),k.y=Math.atan2(2*w.w*w.y+2*w.z*w.x,1-2*(w.x*w.x+w.y*w.y)),k.z=Math.atan2(2*w.w*w.z+2*w.x*w.y,1-2*(w.z*w.z+w.x*w.x))),k.x*=fi,k.y*=fi,k.z*=fi,k.x=ht.repeat(k.x,360),k.y=ht.repeat(k.y,360),k.z=ht.repeat(k.z,360),k}e.toEulerAngles=l;function d(w,k,V,K){let H=k*.5,oe=w*.5,ie=V*.5,ue=Math.cos(H),me=Math.cos(oe),Ae=Math.cos(ie),Fe=Math.sin(H),Me=Math.sin(oe),je=Math.sin(ie);K.x=me*Fe*Ae+Me*ue*je,K.y=Me*ue*Ae-me*Fe*je,K.z=me*ue*je-Me*Fe*Ae,K.w=me*ue*Ae+Me*Fe*je}e.fromRotationYawPitchRollToRef=d;function v(w,k){let V=w._m,K=V[0],H=V[4],oe=V[8],ie=V[1],ue=V[5],me=V[9],Ae=V[2],Fe=V[6],Me=V[10],je=K+ue+Me,Pe;je>0?(Pe=.5/Math.sqrt(je+1),k.w=.25/Pe,k.x=(Fe-me)*Pe,k.y=(oe-Ae)*Pe,k.z=(ie-H)*Pe):K>ue&&K>Me?(Pe=2*Math.sqrt(1+K-ue-Me),k.w=(Fe-me)/Pe,k.x=.25*Pe,k.y=(H+ie)/Pe,k.z=(oe+Ae)/Pe):ue>Me?(Pe=2*Math.sqrt(1+ue-K-Me),k.w=(oe-Ae)/Pe,k.x=(H+ie)/Pe,k.y=.25*Pe,k.z=(me+Fe)/Pe):(Pe=2*Math.sqrt(1+Me-K-ue),k.w=(ie-H)/Pe,k.x=(oe+Ae)/Pe,k.y=(me+Fe)/Pe,k.z=.25*Pe)}e.fromRotationMatrixToRef=v;function p(w,k,V){let K=e.Identity();return e.slerpToRef(w,k,V,K),K}e.slerp=p;function x(w,k,V,K){let H,oe,ie=w.x*k.x+w.y*k.y+w.z*k.z+w.w*k.w,ue=!1;if(ie<0&&(ue=!0,ie=-ie),ie>.999999)oe=1-V,H=ue?-V:V;else{let me=Math.acos(ie),Ae=1/Math.sin(me);oe=Math.sin((1-V)*me)*Ae,H=ue?-Math.sin(V*me)*Ae:Math.sin(V*me)*Ae}K.x=oe*w.x+H*k.x,K.y=oe*w.y+H*k.y,K.z=oe*w.z+H*k.z,K.w=oe*w.w+H*k.w}e.slerpToRef=x;function b(w,k){let V=n(0,0,0,1);return O(w,k,V),V}e.multiply=b;function O(w,k,V){V.x=w.x*k.w+w.y*k.z-w.z*k.y+w.w*k.x,V.y=-w.x*k.z+w.y*k.w+w.z*k.x+w.w*k.y,V.z=w.x*k.y-w.y*k.x+w.z*k.w+w.w*k.z,V.w=-w.x*k.x-w.y*k.y-w.z*k.z+w.w*k.w}e.multiplyToRef=O;function N(w,k){if(J.lengthSquared(k)===0)return e.Identity();let V=y(),K=w*ui;K*=.5;let H=J.normalize(k);return J.scaleToRef(H,Math.sin(K),H),V.x=H.x,V.y=H.y,V.z=H.z,V.w=Math.cos(K),m(V)}e.fromAngleAxis=N;function _(w,k,V){let K=e.create(0,0,0,0);return P(w,k,V,K),K}e.fromAxisToRotationQuaternion=_;function P(w,k,V,K){let H=Ln.create();Ln.fromXYZAxesToRef(J.normalize(w),J.normalize(k),J.normalize(V),H),e.fromRotationMatrixToRef(H,K)}e.fromAxisToRotationQuaternionToRef=P;function M(){return n(0,0,0,0)}e.Zero=M;function q(w,k,V=J.Up()){let K=e.Identity();return Q(w,k,V,K),K}e.fromLookAt=q;function Q(w,k,V=J.Up(),K){let H=Ln.Identity();Ln.lookAtLHToRef(w,k,V,H),Ln.invertToRef(H,H),e.fromRotationMatrixToRef(H,K)}e.fromLookAtToRef=Q})(He||(He={}));var yn;(function(e){function n(A=0,F=0,ee=0,S=1){return{r:A,g:F,b:ee,a:S}}e.create=n;function s(A){if(A.substring(0,1)!=="#"||A.length!==7&&A.length!==9)return n(0,0,0,1);let F=parseInt(A.substring(1,3),16),ee=parseInt(A.substring(3,5),16),S=parseInt(A.substring(5,7),16),L=A.substring(7,9),ce=L?parseInt(L,16):255;return e.fromInts(F,ee,S,ce)}e.fromHexString=s;function t(A,F,ee){let S=n(0,0,0,0);return e.lerpToRef(A,F,ee,S),S}e.lerp=t;function a(A,F,ee,S){S.r=A.r+(F.r-A.r)*ee,S.g=A.g+(F.g-A.g)*ee,S.b=A.b+(F.b-A.b)*ee,S.a=A.a+(F.a-A.a)*ee}e.lerpToRef=a;function r(){return n(1,0,0,1)}e.Red=r;function c(){return n(0,1,0,1)}e.Green=c;function o(){return n(0,0,1,1)}e.Blue=o;function i(){return n(0,0,0,1)}e.Black=i;function u(){return n(1,1,1,1)}e.White=u;function h(){return n(.5,0,.5,1)}e.Purple=h;function m(){return n(1,0,1,1)}e.Magenta=m;function f(){return n(1,1,0,1)}e.Yellow=f;function y(){return n(.5,.5,.5,1)}e.Gray=y;function l(){return n(0,1,1,1)}e.Teal=l;function d(){return n(0,0,0,0)}e.Clear=d;function v(A,F=1){return n(A.r,A.g,A.b,F)}e.fromColor3=v;function p(A,F=0){return n(A[F],A[F+1],A[F+2],A[F+3])}e.fromArray=p;function x(A,F,ee,S){return n(A/255,F/255,ee/255,S/255)}e.fromInts=x;function b(A,F){if(A.length===F*3){let ee=[];for(let S=0;S<A.length;S+=3){let L=S/3*4;ee[L]=A[S],ee[L+1]=A[S+1],ee[L+2]=A[S+2],ee[L+3]=1}return ee}return A}e.checkColors4=b;function O(A,F,ee){ee.r=A.r+F.r,ee.g=A.g+F.g,ee.b=A.b+F.b,ee.a=A.a+F.a}e.addToRef=O;function N(A,F,ee=0){F[ee]=A.r,F[ee+1]=A.g,F[ee+2]=A.b,F[ee+3]=A.a}e.toArray=N;function _(A,F){let ee=d();return O(A,F,ee),ee}e.add=_;function P(A,F){let ee=d();return M(A,F,ee),ee}e.subtract=P;function M(A,F,ee){ee.r=A.r-F.r,ee.g=A.g-F.g,ee.b=A.b-F.b,ee.a=A.a-F.a}e.subtractToRef=M;function q(A,F){return n(A.r*F,A.g*F,A.b*F,A.a*F)}e.scale=q;function Q(A,F,ee){ee.r=A.r*F,ee.g=A.g*F,ee.b=A.b*F,ee.a=A.a*F}e.scaleToRef=Q;function w(A,F,ee){ee.r+=A.r*F,ee.g+=A.g*F,ee.b+=A.b*F,ee.a+=A.a*F}e.scaleAndAddToRef=w;function k(A,F=0,ee=1,S){S.r=ht.clamp(A.r,F,ee),S.g=ht.clamp(A.g,F,ee),S.b=ht.clamp(A.b,F,ee),S.a=ht.clamp(A.a,F,ee)}e.clampToRef=k;function V(A,F){return n(A.r*F.r,A.g*F.g,A.b*F.b,A.a*F.a)}e.multiply=V;function K(A,F,ee){ee.r=A.r*F.r,ee.g=A.g*F.g,ee.b=A.b*F.b,ee.a=A.a*F.a}e.multiplyToRef=K;function H(A){return"{R: "+A.r+" G:"+A.g+" B:"+A.b+" A:"+A.a+"}"}e.toString=H;function oe(A){let F=A.r||0;return F=F*397^(A.g||0),F=F*397^(A.b||0),F=F*397^(A.a||0),F}e.getHashCode=oe;function ie(A){return n(A.r,A.g,A.b,A.a)}e.clone=ie;function ue(A,F){F.r=A.r,F.g=A.g,F.b=A.b,F.a=A.a}e.copyFrom=ue;function me(A,F,ee,S,L){L.r=A,L.g=F,L.b=ee,L.a=S}e.copyFromFloats=me;function Ae(A,F,ee,S,L){L.r=A,L.g=F,L.b=ee,L.a=S}e.set=Ae;function Fe(A){let F=A.r*255|0,ee=A.g*255|0,S=A.b*255|0,L=A.a*255|0;return"#"+ht.toHex(F)+ht.toHex(ee)+ht.toHex(S)+ht.toHex(L)}e.toHexString=Fe;function Me(A){let F=n();return je(A,F),F}e.toLinearSpace=Me;function je(A,F){F.r=Math.pow(A.r,vo),F.g=Math.pow(A.g,vo),F.b=Math.pow(A.b,vo),F.a=A.a}e.toLinearSpaceToRef=je;function Pe(A){let F=n();return D(A,F),F}e.toGammaSpace=Pe;function D(A,F){F.r=Math.pow(A.r,yo),F.g=Math.pow(A.g,yo),F.b=Math.pow(A.b,yo),F.a=A.a}e.toGammaSpaceToRef=D})(yn||(yn={}));var Mr;(function(e){function n(S=0,L=0,ce=0){return{r:S,g:L,b:ce}}e.create=n;function s(S){if(S.substring(0,1)!=="#"||S.length!==7)return n(0,0,0);let L=parseInt(S.substring(1,3),16),ce=parseInt(S.substring(3,5),16),xe=parseInt(S.substring(5,7),16);return a(L,ce,xe)}e.fromHexString=s;function t(S,L=0){return n(S[L],S[L+1],S[L+2])}e.fromArray=t;function a(S,L,ce){return n(S/255,L/255,ce/255)}e.fromInts=a;function r(S,L,ce){let xe=n(0,0,0);return e.lerpToRef(S,L,ce,xe),xe}e.lerp=r;function c(S,L,ce,xe){xe.r=S.r+(L.r-S.r)*ce,xe.g=S.g+(L.g-S.g)*ce,xe.b=S.b+(L.b-S.b)*ce}e.lerpToRef=c;function o(){return n(1,0,0)}e.Red=o;function i(){return n(0,1,0)}e.Green=i;function u(){return n(0,0,1)}e.Blue=u;function h(){return n(0,0,0)}e.Black=h;function m(){return n(1,1,1)}e.White=m;function f(){return n(.5,0,.5)}e.Purple=f;function y(){return n(1,0,1)}e.Magenta=y;function l(){return n(1,1,0)}e.Yellow=l;function d(){return n(.5,.5,.5)}e.Gray=d;function v(){return n(0,1,1)}e.Teal=v;function p(){return n(Math.random(),Math.random(),Math.random())}e.Random=p;function x(S){return"{R: "+S.r+" G:"+S.g+" B:"+S.b+"}"}e.toString=x;function b(S){let L=S.r||0;return L=L*397^(S.g||0),L=L*397^(S.b||0),L}e.getHashCode=b;function O(S,L,ce=0){L[ce]=S.r,L[ce+1]=S.g,L[ce+2]=S.b}e.toArray=O;function N(S,L=1){return yn.create(S.r,S.g,S.b,L)}e.toColor4=N;function _(S){let L=new Array;return O(S,L,0),L}e.asArray=_;function P(S){return S.r*.3+S.g*.59+S.b*.11}e.toLuminance=P;function M(S,L){return n(S.r*L.r,S.g*L.g,S.b*L.b)}e.multiply=M;function q(S,L,ce){ce.r=S.r*L.r,ce.g=S.g*L.g,ce.b=S.b*L.b}e.multiplyToRef=q;function Q(S,L){return L&&S.r===L.r&&S.g===L.g&&S.b===L.b}e.equals=Q;function w(S,L,ce,xe){return S.r===L&&S.g===ce&&S.b===xe}e.equalsFloats=w;function k(S,L){return n(S.r*L,S.g*L,S.b*L)}e.scale=k;function V(S,L,ce){ce.r=S.r*L,ce.g=S.g*L,ce.b=S.b*L}e.scaleToRef=V;function K(S,L,ce){ce.r+=S.r*L,ce.g+=S.g*L,ce.b+=S.b*L}e.scaleAndAddToRef=K;function H(S,L=0,ce=1,xe){xe.r=ht.clamp(S.r,L,ce),xe.g=ht.clamp(S.g,L,ce),xe.b=ht.clamp(S.b,L,ce)}e.clampToRef=H;function oe(S,L=0,ce=1){let xe=e.Black();return H(S,L,ce,xe),xe}e.clamp=oe;function ie(S,L){return n(S.r+L.r,S.g+L.g,S.b+L.b)}e.add=ie;function ue(S,L,ce){ce.r=S.r+L.r,ce.g=S.g+L.g,ce.b=S.b+L.b}e.addToRef=ue;function me(S,L){return n(S.r-L.r,S.g-L.g,S.b-L.b)}e.subtract=me;function Ae(S,L,ce){ce.r=S.r-L.r,ce.g=S.g-L.g,ce.b=S.b-L.b}e.subtractToRef=Ae;function Fe(S){return n(S.r,S.g,S.b)}e.clone=Fe;function Me(S,L){L.r=S.r,L.g=S.g,L.b=S.b}e.copyFrom=Me;function je(S,L,ce,xe){S.r=L,S.g=ce,S.b=xe}e.set=je;function Pe(S){let L=S.r*255|0,ce=S.g*255|0,xe=S.b*255|0;return"#"+ht.toHex(L)+ht.toHex(ce)+ht.toHex(xe)}e.toHexString=Pe;function D(S){let L=n();return A(S,L),L}e.toLinearSpace=D;function A(S,L){L.r=Math.pow(S.r,vo),L.g=Math.pow(S.g,vo),L.b=Math.pow(S.b,vo)}e.toLinearSpaceToRef=A;function F(S){let L=n();return ee(S,L),L}e.toGammaSpace=F;function ee(S,L){L.r=Math.pow(S.r,yo),L.g=Math.pow(S.g,yo),L.b=Math.pow(S.b,yo)}e.toGammaSpaceToRef=ee})(Mr||(Mr={}));var li=Se.defineComponent("BoxBody",{boxBodyId:Z.Number}),vn=Se.defineComponent("Marker",{mouseConstraintId:Z.Number,isPointerPressed:Z.Boolean,isEKeyPressed:Z.Boolean,markerDistance:Z.Number}),Wa=1,Xs={albedoColor:yn.create(5,2.5,1)},Ul={albedoColor:yn.create(5,1,3.5)};var wt=Ze(Qs());var qt;function Vl(){qt=new wt.World,qt.quatNormalizeSkip=0,qt.quatNormalizeFast=!1,qt.gravity.set(0,-9.82,0),qt.broadphase=new wt.NaiveBroadphase;let e=new wt.Plane,n=new wt.Body({mass:0});n.addShape(e),n.quaternion.setFromAxisAngle(new wt.Vec3(1,0,0),-Math.PI/2),n.position.y=.1,qt.addBody(n);let s=new wt.Box(new wt.Vec3(32,50,1)),t=new wt.Body({mass:0,shape:s,position:new wt.Vec3(40,29,94)});qt.addBody(t);let a=new wt.Body({mass:0,shape:s,position:new wt.Vec3(40,25,1.5)});qt.addBody(a);let r=new wt.Body({mass:0,shape:s,position:new wt.Vec3(1.5,25,48)});r.quaternion.setFromAxisAngle(new wt.Vec3(0,1,0),-Math.PI/2),qt.addBody(r);let c=new wt.Body({mass:0,shape:s,position:new wt.Vec3(32,25,16)});c.quaternion.setFromAxisAngle(new wt.Vec3(0,1,0),-Math.PI/2),qt.addBody(c)}var nm=1e3;function Jn(e){let n=Se.addEntity(),s=li.create(n,{boxBodyId:nm++});We.create(n,{position:e}),mn.setPbrMaterial(n,{albedoColor:yn.Red()}),Ar.create(n,{src:"models/crate.glb"}),Sl.create(n,{pointerEvents:[{eventType:Qn.PET_DOWN,eventInfo:{button:Zn.IA_POINTER}}]});let t=new wt.Box(new wt.Vec3(.5,.5,.5)),a=new wt.Body({mass:5});a.addShape(t),a.id=s.boxBodyId,a.position.set(e.x,e.y,e.z),a.linearDamping=.4,a.angularDamping=.4,qt.addBody(a)}function Wl(e){qt.step(e);for(let[n,s]of Se.getEntitiesWith(li)){let t=qt.bodies.find(a=>a.id===s.boxBodyId);if(t){let a=We.getMutable(n);a.position=J.create(t.position.x,t.position.y,t.position.z),a.rotation=He.create(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w)}}}function ql(e){qt.addBody(e)}function Hl(e){qt.addConstraint(e)}function Gl(){qt.constraints=[]}function Yl(e){qt.removeConstraint(e)}function qa(e){return qt.bodies.find(n=>n.id===e)}function Js(e){let n=qt.constraints.find(s=>s.id===e);return n||(console.log("CONSTRAINT NOT FOUND. ID: ",e," FULL LIST: ",qt),console.log(qt),null)}var Kn=Ze(Qs());function Mo(){let e=Array.from(Se.getEntitiesWith(vn));if(e.length>0)return e[0][0];throw new Error("No marker found")}function jl(){let e=Se.addEntity();Yn.setSphere(e),We.create(e,{scale:J.Zero()}),mn.setPbrMaterial(e,Xs),vn.create(e);let n=new Kn.Sphere(.1),s=new Kn.Body({mass:0});s.addShape(n),s.collisionFilterGroup=0,s.collisionFilterMask=0,s.id=Wa,ql(s)}function om(e,n,s,t){let a=qa(t);if(!a)return;let r=new Kn.Vec3(e,n,s).vsub(a.position),o=a.quaternion.inverse().vmult(r),i=qa(Wa);if(!i)return;i.position.set(e,n,s);let u=new Kn.PointToPointConstraint(a,o,i,new Kn.Vec3(0,0,0));u.id=vn.getMutable(Mo()).mouseConstraintId++,Hl(u)}function rm(e,n,s){qa(Wa)?.position.set(e,n,s),Js(vn.getMutable(Mo()).mouseConstraintId)?.update()}function im(){let e=vn.get(Mo()),n=Js(e.mouseConstraintId);console.log("MARKER REMOVED",e,n),n?Yl(n):Gl()}function $l(){let e=Mo(),n=vn.get(e),s=_r.getInputCommand(Zn.IA_POINTER,Qn.PET_DOWN);if(s&&!n.isPointerPressed){let t=vn.getMutable(e);if(t.isPointerPressed=!0,s.hit&&s.hit.length!==0&&s.hit.entityId){let a=li.getOrNull(s.hit.entityId);if(a){We.getMutable(e).scale=J.create(.1,.1,.1),t.markerDistance=s.hit.length;let r=s.hit?.position;r&&om(r.x,r.y,r.z,a.boxBodyId)}}}if(_r.isTriggered(Zn.IA_POINTER,Qn.PET_UP)&&n.isPointerPressed){let t=vn.getMutable(e);We.getMutable(e).scale=J.Zero(),t.isPointerPressed=!1,t.markerDistance=0,im()}_r.isTriggered(Zn.IA_PRIMARY,Qn.PET_DOWN)&&(vn.getMutable(e).isEKeyPressed=!0,mn.setPbrMaterial(e,Ul)),_r.isTriggered(Zn.IA_PRIMARY,Qn.PET_UP)&&(vn.getMutable(e).isEKeyPressed=!1,mn.setPbrMaterial(e,Xs))}function Xl(e){let n=vn.get(Mo());if(n.isPointerPressed&&n.markerDistance!==0){let s=Mo(),t=We.get(Se.CameraEntity),a=J.rotate(J.scale(J.Forward(),vn.getMutable(s).markerDistance),t.rotation),r=J.add(t.position,a);We.getMutable(s).position=r;let c=We.get(s).position;rm(c.x,c.y,c.z)}n.isEKeyPressed&&n.markerDistance!==0&&n.markerDistance>1&&(vn.getMutable(Mo()).markerDistance-=5*e)}function Zl(e,n,s){let a=Pr(At.ACTION_TYPES,e).getOrCreateMutable(e.RootEntity),r={type:n,jsonSchema:JSON.stringify(s?.jsonSchema||Z.Map({}).jsonSchema)};a.value=[...a.value.filter(c=>c.type!==r.type),r]}function at(e){return JSON.parse(e.jsonPayload)}var At;(function(e){e.ACTION_TYPES="asset-packs::ActionTypes",e.ACTIONS="asset-packs::Actions",e.COUNTER="asset-packs::Counter",e.TRIGGERS="asset-packs::Triggers",e.STATES="asset-packs::States"})(At||(At={}));var eo;(function(e){e.MOVE_ITEM="move_item",e.ROTATE_ITEM="rotate_item",e.SCALE_ITEM="scale_item"})(eo||(eo={}));var di;(function(e){e.LINEAR="linear",e.EASEINQUAD="easeinquad",e.EASEOUTQUAD="easeoutquad",e.EASEQUAD="easequad",e.EASEINSINE="easeinsine",e.EASEOUTSINE="easeoutsine",e.EASESINE="easeinoutsine",e.EASEINEXPO="easeinexpo",e.EASEOUTEXPO="easeoutexpo",e.EASEEXPO="easeinoutexpo",e.EASEINELASTIC="easeinelastic",e.EASEOUTELASTIC="easeoutelastic",e.EASEELASTIC="easeinoutelastic",e.EASEINBOUNCE="easeinbounce",e.EASEOUTEBOUNCE="easeoutbounce",e.EASEBOUNCE="easeinoutbounce"})(di||(di={}));var Le;(function(e){e.PLAY_ANIMATION="play_animation",e.STOP_ANIMATION="stop_animation",e.SET_STATE="set_state",e.START_TWEEN="start_tween",e.SET_COUNTER="set_counter",e.INCREMENT_COUNTER="increment_counter",e.DECREASE_COUNTER="decrease_counter",e.PLAY_SOUND="play_sound",e.STOP_SOUND="stop_sound",e.SET_VISIBILITY="set_visibility",e.ATTACH_TO_PLAYER="attach_to_player",e.DETACH_FROM_PLAYER="detach_from_player",e.PLAY_VIDEO_STREAM="play_video_stream",e.STOP_VIDEO_STREAM="stop_video_stream",e.PLAY_AUDIO_STREAM="play_audio_stream",e.STOP_AUDIO_STREAM="stop_audio_stream",e.TELEPORT_PLAYER="teleport_player",e.MOVE_PLAYER="move_player",e.PLAY_DEFAULT_EMOTE="play_default_emote",e.PLAY_CUSTOM_EMOTE="play_custom_emote",e.OPEN_LINK="open_link",e.SHOW_TEXT="show_text",e.HIDE_TEXT="hide_text",e.START_DELAY="start_delay",e.STOP_DELAY="stop_delay",e.START_LOOP="start_loop",e.STOP_LOOP="stop_loop",e.CLONE_ENTITY="clone_entity",e.REMOVE_ENTITY="remove_entity",e.SHOW_IMAGE="show_image",e.HIDE_IMAGE="hide_image"})(Le||(Le={}));var kt;(function(e){e.ON_CLICK="on_click",e.ON_STATE_CHANGE="on_state_change",e.ON_SPAWN="on_spawn",e.ON_TWEEN_END="on_tween_end",e.ON_COUNTER_CHANGE="on_counter_change",e.ON_PLAYER_ENTERS_AREA="on_player_enters_area",e.ON_PLAYER_LEAVES_AREA="on_player_leaves_area",e.ON_DELAY="on_delay",e.ON_LOOP="on_loop",e.ON_CLONE="on_clone",e.ON_CLICK_IMAGE="on_click_image"})(kt||(kt={}));var un;(function(e){e.WHEN_STATE_IS="when_state_is",e.WHEN_STATE_IS_NOT="when_state_is_not",e.WHEN_COUNTER_EQUALS="when_counter_equals",e.WHEN_COUNTER_IS_GREATER_THAN="when_counter_is_greater_than",e.WHEN_COUNTER_IS_LESS_THAN="when_counter_is_less_than"})(un||(un={}));var to;(function(e){e.AND="and",e.OR="or"})(to||(to={}));var Et;(function(e){e[e.TAM_TOP_LEFT=0]="TAM_TOP_LEFT",e[e.TAM_TOP_CENTER=1]="TAM_TOP_CENTER",e[e.TAM_TOP_RIGHT=2]="TAM_TOP_RIGHT",e[e.TAM_MIDDLE_LEFT=3]="TAM_MIDDLE_LEFT",e[e.TAM_MIDDLE_CENTER=4]="TAM_MIDDLE_CENTER",e[e.TAM_MIDDLE_RIGHT=5]="TAM_MIDDLE_RIGHT",e[e.TAM_BOTTOM_LEFT=6]="TAM_BOTTOM_LEFT",e[e.TAM_BOTTOM_CENTER=7]="TAM_BOTTOM_CENTER",e[e.TAM_BOTTOM_RIGHT=8]="TAM_BOTTOM_RIGHT"})(Et||(Et={}));var Po;(function(e){e[e.F_SANS_SERIF=0]="F_SANS_SERIF",e[e.F_SERIF=1]="F_SERIF",e[e.F_MONOSPACE=2]="F_MONOSPACE"})(Po||(Po={}));function Ks(e){return{all:e=e||new Map,on:function(n,s){var t=e.get(n);t?t.push(s):e.set(n,[s])},off:function(n,s){var t=e.get(n);t&&(s?t.splice(t.indexOf(s)>>>0,1):e.set(n,[]))},emit:function(n,s){var t=e.get(n);t&&t.slice().map(function(a){a(s)}),(t=e.get("*"))&&t.slice().map(function(a){a(n,s)})}}}var ec=new Map,tc=new Map;function fn(e){return ec.has(e)||ec.set(e,Ks()),ec.get(e)}function zr(e){return tc.has(e)||tc.set(e,Ks()),tc.get(e)}var am=[At.ACTIONS,At.STATES,At.COUNTER];function sm(e){return e.getComponent(At.COUNTER)}function Ql(e){let s=sm(e).getOrCreateMutable(e.RootEntity);return++s.value}function Jl(e){return am.includes(e.componentName)}function Ha(e,n){return!!n&&e.value.includes(n)}function nc(e){return Ha(e,e.currentValue)?e.currentValue:oc(e)}function oc(e){if(Ha(e,e.defaultValue))return e.defaultValue;if(e.value.length>0)return e.value[0]}function Kl(e){return!!e.createOrReplace}function ed(e,n,s){let t=n.addEntity(),a=new Map;debugger;for(let r of n.componentsIter())if(r.has(e)){let c=JSON.parse(JSON.stringify(r.get(e)));if(Jl(r)){let o=c.id,i=Ql(n);a.set(o,i),c={...c,id:i}}Kl(r)&&r.createOrReplace(t,c)}if(s.has(t)){let r=s.getMutable(t);for(let c of r.value){for(let o of c.actions)if(o.id){let i=a.get(o.id);i&&(o.id=i)}if(c.conditions){for(let o of c.conditions)if(o.id){let i=a.get(o.id);i&&(o.id=i)}}}}return t}var cm={[Le.PLAY_ANIMATION]:Z.Map({animation:Z.String,loop:Z.Optional(Z.Boolean)}),[Le.STOP_ANIMATION]:Z.Map({}),[Le.SET_STATE]:Z.Map({state:Z.String}),[Le.START_TWEEN]:Z.Map({type:Z.EnumString(eo,eo.MOVE_ITEM),end:Z.Vector3,interpolationType:Z.EnumString(di,di.LINEAR),duration:Z.Float,relative:Z.Boolean}),[Le.SET_COUNTER]:Z.Map({counter:Z.Int}),[Le.INCREMENT_COUNTER]:Z.Map({}),[Le.DECREASE_COUNTER]:Z.Map({}),[Le.PLAY_SOUND]:Z.Map({src:Z.String,loop:Z.Optional(Z.Boolean),volume:Z.Optional(Z.Float)}),[Le.STOP_SOUND]:Z.Map({}),[Le.SET_VISIBILITY]:Z.Map({visible:Z.Boolean,physicsCollider:Z.Optional(Z.Boolean)}),[Le.ATTACH_TO_PLAYER]:Z.Map({anchorPointId:Z.Int}),[Le.DETACH_FROM_PLAYER]:Z.Map({}),[Le.PLAY_VIDEO_STREAM]:Z.Map({src:Z.Optional(Z.String),loop:Z.Optional(Z.Boolean),volume:Z.Optional(Z.Float),dclCast:Z.Optional(Z.Boolean)}),[Le.STOP_VIDEO_STREAM]:Z.Map({}),[Le.PLAY_AUDIO_STREAM]:Z.Map({url:Z.String,volume:Z.Optional(Z.Float)}),[Le.STOP_AUDIO_STREAM]:Z.Map({}),[Le.TELEPORT_PLAYER]:Z.Map({x:Z.Int,y:Z.Int}),[Le.MOVE_PLAYER]:Z.Map({position:Z.Vector3,cameraTarget:Z.Optional(Z.Vector3)}),[Le.PLAY_DEFAULT_EMOTE]:Z.Map({emote:Z.String}),[Le.PLAY_CUSTOM_EMOTE]:Z.Map({src:Z.String,loop:Z.Optional(Z.Boolean)}),[Le.OPEN_LINK]:Z.Map({url:Z.String}),[Le.SHOW_TEXT]:Z.Map({text:Z.String,hideAfterSeconds:Z.Float,font:Z.EnumNumber(Po,Po.F_SANS_SERIF),fontSize:Z.Optional(Z.Float),textAlign:Z.EnumNumber(Et,Et.TAM_MIDDLE_CENTER)}),[Le.HIDE_TEXT]:Z.Map({}),[Le.START_DELAY]:Z.Map({actions:Z.Array(Z.String),timeout:Z.Float}),[Le.STOP_DELAY]:Z.Map({action:Z.String}),[Le.START_LOOP]:Z.Map({actions:Z.Array(Z.String),interval:Z.Float}),[Le.STOP_LOOP]:Z.Map({action:Z.String}),[Le.CLONE_ENTITY]:Z.Map({position:Z.Vector3}),[Le.REMOVE_ENTITY]:Z.Map({}),[Le.SHOW_IMAGE]:Z.Map({src:Z.String,align:Z.EnumNumber(Et,Et.TAM_MIDDLE_CENTER),height:Z.Float,width:Z.Float,hideAfterSeconds:Z.Optional(Z.Float),text:Z.Optional(Z.String),fontSize:Z.Optional(Z.Float)}),[Le.HIDE_IMAGE]:Z.Map({imageEntity:Z.Optional(Z.Int)})};function Pr(e,n){try{return n.getComponent(e)}catch(s){throw console.error(`Error using getComponent with componentName="${e}"`),s}}function Ga(e){return{Actions:Pr(At.ACTIONS,e),States:Pr(At.STATES,e),Counter:Pr(At.COUNTER,e),Triggers:Pr(At.TRIGGERS,e)}}function td(e){let n=e.defineComponent(At.ACTION_TYPES,{value:Z.Array(Z.Map({type:Z.String,jsonSchema:Z.String}))}),s=e.defineComponent(At.ACTIONS,{id:Z.Int,value:Z.Array(Z.Map({name:Z.String,type:Z.String,jsonPayload:Z.String}))}),t=e.defineComponent(At.COUNTER,{id:Z.Number,value:Z.Int}),a=e.defineComponent(At.TRIGGERS,{value:Z.Array(Z.Map({type:Z.EnumString(kt,kt.ON_CLICK),conditions:Z.Optional(Z.Array(Z.Map({id:Z.Optional(Z.Int),type:Z.EnumString(un,un.WHEN_STATE_IS),value:Z.String}))),operation:Z.Optional(Z.EnumString(to,to.AND)),actions:Z.Array(Z.Map({id:Z.Optional(Z.Int),name:Z.Optional(Z.String)}))}))}),r=e.defineComponent(At.STATES,{id:Z.Number,value:Z.Array(Z.String),defaultValue:Z.Optional(Z.String),currentValue:Z.Optional(Z.String)});return{ActionTypes:n,Actions:s,Counter:t,Triggers:a,States:r}}function nd(e,n){let s=Object.values(Le);for(let r of s){let c=r;Zl(e,c,cm[c])}let a=e.getComponent(At.COUNTER).getOrCreateMutable(e.RootEntity);a.value=a.value||0,n&&n.VideoPlayer&&n.Material&&fm(e,{VideoPlayer:n.VideoPlayer,Material:n.Material})}function um({material:e}){if(e?.$case==="pbr"&&e.pbr.texture?.tex?.$case==="videoTexture")return e.pbr.texture.tex.videoTexture}function rc(e,{Material:n},s){if(!s||!s.material||s.material.$case!=="pbr")return null;n.setPbrMaterial(e,{...s.material.pbr,texture:n.Texture.Video({videoPlayerEntity:e})})}function fm(e,n){function s(){let{Material:t,VideoPlayer:a}=n;e.removeSystem(s);for(let[r,c]of e.getEntitiesWith(t,a))um(c)?.videoPlayerEntity===e.RootEntity&&rc(r,n,c)}e.addSystem(s)}function od(e){switch(e){case At.STATES:return[un.WHEN_STATE_IS,un.WHEN_STATE_IS_NOT];case At.COUNTER:return[un.WHEN_COUNTER_EQUALS,un.WHEN_COUNTER_IS_GREATER_THAN,un.WHEN_COUNTER_IS_LESS_THAN];default:return[]}}function pi(e){let n=We.getOrNull(e);if(!n)return J.Zero();let s=n.parent;if(s){let t=We.get(s).rotation;return J.add(pi(s),J.rotate(n.position,t))}else return n.position}function hi(e){let n=We.getOrNull(e);if(!n)return He.Identity();let s=n.parent;return s?He.multiply(n.rotation,hi(s)):n.rotation}var Rt;(function(e){e.LINEAR="linear",e.EASEINQUAD="easeinquad",e.EASEOUTQUAD="easeoutquad",e.EASEQUAD="easequad",e.EASEINSINE="easeinsine",e.EASEOUTSINE="easeoutsine",e.EASESINE="easeinoutsine",e.EASEINEXPO="easeinexpo",e.EASEOUTEXPO="easeoutexpo",e.EASEEXPO="easeinoutexpo",e.EASEINELASTIC="easeinelastic",e.EASEOUTELASTIC="easeoutelastic",e.EASEELASTIC="easeinoutelastic",e.EASEINBOUNCE="easeinbounce",e.EASEOUTEBOUNCE="easeoutbounce",e.EASEBOUNCE="easeinoutbounce"})(Rt||(Rt={}));function ic(e,n){switch(e){case Rt.LINEAR:return n;case Rt.EASEINQUAD:return lm(n);case Rt.EASEOUTQUAD:return dm(n);case Rt.EASEQUAD:return pm(n);case Rt.EASEINSINE:return hm(n);case Rt.EASEOUTSINE:return mm(n);case Rt.EASESINE:return ym(n);case Rt.EASEINEXPO:return vm(n);case Rt.EASEOUTEXPO:return xm(n);case Rt.EASEEXPO:return Em(n);case Rt.EASEINELASTIC:return bm(n);case Rt.EASEOUTELASTIC:return gm(n);case Rt.EASEELASTIC:return Tm(n);case Rt.EASEINBOUNCE:return wm(n);case Rt.EASEOUTEBOUNCE:return Sm(n);case Rt.EASEBOUNCE:return _m(n);default:return n}}function lm(e){return e*e}function dm(e){return e*(2-e)}function pm(e){return e*e/(2*(e*e-e)+1)}function hm(e){return 1-Math.cos(e*Math.PI/2)}function mm(e){return Math.sin(e*Math.PI/2)}function ym(e){return-(Math.cos(Math.PI*e)-1)/2}function vm(e){return e===0?0:Math.pow(2,10*e-10)}function xm(e){return e===1?1:1-Math.pow(2,-10*e)}function Em(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}function bm(e){let n=2*Math.PI/3;return e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*n)}function gm(e){let n=2*Math.PI/3;return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*n)+1}function Tm(e){let n=2*Math.PI/4.5;return e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*n))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*n)/2+1}function wm(e){return 1-Ya(1-e)}function Sm(e){return Ya(e)}function _m(e){return e<.5?(1-Ya(1-2*e))/2:(1+Ya(2*e-1))/2}function Ya(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function rd(e,n,s){let t=new Array,a=1/n,r=0;if(s){let c=e.length;for(let o=0;o<c;o++){r=0;for(let i=0;i<n;i++)t.push(J.catmullRom(e[o%c],e[(o+1)%c],e[(o+2)%c],e[(o+3)%c],r)),r+=a}t.push(t[0])}else{let c=new Array;c.push(J.clone(e[0])),Array.prototype.push.apply(c,e),c.push(J.clone(e[e.length-1]));let o=0;for(;o<c.length-3;o++){r=0;for(let i=0;i<n;i++)t.push(J.catmullRom(c[o],c[o+1],c[o+2],c[o+3],r)),r+=a}o--,t.push(J.catmullRom(c[o],c[o+1],c[o+2],c[o+3],r))}return t}function id(e,n,s,t){return e.x<=t.x&&n.x>=s.x&&e.y<=t.y&&n.y>=s.y&&e.z<=t.z&&n.z>=s.z}function ad(e,n,s,t){let a=J.distanceSquared(e,s),r=n+t;return a<r*r}function ac(e,n,s,t){let a=0;return s.x<e.x&&(a+=(e.x-s.x)*(e.x-s.x)),s.x>n.x&&(a+=(s.x-n.x)*(s.x-n.x)),s.y<e.y&&(a+=(e.y-s.y)*(e.y-s.y)),s.y>n.y&&(a+=(s.y-n.y)*(s.y-n.y)),s.z<e.z&&(a+=(e.z-s.z)*(e.z-s.z)),s.z>n.z&&(a+=(s.z-n.z)*(s.z-n.z)),a<t*t}var en;(function(e){e.TimerSystemPriority=1e5+256,e.TweenSystemPriority=1e5+192,e.PerpetualMotionSystemPriority=1e5+192,e.PathSystemPriority=1e5+192,e.TriggerSystemPriority=1e5+128,e.ActionSystemPriority=1e5+64})(en||(en={}));function Am(e){let n={start:Z.Vector3,end:Z.Vector3,interpolationType:Z.EnumString(Rt,Rt.LINEAR),speed:Z.Float,normalizedTime:Z.Float},s=e.defineComponent("dcl.utils.PositionTween",n),t=e.defineComponent("dcl.utils.ScaleTween",n),a=e.defineComponent("dcl.utils.RotationTween",{start:Z.Quaternion,end:Z.Quaternion,interpolationType:Z.EnumString(Rt,Rt.LINEAR),speed:Z.Float,normalizedTime:Z.Float}),r=new Map,c=new Map,o=new Map;function i(f,y,l){return function(v){let p=[];for(let x of y.keys()){if(e.getEntityState(x)==Wt.Removed||!f.has(x)){y.delete(x);continue}let b=f.getMutable(x);b.normalizedTime=ht.clamp(b.normalizedTime+v*b.speed,0,1);let O=ic(b.interpolationType,b.normalizedTime);l(We.getMutable(x),b.start,b.end,O),b.normalizedTime>=1&&p.push(x)}for(let x of p){let b=y.get(x);f.deleteFrom(x),y.delete(x),b&&b()}}}function u(f,y){return function(l){f.deleteFrom(l),y.delete(l)}}function h(f,y){return function(l,d,v,p,x=Rt.LINEAR,b){y.set(l,b),f.createOrReplace(l,{start:d,end:v,speed:p==0?0:1/p,interpolationType:x,normalizedTime:p==0?1:0})}}function m(f){return function(y){if(!f.has(y))throw new Error(`Entity ${y} is not registered with tweens system`);return f.get(y)}}return e.addSystem(i(s,r,function(f,y,l,d){f.position=J.lerp(y,l,d)}),en.TweenSystemPriority),e.addSystem(i(a,c,function(f,y,l,d){f.rotation=He.slerp(y,l,d)}),en.TweenSystemPriority),e.addSystem(i(t,o,function(f,y,l,d){f.scale=J.lerp(y,l,d)}),en.TweenSystemPriority),{startTranslation:h(s,r),stopTranslation:u(s,r),startRotation:h(a,c),stopRotation:u(a,c),startScaling:h(t,o),stopScaling:u(t,o),getTranslationOnFinishCallback:m(r),getRotationOnFinishCallback:m(c),getScalingOnFinishCallback:m(o)}}var mi=Am(Se);var bd=require("~system/UserActionModule"),Eo=require("~system/RestrictedActions"),gd=require("~system/CommsApi");var Fr=new Map,Lr=new Map;function sd(){return function(t){e(t),n(t)};function e(s){for(let[t,a]of Lr.entries()){let r=fn(t);for(let c of a)c.timeout===c.interval&&c.callback(),c.timeout-=s,c.timeout<=0&&(c.timeout=c.interval,r.emit(kt.ON_LOOP))}}function n(s){for(let[t,a]of Fr.entries()){let r=fn(t),c=[],o=0;for(let i of a)i.timeout-=s,i.timeout<=0&&(i.callback(),r.emit(kt.ON_DELAY),c.push(o)),o++;for(let i of c)a.splice(i,1)}}}function ja(e,n,s,t){let a=Fr.get(e)??[];a.push({timeout:s,action:n,callback:t}),Fr.set(e,a)}function cd(e,n){let s=Fr.get(e)??[];Fr.set(e,s.filter(t=>t.action!==n))}function ud(e){Fr.delete(e)}function fd(e,n,s,t){let a=Lr.get(e)??[];a.push({timeout:s,action:n,callback:t,interval:s}),Lr.set(e,a)}function ld(e,n){let s=Lr.get(e)??[];Lr.set(e,s.filter(t=>t.action!==n))}function dd(e){Lr.delete(e)}function no(e,n){switch(e){case Et.TAM_TOP_LEFT:return{alignItems:1,justifyContent:0};case Et.TAM_TOP_CENTER:return n?{alignItems:2,justifyContent:0}:{alignItems:1,justifyContent:1};case Et.TAM_TOP_RIGHT:return n?{alignItems:3,justifyContent:0}:{alignItems:1,justifyContent:2};case Et.TAM_MIDDLE_LEFT:return n?{alignItems:1,justifyContent:1}:{alignItems:2,justifyContent:0};case Et.TAM_MIDDLE_CENTER:return{alignItems:2,justifyContent:1};case Et.TAM_MIDDLE_RIGHT:return n?{alignItems:3,justifyContent:1}:{alignItems:2,justifyContent:2};case Et.TAM_BOTTOM_LEFT:return n?{alignItems:1,justifyContent:2}:{alignItems:2,justifyContent:1};case Et.TAM_BOTTOM_CENTER:return n?{alignItems:2,justifyContent:2}:{alignItems:3,justifyContent:1};case Et.TAM_BOTTOM_RIGHT:return{alignItems:3,justifyContent:2}}}function pd(e,n=0){let s=n===1;switch(e){case Et.TAM_TOP_LEFT:return no(e,s);case Et.TAM_TOP_CENTER:return no(e,s);case Et.TAM_TOP_RIGHT:return no(e,s);case Et.TAM_MIDDLE_LEFT:return no(e,s);case Et.TAM_MIDDLE_CENTER:return no(e,s);case Et.TAM_MIDDLE_RIGHT:return no(e,s);case Et.TAM_BOTTOM_LEFT:return no(e,s);case Et.TAM_BOTTOM_CENTER:return no(e,s);case Et.TAM_BOTTOM_RIGHT:return no(e,s);default:throw new Error(`Unsupported AlignMode: ${e}`)}}function yi(e,n=100,s=100,t=2){let a=Ys.getMutableOrNull(e);return a||(a=Ys.create(e),a.heightUnit=t,a.widthUnit=t,a.height=n,a.width=s,a.maxHeightUnit=t,a.maxWidthUnit=t,a.maxHeight=n,a.maxWidth=s),e===0&&(a.positionType=1),a}function hd(e,n,s=0,t=1){return _l.createOrReplace(e,{textureMode:s,texture:{tex:{$case:"texture",texture:{src:n,wrapMode:t}}},uvs:[]})}function Rm(e,n){let s=`
`,t=0,a="",r="",c=!1,o=n||50;if(!e)return"";if(e.length<o+1)return e;for(;t<e.length;)if(a=e.substring(t,t+o),c=!1,a.length==o){for(let i=a.length;i>-1;i--)if(a.substring(i,i+1)==" "){t+=a.substring(0,i).length,a=a.substring(0,i)+s,r+=a,c=!0;break}c||(t+=a.length,a=a+s,r+=a)}else{r+=a;break}return r}function md(e,n,s=10,t,a=Et.TAM_MIDDLE_CENTER,r=yn.Black()){let c=Math.floor(t/(s/1.7));return Rr.createOrReplace(e,{value:Rm(n,c),fontSize:s,font:Po.F_MONOSPACE,textAlign:a,color:r})}function Nm(e){let n=new Map,s=0;function t(a){let r=[],c=[];for(let[o,i]of n)i.accumulatedTime+=1e3*a,!(i.accumulatedTime<i.interval)&&(c.push(i.callback),i.recurrent?i.accumulatedTime-=Math.floor(i.accumulatedTime/i.interval)*i.interval:r.push(o));for(let o of r)n.delete(o);for(let o of c)o()}return e.addSystem(t,en.TimerSystemPriority),{setTimeout(a,r){let c=s++;return n.set(c,{callback:a,interval:r,recurrent:!1,accumulatedTime:0}),c},clearTimeout(a){n.delete(a)},setInterval(a,r){let c=s++;return n.set(c,{callback:a,interval:r,recurrent:!0,accumulatedTime:0}),c},clearInterval(a){n.delete(a)}}}var vi=Nm(Se);var Ur;(function(e){e[e.Off=0]="Off",e[e.On=1]="On"})(Ur||(Ur={}));function Cm(e,n){let s=e.defineComponent("dcl.utils.Toggle",{state:Z.EnumNumber(Ur,Ur.Off)}),t=new Map;return n.setInterval(function(){for(let a of t.keys())(e.getEntityState(a)==Wt.Removed||!s.has(a))&&t.delete(a)},5e3),{addToggle(a,r,c){t.set(a,c),s.createOrReplace(a,{state:r})},removeToggle(a){t.delete(a),s.deleteFrom(a)},setCallback(a,r){t.set(a,r)},set(a,r){if(s.get(a).state!=r){s.getMutable(a).state=r;let o=t.get(a);o&&o(r)}},flip(a){this.set(a,1-s.get(a).state)},isOn(a){return s.get(a).state==Ur.On}}}var Im=Cm(Se,vi);function Bm(e){let n=e.defineComponent("dcl.utils.PerpetualRotation",{velocity:Z.Quaternion});function s(t){for(let[a,r]of e.getEntitiesWith(n,We)){let c=He.slerp(He.Identity(),r.velocity,t),o=We.getMutable(a);o.rotation=He.normalize(He.multiply(o.rotation,c))}}return e.addSystem(s,en.PerpetualMotionSystemPriority),{startRotation(t,a){n.createOrReplace(t,{velocity:a})},stopRotation(t){n.deleteFrom(t)}}}var Om=Bm(Se);function km(e){let n=e.defineComponent("dcl.utils.FollowPath",{points:Z.Array(Z.Vector3),faceDirection:Z.Boolean,speed:Z.Number,normalizedTime:Z.Number,currentIndex:Z.Number,segmentTimes:Z.Array(Z.Number),curveSegmentCount:Z.Number}),s=new Map,t=new Map;function a(o){s.delete(o),t.delete(o),n.deleteFrom(o)}function r(o){let i=[],u=[];for(let h of s.keys()){if(e.getEntityState(h)==Wt.Removed||!n.has(h)){a(h);continue}let m=We.getMutable(h),f=n.getMutable(h);for(f.normalizedTime=ht.clamp(f.normalizedTime+o*f.speed,0,1),f.normalizedTime>=1&&i.push(h);f.normalizedTime>=f.segmentTimes[f.currentIndex]&&f.currentIndex<f.points.length-1;){if(f.faceDirection){let d=J.subtract(f.points[f.currentIndex+1],f.points[f.currentIndex]);m.rotation=He.lookRotation(d)}if(f.currentIndex>0&&f.currentIndex%f.curveSegmentCount==0){let d=f.currentIndex/f.curveSegmentCount,v=f.points[f.currentIndex],p=f.points[f.currentIndex+f.curveSegmentCount];u.push({entity:h,index:d,coords:v,nextCoords:p})}f.currentIndex+=1}let y=f.segmentTimes[f.currentIndex]-f.segmentTimes[f.currentIndex-1],l=(f.segmentTimes[f.currentIndex]-f.normalizedTime)/y;m.position=J.lerp(f.points[f.currentIndex],f.points[f.currentIndex-1],l)}for(let h of u){let m=t.get(h.entity);m&&m(h.index,h.coords,h.nextCoords)}for(let h of i){let m=s.get(h);a(h),m&&m()}}e.addSystem(r,en.PathSystemPriority);function c(o,i,u,h,m,f,y){if(i.length<2)throw new Error("At least 2 points are required to form a path.");if(u==0)throw new Error("Path duration must not be zero");if(m){let p=J.equals(i[0],i[i.length-1]);p&&(i.pop(),i.unshift(i.pop())),i=rd(i,m,p)}else m=1;s.set(o,f),t.set(o,y);let l=0,d=[];for(let p=0;p<i.length-1;p++){let x=J.distance(i[p],i[p+1]);l+=x,d.push(x)}let v=[0];for(let p=0;p<d.length;p++)v.push(d[p]/l+v[p]);n.createOrReplace(o,{points:i,segmentTimes:v,curveSegmentCount:m,speed:1/u,normalizedTime:0,currentIndex:0,faceDirection:h})}return{startStraightPath(o,i,u,h,m,f){return c(o,i,u,h,0,m,f)},startSmoothPath(o,i,u,h,m,f,y){if(h<2||!Number.isInteger(h))throw new Error(`segmentCount must be an integer that is greater than 2, got: ${h}`);return c(o,i,u,m,h,f,y)},stopPath(o){a(o)},getOnFinishCallback(o){if(!s.has(o))throw new Error(`Entity ${o} is not registered in triggers system`);return s.get(o)}}}var Mm=km(Se);var $a=1;var oo=255,xo=0;function Pm(e){let n=Se.defineComponent("dcl.utils.Trigger",{active:Z.Boolean,layerMask:Z.Int,triggeredByMask:Z.Int,areas:Z.Array(Z.OneOf({box:Z.Map({position:Z.Vector3,scale:Z.Vector3}),sphere:Z.Map({position:Z.Vector3,radius:Z.Number})})),debugColor:Z.Color3}),s=new Map,t=new Map,a=!1,r=new Map,c=new Map;function o(l){if(l)for(let[d,v]of e.getEntitiesWith(n,We)){let p=c.get(d),x=v.areas.length;for(;p.length>x;)e.removeEntity(p.pop());for(;p.length<x;)p.push(e.addEntity());let b=pi(d),O=hi(d);for(let N=0;N<x;++N){let _=v.areas[N],P=p[N],M;if(_.$case=="box")M=_.value.scale,Yn.setBox(P);else{let Q=_.value.radius;M={x:Q,y:Q,z:Q},Yn.setSphere(P)}We.createOrReplace(P,{position:J.add(b,J.rotate(_.value.position,O)),scale:M});let q=v.active?v.debugColor:Mr.Black();mn.setPbrMaterial(P,{albedoColor:yn.fromInts(255*q.r,255*q.g,255*q.b,75)})}}}function i(l,d,v,p){for(let x=0;x<d.areas.length;++x){let b=l[x],O=d.areas[x];if(O.$case=="box"){let N=O.value,_=J.subtract(b,J.scale(N.scale,.5)),P=J.add(_,N.scale);for(let M=0;M<p.areas.length;++M){let q=v[M],Q=p.areas[M];if(Q.$case=="box"){let w=Q.value,k=J.subtract(q,J.scale(w.scale,.5)),V=J.add(k,w.scale);if(id(_,P,k,V))return!0}else if(ac(_,P,q,Q.value.radius))return!0}}else{let N=O.value.radius;for(let _=0;_<p.areas.length;++_){let P=v[_],M=p.areas[_];if(M.$case=="box"){let q=M.value,Q=J.subtract(P,J.scale(q.scale,.5)),w=J.add(Q,q.scale);if(ac(Q,w,b,N))return!0}else if(ad(b,N,P,M.value.radius))return!0}}}return!1}function u(l,d){let v=new Set,p=n.get(l);if(!p.active)return v;for(let[x,b]of e.getEntitiesWith(n,We)){if(x==l||!b.active||!(p.triggeredByMask&b.layerMask))continue;i(d.get(l),p,d.get(x),b)&&v.add(x)}return v}function h(){let l=[],d=[],v=new Map;for(let p of r.keys()){if(e.getEntityState(p)==Wt.Removed||!n.has(p)){for(let _ of c.get(p))e.removeEntity(_);for(let _ of r.values())_.has(p)&&_.delete(p);c.delete(p),r.delete(p),s.delete(p),t.delete(p);continue}let x=[],b=pi(p),O=hi(p),N=n.get(p);for(let _ of N.areas)x.push(J.add(b,J.rotate(_.value.position,O)));v.set(p,x)}for(let p of r.keys()){let x=u(p,v),b=r.get(p);for(let O of b)x.has(O)||d.push([p,O]);for(let O of x)b.has(O)||l.push([p,O]);r.set(p,x)}for(let[p,x]of l){let b=s.get(p);b&&b(x)}for(let[p,x]of d){let b=t.get(p);b&&b(x)}}function m(l){h(),o(a)}e.addSystem(m,en.TriggerSystemPriority);function f(l){l||(l=[{type:"box"}]);let d=[];for(let v of l)v.type=="box"?d.push({$case:"box",value:{position:v.position?v.position:J.Zero(),scale:v.scale?v.scale:J.One()}}):d.push({$case:"sphere",value:{position:v.position?v.position:J.Zero(),radius:v.radius?v.radius:1}});return d}let y={addTrigger(l,d=xo,v=xo,p,x,b,O){if(d<0||d>oo||!Number.isInteger(d))throw new Error(`Bad layerMask: ${d}. Expected a non-negative integer no greater than ${oo}`);if(v<0||v>oo||!Number.isInteger(v))throw new Error(`Bad triggeredByMask: ${v}. Expected a non-negative integer no greater than ${oo}`);c.set(l,[]),r.set(l,new Set),s.set(l,x),t.set(l,b),n.createOrReplace(l,{active:!0,layerMask:d,triggeredByMask:v,areas:f(p),debugColor:O||Mr.Red()})},removeTrigger(l){let d=r.get(l),v=t.get(l);for(let x of c.get(l))e.removeEntity(x);c.delete(l),r.delete(l),s.delete(l),t.delete(l),n.deleteFrom(l);let p=[];for(let[x,b]of r)b.has(l)&&(b.delete(l),p.push(x));if(v)for(let x of d)v(x);for(let x of p){let b=t.get(x);b&&b(l)}},oneTimeTrigger(l,d=xo,v=xo,p,x,b){this.addTrigger(l,d,v,p,function(O){Dr.removeTrigger(l),x&&x(O)},void 0,b)},enableTrigger(l,d){n.getMutable(l).active=d},isTriggerEnabled(l){return n.get(l).active},getLayerMask(l){return n.get(l).layerMask},setLayerMask(l,d){if(d<0||d>oo||!Number.isInteger(d))throw new Error(`Bad layerMask: ${d}. Expected a non-negative integer no greater than ${oo}`);n.getMutable(l).layerMask=d},getTriggeredByMask(l){return n.get(l).triggeredByMask},setTriggeredByMask(l,d){if(d<0||d>oo||!Number.isInteger(d))throw new Error(`Bad layerMask: ${d}. Expected a non-negative integer no greater than ${oo}`);n.getMutable(l).triggeredByMask=d},getAreas(l){return n.get(l).areas},setAreas(l,d){n.getMutable(l).areas=f(d)},setOnEnterCallback(l,d){s.set(l,d)},setOnExitCallback(l,d){t.set(l,d)},enableDebugDraw(l){if(a=l,!l)for(let d of c.values()){for(let v of d)e.removeEntity(v);d.length=0}},isDebugDrawEnabled(){return a}};return y.addTrigger(e.PlayerEntity,$a,xo,[{type:"box",scale:{x:.65,y:1.92,z:.65},position:{x:0,y:.15,z:0}}],void 0,void 0,Mr.Green()),y}var Dr=Pm(Se);var sc;(function(e){class n{constructor(h,m,f){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,this.engine=h,this.systemFn=y=>{this.update(y)},this.engine.addSystem(this.systemFn,en.ActionSystemPriority),m&&this.startSequence(m),f&&this.setOnFinishCallback(f)}startSequence(h){this.beginSequenceNode=h.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1}destroy(){this.engine.removeSystem(this.systemFn)}setOnFinishCallback(h){this.onFinishCallback=h}isRunning(){return this.running}stop(){this.running=!1}resume(){this.beginSequenceNode!=null&&(this.running=!0)}reset(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1}getRunningAction(){let h=this.currentSequenceNode;if(this.currentSequenceNode instanceof a)do h=h.currentInnerSequence;while(h instanceof a);return h.action}update(h){if(this.running){if(!this.started){this.currentSequenceNode.onStart(),this.started=!0;return}if(!this.currentSequenceNode.hasFinish()){this.currentSequenceNode.update(h);return}this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())}}}e.SequenceRunner=n;class s{constructor(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}then(h){if(this.currentSequenceNode==null)this.currentSequenceNode=new t,this.currentSequenceNode.action=h,this.beginSequenceNode=this.currentSequenceNode;else{let m=new t;m.action=h,this.currentSequenceNode=this.currentSequenceNode.then(m)}return this}if(h){let m=new r(h);return this.currentSequenceNode==null?(this.currentSequenceNode=m,this.beginSequenceNode=m):this.currentSequenceNode=this.currentSequenceNode.then(m),this}else(){let h=this.currentSequenceNode.getSequence();if(h instanceof r){h.closed=!0;let m=new c(h);this.currentSequenceNode=this.currentSequenceNode.then(m)}else throw new Error("IF statement is needed to be called before ELSE statement.");return this}endIf(){let h=this.currentSequenceNode.getSequence();if(h instanceof r||h instanceof c)h.closed=!0;else throw new Error("IF statement is needed to be called before ENDIF statement.");return this}while(h){let m=new o(h);return this.currentSequenceNode==null?(this.currentSequenceNode=m,this.beginSequenceNode=m):this.currentSequenceNode=this.currentSequenceNode.then(m),this.whileNodeStack.push(m),this}endWhile(){let h=this.currentSequenceNode.getSequence();if(h instanceof o)h.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1);else throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return this}breakWhile(){if(this.whileNodeStack.length>0)this.currentSequenceNode=this.currentSequenceNode.then(new i(this.whileNodeStack[this.whileNodeStack.length-1]));else throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this}}e.SequenceBuilder=s;class t{constructor(){this.action=null,this.next=null}then(h){return this.next=h,h}onStart(){this.action&&this.action.onStart()}update(h){this.action&&this.action.update(h)}onFinish(){this.action&&this.action.onFinish()}hasFinish(){return this.action?this.action.hasFinished:!0}getSequence(){return this}}e.SequenceNode=t;class a extends t{constructor(){super(...arguments),this.currentInnerSequence=null,this.startingInnerSequence=null,this.closed=!1}then(h){if(this.currentInnerSequence==null)this.currentInnerSequence=h,this.startingInnerSequence=h;else{if(this.closed)return this.next=h,h;this.currentInnerSequence=this.currentInnerSequence.then(h)}return this}onStart(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()}update(h){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(h))}onFinish(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()}hasFinish(){return this.currentInnerSequence==null}getSequence(){if(this.currentInnerSequence){let h=this.currentInnerSequence.getSequence();if(h instanceof a&&!h.closed)return h}return this}}class r extends a{constructor(h){super(),this.result=!1,this.condition=h}onStart(){this.result=this.condition(),this.result?super.onStart():this.currentInnerSequence=null}}class c extends a{constructor(h){super(),this.ifSequence=null,this.ifSequence=h}onStart(){this.ifSequence&&!this.ifSequence.result?super.onStart():this.currentInnerSequence=null}}class o extends a{constructor(h){super(),this.breakWhile=!1,this.condition=h}onStart(){this.breakWhile=!1,this.condition()?super.onStart():this.currentInnerSequence=null}update(h){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence==null&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(h))}hasFinish(){return this.breakWhile||!this.condition()}}class i extends t{constructor(h){super(),this.whileNode=h}onStart(){this.whileNode.breakWhile=!0}}})(sc||(sc={}));var yd=new Set,cc=[],uc=null;function vd(e){if(uc)return uc(e);throw new Error("Cannot call initTriggers while triggersSystem has not been created")}function xd(e,n){let{Actions:s,States:t,Counter:a,Triggers:r}=Ga(e);return uc=c,function(v){for(;cc.length>0;){let{entity:x,action:b}=cc.shift();zr(x).emit(b.name,at(b))}let p=e.getEntitiesWith(r);for(let[x]of p)c(x)};function c(d){if(!r.has(d)||yd.has(d))return;let v=r.get(d),p=v.value.reduce((b,O)=>b.add(O.type),new Set);for(let b of p)switch(b){case kt.ON_CLICK:{y(d);break}case kt.ON_PLAYER_ENTERS_AREA:case kt.ON_PLAYER_LEAVES_AREA:{l(d);break}}let x=fn(d);for(let b of v.value)x.on(b.type,()=>{if(i(b)){for(let O of b.actions)if(o(O)){let N=m(O);if(N){let _=s.getOrNull(N);if(_){let P=_.value.find(M=>M.name===O.name);P&&cc.push({entity:N,action:P})}}}}});x.emit(kt.ON_SPAWN),yd.add(d)}function o(d){let{id:v,name:p}=d;return!!v&&!!p}function i(d){if(d.conditions&&d.conditions.length>0){let v=d.conditions.map(u),p=b=>!!b;switch(d.operation||to.AND){case to.AND:return v.every(p);case to.OR:return v.some(p)}}return!0}function u(d){let v=f(d);if(v)try{switch(d.type){case un.WHEN_STATE_IS:{let p=t.getOrNull(v);if(p!==null)return nc(p)===d.value;break}case un.WHEN_STATE_IS_NOT:{let p=t.getOrNull(v);if(p!==null)return nc(p)!==d.value;break}case un.WHEN_COUNTER_EQUALS:{let p=a.getOrNull(v);if(p!==null){let x=Number(d.value);if(!isNaN(x))return p.value===x}break}case un.WHEN_COUNTER_IS_GREATER_THAN:{let p=a.getOrNull(v);if(p!==null){let x=Number(d.value);if(!isNaN(x))return p.value>x}break}case un.WHEN_COUNTER_IS_LESS_THAN:{let p=a.getOrNull(v);if(p!==null){let x=Number(d.value);if(!isNaN(x))return p.value<x}break}}}catch{console.error("Error in condition",d)}return!1}function h(d,v){let p=e.getComponent(d),b=Array.from(e.getEntitiesWith(p)).find(([O,N])=>N.id===v);return Array.isArray(b)&&b.length>0?b[0]:null}function m(d){if(d.id){let v=h(At.ACTIONS,d.id);if(v)return v}return null}function f(d){let v=Object.values(At).map(p=>({componentName:p,conditionTypes:od(p)})).reduce((p,{componentName:x,conditionTypes:b})=>b.includes(d.type)?x:p,null);if(v&&d.id){let p=h(v,d.id);if(p)return p}return null}function y(d){n.onPointerDown({entity:d,opts:{button:0,hoverText:"Click"}},()=>{fn(d).emit(kt.ON_CLICK)})}function l(d){let{scale:v}=We.get(d);Dr.addTrigger(d,xo,$a,[{type:"box",scale:v}],()=>{fn(d).emit(kt.ON_PLAYER_ENTERS_AREA)},()=>{fn(d).emit(kt.ON_PLAYER_LEAVES_AREA)})}}var Ed=new Set,fc=new Map,lc=new Map,Fm=null;function Td(e,n){let{Animator:s,Transform:t,AudioSource:a,AvatarAttach:r,VisibilityComponent:c,GltfContainer:o}=n,{Actions:i,States:u,Counter:h,Triggers:m}=Ga(e);return Fm=f,function(W){let j=e.getEntitiesWith(i);for(let[ne]of j)f(ne)};function f(R){if(!i.has(R)||Ed.has(R))return;let W=i.get(R),j=W.value.reduce((re,he)=>re.add(he.type),new Set);for(let re of j)switch(re){case Le.PLAY_ANIMATION:{y(R);break}default:break}let ne=zr(R);for(let re of W.value)ne.on(re.name,()=>{switch(re.type){case Le.PLAY_ANIMATION:{l(R,at(re));break}case Le.STOP_ANIMATION:{d(R,at(re));break}case Le.SET_STATE:{v(R,at(re));break}case Le.START_TWEEN:{p(R,at(re));break}case Le.SET_COUNTER:{N(R,at(re));break}case Le.INCREMENT_COUNTER:{_(R,at(re));break}case Le.DECREASE_COUNTER:{P(R,at(re));break}case Le.PLAY_SOUND:{M(R,at(re));break}case Le.STOP_SOUND:{q(R,at(re));break}case Le.SET_VISIBILITY:{Q(R,at(re));break}case Le.ATTACH_TO_PLAYER:{w(R,at(re));break}case Le.DETACH_FROM_PLAYER:{k(R,at(re));break}case Le.PLAY_VIDEO_STREAM:{me(R,at(re));break}case Le.STOP_VIDEO_STREAM:{Ae(R,at(re));break}case Le.PLAY_AUDIO_STREAM:{Fe(R,at(re));break}case Le.STOP_AUDIO_STREAM:{Me(R,at(re));break}case Le.TELEPORT_PLAYER:{V(R,at(re));break}case Le.MOVE_PLAYER:{K(R,at(re));break}case Le.PLAY_DEFAULT_EMOTE:{H(R,at(re));break}case Le.PLAY_CUSTOM_EMOTE:{oe(R,at(re));break}case Le.OPEN_LINK:{ie(R,at(re));break}case Le.SHOW_TEXT:{je(R,at(re));break}case Le.HIDE_TEXT:{Pe(R,at(re));break}case Le.START_DELAY:{A(R,at(re));break}case Le.STOP_DELAY:{F(R,at(re));break}case Le.START_LOOP:{ee(R,at(re));break}case Le.STOP_LOOP:{S(R,at(re));break}case Le.CLONE_ENTITY:{L(R,at(re));break}case Le.REMOVE_ENTITY:{ce(R,at(re));break}case Le.SHOW_IMAGE:{X(R,at(re));break}case Le.HIDE_IMAGE:{C(R,at(re));break}default:break}});Ed.add(R)}function y(R){s.has(R)||(s.create(R,{states:[]}),s.stopAllAnimations(R))}function l(R,W){let{animation:j,loop:ne}=W,re=s.getMutable(R);re.states.some(Ee=>Ee.clip===j)||(re.states=[...re.states,{clip:j}]),s.stopAllAnimations(R);let he=s.getClip(R,j);he.playing=!0,he.loop=ne??!1}function d(R,W){s.has(R)&&s.stopAllAnimations(R)}function v(R,W){let j=u.getMutableOrNull(R);if(j){let ne=W.state;ne=Ha(j,ne)?ne:oc(j),j.currentValue=ne,fn(R).emit(kt.ON_STATE_CHANGE)}}function p(R,W){if(W){let j=fn(R),ne=()=>j.emit(kt.ON_TWEEN_END);switch(W.type){case eo.MOVE_ITEM:{x(R,W,ne);break}case eo.ROTATE_ITEM:{b(R,W,ne);break}case eo.SCALE_ITEM:{O(R,W,ne);break}default:throw new Error(`Unknown tween type: ${W.type}`)}}}function x(R,W,j){let ne=t.get(R),{duration:re,interpolationType:he,relative:Ee}=W,Te=J.create(W.end.x,W.end.y,W.end.z),Ne=Ee?J.add(ne.position,Te):Te;mi.startTranslation(R,ne.position,Ne,re,he,j)}function b(R,W,j){let ne=t.get(R),{duration:re,interpolationType:he,relative:Ee}=W,Te=He.fromEulerDegrees(W.end.x,W.end.y,W.end.z),Ne=Ee?He.multiply(ne.rotation,Te):Te;mi.startRotation(R,ne.rotation,Ne,re,he,j)}function O(R,W,j){let ne=t.get(R),{duration:re,interpolationType:he,relative:Ee}=W,Te=J.create(W.end.x,W.end.y,W.end.z),Ne=Ee?J.add(ne.scale,Te):Te;mi.startScaling(R,ne.scale,Ne,re,he,j)}function N(R,W){let j=h.getMutableOrNull(R);j&&(j.value=W.counter,fn(R).emit(kt.ON_COUNTER_CHANGE))}function _(R,W){let j=h.getMutableOrNull(R);j&&(j.value+=1,fn(R).emit(kt.ON_COUNTER_CHANGE))}function P(R,W){let j=h.getMutableOrNull(R);j&&(j.value-=1,fn(R).emit(kt.ON_COUNTER_CHANGE))}function M(R,W){let{src:j,loop:ne,volume:re}=W;a.createOrReplace(R,{audioClipUrl:j,loop:ne,playing:!0,volume:re??1})}function q(R,W){let j=a.getMutableOrNull(R);j&&(j.playing=!1)}function Q(R,W){let{visible:j,physicsCollider:ne}=W;c.createOrReplace(R,{visible:j});let re=o.getMutableOrNull(R);re&&ne!==void 0&&(re.invisibleMeshesCollisionMask=ne?2:0)}function w(R,W){let{anchorPointId:j}=W;r.createOrReplace(R,{anchorPointId:j})}function k(R,W){r.has(R)&&r.deleteFrom(R)}function V(R,W){let{x:j,y:ne}=W;(0,bd.requestTeleport)({destination:`${j},${ne}`})}function K(R,W){let j={newRelativePosition:W.position,cameraTarget:W.cameraTarget};console.log("movePlayerTo",j),(0,Eo.movePlayerTo)(j)}function H(R,W){let{emote:j}=W;(0,Eo.triggerEmote)({predefinedEmote:j})}function oe(R,W){let{src:j,loop:ne}=W;(0,Eo.triggerSceneEmote)({src:j,loop:ne})}function ie(R,W){let{url:j}=W;(0,Eo.openExternalUrl)({url:j})}async function ue({src:R,dclCast:W}){if(W){let{streams:j}=await(0,gd.getActiveVideoStreams)({});return j.length>0?j[0].trackSid:""}return R??""}function me(R,W){ue(W).then(j=>{if(!j)return;let ne=Nr.getMutableOrNull(R);ne?(ne.src=j,ne.volume=W.volume??1,ne.loop=W.loop??!1,ne.playing=!0):(Nr.createOrReplace(R,{src:j,volume:W.volume??1,loop:W.loop??!1,playing:!0}),rc(R,n,mn.getOrNull(R)))})}function Ae(R,W){let j=Nr.getMutableOrNull(R);j&&(j.playing=!1)}function Fe(R,W){let{url:j,volume:ne}=W;Gs.createOrReplace(R,{url:j,playing:!0,volume:ne??1})}function Me(R,W){let j=Gs.getMutableOrNull(R);j&&(j.playing=!1)}function je(R,W){let{text:j,hideAfterSeconds:ne,font:re,fontSize:he,textAlign:Ee}=W;yi(R)&&(Rr.createOrReplace(R,{value:j,font:re,fontSize:he,textAlign:Ee}),ja(R,Le.HIDE_TEXT,ne,()=>Pe(R,{})))}function Pe(R,W){Rr.getOrNull(R)&&Rr.deleteFrom(R)}function D(R,W){return i.getOrNull(R)?.value.find(ne=>ne.name===W)}function A(R,W){let{actions:j,timeout:ne}=W;for(let re of j){let he=D(R,re);he&&ja(R,re,ne,()=>{zr(R).emit(he.name,at(he))})}}function F(R,W){let{action:j}=W;cd(R,j)}function ee(R,W){let{actions:j,interval:ne}=W;for(let re of j){let he=D(R,re);he&&fd(R,re,ne,()=>{zr(R).emit(he.name,at(he))})}}function S(R,W){let{action:j}=W;ld(R,j)}function L(R,W){let{position:j}=W,ne=ed(R,e,m);f(ne),vd(ne);let re=t.getOrCreateMutable(ne);re.position=j,fn(ne).emit(kt.ON_CLONE)}function ce(R,W){ud(R),dd(R),e.removeEntity(R)}function xe(R){let W=`${R.alignItems},${R.justifyContent}`;return fc.has(W)||fc.set(W,e.addEntity()),fc.get(W)}function X(R,W){let{src:j,text:ne,hideAfterSeconds:re,fontSize:he,align:Ee,height:Te,width:Ne}=W;yi(e.RootEntity);let ke=pd(Ee),_e=xe(ke),$e=yi(_e);$e.alignItems=ke.alignItems,$e.justifyContent=ke.justifyContent,$e.positionType=1;let qe=e.addEntity(),Ke=yi(qe,Ne,Te,1);Ke.parent=_e,Ke.pointerFilter=1,hd(qe,j),ne&&md(qe,ne,he,Ne),ci.onPointerDown({entity:qe,opts:{button:0,hoverText:"Click"}},()=>{lc.set(R,qe),fn(R).emit(kt.ON_CLICK_IMAGE)}),re&&ja(R,Le.HIDE_IMAGE,re,()=>C(R,{imageEntity:qe}))}function C(R,W){let{imageEntity:j}=W;if(j)e.removeEntity(j);else{let ne=lc.get(R);ne&&(e.removeEntity(ne),lc.delete(R))}}}function wd(e,n,s){let t=e,a=n,r=s;try{td(t),t.addSystem(Td(t,r)),t.addSystem(xd(t,a)),t.addSystem(sd()),nd(t,r)}catch(c){console.error(`Error initializing Asset Packs: ${c.message}`)}}var dc=require("~system/RestrictedActions");var Sd=["dance","disco","robot","hammer","tik"],Xa=0,xi=!1;function _d(e,n){let s=Se.addEntity();We.create(s,{position:e,scale:n}),Yn.setBox(s),za.create(s,{visible:!1}),Dr.addTrigger(s,1,1,[{type:"box",scale:n,position:J.create(0,0,0)}],function(t){xi||(xi=!0,Xa=0,Ad(),console.log("dancing"))},function(t){xi&&(xi=!1,console.log("noDance"))})}async function Ad(){if(xi){let e=Sd[Xa];await(0,dc.triggerEmote)({predefinedEmote:e}),Xa=(Xa+1)%Sd.length,vi.setTimeout(()=>{Ad()},3e3)}}wd(Se,ci,{Animator:Fl,AudioSource:Hs,AvatarAttach:wl,Transform:We,VisibilityComponent:za,GltfContainer:Ar,Material:void 0,VideoPlayer:void 0});function Za(){Vl(),jl(),Jn(J.create(48,5,7)),Jn(J.create(62,5,27)),Jn(J.create(69,5,54)),Jn(J.create(67,5,75)),Jn(J.create(14,5,41)),Jn(J.create(16,5,47)),Jn(J.create(16,5,82)),Jn(J.create(8.5,5,4)),Se.addSystem(Wl),Se.addSystem(Xl),Se.addSystem($l);let e=Se.addEntity();We.create(e,{position:J.create(40,.01,48)}),Ar.create(e,{src:"models/new_2023C.glb"});let n=Se.addEntity();We.create(n,{position:J.create(40,.01,48)}),Ar.create(n,{src:"models/new_2023D.glb"});let s=Se.addEntity();We.create(s,{position:J.create(45,2.5,78.9),rotation:He.fromEulerDegrees(0,-82.9,0),scale:J.create(3.75,3.75,3.75)}),xt.create(s,{urn:"urn:decentraland:ethereum:erc721:0x10daa9f4c0f985430fde4959adb2c791ef2ccf83:10004"});let t=Se.addEntity();We.create(t,{position:J.create(43,2.5,71.5),rotation:He.fromEulerDegrees(0,-82.9,0),scale:J.create(3.75,3.75,3.75)}),xt.create(t,{urn:"urn:decentraland:ethereum:erc721:0x10daa9f4c0f985430fde4959adb2c791ef2ccf83:2"});let a=Se.addEntity();We.create(a,{position:J.create(38.5,2.5,64),rotation:He.fromEulerDegrees(0,-45,0),scale:J.create(3.75,3.75,3.75)}),xt.create(a,{urn:"urn:decentraland:ethereum:erc721:0x10daa9f4c0f985430fde4959adb2c791ef2ccf83:1"});let r=Se.addEntity();We.create(r,{position:J.create(32.5,2.5,59),rotation:He.fromEulerDegrees(0,-40,0),scale:J.create(3.75,3.75,3.75)}),xt.create(r,{urn:"urn:decentraland:ethereum:erc721:0x096de8baf03ed34790b4ce3c595b767cff517b6f:14"});let c=Se.addEntity();We.create(c,{position:J.create(26.5,2.5,54),rotation:He.fromEulerDegrees(0,-40,0),scale:J.create(3.75,3.75,3.75)}),xt.create(c,{urn:"urn:decentraland:ethereum:erc721:0xb662f710ef01fc47e7c047fe85d309033e080f41:11"});let o=Se.addEntity();We.create(o,{position:J.create(24,2.5,47.5),rotation:He.fromEulerDegrees(0,-78,0),scale:J.create(3.75,3.75,3.75)}),xt.create(o,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:3689"});let i=Se.addEntity();We.create(i,{position:J.create(23,2.5,38.5),rotation:He.fromEulerDegrees(0,-78,0),scale:J.create(3.75,3.75,3.75)}),xt.create(i,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:1510"});let u=Se.addEntity();We.create(u,{position:J.create(22,2.5,31),rotation:He.fromEulerDegrees(0,-78,0),scale:J.create(3.75,3.75,3.75)}),xt.create(u,{urn:"urn:decentraland:ethereum:erc721:0xb662f710ef01fc47e7c047fe85d309033e080f41:18"});let h=Se.addEntity();We.create(h,{position:J.create(57.5,2.5,75.5),rotation:He.fromEulerDegrees(0,110,0),scale:J.create(3.75,3.75,3.75)}),xt.create(h,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:1008"});let m=Se.addEntity();We.create(m,{position:J.create(54.5,2.5,67),rotation:He.fromEulerDegrees(0,110,0),scale:J.create(3.75,3.75,3.75)}),xt.create(m,{urn:"urn:decentraland:ethereum:erc721:0x3fd36d72f05fb1af76ee7ce9257ca850faba91ed:1007"});let f=Se.addEntity();We.create(f,{position:J.create(51,2.5,58),rotation:He.fromEulerDegrees(0,145,0),scale:J.create(3.75,3.75,3.75)}),xt.create(f,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000723"});let y=Se.addEntity();We.create(y,{position:J.create(43.5,2.5,54),rotation:He.fromEulerDegrees(0,145,0),scale:J.create(3.75,3.75,3.75)}),xt.create(y,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000055"});let l=Se.addEntity();We.create(l,{position:J.create(36,2.5,50),rotation:He.fromEulerDegrees(0,145,0),scale:J.create(3.75,3.75,3.75)}),xt.create(l,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000719"});let d=Se.addEntity();We.create(d,{position:J.create(29,2.5,42.5),rotation:He.fromEulerDegrees(0,101,0),scale:J.create(3.75,3.75,3.75)}),xt.create(d,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000100"});let v=Se.addEntity();We.create(v,{position:J.create(26,2.5,32.5),rotation:He.fromEulerDegrees(0,101,0),scale:J.create(3.75,3.75,3.75)}),xt.create(v,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000101"});let p=Se.addEntity();We.create(p,{position:J.create(27,2.5,25.5),rotation:He.fromEulerDegrees(0,65,0),scale:J.create(3.75,3.75,3.75)}),xt.create(p,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000112"});let x=Se.addEntity();We.create(x,{position:J.create(30.5,2.5,18.5),rotation:He.fromEulerDegrees(0,65,0),scale:J.create(2.7,2.7,2.7)}),xt.create(x,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000110"});let b=Se.addEntity();We.create(b,{position:J.create(20,4,39),rotation:He.fromEulerDegrees(0,-80,0),scale:J.create(3.5,3.5,3.5)}),xt.create(b,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000117"});let O=Se.addEntity();We.create(O,{position:J.create(21,4,47),rotation:He.fromEulerDegrees(0,-80,0),scale:J.create(3.5,3.5,3.5)}),xt.create(O,{urn:"urn:decentraland:ethereum:erc721:0xa7d8d9ef8d8ce8992df33d8b8cf4aebabd5bd270:216000121"});let N=Se.addEntity();We.create(N,{position:J.create(22.5,4.4,55),rotation:He.fromEulerDegrees(0,-45,0),scale:J.create(3.5,3.5,3.5)}),xt.create(N,{urn:"urn:decentraland:ethereum:erc721:0xb662f710ef01fc47e7c047fe85d309033e080f41:1"});let _=Se.addEntity();We.create(_,{position:J.create(28.5,4.4,60),rotation:He.fromEulerDegrees(0,-45,0),scale:J.create(3.5,3.5,3.5)}),xt.create(_,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:1"});let P=Se.addEntity();We.create(P,{position:J.create(35,4.4,65.5),rotation:He.fromEulerDegrees(0,-45,0),scale:J.create(3.5,3.5,3.5)}),xt.create(P,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:2"});let M=Se.addEntity();We.create(M,{position:J.create(39,4.4,71),rotation:He.fromEulerDegrees(0,-72,0),scale:J.create(3.5,3.5,3.5)}),xt.create(M,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:3"});let q=Se.addEntity();We.create(q,{position:J.create(42.5,5,39.5),rotation:He.fromEulerDegrees(0,110,0),scale:J.create(3.75,3.75,3.75)}),xt.create(q,{urn:"urn:decentraland:ethereum:erc721:0x4c7895f454173e976004bda6db1a379a15ebf49e:5"});let Q=Se.addEntity();We.create(Q,{position:J.create(40,5,34.5),rotation:He.fromEulerDegrees(0,-115,0),scale:J.create(3.75,3.75,3.75)}),xt.create(Q,{urn:"urn:decentraland:ethereum:erc721:0xc9a16e8d9e41eaa51e200d9e24d9be81a05fba06:21"});let w=Se.addEntity();We.create(w,{position:J.create(40.5,5,42),rotation:He.fromEulerDegrees(0,-10,0),scale:J.create(3.75,3.75,3.75)}),xt.create(w,{urn:"urn:decentraland:ethereum:erc721:0xc9a16e8d9e41eaa51e200d9e24d9be81a05fba06:18"}),_d(J.create(12.5,1,68),J.create(23,1,19));let k=Se.addEntity();Yn.setPlane(k),We.create(k,{position:{x:6,y:6,z:66},scale:J.create(11,7,11),rotation:He.fromEulerDegrees(0,-90,0)}),Nr.create(k,{src:"https://bafybeieb7wfh46yjzpbdwdqnbx4kiviiub4kihibcdhjt5td4gs5txglwi.ipfs.w3s.link/ipfs/bafybeieb7wfh46yjzpbdwdqnbx4kiviiub4kihibcdhjt5td4gs5txglwi/C1%20(1)%20(1).mp4",playing:!0});let V=mn.Texture.Video({videoPlayerEntity:k});mn.setPbrMaterial(k,{texture:V,roughness:1,specularIntensity:0,metallic:0})}var Vr=require("~system/EngineApi");function Rd(e){async function n(t){let a=await e.crdtSendToRenderer({data:new Uint8Array(t)});if(a&&a.data&&a.data.length&&s.onmessage)for(let r of a.data)s.onmessage(r)}let s={async send(t){try{await n(t)}catch(a){console.error(a);debugger}},filter(t){return t.componentId>Ls?!1:!!t}};return s}var pc=class{constructor(n,s=!1,t,a){this.initalize(n,s,t,a)}initalize(n,s=!1,t,a){return this.mask=n,this.skipNextObservers=s,this.target=t,this.currentTarget=a,this}},hc=class{constructor(n,s,t=null){this.callback=n,this.mask=s,this.scope=t,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1}},xn=class e{constructor(n){this._observers=new Array,this._onObserverAdded=null,this._eventState=new pc(0),n&&(this._onObserverAdded=n)}add(n,s=-1,t=!1,a=null,r=!1){if(!n)return null;let c=new hc(n,s,a);return c.unregisterOnNextCall=r,t?this._observers.unshift(c):this._observers.push(c),this._onObserverAdded&&this._onObserverAdded(c),c}addOnce(n){return this.add(n,void 0,void 0,void 0,!0)}remove(n){return n&&this._observers.indexOf(n)!==-1?(this._deferUnregister(n),!0):!1}removeCallback(n,s){for(let t=0;t<this._observers.length;t++)if(this._observers[t].callback===n&&(!s||s===this._observers[t].scope))return this._deferUnregister(this._observers[t]),!0;return!1}notifyObservers(n,s=-1,t,a){if(!this._observers.length)return!0;let r=this._eventState;r.mask=s,r.target=t,r.currentTarget=a,r.skipNextObservers=!1,r.lastReturnValue=n;for(let c of this._observers)if(!c._willBeUnregistered&&(c.mask&s&&(c.scope?r.lastReturnValue=c.callback.apply(c.scope,[n,r]):r.lastReturnValue=c.callback(n,r),c.unregisterOnNextCall&&this._deferUnregister(c)),r.skipNextObservers))return!1;return!0}notifyObserversWithPromise(n,s=-1,t,a){let r=Promise.resolve(n);if(!this._observers.length)return r;let c=this._eventState;return c.mask=s,c.target=t,c.currentTarget=a,c.skipNextObservers=!1,this._observers.forEach(o=>{c.skipNextObservers||o._willBeUnregistered||o.mask&s&&(o.scope?r=r.then(i=>(c.lastReturnValue=i,o.callback.apply(o.scope,[n,c]))):r=r.then(i=>(c.lastReturnValue=i,o.callback(n,c))),o.unregisterOnNextCall&&this._deferUnregister(o))}),r.then(()=>n)}notifyObserver(n,s,t=-1){let a=this._eventState;a.mask=t,a.skipNextObservers=!1,n.callback(s,a)}hasObservers(){return this._observers.length>0}clear(){this._observers=new Array,this._onObserverAdded=null}clone(){let n=new e;return n._observers=this._observers.slice(0),n}hasSpecificMask(n=-1){for(let s of this._observers)if(s.mask&n||s.mask===n)return!0;return!1}_deferUnregister(n){n.unregisterOnNextCall=!1,n._willBeUnregistered=!0,Promise.resolve().then.bind(Promise.resolve())(async()=>this._remove(n)).catch(console.error)}_remove(n){if(!n)return!1;let s=this._observers.indexOf(n);return s!==-1?(this._observers.splice(s,1),!0):!1}};var Nd=require("~system/EngineApi"),Um=Nd.subscribe;function Un(e){return()=>{Um({eventId:e}).catch(console.error)}}var Dm=new xn(Un("onEnterScene"));var Vm=new xn(Un("onLeaveScene"));var Wm=new xn(Un("sceneStart")),qm=new xn(Un("playerExpression")),Hm=new xn(Un("videoEvent")),Gm=new xn(Un("profileChanged")),Ym=new xn(Un("playerConnected")),jm=new xn(Un("playerDisconnected")),$m=new xn(Un("onRealmChanged")),Xm=new xn(Un("playerClicked")),Zm=new xn(Un("comms"));async function Cd(e){let{events:n}=await e({actions:[]});for(let s of n)if(s.generic){let t=JSON.parse(s.generic.eventData);switch(s.generic.eventId){case"onEnterScene":{Dm.notifyObservers(t);break}case"onLeaveScene":{Vm.notifyObservers(t);break}case"sceneStart":{Wm.notifyObservers(t);break}case"playerExpression":{qm.notifyObservers(t);break}case"videoEvent":{let a=t;Hm.notifyObservers(a);break}case"profileChanged":{Gm.notifyObservers(t);break}case"playerConnected":{Ym.notifyObservers(t);break}case"playerDisconnected":{jm.notifyObservers(t);break}case"onRealmChanged":{$m.notifyObservers(t);break}case"playerClicked":{Xm.notifyObservers(t);break}case"comms":{Zm.notifyObservers(t);break}}}}var mc={"assetsscenemain.composite":{version:1,components:[{name:"core::Transform",jsonSchema:{type:"object",properties:{position:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},scale:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},rotation:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"},w:{type:"number"}}},parent:{type:"integer"}},serializationType:"transform"},data:{512:{json:{position:{x:8,y:1,z:8},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1},parent:0}}}},{name:"core::MeshRenderer",jsonSchema:{type:"object",properties:{},serializationType:"protocol-buffer",protocolBuffer:"PBMeshRenderer"},data:{512:{json:{mesh:{$case:"box",box:{uvs:[]}}}}}},{name:"core-schema::Name",jsonSchema:{type:"object",properties:{value:{type:"string",serializationType:"utf8-string"}},serializationType:"map"},data:{512:{json:{value:"Magic Cube"}}}},{name:"inspector::Scene",jsonSchema:{type:"object",properties:{layout:{type:"object",properties:{base:{type:"object",properties:{x:{type:"integer",serializationType:"int32"},y:{type:"integer",serializationType:"int32"}},serializationType:"map"},parcels:{type:"array",items:{type:"object",properties:{x:{type:"integer",serializationType:"int32"},y:{type:"integer",serializationType:"int32"}},serializationType:"map"},serializationType:"array"}},serializationType:"map"}},serializationType:"map"},data:{0:{json:{layout:{base:{x:0,y:0},parcels:[{x:0,y:0}]}}}}},{name:"inspector::Nodes",jsonSchema:{type:"object",properties:{value:{type:"array",items:{type:"object",properties:{entity:{type:"integer",serializationType:"entity"},open:{type:"boolean",serializationType:"optional",optionalJsonSchema:{type:"boolean",serializationType:"boolean"}},children:{type:"array",items:{type:"integer",serializationType:"entity"},serializationType:"array"}},serializationType:"map"},serializationType:"array"}},serializationType:"map"},data:{0:{json:{value:[{entity:512,children:[513],open:!0},{entity:513,children:[]}]}}}},{name:"cube-id",jsonSchema:{type:"object",properties:{},serializationType:"map"},data:{512:{json:{}}}}]}};var Qa=[],yc={getCompositeOrNull(e,n){let s=mc[e];if(s){try{if(s instanceof Uint8Array){let t=mo.fromBinary(s);Qa.push({src:e,composite:t})}else if(typeof s=="string"){let t=mo.fromJson(JSON.parse(s));Qa.push({src:e,composite:t})}else if(typeof s=="object"){let t=mo.fromJson(s);Qa.push({src:e,composite:t})}}catch(t){console.error(t)}delete mc[e]}return Qa.find(t=>t.src===e)||null}};var Ja=Rd({crdtSendToRenderer:Vr.crdtSendToRenderer});Se.addTransport(Ja);async function Qm(e){Se.seal(),await Se.update(e),await Cd(Vr.sendBatch)}async function Jm(){let e=await(0,Vr.crdtGetState)({data:new Uint8Array});if(!e.hasEntities){let n=yc.getCompositeOrNull("main.composite");if(n)try{mo.instance(Se,n,yc)}catch(s){console.log("Warning: main.composite couldn't be instanced."),console.error(s)}}if(Ja.onmessage&&e&&e.data&&e.data.length)for(let n of e.data)Ja.onmessage(n)}if(Za!==void 0){let e=function(){let n=Za();n&&typeof n=="object"&&typeof n.then=="function"&&n.catch(console.error),Se.removeSystem(e)};Se.addSystem(e,1/0)}
/*! Bundled license information:

long/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
